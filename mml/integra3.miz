:: Darboux's Theorem
::  by Noboru Endou , Katsumi Wasaki and Yasunari Shidama
::
:: Received December 7, 1999
:: Copyright (c) 1999 Association of Mizar Users

environ

 vocabularies FINSEQ_1, ARYTM_1, INTEGRA1, MEASURE5, RELAT_1, ORDINAL2, BOOLE,
      FUNCT_1, CARD_1, FUNCT_3, SQUARE_1, ABSVALUE, RFUNCT_1, RLVECT_1, SEQ_2,
      LATTICES, JORDAN3, RCOMP_1, PARTFUN1, RFINSEQ, INTEGRA2, FDIFF_1, SEQ_1,
      ARYTM_3, PROB_1, FINSEQ_4, ARYTM, NAT_1;
 notations TARSKI, XBOOLE_0, SUBSET_1, ORDINAL1, NUMBERS, XCMPLX_0, XXREAL_0,
      XREAL_0, COMPLEX1, REAL_1, NAT_1, RELAT_1, FUNCT_1, FUNCT_2, SEQ_4,
      PARTFUN1, PSCOMP_1, FINSEQ_1, RFUNCT_1, RVSUM_1, INTEGRA1, SEQ_1, SEQ_2,
      JORDAN3, PRE_CIRC, RCOMP_1, FDIFF_1, GOBOARD1, CARD_1, SQUARE_1,
      FINSEQ_4, RFINSEQ, BINARITH, INTEGRA2;
 constructors PARTFUN1, REAL_1, SQUARE_1, NAT_1, COMPLEX1, FINSEQ_4, FINSOP_1,
      RFUNCT_1, FDIFF_1, RFINSEQ, BINARITH, PRE_CIRC, PSCOMP_1, JORDAN3,
      INTEGRA2;
 registrations XBOOLE_0, RELAT_1, ORDINAL1, NUMBERS, XXREAL_0, XREAL_0, NAT_1,
      MEMBERED, FINSEQ_1, SEQ_1, GOBOARD1, INTEGRA1, INTEGRA2;
 requirements REAL, NUMERALS, BOOLE, SUBSET, ARITHM;
 definitions TARSKI, RVSUM_1;
 theorems REAL_1, SEQ_4, SUBSET_1, REAL_2, PARTFUN1, INTEGRA1, RFUNCT_1,
      FUNCT_1, FINSEQ_1, RVSUM_1, SEQ_1, SEQ_2, FDIFF_1, ABSVALUE, PRE_CIRC,
      NAT_1, GOBOARD2, RFINSEQ, TARSKI, GOBOARD1, CARD_1, FINSEQ_5, FINSEQ_3,
      FINSEQ_4, JORDAN7, JORDAN3, BINARITH, INTEGRA2, RELAT_1, XREAL_0,
      FUNCT_2, XBOOLE_0, XBOOLE_1, RCOMP_1, XREAL_1, COMPLEX1, XXREAL_0,
      FINSOP_1, ORDINAL1;
 schemes FINSEQ_2, NAT_1, BINARITH;

begin :: Lemmas of Division

reserve a,b,e,x,y for Real,
        i,j,k,n,m for Element of NAT,
        x1 for set,
        p,q for FinSequence of REAL;

Lm1: a in dom p implies 1<=a & a<=len p
proof
  assume
A1: a in dom p;
  then reconsider a as Element of NAT;
   1<=a & a<=len p by A1,FINSEQ_3:27;
  hence thesis;
end;

Lm2:j-'j+1 = 1
    proof
      j-'j=j-j by BINARITH:50 .= 0;
     hence thesis;
    end;

Lm3:for n st 1 <= n & n <= 2 holds n = 1 or n = 2
    proof
     let n; assume A1:1<=n & n<=2;
     per cases by A1,REAL_1:def 5;
      suppose n=1;
      hence thesis;
      end;
      suppose n>1;
      then n >= 1+1 by NAT_1:13;
      hence thesis by A1,XXREAL_0:1;
    end;
    end;

theorem Th1:for A be closed-interval Subset of REAL, D be Element of divs A
st vol(A) <> 0 holds ex i st i in dom D & vol(divset(D,i)) > 0
proof
   let A be closed-interval Subset of REAL;
   let D be Element of divs A;
   assume A1:vol(A) <>0;
   assume A2:for i st i in dom D holds vol(divset(D,i))<=0;
A3:i in dom D implies vol(divset(D,i))=0
   proof
    assume i in dom D;
then vol(divset(D,i)) <= 0 by A2;
    hence thesis by INTEGRA1:11;
   end;
A4:i in dom D implies sup divset(D,i)=inf divset(D,i)
   proof
    assume i in dom D;
    then vol(divset(D,i))=0 by A3;
    then sup divset(D,i)-inf divset(D,i)=0 by INTEGRA1:def 6;
    hence thesis;
   end;
A5:len D in dom D by FINSEQ_5:6;
       len D = 1
   proof
    assume A6:len D <> 1;
then A7:inf divset(D,len D)=D.(len D-1) & sup divset(D,len D)=D.(len D)
    by A5,INTEGRA1:def 5;
A8: len D-1 in dom D & len D-1 in NAT by A5,A6,INTEGRA1:9;
        len D < len D+1 by NAT_1:13;
    then len D-1 < len D by XREAL_1:21;
    then inf divset(D,len D)<sup divset(D,len D) by A5,A7,A8,GOBOARD1:def 1;
    hence contradiction by A4,A5;
   end;
   then inf divset(D,len D)=inf A & sup divset(D,len D)=D.(len D)
   by A5,INTEGRA1:def 5;
   then inf divset(D,len D)=inf A & sup divset(D,len D)=sup A
   by INTEGRA1:def 2;
   then sup A = inf A+0 by A4,A5;
   then sup A- inf A = 0;
   hence contradiction by A1,INTEGRA1:def 6;
end;

theorem Th2: for A be closed-interval Subset of REAL,
D be Element of divs A st x in A holds
ex j st j in dom D & x in divset(D,j)
proof
   let A be closed-interval Subset of REAL;
   let D be Element of divs A;
   assume x in A;
then A1:inf A <= x & x <= sup A by INTEGRA2:1;
       rng D <> {};
then A2:1 in dom D by FINSEQ_3:34;
   per cases;
    suppose x in rng D;
    then consider j such that
A3: j in dom D & D.j = x by PARTFUN1:26;
        x in divset(D,j)
    proof
     per cases;
      suppose j=1;
then A4:   inf divset(D,j)=inf A & sup divset(D,j)=D.j by A3,INTEGRA1:def 5;
      consider a,b such that
A5:  a <= b & a=inf divset(D,j) & b=sup divset(D,j) by INTEGRA1:4;
      thus thesis by A3,A4,A5,INTEGRA2:1;
      end;
      suppose j<>1;
then A6:  sup divset(D,j)=D.j by A3,INTEGRA1:def 5;
      consider a,b such that
A7:  a <= b & a=inf divset(D,j) & b=sup divset(D,j) by INTEGRA1:4;
      thus thesis by A3,A6,A7,INTEGRA2:1;
    end;
    end;
    hence thesis by A3;
    end;
    suppose A8:not x in rng D;
    defpred MIN[Element of NAT] means x < sup divset(D,$1) & $1 in dom D;
    defpred MAX[Element of NAT] means x >= inf divset(D,$1) & $1 in dom D;
A9:len D in dom D by FINSEQ_5:6;
        sup divset(D,len D)=D.(len D)
     proof
      per cases;
       suppose len D=1;
       hence thesis by A9,INTEGRA1:def 5;
       end;
       suppose len D<>1;
       hence thesis by A9,INTEGRA1:def 5;
     end;
     end;
then A10: sup divset(D,len D) = sup A by INTEGRA1:def 2;
     x < sup divset(D,len D)
    proof
      x <> sup A
     proof
      assume x = sup A;
      then x = D.(len D) by INTEGRA1:def 2;
      hence contradiction by A8,A9,FUNCT_1:def 5;
     end;
     hence thesis by A1,A10,REAL_1:def 5;
    end;
then A11: ex k st MIN[k] by A9;
    consider k such that
A12:MIN[k] & for n st MIN[n] holds k <= n from NAT_1:sch 5(A11);
        inf divset(D,1)=inf A by A2,INTEGRA1:def 5;
then A13: ex k st MAX[k] by A1,A2;
A14: for k holds MAX[k] implies k <= len D by FINSEQ_3:27;
    consider j such that
A15:MAX[j] & for n st MAX[n] holds n <= j from NAT_1:sch 6(A14,A13);
     k=j
    proof
     assume A16:k<>j;
     per cases by A16,XXREAL_0:1;
      suppose A17:k < j;
A18:  1 <= k & k <= len D by A12,FINSEQ_3:27;
then A19:  j-1 in dom D & j-1 in NAT by A15,A17,INTEGRA1:9;
A20:   sup divset(D,k)=D.k
      proof
       per cases;
        suppose k=1;
        hence thesis by A12,INTEGRA1:def 5;
        end;
        suppose k<>1;
        hence thesis by A12,INTEGRA1:def 5;
      end;
      end;
       D.(j-1) <= x by A15,A17,A18,INTEGRA1:def 5;
      then D.(j-1) < D.k by A12,A20,XXREAL_0:2;
      then j-1 < k by A12,A19,GOBOARD2:18;
      then j < k+1 by XREAL_1:21;
      hence contradiction by A17,NAT_1:13;
      end;
      suppose A21:k > j;
       x < sup divset(D,j)
      proof
       assume A22:x >= sup divset(D,j);
A23:    sup divset(D,j)=D.j
       proof
        per cases;
         suppose j=1;
         hence thesis by A15,INTEGRA1:def 5;
         end;
         suppose j<>1;
         hence thesis by A15,INTEGRA1:def 5;
       end;
       end;
A24:   j+1 in dom D & j+1 > 1
       proof
A25:    1 <= j & k <= len D by A12,A15,FINSEQ_3:27;
         j < j+1 & j+1 <= k by A21,NAT_1:13;
        then 1 <= j+1 & j+1 <= len D by A25,XXREAL_0:2;
        hence j+1 in dom D by FINSEQ_3:27;
        thus thesis by A25,NAT_1:13;
       end;
       then inf divset(D,j+1) = D.(j+1-1) by INTEGRA1:def 5 .=D.j;
       then j+1 <= j by A15,A22,A23,A24;
       hence contradiction by NAT_1:13;
      end;
      hence contradiction by A12,A15,A21;
     end;
    end;
    then x in divset(D,k) & k in dom D by A12,A15,INTEGRA2:1;
    hence thesis;
end;
end;

theorem Th3:
  for A be closed-interval Subset of REAL,
      D1,D2 be Element of divs A holds
  ex D be Element of divs A st D1 <= D & D2 <= D & rng D = rng D1 \/ rng D2
proof
   let A be closed-interval Subset of REAL;
   let D1,D2 be Element of divs A;
   consider D being FinSequence of REAL such that
A1:rng D = rng(D1^D2) & len D = card rng(D1^D2) & D is increasing
   by GOBOARD2:21;
   reconsider D as increasing FinSequence of REAL by A1;
   reconsider D as non empty increasing FinSequence of REAL by A1,FINSEQ_1:27
;
A2:rng(D1^D2) = rng D1 \/ rng D2 by FINSEQ_1:44;
       rng D1 c= A & rng D2 c= A by INTEGRA1:def 2;
then A3:rng D c= A by A1,A2,XBOOLE_1:8;
A4:rng D1 c= rng(D1^D2) by A2,XBOOLE_1:7;
A5:rng D2 c= rng(D1^D2) by A2,XBOOLE_1:7;
    D.len D = sup A
   proof
    assume A6:D.len D <> sup A;
A7: len D in dom D by FINSEQ_5:6;
    then D.len D in rng D by FUNCT_1:def 5;
    then D.len D <= sup A by A3,INTEGRA2:1;
then A8: D.len D < sup A by A6,REAL_1:def 5;
A9: D1.len D1 = sup A by INTEGRA1:def 2;
     len D1 in dom D1 by FINSEQ_5:6;
    then D1.len D1 in rng D1 by FUNCT_1:def 5;
    then consider k such that
A10: k in dom D & D1.len D1=D.k by A1,A4,PARTFUN1:26;
        k > len D by A7,A8,A9,A10,GOBOARD2:18;
    hence contradiction by A10,FINSEQ_3:27;
   end;
   then D is DivisionPoint of A by A3,INTEGRA1:def 2;
   then reconsider D as Element of divs A by INTEGRA1:def 3;
   take D;
A11:card rng D1 <= len D by A1,A4,CARD_1:80;
     D1 is one-to-one by JORDAN7:17;
    then len D1 <= len D by A11,FINSEQ_4:77;
    hence D1 <= D by A1,A4,INTEGRA1:def 20;
A12:card rng D2 <= len D by A1,A5,CARD_1:80;
     D2 is one-to-one by JORDAN7:17;
    then len D2 <= len D by A12,FINSEQ_4:77;
    hence D2 <= D by A1,A5,INTEGRA1:def 20;
    thus thesis by A1,FINSEQ_1:44;
end;

theorem Th4:for A be closed-interval Subset of REAL,
D,D1 be Element of divs A
st delta(D1)<min rng upper_volume(chi(A,A),D)
holds (for x,y,i st i in dom D1 & x in rng D /\ divset(D1,i)
& y in rng D /\ divset(D1,i) holds x=y)
proof
   let A be closed-interval Subset of REAL;
   let D,D1 be Element of divs A;
   assume A1:delta(D1)<min rng upper_volume(chi(A,A),D);
    let x,y,i;
    assume A2:i in dom D1;
    assume A3:x in rng D /\ divset(D1,i);
    assume A4:y in rng D /\ divset(D1,i);
     assume A5:x<>y;
      x in rng D by A3,XBOOLE_0:def 3;
     then consider n such that A6:n in dom D & x=D.n by PARTFUN1:26;
      y in rng D by A4,XBOOLE_0:def 3;
     then consider m such that A7:m in dom D & y=D.m by PARTFUN1:26;
A8:abs( D.n-D.m ) >= min rng upper_volume(chi(A,A),D)
    proof
     per cases by A5,A6,A7,XXREAL_0:1;
      suppose n<m;
then A9:   n+1<=m by NAT_1:13;
          n in Seg len D & m in Seg len D by A6,A7,FINSEQ_1:def 3;
then A10:  1<=n & m<=len D by FINSEQ_1:3;
      then 1<=n+1 & n+1<=len D by A9,XXREAL_0:2,NAT_1:12;
then A11:  n+1 in Seg len D by FINSEQ_1:3;
then A12:  n+1 in dom D by FINSEQ_1:def 3;
          -abs( D.n-D.m ) <= D.n-D.m by ABSVALUE:11;
then A13:  abs( D.n-D.m ) >= -(D.n-D.m) by REAL_2:110;
          D.m>=D.(n+1) by A7,A9,A12,GOBOARD2:18;
      then D.n-D.m <= D.n-D.(n+1) by REAL_2:106;
      then A14: -(D.n-D.m) >= -(D.n-D.(n+1)) by XREAL_1:26;
A15:  D.(n+1)-D.n=(upper_volume(chi(A,A),D)).(n+1)
      proof
        n+1 <> 1 by A10,NAT_1:13;
then inf divset(D,n+1)=D.((n+1)-1)
       & sup divset(D,n+1)=D.(n+1) by A12,INTEGRA1:def 5;
       then vol(divset(D,n+1))=D.(n+1)-D.n by INTEGRA1:def 6;
       hence thesis by A11,INTEGRA1:22;
      end;
       n+1 in Seg len upper_volume(chi(A,A),D) by A11,INTEGRA1:def 7;
      then n+1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
      then (upper_volume(chi(A,A),D)).(n+1) in rng upper_volume(chi(A,A),D)
      by FUNCT_1:def 5;
      then D.(n+1)-D.n>=min rng upper_volume(chi(A,A),D) by A15,PRE_CIRC:def 4
;
      then -(D.n-D.m) >= min rng upper_volume(chi(A,A),D) by A14,XXREAL_0:2;
      hence thesis by A13,XXREAL_0:2;
      end;
      suppose n>m;
then A16:  m+1<=n by NAT_1:13;
          n in Seg len D & m in Seg len D by A6,A7,FINSEQ_1:def 3;
then A17:  1<=m & n<=len D by FINSEQ_1:3;
then A18:  1<=m+1 & m+1<=len D by A16,XXREAL_0:2,NAT_1:12;
then A19:  m+1 in Seg len D by FINSEQ_1:3;
A20:  m+1 in dom D by A18,FINSEQ_3:27;
A21:  abs( D.n-D.m ) >= D.n-D.m by ABSVALUE:11;
          D.(m+1)<=D.n by A6,A16,A20,GOBOARD2:18;
then A22:  D.n-D.m >= D.(m+1)-D.m by XREAL_1:11;
A23:  D.(m+1)-D.m=(upper_volume(chi(A,A),D)).(m+1)
      proof
        1 < m+1 by A17,NAT_1:13;
then inf divset(D,m+1)=D.((m+1)-1)
       & sup divset(D,m+1)=D.(m+1) by A20,INTEGRA1:def 5;
       then vol(divset(D,m+1))=D.(m+1)-D.m by INTEGRA1:def 6;
       hence thesis by A19,INTEGRA1:22;
      end;
          m+1 in Seg len upper_volume(chi(A,A),D) by A19,INTEGRA1:def 7;
      then m+1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
      then (upper_volume(chi(A,A),D)).(m+1) in rng upper_volume(chi(A,A),D)
      by FUNCT_1:def 5;
      then D.(m+1)-D.m>=min rng upper_volume(chi(A,A),D) by A23,PRE_CIRC:def 4
;
      then D.n-D.m >= min rng upper_volume(chi(A,A),D) by A22,XXREAL_0:2;
      hence thesis by A21,XXREAL_0:2;
    end;
    end;
     abs (D.n-D.m) <= delta D1
    proof
     per cases by A5,A6,A7,XXREAL_0:1;
      suppose n<m;
      then D.n<D.m by A6,A7,GOBOARD1:def 1;
      then D.n-D.m<0 by REAL_2:105;
then A24:  abs( D.n-D.m )=-(D.n-D.m) by ABSVALUE:def 1 .= D.m-D.n;
          D.n in divset(D1,i) by A3,A6,XBOOLE_0:def 3;
then A25:  D.n >= inf divset(D1,i) by INTEGRA2:1;
          D.m in divset(D1,i) by A4,A7,XBOOLE_0:def 3;
      then D.m <= sup divset(D1,i) by INTEGRA2:1;
then A26:  D.m-inf divset(D1,i)<= sup divset(D1,i)-inf divset(D1,i) by
XREAL_1:11;
          D.m-D.n <= D.m-inf divset(D1,i) by A25,REAL_2:106;
      then D.m-D.n <= sup divset(D1,i)-inf divset(D1,i) by A26,XXREAL_0:2;
then A27:  D.m-D.n <= vol(divset(D1,i)) by INTEGRA1:def 6;
A28:  i in Seg len D1 by A2,FINSEQ_1:def 3;
then A29:  D.m-D.n <= upper_volume(chi(A,A),D1).i by A27,INTEGRA1:22;
          i in Seg len upper_volume(chi(A,A),D1) by A28,INTEGRA1:def 7;
      then i in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
      then upper_volume(chi(A,A),D1).i in rng upper_volume(chi(A,A),D1)
      by FUNCT_1:def 5;
      then upper_volume(chi(A,A),D1).i <= max rng upper_volume(chi(A,A),D1)
      by PRE_CIRC:def 1;
      then upper_volume(chi(A,A),D1).i<=delta(D1) by INTEGRA1:def 19;
      hence thesis by A24,A29,XXREAL_0:2;
      end;
      suppose n>m;
      then D.n>D.m by A6,A7,GOBOARD1:def 1;
      then D.n-D.m>0 by XREAL_1:52;
then A30:  abs( D.n-D.m )=D.n-D.m by ABSVALUE:def 1;
          D.m in divset(D1,i) by A4,A7,XBOOLE_0:def 3;
then A31:  D.m >= inf divset(D1,i) by INTEGRA2:1;
          D.n in divset(D1,i) by A3,A6,XBOOLE_0:def 3;
      then D.n <= sup divset(D1,i) by INTEGRA2:1;
then A32:  D.n-inf divset(D1,i)<= sup divset(D1,i)-inf divset(D1,i) by
XREAL_1:11;
       D.n-D.m <= D.n-inf divset(D1,i) by A31,REAL_2:106;
      then D.n-D.m <= sup divset(D1,i)-inf divset(D1,i) by A32,XXREAL_0:2;
then A33:  D.n-D.m <= vol(divset(D1,i)) by INTEGRA1:def 6;
A34:  i in Seg len D1 by A2,FINSEQ_1:def 3;
then A35:  D.n-D.m <= upper_volume(chi(A,A),D1).i by A33,INTEGRA1:22;
       i in Seg len upper_volume(chi(A,A),D1) by A34,INTEGRA1:def 7;
      then i in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
      then upper_volume(chi(A,A),D1).i in rng upper_volume(chi(A,A),D1)
      by FUNCT_1:def 5;
      then upper_volume(chi(A,A),D1).i <= max rng upper_volume(chi(A,A),D1)
      by PRE_CIRC:def 1;
      then upper_volume(chi(A,A),D1).i<=delta(D1) by INTEGRA1:def 19;
      hence thesis by A30,A35,XXREAL_0:2;
    end;
    end;
    hence contradiction by A1,A8,XXREAL_0:2;
end;

theorem Th5:
for p,q st rng p = rng q & p is increasing & q is increasing holds p = q
proof
  let p,q;
  assume A1:rng p = rng q;
  assume A2:p is increasing & q is increasing;
  then p is one-to-one & q is one-to-one by JORDAN7:17;
  then len p = len q by A1,FINSEQ_1:65;
  hence thesis by A1,A2,GOBOARD2:22;
end;

theorem Th6:
for A be closed-interval Subset of REAL, D,D1 be Element of divs A st
D <= D1 & i in dom D & j in dom D & i <= j holds
indx(D1,D,i) <= indx(D1,D,j) & indx(D1,D,i) in dom D1
proof
   let A be closed-interval Subset of REAL;
   let D,D1 be Element of divs A;
   assume A1:D <= D1 & i in dom D & j in dom D & i <= j;
then A2:D.i = D1.indx(D1,D,i) & indx(D1,D,i) in dom D1 by INTEGRA1:def 21;
A3:D.j = D1.indx(D1,D,j) & indx(D1,D,j) in dom D1 by A1,INTEGRA1:def 21;
    D.i <= D.j by A1,GOBOARD2:18;
   hence thesis by A2,A3,GOBOARD1:def 1;
end;

theorem Th7:for A be closed-interval Subset of REAL, D,D1 be Element of divs A
st D <= D1 & i in dom D & j in dom D & i < j holds
indx(D1,D,i) < indx(D1,D,j)
proof
   let A be closed-interval Subset of REAL;
   let D,D1 be Element of divs A;
   assume A1:D <= D1 & i in dom D & j in dom D & i < j;
then A2:D.i = D1.indx(D1,D,i) & indx(D1,D,i) in dom D1 by INTEGRA1:def 21;
A3:D.j = D1.indx(D1,D,j) & indx(D1,D,j) in dom D1 by A1,INTEGRA1:def 21;
       D.i < D.j by A1,GOBOARD1:def 1;
   hence thesis by A2,A3,GOBOARD2:18;
end;

theorem Th8:
  for A be closed-interval Subset of REAL,
      D be Element of divs A holds delta(D) >= 0
proof
   let A be closed-interval Subset of REAL;
   let D be Element of divs A;
   consider y such that
A1:y in rng D by SUBSET_1:10;
   consider n such that
A2:n in dom D & y=D.n by A1,PARTFUN1:26;
A3:n in Seg len D by A2,FINSEQ_1:def 3;
   then vol(divset(D,n))=upper_volume(chi(A,A),D).n by INTEGRA1:22;
then A4:upper_volume(chi(A,A),D).n >= 0 by INTEGRA1:11;
       n in Seg len upper_volume(chi(A,A),D) by A3,INTEGRA1:def 7;
   then n in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
   then upper_volume(chi(A,A),D).n in rng upper_volume(chi(A,A),D)
   by FUNCT_1:def 5;
   then upper_volume(chi(A,A),D).n <= max rng upper_volume(chi(A,A),D)
   by PRE_CIRC:def 1;
   hence thesis by A4,INTEGRA1:def 19;
end;

Lm4:for A be closed-interval Subset of REAL, g be Function of A,REAL st
 g is_bounded_on A holds sup rng g >= inf rng g
proof
  let A be closed-interval Subset of REAL;
  let g be Function of A,REAL;
  assume A1: g is_bounded_on A;
      dom g <> {} by FUNCT_2:def 1;
  then A2: rng g <> {} by RELAT_1:65;
      g is_bounded_below_on A & g is_bounded_above_on A by A1,RFUNCT_1:def 11;
  then rng g is bounded_above & rng g is bounded_below by INTEGRA1:13,
15;
  then rng g is bounded by SEQ_4:def 3;
  hence thesis by A2,SEQ_4:24;
end;

Lm5:for A,B be closed-interval Subset of REAL,
        f be Function of A,REAL st f is_bounded_on A & B c= A holds
   inf rng(f|B) >= inf rng f & inf rng f <= sup rng(f|B) &
   sup rng(f|B) <= sup rng f & inf rng(f|B) <= sup rng f
  proof
     let A,B be closed-interval Subset of REAL,
         f be Function of A,REAL;
     assume A1: f is_bounded_on A & B c= A;
     then f is_bounded_above_on A & f is_bounded_below_on A
       by RFUNCT_1:def 11;
then A2:rng f is bounded_above & rng f is bounded_below by INTEGRA1:13,
15;
     consider x such that
A3:x in B by SUBSET_1:10;
         B c=dom f by A1,FUNCT_2:def 1;
then A4:dom(f|B)=B by RELAT_1:91;
then A5:(f|B).x in rng(f|B) by A3,FUNCT_1:def 5;
A6:rng(f|B) <> {} by A4,RELAT_1:65;
A7:rng(f|B) c= rng f by RELAT_1:99;
then A8:rng(f|B) is bounded_above & rng(f|B) is bounded_below
              by A2,RCOMP_1:3,4;
     thus A9:inf rng(f|B) >= inf rng f by A2,A6,A7,SEQ_4:64;
A10:inf rng(f|B)<=(f|B).x by A5,A8,SEQ_4:def 5;
         sup rng(f|B)>=(f|B).x by A5,A8,SEQ_4:def 4;
then A11:  inf rng(f|B) <= sup rng(f|B) by A10,XXREAL_0:2;
     hence sup rng(f|B) >= inf rng f by A9,XXREAL_0:2;
     thus sup rng(f|B) <= sup rng f by A2,A6,A7,SEQ_4:65;
     hence thesis by A11,XXREAL_0:2;
   end;

Lm6: for A be closed-interval Subset of REAL,
         D1 be Element of divs A st j in dom D1 holds
    vol(divset(D1,j)) <= delta D1
proof
  let A be closed-interval Subset of REAL,
      D1 be Element of divs A;
  assume j in dom D1;
then A1:j in Seg len D1 by FINSEQ_1:def 3;
  then j in Seg len upper_volume(chi(A,A),D1) by INTEGRA1:def 7;
  then j in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
  then upper_volume(chi(A,A),D1).j in rng upper_volume(chi(A,A),D1)
  by FUNCT_1:def 5;
  then upper_volume(chi(A,A),D1).j <= max rng upper_volume(chi(A,A),D1)
  by PRE_CIRC:def 1;
  then vol(divset(D1,j)) <= max rng upper_volume(chi(A,A),D1) by A1,INTEGRA1:
22;
  hence thesis by INTEGRA1:def 19;
end;

Lm7:for A be closed-interval Subset of REAL, j1 be Element of NAT,
          D1,D2 be Element of divs A st
    j1 = len D1 - 1 & x in divset(D1,len D1) & len D1 >= 2 &
    D1 <= D2 & rng D2 = rng D1 \/ {x}
    holds rng (D2|indx(D2,D1,j1)) = rng (D1|j1)
    proof
    let A be closed-interval Subset of REAL, j1 be Element of NAT,
        D1,D2 be Element of divs A;
    assume A1:j1 = len D1 - 1 & x in divset(D1,len D1) & len D1 >= 2;
    assume A2:D1<=D2 & rng D2 = rng D1 \/ {x};
A3: len D1 in dom D1 & len D2 in dom D2 by FINSEQ_5:6;
A4: len D1 <> 1 by A1;
then A5:len D1-1 in NAT & len D1-1 in dom D1 by A3,INTEGRA1:9;
       inf divset(D1,len D1) <= x & x <= sup divset(D1,len D1)
   by A1,INTEGRA2:1;
then A6:D1.j1 <= x & x <= D1.(len D1) by A1,A3,A4,INTEGRA1:def 5;
    A7:indx(D2,D1,j1) in dom D2 by A1,A2,A5,INTEGRA1:def 21;
then A8:  1 <= indx(D2,D1,j1) & indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
    A9:j1 in dom D1 by A1,A3,A4,INTEGRA1:9;
then A10:  1 <= j1 & j1 <= len D1 by FINSEQ_3:27;
         for x1 st x1 in rng(D2|indx(D2,D1,j1)) holds x1 in rng(D1|j1)
     proof
      let x1; assume x1 in rng(D2|indx(D2,D1,j1));
      then consider k such that
A11:  k in dom(D2|indx(D2,D1,j1)) & x1=(D2|indx(D2,D1,j1)).k by PARTFUN1:26;
          k in Seg len(D2|indx(D2,D1,j1)) by A11,FINSEQ_1:def 3;
then A12:  k in Seg indx(D2,D1,j1) by A8,FINSEQ_1:80;
then A13:  (D2|indx(D2,D1,j1)).k = D2.k & k in dom D2 by A7,RFINSEQ:19;
then A14:   D2.k in rng D2 by FUNCT_1:def 5;
          1 <= k & k <= indx(D2,D1,j1) by A12,FINSEQ_1:3;
      then D2.k <= D2.indx(D2,D1,j1) by A7,A13,GOBOARD2:18;
then A15:  D2.k <= D1.j1 by A1,A2,A5,INTEGRA1:def 21;
A16:  len(D1|j1) = j1 by A10,FINSEQ_1:80;
A17:  D2.k in {x} implies D2.k = D1.j1
      proof
       assume D2.k in {x};
       then D1.j1 <= D2.k by A6,TARSKI:def 1;
       hence thesis by A15,XXREAL_0:1;
      end;
A18:  D2.k in {x} implies D2.k in rng(D1|j1)
      proof
       assume A19:D2.k in {x};
           j1 in dom(D1|j1) by A10,A16,FINSEQ_3:27;
then A20:   (D1|j1).j1 in rng(D1|j1) by FUNCT_1:def 5;
           j1 in Seg j1 by A10,FINSEQ_1:3;
       hence thesis by A9,A17,A19,A20,RFINSEQ:19;
      end;
          D2.k in rng D1 implies D2.k in rng(D1|j1)
      proof
       assume D2.k in rng D1;
       then consider m such that
A21:   m in dom D1 & D2.k = D1.m by PARTFUN1:26;
           m in Seg len D1 by A21,FINSEQ_1:def 3;
then A22:   1 <= m & m <= j1 by A9,A15,A21,FINSEQ_1:3,GOBOARD1:def 1;
then A23:   m in dom (D1|j1) by A16,FINSEQ_3:27;
           m in Seg j1 by A22,FINSEQ_1:3;
       then D2.k = (D1|j1).m by A9,A21,RFINSEQ:19;
       hence thesis by A23,FUNCT_1:def 5;
      end;
      hence thesis by A2,A7,A11,A12,A14,A18,RFINSEQ:19,XBOOLE_0:def 2;
     end;
then A24: rng(D2|indx(D2,D1,j1)) c= rng (D1|j1) by TARSKI:def 3;
         for x1 st x1 in rng(D1|j1) holds x1 in rng(D2|indx(D2,D1,j1))
     proof
      let x1; assume x1 in rng(D1|j1);
      then consider k such that
A25:   k in dom(D1|j1) & x1=(D1|j1).k by PARTFUN1:26;
          k in Seg len(D1|j1) by A25,FINSEQ_1:def 3;
then A26:  k in Seg j1 by A10,FINSEQ_1:80;
then A27:  (D1|j1).k = D1.k & k in dom D1 by A9,RFINSEQ:19;
      then D1.k in rng D1 by FUNCT_1:def 5;
      then x1 in rng D2 by A2,A25,A27,XBOOLE_0:def 2;
      then consider n such that
A28:   n in dom D2 & x1=D2.n by PARTFUN1:26;
A29:  indx(D2,D1,k) in dom D2 & D2.indx(D2,D1,k)=D2.n
        by A2,A25,A27,A28,INTEGRA1:def 21;
          k <= j1 by A26,FINSEQ_1:3;
      then D1.k <= D1.j1 by A1,A5,A27,GOBOARD2:18;
      then D2.indx(D2,D1,k) <= D1.j1 by A2,A27,INTEGRA1:def 21;
      then D2.indx(D2,D1,k)<=D2.indx(D2,D1,j1)
      by A1,A2,A5,INTEGRA1:def 21;
then A30:  n <= indx(D2,D1,j1) by A7,A28,A29,GOBOARD1:def 1;
          1 <= n by A28,FINSEQ_3:27;
then A31:  n in Seg indx(D2,D1,j1) by A30,FINSEQ_1:3;
then A32:  D2.n = (D2|indx(D2,D1,j1)).n by A7,RFINSEQ:19;
          n in Seg len(D2|indx(D2,D1,j1)) by A8,A31,FINSEQ_1:80;
      then n in dom(D2|indx(D2,D1,j1)) by FINSEQ_1:def 3;
      hence thesis by A28,A32,FUNCT_1:def 5;
     end;
     then rng(D1|j1) c= rng(D2|indx(D2,D1,j1)) by TARSKI:def 3;
     hence thesis by A24,XBOOLE_0:def 10;
    end;

theorem Th9:
for A be closed-interval Subset of REAL, g be Function of A,REAL,
D1,D2 be Element of divs A st x in divset(D1,len D1) & len D1 >= 2
& D1<=D2 & rng D2 = rng D1 \/ {x} & g is_bounded_on A
holds Sum lower_volume(g,D2)-Sum
lower_volume(g,D1)<=(sup rng g-inf rng g)*delta(D1)
proof
   let A be closed-interval Subset of REAL;
   let g be Function of A,REAL;
   let D1,D2 be Element of divs A;
   assume A1:x in divset(D1,len D1) & len D1 >= 2;
   assume A2:D1<=D2 & rng D2 = rng D1 \/ {x};
   assume A3:g is_bounded_on A;
   deffunc PLg(Element of divs A,Nat) = (PartSums(lower_volume(g,$1))).$2;
   deffunc LVg(Element of divs A) = lower_volume(g,$1);
   set j = len D1;
A4:len D1 <> 0 & len D2 <> 0 by FINSEQ_1:25;
then A5:len D1 in Seg len D1 & len D2 in Seg len D2 by FINSEQ_1:5;
A6:len D1 in dom D1 & len D2 in dom D2 by FINSEQ_5:6;
A7:len D1 <> 1 by A1;
A8:sup rng g >= inf rng g by A3,Lm4;
A9:indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.(len D1)
  by A2,A6,INTEGRA1:def 21;
then A10:indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
  A11: indx(D2,D1,j) >= len lower_volume(g,D2)
  proof
   assume indx(D2,D1,j) < len lower_volume(g,D2);
   then indx(D2,D1,j) < len D2 by INTEGRA1:def 8;
then A12:D1.(len D1) < D2.(len D2) by A6,A9,GOBOARD1:def 1;
A13:not D2.(len D2) in rng D1
   proof
    assume A14:D2.(len D2) in rng D1;
        rng D1 c= A by INTEGRA1:def 2;
    then inf A <= D2.(len D2) & D2.(len D2) <= sup A by A14,INTEGRA2:1;
    hence contradiction by A12,INTEGRA1:def 2;
   end;
       D2.(len D2) in rng D2 by A6,FUNCT_1:def 5;
   then D2.(len D2) in rng D1 or D2.(len D2) in {x} by A2,XBOOLE_0:def 2;
   then D2.(len D2) = x by A13,TARSKI:def 1;
   then D2.(len D2) <= sup divset(D1,len D1) by A1,INTEGRA2:1;
   hence contradiction by A6,A7,A12,INTEGRA1:def 5;
  end;
then A15:indx(D2,D1,j) in Seg len lower_volume(g,D2)
   & indx(D2,D1,j) >= len lower_volume(g,D2) by A10,INTEGRA1:def 8;
A16:j in Seg len lower_volume(g,D1)
   & j >= len lower_volume(g,D1) by A5,INTEGRA1:def 8;
A17:len D1-1 in NAT & len D1-1 in dom D1 by A6,A7,INTEGRA1:9;
   reconsider j1=len D1-1 as Element of NAT by A6,A7,INTEGRA1:9;
A18:indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) & indx(D2,D1,j1) <= len D2
   proof
    thus indx(D2,D1,j1) in dom D2 by A2,A17,INTEGRA1:def 21;
    hence thesis by FINSEQ_3:27;
   end;
   then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
then A19:D2|indx(D2,D1,j1) is increasing by A18,JORDAN3:25;
A20:j1 in dom D1 & 1 <= j1 & j1 <= len D1
   proof
    thus j1 in dom D1 by A6,A7,INTEGRA1:9;
    hence thesis by FINSEQ_3:27;
    end;
    then mid(D1,1,j1) is increasing by INTEGRA1:37;
then A21:D1|j1 is increasing by A20,JORDAN3:25;
A22:rng (D2|indx(D2,D1,j1)) = rng (D1|j1) by A1,A2,Lm7;
then A23:D2|indx(D2,D1,j1)=D1|j1 by A19,A21,Th5;
A24:for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
    proof
     let k; assume A25:1 <= k & k <= j1;
     assume A26:k<>indx(D2,D1,k);
     per cases by A26,XXREAL_0:1;
      suppose A27:k > indx(D2,D1,k);
       1 <= k & k <= len D1 by A20,A25,XXREAL_0:2;
then A28:  k in dom D1 by FINSEQ_3:27;
then A29:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
      by A2,INTEGRA1:def 21;
      then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
then A30:  1<=indx(D2,D1,k)&indx(D2,D1,k)<=indx(D2,D1,j1)
      by A2,A20,A25,A28,Th6,FINSEQ_1:3;
      then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
then A31:   (D2|indx(D2,D1,j1)).indx(D2,D1,k)=D2.indx(D2,D1,k) by A18,
RFINSEQ:19;
A32:  indx(D2,D1,k) < j1 by A25,A27,XXREAL_0:2;
      then indx(D2,D1,k) <= len D1 by A20,XXREAL_0:2;
      then indx(D2,D1,k) in dom D1 by A30,FINSEQ_3:27;
then A33:   D1.k > D1.indx(D2,D1,k) by A27,A28,GOBOARD1:def 1;
          indx(D2,D1,k) in Seg j1 by A30,A32,FINSEQ_1:3;
      hence contradiction by A20,A23,A29,A31,A33,RFINSEQ:19;
      end;
      suppose A34:k < indx(D2,D1,k);
          k in Seg j1 by A25,FINSEQ_1:3;
then A35:  D1.k = (D1|j1).k by A17,RFINSEQ:19;
          1 <= k & k <= len D1 by A20,A25,XXREAL_0:2;
then A36:  k in dom D1 by FINSEQ_3:27;
then A37:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
      by A2,INTEGRA1:def 21;
          indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2 &
      indx(D2,D1,j1) in dom D2 by A2,A20,A25,A36,Th6;
then A38:  k <= indx(D2,D1,j1) by A34,XXREAL_0:2;
      then k <= len D2 by A18,XXREAL_0:2;
      then k in dom D2 by A25,FINSEQ_3:27;
then A39:  D2.k < D2.indx(D2,D1,k) by A34,A37,GOBOARD1:def 1;
          k in Seg indx(D2,D1,j1) by A25,A38,FINSEQ_1:3;
      hence contradiction by A18,A23,A35,A37,A39,RFINSEQ:19;
     end;
    end;
A40:len (D2|indx(D2,D1,j1))=len (D1|j1) by A19,A21,A22,Th5;
        len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A18,FINSEQ_1:80;
then A41:indx(D2,D1,j1) =j1 by A20,A40,FINSEQ_1:80;
        j1 <= len D1 by A17,FINSEQ_3:27;
    then j1 <= len lower_volume(g,D1) by INTEGRA1:def 8;
then A42:len(lower_volume(g,D1)|j1)=indx(D2,D1,j1) by A41,FINSEQ_1:80;
     indx(D2,D1,j1) in dom D2 by A2,A17,INTEGRA1:def 21;
    then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
    then indx(D2,D1,j1) <= len lower_volume(g,D2) by INTEGRA1:def 8;
then A43:len(lower_volume(g,D1)|j1)=len(lower_volume(g,D2)|indx(D2,D1,j1))
    by A42,FINSEQ_1:80;
        for k st 1 <= k & k <= len(lower_volume(g,D1)|j1) holds
    (lower_volume(g,D1)|j1).k = (lower_volume(g,D2)|indx(D2,D1,j1)).k
    proof
    let k; assume A44:1 <= k & k <= len(lower_volume(g,D1)|j1);
A45: len(lower_volume(g,D1)) = len D1 by INTEGRA1:def 8;
then A46:1 <= k & k <= j1 by A20,A44,FINSEQ_1:80;
then A47: k in Seg j1 by FINSEQ_1:3;
        k <= len D1 by A20,A46,XXREAL_0:2;
then A48:k in Seg len D1 by A44,FINSEQ_1:3;
A49:divset(D1,k)=divset(D2,indx(D2,D1,k))
    proof
A50:  divset(D1,k)=[. inf divset(D1,k), sup divset(D1,k) .] by INTEGRA1:5;
A51:  k in dom D1 by A48,FINSEQ_1:def 3;
then A52:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2,
INTEGRA1:def 21;
      inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
     sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
     proof
      per cases;
      suppose A53:k=1;
then A54:  inf divset(D1,k)=inf A & sup divset(D1,k)=D1.k by A51,INTEGRA1:def 5
;
       indx(D2,D1,k)=1 by A20,A24,A53;
      hence thesis by A52,A54,INTEGRA1:def 5;
      end;
      suppose A55:k<>1;
then A56:  inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
      by A51,INTEGRA1:def 5;
A57:  k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT by A51,A55,INTEGRA1:9;
      reconsider k1=k-1 as Element of NAT by A51,A55,INTEGRA1:9;
          k <= k+1 by NAT_1:11;
      then k1 <= k by XREAL_1:22;
then A58:  k1 <= j1 by A46,XXREAL_0:2;
A59:  1 <= k1 by A57,FINSEQ_3:27;
       indx(D2,D1,k)<>1 by A24,A46,A55;
then A60:  inf divset(D2,indx(D2,D1,k))=D2.(indx(D2,D1,k)-1) &
      sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A52,INTEGRA1:def 5;
       D2.(indx(D2,D1,k)-1)=D2.(k-1) by A24,A46
        .= D2.indx(D2,D1,k1) by A24,A58,A59;
      hence thesis by A2,A51,A56,A57,A60,INTEGRA1:def 21;
     end;
     end;
     hence thesis by A50,INTEGRA1:5;
    end;
        j1 in Seg len(lower_volume(g,D1)) by A20,A45,FINSEQ_1:def 3;
    then j1 in dom(lower_volume(g,D1)) by FINSEQ_1:def 3;
then A61: (lower_volume(g,D1)|j1).k = lower_volume(g,D1).k by A47,RFINSEQ:19
    .=(inf(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
     by A48,A49,INTEGRA1:def 8;
        indx(D2,D1,k) in Seg j1 by A24,A46,A47;
then A62:indx(D2,D1,k) in Seg indx(D2,D1,j1) by A20,A24;
    then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;
    then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A18,XXREAL_0:2;
then A63:indx(D2,D1,k) in Seg len D2 by FINSEQ_1:3;
        indx(D2,D1,j1) in Seg len D2 by A18,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len lower_volume(g,D2) by INTEGRA1:def 8;
then A64:indx(D2,D1,j1) in dom lower_volume(g,D2) by FINSEQ_1:def 3;
     (lower_volume(g,D2)|indx(D2,D1,j1)).k
     =(lower_volume(g,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A24,A46
    .=lower_volume(g,D2).indx(D2,D1,k) by A62,A64,RFINSEQ:19
    .=(inf(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
    by A63,INTEGRA1:def 8;
    hence thesis by A61;
   end;
then A65:lower_volume(g,D2)|indx(D2,D1,j1)=lower_volume(g,D1)|j1
   by A43,FINSEQ_1:18;
       indx(D2,D1,j1) in Seg len D2 by A18,FINSEQ_1:def 3;
then A66:indx(D2,D1,j1) in Seg len lower_volume(g,D2) by INTEGRA1:def 8;
       j1 in Seg len D1 by A20,FINSEQ_1:def 3;
then A67:j1 in Seg len lower_volume(g,D1) by INTEGRA1:def 8;
A68:PLg(D2,indx(D2,D1,j1))=Sum(lower_volume(g,D2)|indx(D2,D1,j1))
   by A66,INTEGRA1:def 22
   .=PLg(D1,j1) by A65,A67,INTEGRA1:def 22;
A69:indx(D2,D1,j1)+1 <= indx(D2,D1,len D1)
   proof
     len D1 < len D1+1 by NAT_1:13;
    then j1 < len D1 by XREAL_1:21;
    then indx(D2,D1,j1) < indx(D2,D1,len D1) by A2,A6,A20,Th7;
    hence thesis by NAT_1:13;
   end;
A70:Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,len D1))
   -Sum mid(lower_volume(g,D1),len D1,len D1) <=
   (sup rng g-inf rng g)*delta(D1)
   proof
A71: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len lower_volume(g,D2)
    proof
      indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
     then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
     then indx(D2,D1,j) in Seg len lower_volume(g,D2) by INTEGRA1:def 8;
    hence thesis by FINSEQ_1:3;
    end;
then A72: 1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len lower_volume(g,D2)
    by A18,A69,XXREAL_0:2,NAT_1:13;
A73:indx(D2,D1,j)-indx(D2,D1,j1) <= 2
    proof
     assume A74:indx(D2,D1,j)-indx(D2,D1,j1) > 2;
     set ID1=indx(D2,D1,j1)+1;
     set ID2=ID1+1;
A75:indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
     proof
      thus indx(D2,D1,j1) < ID1 by NAT_1:13;
      thus ID1 < ID2 by NAT_1:13;
          indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A74,XREAL_1:22;
      hence thesis;
     end;
A76:indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
then A77:indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A78:ID1 in dom D2
     proof
A79:    1 <= ID1 & ID1 <= indx(D2,D1,j) by A18,A75,XXREAL_0:2;
      then ID1 <= len D2 by A77,XXREAL_0:2;
      hence thesis by A79,FINSEQ_3:27;
     end;
A80:ID2 in dom D2
     proof
A81:    indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A75,A77,XXREAL_0:2;
      then 1 <= ID2 by A18,XXREAL_0:2;
      hence thesis by A81,FINSEQ_3:27;
     end;
then A82:D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
     by A18,A75,A76,A78,GOBOARD1:def 1;
A83: D2.ID1 in rng D2 & D2.ID2 in rng D2 by A78,A80,FUNCT_1:def 5;
A84: D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
      by A2,A6,A20,INTEGRA1:def 21;
A85:D2.ID1 in {x} & D2.ID2 in {x}
     proof
       not(D2.ID1 in rng D1) & not(D2.ID2 in rng D1)
      proof
       assume A86:D2.ID1 in rng D1 or D2.ID2 in rng D1;
       per cases by A86;
        suppose D2.ID1 in rng D1;
        then consider n such that
A87:   n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
            D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
        by A82,XXREAL_0:2;
        then j1<n & n<j by A6,A20,A84,A87,GOBOARD2:18;
        then j<n+1 & n<j by XREAL_1:21;
        hence contradiction by NAT_1:13;
        end;
        suppose D2.ID2 in rng D1;
        then consider n such that
A88:   n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
         D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
        by A82,XXREAL_0:2;
        then j1<n & n<j by A6,A20,A84,A88,GOBOARD2:18;
        then j<n+1 & n<j by XREAL_1:21;
        hence contradiction by NAT_1:13;
       end;
      end;
      hence thesis by A2,A83,XBOOLE_0:def 2;
     end;
     then D2.ID1 = x by TARSKI:def 1;
     then D2.ID1=D2.ID2 by A85,TARSKI:def 1;
     hence contradiction by A75,A78,A80,GOBOARD2:19;
    end;
    1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
    indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
    proof
A89: indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
     =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A69,BINARITH:50;
      indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
     hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
     thus thesis by A73,A89;
    end;
then A90: 1 <= len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)) &
    len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
    by A69,A71,A72,JORDAN3:27;
A91: 1 <= j & j <= len lower_volume(g,D1) by A5,FINSEQ_1:3,INTEGRA1:def 8;
    j-'j+1 = 1 by Lm2;
then A92: len mid(lower_volume(g,D1),j,j)=1 by A91,JORDAN3:27;
        mid(lower_volume(g,D1),j,j).1 = lower_volume(g,D1).j by A91,JORDAN3:27;
then A93:mid(lower_volume(g,D1),j,j)=<*lower_volume(g,D1).j*> by A92,
FINSEQ_1:57;
         indx(D2,D1,j1)+1 in Seg len lower_volume(g,D2) by A72,FINSEQ_1:3;
then A94:indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 8;
A95:j in Seg len D1 by A4,FINSEQ_1:5;
     now per cases by A90,Lm3;
     suppose
A96: len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A97: indx(D2,D1,j1)+1=indx(D2,D1,j)
     proof
       len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
       = indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 by A69,A71,A72,JORDAN3:27;
      then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A69,A96,BINARITH:50;
      hence thesis;
     end;
A98: divset(D2,indx(D2,D1,j))=divset(D1,j)
     proof
       inf divset(D1,j)=D2.indx(D2,D1,j1)
      & sup divset(D1,j)=D2.indx(D2,D1,j)
      proof
        inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
        by A6,A7,INTEGRA1:def 5;
       hence thesis by A2,A6,A20,INTEGRA1:def 21;
      end;
then A99: divset(D1,j)=[. D2.indx(D2,D1,j1),D2.indx(D2,D1,j).] by INTEGRA1:5;
A100: indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
       indx(D2,D1,j)<>1 by A18,A97,NAT_1:13;
      then inf divset(D2,indx(D2,D1,j))=D2.(indx(D2,D1,j)-1)
      & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
      by A100,INTEGRA1:def 5;
      hence thesis by A97,A99,INTEGRA1:5;
     end;
      mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
      =lower_volume(g,D2).(indx(D2,D1,j1)+1) by A71,A72,JORDAN3:27;
     then mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =<*lower_volume(g,D2).(indx(D2,D1,j1)+1)*> by A96,FINSEQ_1:57;
then A101: Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =lower_volume(g,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
     .=(inf(rng(g|divset(D2,(indx(D2,D1,j1)+1)))))
      *vol(divset(D2,(indx(D2,D1,j1)+1))) by A94,INTEGRA1:def 8
     .=lower_volume(g,D1).j by A95,A97,A98,INTEGRA1:def 8
     .=Sum mid(lower_volume(g,D1),j,j) by A93,FINSOP_1:12;
A102: delta(D1) >= 0 by Th8;
         sup rng g - inf rng g >= 0 by A8,XREAL_1:50;
     then (sup rng g - inf rng g)*delta(D1) >= 0*delta(D1) by A102,XREAL_1:66;
     hence Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
     -Sum mid(lower_volume(g,D1),j,j) <= (sup rng g-inf rng g)*delta(D1)
       by A101;
     end;
     suppose
A103:  len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A104:  mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
      =lower_volume(g,D2).(indx(D2,D1,j1)+1) by A71,A72,JORDAN3:27;
         mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
      =lower_volume(g,D2).(indx(D2,D1,j1)+2)
     proof
A105:  2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;
          mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
       =LVg(D2).(2+(indx(D2,D1,j1)+1)-'1) by A69,A71,A72,A103,JORDAN3:27
      .=LVg(D2).(2+(indx(D2,D1,j1)+1)-1) by A105,BINARITH:50
      .=LVg(D2).(indx(D2,D1,j1)+(1+1));
      hence thesis;
     end;
     then mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =<*lower_volume(g,D2).(indx(D2,D1,j1)+1),
       lower_volume(g,D2).(indx(D2,D1,j1)+2)*> by A103,A104,FINSEQ_1:61;
then A106:  Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =lower_volume(g,D2).(indx(D2,D1,j1)+1)
       +lower_volume(g,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A107:  vol(divset(D1,j))
      =vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
     proof
A108:  inf divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
     proof
       inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j by A6,A7,INTEGRA1:def 5;
      hence thesis by A2,A6,A20,INTEGRA1:def 21;
     end;
A109:  indx(D2,D1,j)=indx(D2,D1,j1)+2
      proof
        indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A69,A71,A72,A103,JORDAN3:27;
       then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A69,BINARITH:50;
       hence thesis;
      end;
A110:  inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
      & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
      & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
      & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
      proof
A111:  indx(D2,D1,j1)+2 in dom D2 by A2,A6,A109,INTEGRA1:def 21;
        indx(D2,D1,j1)+1 in Seg len lower_volume(g,D2) by A72,FINSEQ_1:3;
       then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 8;
then A112:  indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A113:  indx(D2,D1,j1)+1 <> 1 by A18,NAT_1:13;
         A114: indx(D2,D1,j1)+1+1 > 1 by A72,NAT_1:13;
A115:  indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A116:  indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;
       thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
       & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
       by A111,A114,A115,INTEGRA1:def 5;
       thus thesis by A112,A113,A116,INTEGRA1:def 5;
      end;
       vol(divset(D1,j))=D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
        +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A108,A109,INTEGRA1:def 6;
      then vol(divset(D1,j))=vol(divset(D2,indx(D2,D1,j1)+2))
        +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A110,INTEGRA1:def 6
      .=vol(divset(D2,indx(D2,D1,j1)+2))
        +(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1))
      by A110;
      hence thesis by INTEGRA1:def 6;
     end;
then A117: lower_volume(g,D1).j=(inf(rng(g|divset(D1,j))))*
     (vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
     by A95,INTEGRA1:def 8;
A118: vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A119: vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
     A120: Sum mid(LVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))-Sum mid(LVg(D1),j,j)
     <=(sup rng g - inf rng g)*(vol(divset(D2,indx(D2,D1,j1)+2))
      +vol(divset(D2,indx(D2,D1,j1)+1)))
     proof
A121: indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
A122: indx(D2,D1,j)=indx(D2,D1,j1)+2
      proof
        indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A69,A71,A72,A103,JORDAN3:27;
       then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A69,BINARITH:50;
       hence thesis;
      end;
then A123:  indx(D2,D1,j1)+2 in Seg len D2 by A121,FINSEQ_1:def 3;
      set ID1=indx(D2,D1,j1)+1, ID2=indx(D2,D1,j1)+2;
A124:  Sum mid(LVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
       =(inf rng(g|divset(D2,indx(D2,D1,j1)+2)))
        *vol(divset(D2,indx(D2,D1,j1)+2))
        +LVg(D2).(indx(D2,D1,j1)+1) by A106,A123,INTEGRA1:def 8
      .=(inf rng(g|divset(D2,indx(D2,D1,j1)+2)))
        *vol(divset(D2,indx(D2,D1,j1)+2))
        +(inf rng(g|divset(D2,indx(D2,D1,j1)+1)))
        *vol(divset(D2,indx(D2,D1,j1)+1)) by A94,INTEGRA1:def 8;
          divset(D2,ID2)c=A by A121,A122,INTEGRA1:10;
      then A125: inf rng(g|divset(D2,ID2)) <= sup rng g by A3,Lm5;
          ID1 in dom D2 by A94,FINSEQ_1:def 3;
      then divset(D2,ID1) c= A by INTEGRA1:10;
      then inf rng(g|divset(D2,ID1)) <= sup rng g by A3,Lm5;
then A126:  (inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
      <=(sup rng g)*vol(divset(D2,ID1)) by A118,XREAL_1:66;
          divset(D1,j)c=A by A6,INTEGRA1:10;
      then A127: inf rng(g|divset(D1,j)) >= inf rng g by A3,Lm5;
then A128:  (inf rng(g|divset(D1,j)))*vol(divset(D2,ID2))
      >=(inf rng g)*vol(divset(D2,ID2))
      & (inf rng(g|divset(D1,j)))*vol(divset(D2,ID1))
      >=(inf rng g)*vol(divset(D2,ID1)) by A118,A119,XREAL_1:66;
          Sum mid(LVg(D2),ID1,indx(D2,D1,j))
      -(inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
      <=(sup rng g)*vol(divset(D2,ID2)) by A119,A124,A125,XREAL_1:66;
      then Sum mid(LVg(D2),ID1,indx(D2,D1,j))
      <=(sup rng g)*vol(divset(D2,ID2))
      +(inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;
      then Sum mid(LVg(D2),ID1,indx(D2,D1,j))-(sup rng g)*vol(divset(D2,ID2))
      <=(inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;
      then Sum mid(LVg(D2),ID1,indx(D2,D1,j))-(sup rng g)*vol(divset(D2,ID2))
      <=(sup rng g)*vol(divset(D2,ID1)) by A126,XXREAL_0:2;
then A129:  Sum mid(LVg(D2),ID1,indx(D2,D1,j))<=(sup rng g)*vol(divset(D2,ID2))
+
      (sup rng g)*vol(divset(D2,ID1)) by XREAL_1:22;
      set IR = (inf rng g)*vol(divset(D2,ID2));
          Sum mid(LVg(D1),j,j)=(inf rng(g|divset(D1,j)))*vol(divset(D2,indx(D2,
D1,j1)+2))
       +(inf rng(g|divset(D1,j)))*vol(divset(D2,indx(D2,D1,j1)+1)) by A93,A117,
FINSOP_1:12;
      then Sum mid(LVg(D1),j,j)-(inf rng(g|divset(D1,j)))*vol(divset(D2,ID1))
       >=IR by A119,A127,XREAL_1:66;
      then Sum mid(LVg(D1),j,j)>=(inf rng(g|divset(D1,j)))*vol(divset(D2,ID1))
       +IR by XREAL_1:21;
      then Sum mid(LVg(D1),j,j)-(inf rng g)*vol(divset(D2,ID2))
       >=(inf rng(g|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:21;
      then Sum mid(LVg(D1),j,j)-(inf rng g)*vol(divset(D2,ID2))
       >=(inf rng g)*vol(divset(D2,ID1)) by A128,XXREAL_0:2;
      then Sum mid(LVg(D1),j,j) >=IR+(inf rng g)*vol(divset(D2,ID1))
      by XREAL_1:21;
      then Sum mid(LVg(D2),ID1,indx(D2,D1,j))-Sum mid(LVg(D1),j,j)
      <=(sup rng g)*vol(divset(D2,ID2))+(sup rng g)*vol(divset(D2,ID1))
       -(IR+(inf rng g)*vol(divset(D2,ID1)))
      by A129,REAL_1:92;
      hence thesis;
     end;
A130: vol(divset(D1,j)) <= delta(D1) by A6,Lm6;
         sup rng g - inf rng g >= 0 by A8,XREAL_1:50;
     then (sup rng g - inf rng g)*(vol(divset(D1,j)))
      <=(sup rng g - inf rng g)*delta(D1) by A130,XREAL_1:66;
     hence thesis by A107,A120,XXREAL_0:2;
    end;
    end;
    hence thesis;
   end;

A131:PLg(D2,indx(D2,D1,j1))
    +Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
    =PLg(D2,indx(D2,D1,j))
   proof
        indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
then A132: indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
then A133:1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
then A134: indx(D2,D1,j) <= len LVg(D2) by INTEGRA1:def 8;
A135: indx(D2,D1,j) in Seg len LVg(D2) by A132,INTEGRA1:def 8;
A136: indx(D2,D1,j1) < indx(D2,D1,j) by A69,NAT_1:13;
        indx(D2,D1,j1) in Seg len D2 by A18,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len LVg(D2) by INTEGRA1:def 8;
    then PLg(D2,indx(D2,D1,j1))
    =Sum(LVg(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
    then PLg(D2,indx(D2,D1,j1))
    +Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
    =Sum(LVg(D2)|indx(D2,D1,j1)
    ^mid(LVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
    .=Sum(mid(LVg(D2),1,indx(D2,D1,j1))
     ^mid(LVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A18,JORDAN3:25
    .=Sum(mid(LVg(D2),1,indx(D2,D1,j))) by A18,A134,A136,INTEGRA2:4
    .=Sum(LVg(D2)|indx(D2,D1,j)) by A133,JORDAN3:25;
    hence thesis by A135,INTEGRA1:def 22;
   end;

  A137: PLg(D1,j1)+Sum mid(lower_volume(g,D1),j,j)=PLg(D1,j)
   proof
A138: 1 <= j & j <= len LVg(D1) by A5,FINSEQ_1:3,INTEGRA1:def 8;
A139: j in Seg len LVg(D1) by A5,INTEGRA1:def 8;
        j < j+1 by NAT_1:13;
then A140: j1 < j by XREAL_1:21;
        j1 in Seg len D1 by A20,FINSEQ_1:def 3;
    then j1 in Seg len LVg(D1) by INTEGRA1:def 8;
    then PLg(D1,j1)=Sum(LVg(D1)|j1) by INTEGRA1:def 22;
    then PLg(D1,j1)+Sum mid(LVg(D1),j,j)
     =Sum((LVg(D1)|j1)^mid(LVg(D1),j,j)) by RVSUM_1:105
    .=Sum(mid(LVg(D1),1,j1)^mid(LVg(D1),j1+1,j)) by A20,JORDAN3:25
    .=Sum(mid(LVg(D1),1,j)) by A20,A138,A140,INTEGRA2:4
    .=Sum(LVg(D1)|j) by A138,JORDAN3:25;
    hence thesis by A139,INTEGRA1:def 22;
   end;
A141:PLg(D2,indx(D2,D1,j))=Sum(lower_volume(g,D2)|indx(D2,D1,j))
   by A15,INTEGRA1:def 22
   .=Sum lower_volume(g,D2) by A11,FINSEQ_1:79;
       PLg(D1,j)=Sum(lower_volume(g,D1)|j) by A16,INTEGRA1:def 22
   .=Sum lower_volume(g,D1) by A16,FINSEQ_1:79;
   hence thesis by A68,A70,A131,A137,A141;
end;

theorem Th10:
for A be closed-interval Subset of REAL, g be Function of A,REAL,
D1,D2 be Element of divs A st x in divset(D1,len D1) & len D1 >= 2
& D1<=D2 & rng D2 = rng D1 \/ {x} & g is_bounded_on A
holds Sum upper_volume(g,D1)-Sum
upper_volume(g,D2)<=(sup rng g-inf rng g)*delta(D1)
proof
   let A be closed-interval Subset of REAL;
   let g be Function of A,REAL;
   let D1,D2 be Element of divs A;
   assume A1:x in divset(D1,len D1) & len D1 >= 2;
   assume A2:D1<=D2 & rng D2 = rng D1 \/ {x};
   assume A3:g is_bounded_on A;
   deffunc PUg(Element of divs A,Nat) = (PartSums(upper_volume(g,$1))).$2;
   deffunc UVg(Element of divs A) = upper_volume(g,$1);
   set j = len D1;
       len D1 <> 0 & len D2 <> 0 by FINSEQ_1:25;
then A4:len D1 in Seg len D1 & len D2 in Seg len D2 by FINSEQ_1:5;
then A5:len D1 in dom D1 & len D2 in dom D2 by FINSEQ_1:def 3;
A6:len D1 <> 1 by A1;
A7:sup rng g >= inf rng g by A3,Lm4;
A8:indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.(len D1)
  by A2,A5,INTEGRA1:def 21;
then A9:indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
  A10: indx(D2,D1,j) >= len upper_volume(g,D2)
  proof
   assume indx(D2,D1,j) < len upper_volume(g,D2);
   then indx(D2,D1,j) < len D2 by INTEGRA1:def 7;
then A11:D1.(len D1) < D2.(len D2) by A5,A8,GOBOARD1:def 1;
A12:not(D2.(len D2) in rng D1)
   proof
    assume A13:D2.(len D2) in rng D1;
        rng D1 c= A by INTEGRA1:def 2;
    then inf A <= D2.(len D2) & D2.(len D2) <= sup A by A13,INTEGRA2:1;
    hence contradiction by A11,INTEGRA1:def 2;
   end;
       D2.(len D2) in rng D2 by A5,FUNCT_1:def 5;
   then D2.(len D2) in rng D1 or D2.(len D2) in {x} by A2,XBOOLE_0:def 2;
   then D2.(len D2) = x by A12,TARSKI:def 1;
   then D2.(len D2) <= sup divset(D1,len D1) by A1,INTEGRA2:1;
   hence contradiction by A5,A6,A11,INTEGRA1:def 5;
  end;
then A14:indx(D2,D1,j) in Seg len upper_volume(g,D2)
   & indx(D2,D1,j) >= len upper_volume(g,D2) by A9,INTEGRA1:def 7;
A15:j in Seg len upper_volume(g,D1)
   & j >= len upper_volume(g,D1) by A4,INTEGRA1:def 7;
A16:len D1-1 in NAT & len D1-1 in dom D1 by A5,A6,INTEGRA1:9;
   reconsider j1=len D1-1 as Element of NAT by A5,A6,INTEGRA1:9;
A17:indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) & indx(D2,D1,j1) <= len D2
   proof
    thus indx(D2,D1,j1) in dom D2 by A2,A16,INTEGRA1:def 21;
    hence thesis by FINSEQ_3:27;
   end;
   then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
then A18:D2|indx(D2,D1,j1) is increasing by A17,JORDAN3:25;
A19:j1 in dom D1 & 1 <= j1 & j1 <= len D1 by A16,FINSEQ_3:27;
    then mid(D1,1,j1) is increasing by INTEGRA1:37;
then A20: D1|j1 is increasing by A19,JORDAN3:25;
A21: rng (D2|indx(D2,D1,j1)) = rng (D1|j1) by A1,A2,Lm7;
then A22:D2|indx(D2,D1,j1)=D1|j1 by A18,A20,Th5;
A23:for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
    proof
     let k; assume A24:1 <= k & k <= j1;
     assume A25:k<>indx(D2,D1,k);
         now per cases by A25,XXREAL_0:1;
      suppose A26:k > indx(D2,D1,k);
          1 <= k & k <= len D1 by A19,A24,XXREAL_0:2;
then A27:   k in dom D1 by FINSEQ_3:27;
then A28:   indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
      by A2,INTEGRA1:def 21;
      then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
then A29:   1<=indx(D2,D1,k)&indx(D2,D1,k)<=indx(D2,D1,j1)
      by A2,A16,A24,A27,Th6,FINSEQ_1:3;
      then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
then A30:   (D2|indx(D2,D1,j1)).indx(D2,D1,k)=D2.indx(D2,D1,k) by A17,
RFINSEQ:19;
A31:  indx(D2,D1,k) < j1 by A24,A26,XXREAL_0:2;
      then indx(D2,D1,k) <= len D1 by A19,XXREAL_0:2;
      then indx(D2,D1,k) in Seg len D1 by A29,FINSEQ_1:3;
      then indx(D2,D1,k) in dom D1 by FINSEQ_1:def 3;
then A32:   D1.k > D1.indx(D2,D1,k) by A26,A27,GOBOARD1:def 1;
          indx(D2,D1,k) in Seg j1 by A29,A31,FINSEQ_1:3;
      hence contradiction by A16,A22,A28,A30,A32,RFINSEQ:19;
      end;
      suppose A33:k < indx(D2,D1,k);
          k in Seg j1 by A24,FINSEQ_1:3;
then A34:   D1.k = (D1|j1).k by A16,RFINSEQ:19;
          1 <= k & k <= len D1 by A19,A24,XXREAL_0:2;
then A35:   k in dom D1 by FINSEQ_3:27;
then A36:   indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
      by A2,INTEGRA1:def 21;
          indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2 &
      indx(D2,D1,j1) in dom D2 by A2,A16,A24,A35,Th6;
then A37:  k <= indx(D2,D1,j1) by A33,XXREAL_0:2;
      then k <= len D2 by A17,XXREAL_0:2;
      then k in dom D2 by A24,FINSEQ_3:27;
then A38:  D2.k < D2.indx(D2,D1,k) by A33,A36,GOBOARD1:def 1;
          k in Seg indx(D2,D1,j1) by A24,A37,FINSEQ_1:3;
      hence contradiction by A17,A22,A34,A36,A38,RFINSEQ:19;
     end;
     end;
     hence contradiction;
    end;

A39: len (D2|indx(D2,D1,j1))=len (D1|j1) by A18,A20,A21,Th5;
         len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A17,FINSEQ_1:80;
then A40: indx(D2,D1,j1) =j1 by A19,A39,FINSEQ_1:80;
        j1 in Seg len D1 by A16,FINSEQ_1:def 3;
    then j1 <= len D1 by FINSEQ_1:3;
    then j1 <= len upper_volume(g,D1) by INTEGRA1:def 7;
then A41:len(upper_volume(g,D1)|j1)=indx(D2,D1,j1) by A40,FINSEQ_1:80;
        indx(D2,D1,j1) in dom D2 by A2,A16,INTEGRA1:def 21;
    then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
    then indx(D2,D1,j1) <= len upper_volume(g,D2) by INTEGRA1:def 7;
then A42:len(upper_volume(g,D1)|j1)=len(upper_volume(g,D2)|indx(D2,D1,j1))
    by A41,FINSEQ_1:80;
        for k st 1 <= k & k <= len(upper_volume(g,D1)|j1) holds
    (upper_volume(g,D1)|j1).k = (upper_volume(g,D2)|indx(D2,D1,j1)).k
    proof
    let k; assume A43:1 <= k & k <= len(upper_volume(g,D1)|j1);
A44: len(upper_volume(g,D1)) = len D1 by INTEGRA1:def 7;
then A45:1 <= k & k <= j1 by A19,A43,FINSEQ_1:80;
then A46: k in Seg j1 by FINSEQ_1:3;
        1 <= k & k <= len D1 by A19,A45,XXREAL_0:2;
then A47:k in Seg len D1 by FINSEQ_1:3;
A48:divset(D1,k)=divset(D2,indx(D2,D1,k))
    proof
A49:  divset(D1,k)=[. inf divset(D1,k), sup divset(D1,k) .] by INTEGRA1:5;
A50:  k in dom D1 by A47,FINSEQ_1:def 3;
then A51:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2,
INTEGRA1:def 21;
         inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
     sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
     proof
      per cases;
       suppose A52:k=1;
then A53:   inf divset(D1,k)=inf A&sup divset(D1,k)=D1.k by A50,INTEGRA1:def 5;
           indx(D2,D1,k)=1 by A19,A23,A52;
       hence thesis by A51,A53,INTEGRA1:def 5;
       end;
       suppose A54:k<>1;
then A55:   inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
       by A50,INTEGRA1:def 5;
A56:   k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT by A50,A54,INTEGRA1:9;
       reconsider k1=k-1 as Element of NAT by A50,A54,INTEGRA1:9;
          k <= k+1 by NAT_1:11;
      then k1 <= k by XREAL_1:22;
then A57:  k1 <= j1 by A45,XXREAL_0:2;
          1 <= k1 by A56,FINSEQ_3:27;
then A58:  k1=indx(D2,D1,k1) by A23,A57;
           indx(D2,D1,k)<>1 by A23,A45,A54;
then A59:   inf divset(D2,indx(D2,D1,k))=D2.(indx(D2,D1,k)-1) &
       sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A51,INTEGRA1:def 5;
           D2.(indx(D2,D1,k)-1)= D2.indx(D2,D1,k1) by A23,A45,A58;
       hence thesis by A2,A50,A55,A56,A59,INTEGRA1:def 21;
     end;
     end;
     hence thesis by A49,INTEGRA1:5;
    end;
        j1 in Seg len(upper_volume(g,D1))
       by A16,A44,FINSEQ_1:def 3;
    then j1 in dom(upper_volume(g,D1)) by FINSEQ_1:def 3;
then A60: (upper_volume(g,D1)|j1).k = upper_volume(g,D1).k by A46,RFINSEQ:19
    .=(sup(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
     by A47,A48,INTEGRA1:def 7;
        indx(D2,D1,k) in Seg j1 by A23,A45,A46;
then A61:indx(D2,D1,k) in Seg indx(D2,D1,j1) by A19,A23;
    then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;
    then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A17,XXREAL_0:2;
then A62:indx(D2,D1,k) in Seg len D2 by FINSEQ_1:3;
        indx(D2,D1,j1) in Seg len D2 by A17,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len upper_volume(g,D2) by INTEGRA1:def 7;
then A63:indx(D2,D1,j1) in dom upper_volume(g,D2) by FINSEQ_1:def 3;
        (upper_volume(g,D2)|indx(D2,D1,j1)).k
     =(upper_volume(g,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A23,A45
    .=upper_volume(g,D2).indx(D2,D1,k) by A61,A63,RFINSEQ:19
    .=(sup(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
    by A62,INTEGRA1:def 7;
    hence thesis by A60;
   end;
then A64:upper_volume(g,D2)|indx(D2,D1,j1)=upper_volume(g,D1)|j1
   by A42,FINSEQ_1:18;
       indx(D2,D1,j1) in Seg len D2 by A17,FINSEQ_1:def 3;
then A65:indx(D2,D1,j1) in Seg len upper_volume(g,D2) by INTEGRA1:def 7;
       j1 in Seg len D1 by A16,FINSEQ_1:def 3;
then A66:j1 in Seg len upper_volume(g,D1) by INTEGRA1:def 7;
A67:PUg(D2,indx(D2,D1,j1))=Sum(upper_volume(g,D2)|indx(D2,D1,j1))
   by A65,INTEGRA1:def 22
   .=PUg(D1,j1) by A64,A66,INTEGRA1:def 22;
A68:indx(D2,D1,j1)+1 <= indx(D2,D1,len D1)
   proof
        len D1 < len D1+1 by NAT_1:13;
    then j1 < len D1 by XREAL_1:21;
    then indx(D2,D1,j1) < indx(D2,D1,len D1) by A2,A5,A16,Th7;
    hence thesis by NAT_1:13;
   end;
A69:Sum mid(upper_volume(g,D1),len D1,len D1)
    -Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,len D1))
    <= (sup rng g-inf rng g)*delta(D1)
   proof
A70: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len upper_volume(g,D2)
    proof
         indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
     then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
     then indx(D2,D1,j) in Seg len upper_volume(g,D2) by INTEGRA1:def 7;
    hence thesis by FINSEQ_1:3;
    end;
then A71: 1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len upper_volume(g,D2)
    by A17,A68,XXREAL_0:2,NAT_1:13;
A72:indx(D2,D1,j)-indx(D2,D1,j1) <= 2
    proof
     assume A73:indx(D2,D1,j)-indx(D2,D1,j1) > 2;
     reconsider ID1=indx(D2,D1,j1)+1 as Element of NAT;
     reconsider ID2=ID1+1 as Element of NAT;
A74:indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
     proof
      thus indx(D2,D1,j1) < ID1 by NAT_1:13;
      thus ID1 < ID2 by NAT_1:13;
          indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A73,XREAL_1:22;
      hence thesis;
     end;
A75:indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
then A76:indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A77:ID1 in dom D2
     proof
A78:    1 <= ID1 & ID1 <= indx(D2,D1,j) by A17,A74,XXREAL_0:2;
      then ID1 <= len D2 by A76,XXREAL_0:2;
      hence thesis by A78,FINSEQ_3:27;
     end;
A79:ID2 in dom D2
     proof
A80:    indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A74,A76,XXREAL_0:2;
      then 1 <= ID2 by A17,XXREAL_0:2;
      hence thesis by A80,FINSEQ_3:27;
     end;
then A81:D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
     by A17,A74,A75,A77,GOBOARD1:def 1;
A82:D2.ID1 in {x} & D2.ID2 in {x}
     proof
      A83: D2.ID1 in rng D2 & D2.ID2 in rng D2 by A77,A79,FUNCT_1:def 5;
A84: D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
      by A2,A5,A16,INTEGRA1:def 21;
          not(D2.ID1 in rng D1) & not(D2.ID2 in rng D1)
      proof
       assume A85:D2.ID1 in rng D1 or D2.ID2 in rng D1;
           now per cases by A85;
        suppose D2.ID1 in rng D1;
        then consider n such that
A86:   n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
            D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
        by A81,XXREAL_0:2;
        then j1<n & n<j by A5,A16,A84,A86,GOBOARD2:18;
        then j<n+1 & n<j by XREAL_1:21;
        hence contradiction by NAT_1:13;
        end;
        suppose D2.ID2 in rng D1;
        then consider n such that
A87:   n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
            D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
        by A81,XXREAL_0:2;
        then j1<n & n<j by A5,A16,A84,A87,GOBOARD2:18;
        then j<n+1 & n<j by XREAL_1:21;
        hence contradiction by NAT_1:13;
       end;
       end;
       hence thesis;
      end;
      hence thesis by A2,A83,XBOOLE_0:def 2;
     end;
     then D2.ID1 = x by TARSKI:def 1;
     then D2.ID1=D2.ID2 by A82,TARSKI:def 1;
     hence contradiction by A74,A77,A79,GOBOARD2:19;
    end;
    1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
    indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
    proof
A88: indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
     =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A68,BINARITH:50;
      indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
     hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
     thus thesis by A72,A88;
    end;
then A89: 1 <= len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)) &
    len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
    by A68,A70,A71,JORDAN3:27;
A90: 1 <= j & j <= len upper_volume(g,D1) by A4,FINSEQ_1:3,INTEGRA1:def 7;
    j-'j+1 = 1 by Lm2;
then A91: len mid(upper_volume(g,D1),j,j)=1 by A90,JORDAN3:27;
        mid(upper_volume(g,D1),j,j).1 = upper_volume(g,D1).j by A90,JORDAN3:27;
    then mid(upper_volume(g,D1),j,j)=<*upper_volume(g,D1).j*> by A91,
FINSEQ_1:57;
then A92:Sum mid(upper_volume(g,D1),j,j)=upper_volume(g,D1).j by FINSOP_1:12;
A93:indx(D2,D1,j1)+1 in Seg len D2
    proof
         indx(D2,D1,j1)+1 in Seg len upper_volume(g,D2) by A71,FINSEQ_1:3;
     hence thesis by INTEGRA1:def 7;
    end;
        now per cases by A89,Lm3;
     suppose
A94: len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A95: indx(D2,D1,j1)+1=indx(D2,D1,j)
     proof
          len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
       = indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 by A68,A70,A71,JORDAN3:27;
      then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A68,A94,BINARITH:50;
      hence thesis;
     end;
A96: divset(D2,indx(D2,D1,j))=divset(D1,j)
     proof
          inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
        by A5,A6,INTEGRA1:def 5;
      then inf divset(D1,j)=D2.indx(D2,D1,j1)
      & sup divset(D1,j)=D2.indx(D2,D1,j)
      by A2,A5,A16,INTEGRA1:def 21;
then A97: divset(D1,j)=[. D2.indx(D2,D1,j1),D2.indx(D2,D1,j).] by INTEGRA1:5;
A98: indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
          indx(D2,D1,j)<>1 by A17,A95,NAT_1:13;
      then inf divset(D2,indx(D2,D1,j))=D2.(indx(D2,D1,j)-1)
      & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
      by A98,INTEGRA1:def 5;
      hence thesis by A95,A97,INTEGRA1:5;
     end;
         mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
      =upper_volume(g,D2).(indx(D2,D1,j1)+1) by A70,A71,JORDAN3:27;
     then mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =<*upper_volume(g,D2).(indx(D2,D1,j1)+1)*> by A94,FINSEQ_1:57;
     then A99: Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =upper_volume(g,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
     .=(sup(rng(g|divset(D2,(indx(D2,D1,j1)+1)))))
      *vol(divset(D2,(indx(D2,D1,j1)+1))) by A93,INTEGRA1:def 7
     .=Sum
mid(upper_volume(g,D1),j,j) by A4,A92,A95,A96,INTEGRA1:def 7;
A100: delta(D1) >= 0 by Th8;
         sup rng g - inf rng g >= 0 by A7,XREAL_1:50;
     then (sup rng g - inf rng g)*delta(D1) >= 0*delta(D1) by A100,XREAL_1:66;
     hence Sum mid(upper_volume(g,D1),j,j)-
     Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
     <= (sup rng g-inf rng g)*delta(D1) by A99;
     end;
     suppose
A101:  len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A102:  mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
      =upper_volume(g,D2).(indx(D2,D1,j1)+1) by A70,A71,JORDAN3:27;
         mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
      =upper_volume(g,D2).(indx(D2,D1,j1)+2)
     proof
A103:  2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;
          mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
       =UVg(D2).(2+(indx(D2,D1,j1)+1)-'1) by A68,A70,A71,A101,JORDAN3:27
      .=UVg(D2).(2+(indx(D2,D1,j1)+1)-1) by A103,BINARITH:50
      .=UVg(D2).(indx(D2,D1,j1)+(1+1));
      hence thesis;
     end;
     then mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =<*upper_volume(g,D2).(indx(D2,D1,j1)+1),
       upper_volume(g,D2).(indx(D2,D1,j1)+2)*> by A101,A102,FINSEQ_1:61;
then A104:  Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
      =upper_volume(g,D2).(indx(D2,D1,j1)+1)
       +upper_volume(g,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A105:  vol(divset(D1,j))
      =vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
     proof
A106:  inf divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
      proof
        inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j by A5,A6,INTEGRA1:def 5;
       hence thesis by A2,A5,A16,INTEGRA1:def 21;
      end;
A107:  indx(D2,D1,j)=indx(D2,D1,j1)+2
      proof
           indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A68,A70,A71,A101,JORDAN3:27
;
       then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A68,BINARITH:50;
       hence thesis;
      end;
A108:  inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
      & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
      & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
      & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
      proof
A109:   indx(D2,D1,j1)+2 in dom D2 by A2,A5,A107,INTEGRA1:def 21;
           indx(D2,D1,j1)+1 in Seg len upper_volume(g,D2) by A71,FINSEQ_1:3;
       then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 7;
then A110:  indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A111:  indx(D2,D1,j1)+1 <> 1 by A17,NAT_1:13;
         A112: indx(D2,D1,j1)+1+1 > 1 by A71,NAT_1:13;
A113:  indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A114:  indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;
       thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
       & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
       by A109,A112,A113,INTEGRA1:def 5;
       thus thesis by A110,A111,A114,INTEGRA1:def 5;
      end;
          vol(divset(D1,j))
       =D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
        +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A106,A107,INTEGRA1:def 6;
      then vol(divset(D1,j))
       =vol(divset(D2,indx(D2,D1,j1)+2))
        +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A108,INTEGRA1:def 6
      .=vol(divset(D2,indx(D2,D1,j1)+2))
        +(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1))
      by A108;
      hence thesis by INTEGRA1:def 6;
     end;
then A115:  upper_volume(g,D1).j=(sup(rng(g|divset(D1,j))))*
     (vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
     by A4,INTEGRA1:def 7;
A116:  vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A117: vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
     A118: Sum mid(UVg(D1),j,j)-Sum mid(UVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))
     <=(sup rng g - inf rng g)*(vol(divset(D2,indx(D2,D1,j1)+2))
      +vol(divset(D2,indx(D2,D1,j1)+1)))
     proof
A119: indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
then A120:  indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
A121: indx(D2,D1,j)=indx(D2,D1,j1)+2
      proof
           indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A68,A70,A71,A101,JORDAN3:27
;
       then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A68,BINARITH:50;
       hence thesis;
      end;
      set ID1=indx(D2,D1,j1)+1, ID2=indx(D2,D1,j1)+2;
A122:  Sum mid(UVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
       =(sup rng(g|divset(D2,indx(D2,D1,j1)+2)))
        *vol(divset(D2,indx(D2,D1,j1)+2))
        +UVg(D2).(indx(D2,D1,j1)+1) by A104,A120,A121,INTEGRA1:def 7
      .=(sup rng(g|divset(D2,indx(D2,D1,j1)+2)))
        *vol(divset(D2,indx(D2,D1,j1)+2))
        +(sup rng(g|divset(D2,indx(D2,D1,j1)+1)))
        *vol(divset(D2,indx(D2,D1,j1)+1)) by A93,INTEGRA1:def 7;
          divset(D2,ID2)c=A by A119,A121,INTEGRA1:10;
      then A123: sup rng(g|divset(D2,ID2)) >= inf rng g by A3,Lm5;
       ID1 in dom D2 by A93,FINSEQ_1:def 3;
      then divset(D2,ID1)c=A by INTEGRA1:10;
      then sup rng(g|divset(D2,ID1)) >= inf rng g by A3,Lm5;
then A124:  (sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
      >=(inf rng g)*vol(divset(D2,ID1)) by A116,XREAL_1:66;
          divset(D1,j)c=A by A5,INTEGRA1:10;
      then sup rng(g|divset(D1,j)) <= sup rng g by A3,Lm5;
then A125:  (sup rng(g|divset(D1,j)))*vol(divset(D2,ID2))
      <=(sup rng g)*vol(divset(D2,ID2))
      & (sup rng(g|divset(D1,j)))*vol(divset(D2,ID1))
      <=(sup rng g)*vol(divset(D2,ID1)) by A116,A117,XREAL_1:66;
          Sum mid(UVg(D2),ID1,indx(D2,D1,j))
      -(sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
      >=(inf rng g)*vol(divset(D2,ID2)) by A117,A122,A123,XREAL_1:66;
      then Sum mid(UVg(D2),ID1,indx(D2,D1,j))
      >=(inf rng g)*vol(divset(D2,ID2))
      +(sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:21;
      then Sum mid(UVg(D2),ID1,indx(D2,D1,j))-(inf rng g)*vol(divset(D2,ID2))
      >=(sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:21;
      then Sum mid(UVg(D2),ID1,indx(D2,D1,j))-(inf rng g)*vol(divset(D2,ID2))
      >=(inf rng g)*vol(divset(D2,ID1)) by A124,XXREAL_0:2;
then A126: Sum mid(UVg(D2),ID1,indx(D2,D1,j)) >= (inf rng g)*vol(divset(D2,ID2)
)
      + (inf rng g)*vol(divset(D2,ID1)) by XREAL_1:21;
      reconsider A = sup(rng(g|divset(D1,j))) as real number;
        Sum mid(UVg(D1),j,j)-(sup rng(g|divset(D1,j)))*vol(divset(D2,ID1))
       = (sup rng(g|divset(D1,j)))*vol(divset(D2,ID2)) by A92,A115;
      then Sum mid(UVg(D1),j,j)<=(sup rng(g|divset(D1,j)))*vol(divset(D2,ID1))
       +(sup rng g)*vol(divset(D2,ID2)) by A125,XREAL_1:22;
      then Sum mid(UVg(D1),j,j)-(sup rng g)*vol(divset(D2,ID2))
       <=(sup rng(g|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:22;
      then Sum mid(UVg(D1),j,j)-(sup rng g)*vol(divset(D2,ID2))
       <=(sup rng g)*vol(divset(D2,ID1)) by A125,XXREAL_0:2;
      then Sum mid(UVg(D1),j,j)
       <=(sup rng g)*vol(divset(D2,ID2))+(sup rng g)*vol(divset(D2,ID1))
      by XREAL_1:22;
      then Sum mid(UVg(D1),j,j)-Sum mid(UVg(D2),ID1,indx(D2,D1,j))
      <=(sup rng g)*vol(divset(D2,ID2))+(sup rng g)*vol(divset(D2,ID1))
       -((inf rng g)*vol(divset(D2,ID2))+(inf rng g)*vol(divset(D2,ID1)))
      by A126,REAL_1:92;
      hence thesis;
     end;
A127: vol(divset(D1,j)) <= delta(D1) by A5,Lm6;
         sup rng g - inf rng g >= 0 by A7,XREAL_1:50;
     then (sup rng g - inf rng g)*(vol(divset(D1,j)))
      <=(sup rng g - inf rng g)*delta(D1) by A127,XREAL_1:66;
     hence thesis by A105,A118,XXREAL_0:2;
    end;
    end;
    hence thesis;
   end;

A128:PUg(D2,indx(D2,D1,j1))
    +Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
    =PUg(D2,indx(D2,D1,j))
   proof
        indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
then A129: indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
    then A130: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
then A131: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len UVg(D2) by INTEGRA1:def 7;
A132: indx(D2,D1,j) in Seg len UVg(D2) by A129,INTEGRA1:def 7;
A133: indx(D2,D1,j1) < indx(D2,D1,j) by A68,NAT_1:13;
        indx(D2,D1,j1) in Seg len D2 by A17,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len UVg(D2) by INTEGRA1:def 7;
    then PUg(D2,indx(D2,D1,j1))
    =Sum(UVg(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
    then PUg(D2,indx(D2,D1,j1))
    +Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
    =Sum(UVg(D2)|indx(D2,D1,j1)
    ^mid(UVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
    .=Sum(mid(UVg(D2),1,indx(D2,D1,j1))
     ^mid(UVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A17,JORDAN3:25
    .=Sum(mid(UVg(D2),1,indx(D2,D1,j))) by A17,A131,A133,INTEGRA2:4
    .=Sum(UVg(D2)|indx(D2,D1,j)) by A130,JORDAN3:25;
    hence thesis by A132,INTEGRA1:def 22;
   end;

  A134: PUg(D1,j1)+Sum mid(upper_volume(g,D1),j,j)=PUg(D1,j)
   proof
A135: 1 <= j & j <= len UVg(D1) by A4,FINSEQ_1:3,INTEGRA1:def 7;
A136: j in Seg len UVg(D1) by A4,INTEGRA1:def 7;
        j < j+1 by NAT_1:13;
then A137: j1 < j by XREAL_1:21;
        j1 in Seg len D1 by A16,FINSEQ_1:def 3;
    then j1 in Seg len UVg(D1) by INTEGRA1:def 7;
    then PUg(D1,j1)=Sum(UVg(D1)|j1) by INTEGRA1:def 22;
    then PUg(D1,j1)+Sum mid(UVg(D1),j,j)
     =Sum((UVg(D1)|j1)^mid(UVg(D1),j,j)) by RVSUM_1:105
    .=Sum(mid(UVg(D1),1,j1)^mid(UVg(D1),j1+1,j)) by A19,JORDAN3:25
    .=Sum(mid(UVg(D1),1,j)) by A19,A135,A137,INTEGRA2:4
    .=Sum(UVg(D1)|j) by A135,JORDAN3:25;
    hence thesis by A136,INTEGRA1:def 22;
   end;
A138:PUg(D2,indx(D2,D1,j))=Sum(upper_volume(g,D2)|indx(D2,D1,j))
   by A14,INTEGRA1:def 22
   .=Sum upper_volume(g,D2) by A10,FINSEQ_1:79;
       PUg(D1,j)=Sum(upper_volume(g,D1)|j) by A15,INTEGRA1:def 22
   .=Sum upper_volume(g,D1) by A15,FINSEQ_1:79;
   hence thesis by A67,A69,A128,A134,A138;
end;

Lm8:
for A be closed-interval Subset of REAL, f be PartFunc of A,REAL
st vol(A)<>0 & y in rng lower_sum_set(f) holds ex D being Element of divs A st
D in dom lower_sum_set(f) & y=(lower_sum_set(f)).D & D.1 > inf A
proof
   let A be closed-interval Subset of REAL;
   let f be PartFunc of A,REAL;
   assume A1:vol(A)<>0;
   assume y in rng lower_sum_set(f);
   then consider D3 being Element of divs A such that
A2:D3 in dom lower_sum_set(f) & y=(lower_sum_set(f)).D3 by PARTFUN1:26;
       len D3 <> 0 by FINSEQ_1:25;
then A3:len D3 in Seg len D3 by FINSEQ_1:5;
   then 1 <= len D3 by FINSEQ_1:3;
then A4:1 in Seg len D3 by FINSEQ_1:3;
       rng D3 <> {};
then A5:1 in dom D3 by FINSEQ_3:34;
       now per cases;
    suppose A6:D3.1 <> inf A;
           D3.1 in A by A5,INTEGRA1:8;
       then inf A <= D3.1 by INTEGRA2:1;
       then D3.1 > inf A by A6,REAL_1:def 5;
       hence ex D being Element of divs A st D in dom lower_sum_set(f) &
       y=(lower_sum_set(f)).D & D.1 > inf A by A2;
       end;
       suppose A7:D3.1 = inf A;
           ex D being Element of divs A st D in dom lower_sum_set(f) &
       y=(lower_sum_set(f)).D & D.1 > inf A
       proof
A8:     D3.(len D3) = sup A by INTEGRA1:def 2;
A9:    len D3 in dom D3 by A3,FINSEQ_1:def 3;
            vol(A) >= 0 by INTEGRA1:11;
        then sup A - inf A > 0 by A1,INTEGRA1:def 6;
        then A10: sup A > inf A by REAL_2:106;
then A11:    len D3 > 1 by A5,A7,A8,A9,GOBOARD2:18;
        then reconsider D=D3/^1 as increasing FinSequence of REAL by
INTEGRA1:36;
A12:    len D = len D3 - 1 & for m be Element of NAT st m in dom D
 holds D.m = D3.(m+1)
        by A11,RFINSEQ:def 2;
        then len D <> 0 by A7,A10,INTEGRA1:def 2;
       then reconsider D as non empty increasing FinSequence of REAL by
FINSEQ_1:25;
            rng D c= rng D3 & rng D3 c= A by FINSEQ_5:36,INTEGRA1:def 2;
then A13:    rng D c= A by XBOOLE_1:1;
A14:    len D+1=len D3 by A12;
            len D in dom D by FINSEQ_5:6;
        then D.(len D)=sup A by A8,A11,A14,RFINSEQ:def 2;
        then D is DivisionPoint of A by A13,INTEGRA1:def 2;
        then reconsider D as Element of divs A by INTEGRA1:def 4;
            D in divs A;
then A15:     D in dom lower_sum_set(f) by INTEGRA1:def 12;
A16:     y=(lower_sum_set(f)).D
        proof
A17:     y=lower_sum(f,D3) by A2,INTEGRA1:def 12
         .=Sum(lower_volume(f,D3)) by INTEGRA1:def 10
         .=Sum((lower_volume(f,D3)|1)^(lower_volume(f,D3)/^1)) by RFINSEQ:21;
A18:     lower_volume(f,D3)|1 = <*lower_volume(f,D3).1*>
         proof
A19:      1 <= len lower_volume(f,D3) by A11,INTEGRA1:def 8;
then A20:      len (lower_volume(f,D3)|1)=1 by FINSEQ_1:80;
A21:      1 in dom lower_volume(f,D3) by A19,FINSEQ_3:27;
              1 in Seg 1 by FINSEQ_1:3;
          then (lower_volume(f,D3)|1).1 = lower_volume(f,D3).1 by A21,
RFINSEQ:19;
          hence thesis by A20,FINSEQ_1:57;
         end;
A22:      vol(divset(D3,1))=sup divset(D3,1)-inf divset(D3,1) by INTEGRA1:def 6
          .=sup divset(D3,1) - inf A by A5,INTEGRA1:def 5
          .=D3.1 - inf A by A5,INTEGRA1:def 5
          .=0 by A7;
          A23: lower_volume(f,D3).1=(inf rng(f|divset(D3,1)))*vol(divset(D3,1))
          by A4,INTEGRA1:def 8;
             lower_volume(f,D3)/^1 = lower_volume(f,D)
         proof
A24:      2-'1=2-1 by BINARITH:50 .= 1;
A25:      len D3 >= 1+1 by A11,NAT_1:13;
          then len lower_volume(f,D3) >= 2 by INTEGRA1:def 8;
then A26:      mid(lower_volume(f,D3),2,len lower_volume(f,D3))
           =lower_volume(f,D3)/^1 by A24,JORDAN3:26;
A27:      2 <= len lower_volume(f,D3) & 1 <= len lower_volume(f,D3)
          by A11,A25,INTEGRA1:def 8;
A28:      len(mid(lower_volume(f,D3),2,len lower_volume(f,D3)))
          =len lower_volume(f,D)
          proof
               len(mid(lower_volume(f,D3),2,len lower_volume(f,D3)))
           =len lower_volume(f,D3)-'2+1 by A27,JORDAN3:27
           .=len D3-'2+1 by INTEGRA1:def 8
           .=len D3-2+1 by A25,BINARITH:50
           .=len D3-1;
           hence thesis by A12,INTEGRA1:def 8;
          end;
              for i st 1<=i&i<=len mid(lower_volume(f,D3),2,len lower_volume(f,
D3
)
)
          holds mid(lower_volume(f,D3),2,len lower_volume(f,D3)).i
          =lower_volume(f,D).i
          proof
           let i; assume
           A29: 1<=i&i<=len mid(lower_volume(f,D3),2,len lower_volume(f,D3));
then A30:       1 <= i & i <= len D by A28,INTEGRA1:def 8;
           then 1<=i & i<=len lower_volume(f,D3) - 1 by A12,INTEGRA1:def 8;
           then 1 <= i & i <= len lower_volume(f,D3)-2+1;
then A31:       mid(lower_volume(f,D3),2,len lower_volume(f,D3)).i
           =lower_volume(f,D3).(i+2-1) by A27,JORDAN3:31
           .=lower_volume(f,D3).(i+1);
               1 <= i+1 & i+1 <= len D3 by A12,A30,NAT_1:12,XREAL_1:21;
then A32:       i+1 in Seg len D3 by FINSEQ_1:3;
then A33:       mid(lower_volume(f,D3),2,len lower_volume(f,D3)).i
           =(inf rng(f|divset(D3,i+1)))*vol(divset(D3,i+1))
           by A31,INTEGRA1:def 8;
           A34: divset(D3,i+1)=divset(D,i)
           proof
A35:        1<>i+1 by A29,NAT_1:13;
                i+1 in dom D3 by A32,FINSEQ_1:def 3;
            then A36: sup divset(D3,i+1)=D3.(i+1) & inf divset(D3,i+1)=D3.(i+1-
1)
            by A35,INTEGRA1:def 5;
A37:        i in dom D by A30,FINSEQ_3:27;
then A38:        D.i=D3.(i+1) by A11,RFINSEQ:def 2;
            per cases;
             suppose A39:i=1;
then A40:         inf divset(D,i)=inf A & sup divset(D,i)=D.i
             by A37,INTEGRA1:def 5;
                 divset(D3,i+1)=[.inf A, D.i.] by A7,A36,A38,A39,INTEGRA1:5;
             hence thesis by A40,INTEGRA1:5;
             end;
             suppose A41:i<>1;
then A42:         inf divset(D,i)=D.(i-1) & sup divset(D,i)=D.i
             by A37,INTEGRA1:def 5;
                 i-1 in dom D & i-1 in NAT by A37,A41,INTEGRA1:9;
                then i-1 in dom D & i-1 is Nat by ORDINAL1:def 13;
then D.(i-1)=D3.(i-1+1) by A11,RFINSEQ:def 2
             .=D3.i;
             then divset(D3,i+1)=[.inf divset(D,i),sup divset(D,i).]
               by A36,A38,A42,INTEGRA1:5;
             hence thesis by INTEGRA1:5;
           end;
           end;
               i in Seg len D by A30,FINSEQ_1:3;
           hence thesis by A33,A34,INTEGRA1:def 8;
          end;
          hence thesis by A26,A28,FINSEQ_1:18;
         end;
         then y=0+Sum(lower_volume(f,D)) by A17,A18,A22,A23,RVSUM_1:106
         .=lower_sum(f,D) by INTEGRA1:def 10;
         hence thesis by A15,INTEGRA1:def 12;
        end;
            rng D <> {};
        then 1 in dom D by FINSEQ_3:34;
then A43:    D.1=D3.(1+1) by A11,RFINSEQ:def 2 .=D3.2;
            1+1 <= len D3 by A11,NAT_1:13;
        then 2 in dom D3 by FINSEQ_3:27;
        then D3.1 < D3.2 by A5,GOBOARD1:def 1;
        hence thesis by A7,A15,A16,A43;
       end;
       hence thesis;
      end;
      end;
      hence thesis;
     end;

theorem Th11:
for A be closed-interval Subset of REAL, D be Element of divs A,
r be Real, i,j be Element of NAT
 st i in dom D & j in dom D & i<=j & r < mid(D,i,j).1
holds ex B be closed-interval Subset of REAL
st r=inf B & sup B=mid(D,i,j).(len mid(D,i,j))
& len mid(D,i,j)=j-i+1 & mid(D,i,j) is DivisionPoint of B
proof
   let A be closed-interval Subset of REAL;
   let D be Element of divs A;
   let r be Real;
   let i,j be Element of NAT;
   assume A1:i in dom D;
   assume A2:j in dom D;
   assume A3:i <= j;
   assume A4:r < mid(D,i,j).1;
   consider C being closed-interval Subset of REAL such that
A5:inf C=mid(D,i,j).1 & sup C=mid(D,i,j).(len mid(D,i,j))
   & len mid(D,i,j)=j-i+1 & mid(D,i,j) is DivisionPoint of C
   by A1,A2,A3,INTEGRA1:38;
   consider a,b such that
A6:a <= b & a = inf C & b = sup C by INTEGRA1:4;
       r <= sup C by A4,A5,A6,XXREAL_0:2;
  then reconsider B=[.r,sup C.] as closed-interval Subset of REAL by
INTEGRA1:def 1;
   reconsider MD=mid(D,i,j) as non empty increasing FinSequence of REAL by A5;
       B=[.inf B,sup B.] by INTEGRA1:5;
then A7:inf B = r & sup B = sup C by INTEGRA1:6;
A8:rng mid(D,i,j) c= C&mid(D,i,j).(len mid(D,i,j))=sup C by A5,INTEGRA1:def 2;
       x in C implies x in B
   proof
    assume x in C;
    then inf C <= x & x <= sup C by INTEGRA2:1;
    then r <= x & x <= sup C by A4,A5,XXREAL_0:2;
    hence thesis by A7,INTEGRA2:1;
   end;
   then C c= B by SUBSET_1:7;
   then rng mid(D,i,j) c= B by A8,XBOOLE_1:1;
   then MD is DivisionPoint of B by A5,A7,INTEGRA1:def 2;
   hence thesis by A5,A7;
end;

Lm9:for A be closed-interval Subset of REAL,
        D1 be Element of divs A st vol(A)<>0 & len D1 = 1 holds
    <*inf A*>^D1 is non empty increasing FinSequence of REAL
proof
  let A be closed-interval Subset of REAL,
      D1 be Element of divs A;
  assume A1:vol(A)<>0;
  assume len D1 = 1;
then A2: D1.1=sup A by INTEGRA1:def 2;
        vol(A) >= 0 by INTEGRA1:11;
    then D1.1 - inf A > 0 by A1,A2,INTEGRA1:def 6;
then A3:inf A < D1.1 by REAL_2:106;
    set MD1 = <*inf A*>^D1;
        n in dom MD1 & m in dom MD1 & n<m implies MD1.n < MD1.m
    proof
     assume A4:n in dom MD1 & m in dom MD1 & n<m;
A5: not m in dom <*inf A*>
     proof
      assume m in dom <*inf A*>;
      then m in Seg len <*inf A*> by FINSEQ_1:def 3;
      then m in {1} by FINSEQ_1:4,56;
then A6:   n < 1 by A4,TARSKI:def 1;
          n in Seg len MD1 by A4,FINSEQ_1:def 3;
      hence contradiction by A6,FINSEQ_1:3;
     end;
         MD1.m in rng MD1 by A4,FUNCT_1:def 5;
then A7:  MD1.m in rng <*inf A*> \/ rng D1 by FINSEQ_1:44;
         not(MD1.m in rng <*inf A*>)
     proof
      assume MD1.m in rng <*inf A*>;
      then MD1.m in {inf A} by FINSEQ_1:55;
then A8:  MD1.m = inf A by TARSKI:def 1;
      consider n such that
A9:  n in dom D1 & m=len <*inf A*>+n by A4,A5,FINSEQ_1:38;
          n in Seg len D1 by A9,FINSEQ_1:def 3;
then A10:  1 <= n & n <= len D1 by FINSEQ_1:3;
          rng D1 <> {};
then A11:  1 in dom D1 by FINSEQ_3:34;
          D1.n=MD1.m by A9,FINSEQ_1:def 7;
      hence contradiction by A3,A8,A9,A10,A11,GOBOARD2:18;
     end;
then A12: MD1.m in rng D1 by A7,XBOOLE_0:def 2;
         now per cases by A4,FINSEQ_1:38;
      suppose A13:n in dom <*inf A*>;
      then n in Seg len <*inf A*> by FINSEQ_1:def 3;
      then n in {1} by FINSEQ_1:4,56;
then A14:  n = 1 by TARSKI:def 1;
      consider k such that
A15:  k in dom D1 & MD1.m = D1.k by A12,PARTFUN1:26;
A16:  1 <= k & k <= len D1 by A15,FINSEQ_3:27;
          rng D1 <> {};
      then 1 in dom D1 by FINSEQ_3:34;
then A17:  D1.1 <= MD1.m by A15,A16,GOBOARD2:18;
          MD1.n = <*inf A*>.n by A13,FINSEQ_1:def 7 .= inf A by A14,
FINSEQ_1:def 8
;
      hence MD1.n < MD1.m by A3,A17,XXREAL_0:2;
      end;
      suppose ex i st i in dom D1 & n = len <*inf A*> + i;
      then consider i such that
A18:  i in dom D1 & n=len <*inf A*> + i;
      consider j such that
A19:  j in dom D1 & m=len <*inf A*> + j by A4,A5,FINSEQ_1:38;
A20:  i < j by A4,A18,A19,XREAL_1:8;
A21:  D1.i=MD1.n by A18,FINSEQ_1:def 7;
          D1.j=MD1.m by A19,FINSEQ_1:def 7;
      hence thesis by A18,A19,A20,A21,GOBOARD1:def 1;
     end;
     end;
     hence thesis;
    end;
    hence thesis by GOBOARD1:def 1;
end;

Lm10:for A be closed-interval Subset of REAL,
        D2 be Element of divs A st inf A < D2.1 holds
    <*inf A*>^D2 is non empty increasing FinSequence of REAL
proof
    let A be closed-interval Subset of REAL,
        D2 be Element of divs A;
    assume A1: inf A < D2.1;
    set MD2=<*inf A*>^D2;
        n in dom MD2 & m in dom MD2 & n<m implies MD2.n < MD2.m
    proof
     assume A2:n in dom MD2 & m in dom MD2 & n<m;
A3: not m in dom <*inf A*>
     proof
      assume m in dom <*inf A*>;
      then m in Seg len <*inf A*> by FINSEQ_1:def 3;
      then m in {1} by FINSEQ_1:4,56;
then A4:  n < 1 by A2,TARSKI:def 1;
          n in Seg len MD2 by A2,FINSEQ_1:def 3;
      hence contradiction by A4,FINSEQ_1:3;
     end;
         MD2.m in rng MD2 by A2,FUNCT_1:def 5;
     then MD2.m in rng <*inf A*> \/ rng D2 by FINSEQ_1:44;
then A5: MD2.m in rng <*inf A*> or MD2.m in rng D2 by XBOOLE_0:def 2;
A6: not MD2.m in rng <*inf A*>
     proof
      assume MD2.m in rng <*inf A*>;
      then MD2.m in {inf A} by FINSEQ_1:55;
then A7:  MD2.m = inf A by TARSKI:def 1;
      consider n such that
A8:  n in dom D2 & m=len <*inf A*>+n by A2,A3,FINSEQ_1:38;
          n in Seg len D2 by A8,FINSEQ_1:def 3;
then A9:  1 <= n & n <= len D2 by FINSEQ_1:3;
          rng D2 <> {};
then A10:  1 in dom D2 by FINSEQ_3:34;
          D2.n=MD2.m by A8,FINSEQ_1:def 7;
      hence contradiction by A1,A7,A8,A9,A10,GOBOARD2:18;
     end;
         now per cases by A2,FINSEQ_1:38;
      suppose A11:n in dom <*inf A*>;
      then n in Seg len <*inf A*> by FINSEQ_1:def 3;
      then n in {1} by FINSEQ_1:4,56;
then A12:  n = 1 by TARSKI:def 1;
      consider k such that
A13:  k in dom D2 & MD2.m = D2.k by A5,A6,PARTFUN1:26;
          k in Seg len D2 by A13,FINSEQ_1:def 3;
then A14:  1 <= k & k <= len D2 by FINSEQ_1:3;
          rng D2 <> {};
      then 1 in dom D2 by FINSEQ_3:34;
then A15:  D2.1 <= MD2.m by A13,A14,GOBOARD2:18;
          MD2.n = <*inf A*>.n by A11,FINSEQ_1:def 7 .= inf A by A12,
FINSEQ_1:def 8
;
      hence MD2.n < MD2.m by A1,A15,XXREAL_0:2;
      end;
      suppose ex i st i in dom D2 & n = len <*inf A*> + i;
      then consider i such that
A16:  i in dom D2 & n=len <*inf A*> + i;
      consider j such that
A17:  j in dom D2 & m=len <*inf A*> + j by A2,A3,FINSEQ_1:38;
A18:  i < j by A2,A16,A17,XREAL_1:8;
A19:  D2.i=MD2.n by A16,FINSEQ_1:def 7;
          D2.j=MD2.m by A17,FINSEQ_1:def 7;
      hence thesis by A16,A17,A18,A19,GOBOARD1:def 1;
     end;
     end;
     hence thesis;
    end;
    hence thesis by GOBOARD1:def 1;
end;

Lm11:for A be closed-interval Subset of REAL,
        f being PartFunc of A,REAL,
        D1, MD1 being Element of divs A
  st MD1 = <*inf A*>^D1 holds
  (for i st i in Seg len D1 holds divset(MD1,i+1)=divset(D1,i)) &
  upper_volume(f,D1)=upper_volume(f,MD1)/^1 &
  lower_volume(f,D1)=lower_volume(f,MD1)/^1
proof
    let A be closed-interval Subset of REAL,
        f being PartFunc of A,REAL,
        D1, MD1 being Element of divs A;
    assume A1:MD1 = <*inf A*>^D1;
then A2: len MD1=len <*inf A*> + len D1 by FINSEQ_1:35
           .= 1+len D1 by FINSEQ_1:56;
    thus A3:for i st i in Seg len D1 holds divset(MD1,i+1)=divset(D1,i)
    proof
     let i;
     assume A4:i in Seg len D1;
then A5:  1 <= i & i <= len D1 by FINSEQ_1:3;
A6:  i in dom D1 by A4,FINSEQ_1:def 3;
A7:  1 <= i+1 by NAT_1:11;
         i+1 <= len D1+1 by A5,XREAL_1:8;
     then i+1 <= len D1 + len<*inf A*> by FINSEQ_1:56;
     then i+1 <= len MD1 by A1,FINSEQ_1:35;
then A8:  i+1 in dom MD1 by A7,FINSEQ_3:27;
A9:  divset(D1,i)=[.inf divset(D1,i), sup divset(D1,i).] by INTEGRA1:5;
         inf divset(D1,i)=inf divset(MD1,i+1)
     & sup divset(D1,i)=sup divset(MD1,i+1)
     proof
      per cases;
       suppose A10:i=1;
           i+1 > 1 by A5,NAT_1:13;
then A11:   inf divset(MD1,i+1)=MD1.(i+1-1) & sup divset(MD1,i+1)=MD1.(i+1)
       by A8,INTEGRA1:def 5;
then A12:   inf divset(MD1,i+1) = inf A by A1,A10,FINSEQ_1:58;
           MD1.(i+1) = MD1.(i+len <*inf A*>) by FINSEQ_1:57
       .= D1.i by A1,A6,FINSEQ_1:def 7;
       hence thesis by A6,A10,A11,A12,INTEGRA1:def 5;
       end;
       suppose A13:i<>1;
A14:   i+1 > 1 by A5,NAT_1:13;
           i-1 in dom D1 & i-1 in NAT by A6,A13,INTEGRA1:9;
       then D1.(i-1) = MD1.(i-1+len <*inf A*>) by A1,FINSEQ_1:def 7
       .=MD1.(i-1+1) by FINSEQ_1:56 .=MD1.(i+1-1);
then A15:   inf divset(D1,i)=MD1.(i+1-1) by A6,A13,INTEGRA1:def 5
       .=inf divset(MD1,i+1) by A8,A14,INTEGRA1:def 5;
           MD1.(i+1) = MD1.(i+len <*inf A*>) by FINSEQ_1:57
       .= D1.i by A1,A6,FINSEQ_1:def 7;
       then sup divset(MD1,i+1)=D1.i by A8,A14,INTEGRA1:def 5
       .= sup divset(D1,i) by A6,A13,INTEGRA1:def 5;
       hence thesis by A15;
     end;
     end;
     hence thesis by A9,INTEGRA1:5;
    end;
    thus upper_volume(f,D1)=upper_volume(f,MD1)/^1
    proof
      set D2 = D1, MD2 = MD1;
A16:  len upper_volume(f,D2)=len (upper_volume(f,MD2)/^1)
     proof
          rng upper_volume(f,MD2) <> {};
      then 1 in dom upper_volume(f,MD2) by FINSEQ_3:34;
      then 1 <= len upper_volume(f,MD2) by FINSEQ_3:27;
      then len (upper_volume(f,MD2)/^1)=len upper_volume(f,MD2)-1 by
RFINSEQ:def 2
      .=len MD2 -1 by INTEGRA1:def 7
      .=len D2 by A2;
      hence thesis by INTEGRA1:def 7;
     end;
         1 <= k & k <= len upper_volume(f,D2) implies
     upper_volume(f,D2).k = (upper_volume(f,MD2)/^1).k
     proof
      assume A17:1 <= k & k <= len upper_volume(f,D2);
      then k in Seg len upper_volume(f,D2) by FINSEQ_1:3;
then A18:   k in Seg len D2 by INTEGRA1:def 7;
then A19:   upper_volume(f,D2).k=(sup rng(f|divset(D2,k)))*vol(divset(D2,k))
      by INTEGRA1:def 7 .=(sup rng(f|divset(MD2,k+1)))*vol(divset(D2,k))
      by A3,A18 .=(sup rng(f|divset(MD2,k+1)))*vol(divset(MD2,k+1)) by A3,A18;
A20:  1 <= k+1 by NAT_1:11;
          k+1 <= len upper_volume(f,D2)+1 by A17,XREAL_1:8;
      then k+1 <= len D2+1 by INTEGRA1:def 7;
then A21:   k+1 in Seg len MD2 by A2,A20,FINSEQ_1:3;
A22:   k in dom (upper_volume(f,MD2)/^1) by A16,A17,FINSEQ_3:27;
A23:   len (upper_volume(f,MD2)/^1) <= len upper_volume(f,MD2) by FINSEQ_5:28;
          1 <= len upper_volume(f,D2) by A17,XXREAL_0:2;
      then 1 <= len upper_volume(f,MD2) by A16,A23,XXREAL_0:2;
      then (upper_volume(f,MD2)/^1).k=upper_volume(f,MD2).(k+1) by A22,
RFINSEQ:def 2
      .=(sup rng(f|divset(MD2,k+1)))*vol(divset(MD2,k+1))
      by A21,INTEGRA1:def 7;
      hence thesis by A19;
     end;
     hence thesis by A16,FINSEQ_1:18;
    end;
A24:  len lower_volume(f,D1)=len (lower_volume(f,MD1)/^1)
     proof
          rng lower_volume(f,MD1) <> {};
      then 1 in dom lower_volume(f,MD1) by FINSEQ_3:34;
      then 1 <= len lower_volume(f,MD1) by FINSEQ_3:27;
      then len (lower_volume(f,MD1)/^1)=len lower_volume(f,MD1)-1 by
RFINSEQ:def 2
      .=len MD1 -1 by INTEGRA1:def 8
      .=len D1 by A2;
      hence thesis by INTEGRA1:def 8;
     end;
         1 <= k & k <= len lower_volume(f,D1) implies
     lower_volume(f,D1).k = (lower_volume(f,MD1)/^1).k
     proof
      assume A25:1 <= k & k <= len lower_volume(f,D1);
      then k in Seg len lower_volume(f,D1) by FINSEQ_1:3;
then A26:   k in Seg len D1 by INTEGRA1:def 8;
then A27:   lower_volume(f,D1).k=(inf rng(f|divset(D1,k)))*vol(divset(D1,k))
      by INTEGRA1:def 8 .=(inf rng(f|divset(MD1,k+1)))*vol(divset(D1,k))
      by A3,A26
      .=(inf rng(f|divset(MD1,k+1)))*vol(divset(MD1,k+1)) by A3,A26;
A28:  1 <= k+1 by NAT_1:11;
A29:   len MD1=len <*inf A*>+len D1 by A1,FINSEQ_1:35
              .=len D1 + 1 by FINSEQ_1:56;
          k+1 <= len lower_volume(f,D1)+1 by A25,XREAL_1:8;
      then k+1 <= len D1+1 by INTEGRA1:def 8;
then A30:   k+1 in Seg len MD1 by A28,A29,FINSEQ_1:3;
A31:   k in dom (lower_volume(f,MD1)/^1) by A24,A25,FINSEQ_3:27;
A32:   len (lower_volume(f,MD1)/^1) <= len lower_volume(f,MD1) by FINSEQ_5:28;
          1 <= len (lower_volume(f,MD1)/^1) by A24,A25,XXREAL_0:2;
      then 1 <= len lower_volume(f,MD1) by A32,XXREAL_0:2;
      then (lower_volume(f,MD1)/^1).k=lower_volume(f,MD1).(k+1) by A31,
RFINSEQ:def 2
      .=(inf rng(f|divset(MD1,k+1)))*vol(divset(MD1,k+1))
      by A30,INTEGRA1:def 8;
      hence thesis by A27;
     end;
     hence thesis by A24,FINSEQ_1:18;
end;

Lm12:for A be closed-interval Subset of REAL, D2, MD2 being Element of divs A
  st MD2 = <*inf A*>^D2 holds vol(divset(MD2,1))=0
    proof
     let A be closed-interval Subset of REAL, D2,MD2 be Element of divs A;
     assume A1:MD2 = <*inf A*>^D2;
         rng MD2 <> {};
     then 1 in dom MD2 by FINSEQ_3:34;
     then inf divset(MD2,1) = inf A & sup divset(MD2,1) = MD2.1 by
INTEGRA1:def 5;
     then vol(divset(MD2,1)) = MD2.1 - inf A by INTEGRA1:def 6.=inf A-inf A
     by A1,FINSEQ_1:58;
     hence thesis;
  end;

Lm13:
for A be closed-interval Subset of REAL, f be Function of A,REAL,
    D1,MD1 be Element of divs A st MD1 = <*inf A*>^D1 holds
     delta(MD1)=delta(D1)
    proof
     let A be closed-interval Subset of REAL, f be Function of A,REAL,
         D1,MD1 be Element of divs A;
     assume A1:MD1 = <*inf A*>^D1;
then A2: vol(divset(MD1,1))=0 by Lm12;
     A3: delta(D1)=max rng upper_volume(chi(A,A),D1) by INTEGRA1:def 19;
then delta(D1) in rng upper_volume(chi(A,A),D1)
     & for x st x in rng upper_volume(chi(A,A),D1) holds x <= delta(D1)
     by PRE_CIRC:def 1;
     then consider i such that
A4:  i in dom upper_volume(chi(A,A),D1) & upper_volume(chi(A,A),D1).i=delta(D1)
     by PARTFUN1:26;
     A5: delta(MD1)=max rng upper_volume(chi(A,A),MD1) by INTEGRA1:def 19;
then delta(MD1) in rng upper_volume(chi(A,A),MD1)
     &for x st x in rng upper_volume(chi(A,A),MD1) holds x <= delta(MD1)
     by PRE_CIRC:def 1;
     then consider j such that
A6:  j in dom upper_volume(chi(A,A),MD1)&upper_volume(chi(A,A),MD1).j=delta(MD1
)
     by PARTFUN1:26;
         i in Seg len upper_volume(chi(A,A),D1) by A4,FINSEQ_1:def 3;
then A7:  i in Seg len D1 by INTEGRA1:def 7;
then A8:  delta(D1)=(sup rng (chi(A,A)|divset(D1,i)))*vol(divset(D1,i))
     by A4,INTEGRA1:def 7
     .=(sup rng(chi(A,A)|divset(MD1,i+1)))*vol(divset(D1,i)) by A1,A7,Lm11
     .=(sup rng (chi(A,A)|divset(MD1,i+1)))*vol(divset(MD1,i+1)) by A1,A7,Lm11;
         i in dom D1 by A7,FINSEQ_1:def 3;
     then len <*inf A*>+i in dom MD1 by A1,FINSEQ_1:41;
     then i+1 in dom MD1 by FINSEQ_1:56;
then A9:  i+1 in Seg len MD1 by FINSEQ_1:def 3;
then A10:  delta(D1)=upper_volume(chi(A,A),MD1).(i+1) by A8,INTEGRA1:def 7;
         i+1 in Seg len upper_volume(chi(A,A),MD1) by A9,INTEGRA1:def 7;
     then i+1 in dom upper_volume(chi(A,A),MD1) by FINSEQ_1:def 3;
     then delta(D1) in rng upper_volume(chi(A,A),MD1) by A10,FUNCT_1:def 5;
then A11:  delta(D1) <= delta(MD1) by A5,PRE_CIRC:def 1;
         j in Seg len upper_volume(chi(A,A),MD1) by A6,FINSEQ_1:def 3;
then A12: j in Seg len MD1 by INTEGRA1:def 7;
then A13: delta(MD1)=(sup rng(chi(A,A)|divset(MD1,j)))*vol(divset(MD1,j))
     by A6,INTEGRA1:def 7;
         delta(MD1) <= delta(D1)
     proof
      per cases;
       suppose j=1;
       hence thesis by A2,A13,Th8;
       end;
       suppose j<>1;
       then not(j in Seg 1) by FINSEQ_1:4,TARSKI:def 1;
       then not(j in Seg len <*inf A*>) by FINSEQ_1:56;
then A14:   not(j in dom <*inf A*>) by FINSEQ_1:def 3;
           j in dom MD1 by A12,FINSEQ_1:def 3;
       then consider k such that
A15:   k in dom D1 & j=len <*inf A*>+k by A1,A14,FINSEQ_1:38;
A16:   k in Seg len D1 by A15,FINSEQ_1:def 3;
       then divset(D1,k)=divset(MD1,k+1) by A1,Lm11
       .=divset(MD1,j) by A15,FINSEQ_1:56;
       then delta(MD1) = (sup rng(chi(A,A)|divset(D1,k)))*vol(divset(D1,k))
         by A6,A12,INTEGRA1:def 7;
then A17:   delta(MD1)=upper_volume(chi(A,A),D1).k by A16,INTEGRA1:def 7;
           k in Seg len upper_volume(chi(A,A),D1) by A16,INTEGRA1:def 7;
       then k in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
       then delta(MD1) in rng upper_volume(chi(A,A),D1) by A17,FUNCT_1:def 5;
       hence thesis by A3,PRE_CIRC:def 1;
     end;
     end;
     hence thesis by A11,XXREAL_0:1;
    end;

theorem Th12:
for A be closed-interval Subset of REAL, f be Function of A,REAL,
D1,D2 be Element of divs A st x in divset(D1,len D1) & vol(A)<>0
& D1<=D2 & rng D2 = rng D1 \/ {x} & f is_bounded_on A & x > inf A
holds Sum lower_volume(f,D2)-Sum
lower_volume(f,D1)<=(sup rng f-inf rng f)*delta(D1)
proof
   let A be closed-interval Subset of REAL;
   let f be Function of A,REAL;
   let D1,D2 be Element of divs A;
   assume that A1:x in divset(D1,len D1) and A2:vol(A)<>0 and A3:D1 <= D2
   and A4:rng D2 = rng D1 \/ {x} and A5:f is_bounded_on A
   and A6:x > inf A;
       len D1 <> 0 by FINSEQ_1:25;
   then len D1 in Seg len D1 by FINSEQ_1:5;
then A7:1 <= len D1 by FINSEQ_1:3;
   then len D1 = 1 or len D1 > 1 by REAL_1:def 5;
then A8:len D1 = 1 or len D1 >= 1+1 by NAT_1:13;
       now per cases by A8;
    suppose A9:len D1 = 1;
then A10: D1.1=sup A by INTEGRA1:def 2;
        vol(A) >= 0 by INTEGRA1:11;
    then D1.1 - inf A > 0 by A2,A10,INTEGRA1:def 6;
then A11:inf A < D1.1 by REAL_2:106;
    reconsider MD1 = <*inf A*>^D1
      as non empty increasing FinSequence of REAL by A2,A9,Lm9;
        MD1 is DivisionPoint of A
    proof
         y in rng MD1 implies y in A
     proof
      assume y in rng MD1;
then A12:   y in rng <*inf A*> \/ rng D1 by FINSEQ_1:44;
      per cases by A12,XBOOLE_0:def 2;
       suppose y in rng <*inf A*>;
       then y in {inf A} by FINSEQ_1:55;
then A13:    y = inf A by TARSKI:def 1;
       consider a,b such that
A14:    a <= b & a = inf A & b = sup A by INTEGRA1:4;
       thus thesis by A13,A14,INTEGRA2:1;
       end;
       suppose A15:y in rng D1;
           rng D1 c= A by INTEGRA1:def 2;
       hence thesis by A15;
     end;
     end;
then A16: rng MD1 c= A by SUBSET_1:7;
         MD1.(len MD1) = sup A
     proof
A17:   len MD1 = len <*inf A*> + len D1 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D1 by A7,XREAL_1:8;
      then MD1.(len MD1)=D1.(len <*inf A*>+len D1-len <*inf A*>) by A17,
FINSEQ_1:36
      .=D1.(len D1);
      hence thesis by INTEGRA1:def 2;
     end;
     hence thesis by A16,INTEGRA1:def 2;
    end;
    then reconsider MD1 as Element of divs A by INTEGRA1:def 4;
        rng D2 <> {};
then A18: 1 in dom D2 by FINSEQ_3:34;
then A19: 1 <= len D2 by FINSEQ_3:27;
A20: D2.1 in rng D2 by A18,FUNCT_1:def 5;
A21:inf A < D2.1
    proof
     per cases by A4,A20,XBOOLE_0:def 2;
      suppose D2.1 in rng D1;
      then consider k such that
A22:  k in dom D1 & D1.k = D2.1 by PARTFUN1:26;
A23:  1 <= k & k <= len D1 by A22,FINSEQ_3:27;
          rng D1 <> {};
      then 1 in dom D1 by FINSEQ_3:34;
      then D1.1 <= D2.1 by A22,A23,GOBOARD2:18;
      hence thesis by A11,XXREAL_0:2;
      end;
      suppose D2.1 in {x};
      hence thesis by A6,TARSKI:def 1;
    end;
    end;
    set MD2=<*inf A*>^D2;
    reconsider MD2 as non empty increasing FinSequence of REAL by A21,Lm10;
        MD2 is DivisionPoint of A
    proof
         y in rng MD2 implies y in A
     proof
      assume y in rng MD2;
then A24:   y in rng <*inf A*> \/ rng D2 by FINSEQ_1:44;
      per cases by A24,XBOOLE_0:def 2;
       suppose y in rng <*inf A*>;
       then y in {inf A} by FINSEQ_1:55;
then A25:    y = inf A by TARSKI:def 1;
       consider a,b such that
A26:    a <= b & a = inf A & b = sup A by INTEGRA1:4;
       thus thesis by A25,A26,INTEGRA2:1;
       end;
       suppose A27:y in rng D2;
           rng D2 c= A by INTEGRA1:def 2;
       hence thesis by A27;
     end;
     end;
then A28: rng MD2 c= A by SUBSET_1:7;
         MD2.(len MD2) = sup A
     proof
A29:  len MD2 = len <*inf A*> + len D2 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D2 by A19,XREAL_1:8;
      then MD2.(len MD2)=D2.(len <*inf A*>+len D2-len <*inf A*>) by A29,
FINSEQ_1:36
      .=D2.(len D2);
      hence thesis by INTEGRA1:def 2;
     end;
     hence thesis by A28,INTEGRA1:def 2;
    end;
    then reconsider MD2 as Element of divs A by INTEGRA1:def 4;
A30: len MD1=len <*inf A*> + len D1 by FINSEQ_1:35 .= 1+len D1 by FINSEQ_1:56;
A31: 1+len D1 >= 1+1 by A7,XREAL_1:8;
A32: x in divset(MD1,len MD1)
    proof
A33: inf divset(D1,len D1) <= x & x <= sup divset(D1,len D1) by A1,INTEGRA2:1;
A34: len D1 in dom D1 by FINSEQ_5:6;
A35: len MD1 in dom MD1 by FINSEQ_5:6;
A36: len MD1 <> 1 by A30,A31;
         len MD1 - 1 =len D1 by A30;
     then inf divset(MD1,len MD1) = MD1.(len D1) by A35,A36,INTEGRA1:def 5
     .=inf A by A9,FINSEQ_1:58;
then A37: inf divset(D1,len D1) = inf divset(MD1,len MD1) by A9,A34,
INTEGRA1:def 5;
         MD1.(len MD1) = MD1.(len <*inf A*> + len D1) by FINSEQ_1:35
     .=D1.(len D1) by A34,FINSEQ_1:def 7;
     then sup divset(MD1,len MD1)=D1.(len D1) by A35,A36,INTEGRA1:def 5
     .= sup divset(D1,len D1)
     by A9,A34,INTEGRA1:def 5;
     hence thesis by A33,A37,INTEGRA2:1;
    end;
A38:MD1<=MD2
    proof
A39: len D1 <= len D2 & rng D1 c= rng D2 by A3,INTEGRA1:def 20;
     then len D1+len <*inf A*> <= len D2+len <*inf A*> by XREAL_1:8;
     then len MD1 <= len D2+len <*inf A*> by FINSEQ_1:35;
then A40: len MD1 <= len MD2 by FINSEQ_1:35;
         rng D1 \/ rng<*inf A*> c= rng D2 \/ rng <*inf A*> by A39,XBOOLE_1:9;
     then rng MD1 c= rng D2 \/ rng <*inf A*> by FINSEQ_1:44;
     then rng MD1 c= rng MD2 by FINSEQ_1:44;
     hence thesis by A40,INTEGRA1:def 20;
    end;
        rng MD2 = rng D2 \/ rng <*inf A*> by FINSEQ_1:44
     .=rng D1 \/ rng <*inf A*> \/ {x} by A4,XBOOLE_1:4;
    then rng MD2 = rng MD1 \/ {x} by FINSEQ_1:44;
then A41:Sum lower_volume(f,MD2)-Sum
    lower_volume(f,MD1)<=(sup rng f-inf rng f)*delta(MD1)
    by A5,A30,A31,A32,A38,Th9;
A42:vol(divset(MD1,1))=0 by Lm12;
        lower_volume(f,D1)=lower_volume(f,MD1)/^1 by Lm11;
    then lower_volume(f,MD1)=<*(lower_volume(f,MD1))/.1*>^lower_volume(f,D1)
    by FINSEQ_5:32;
then A43:Sum lower_volume(f,MD1)=((lower_volume(f,MD1))/.1)+Sum lower_volume(f,
D1)
    by RVSUM_1:106;
        rng MD1 <> {};
    then 1 in dom MD1 by FINSEQ_3:34;
then A44:1 in Seg len MD1 by FINSEQ_1:def 3;
then A45:lower_volume(f,MD1).1 = (inf rng(f|divset(MD1,1)))*vol(divset(MD1,1))
    by INTEGRA1:def 8;
        1 in Seg len lower_volume(f,MD1) by A44,INTEGRA1:def 8;
    then 1 in dom lower_volume(f,MD1) by FINSEQ_1:def 3;
    then A46: lower_volume(f,MD1)/.1 = 0 by A42,A45,FINSEQ_4:def 4;
A47:vol(divset(MD2,1))=0 by Lm12;
        lower_volume(f,D2)=lower_volume(f,MD2)/^1 by Lm11;
    then lower_volume(f,MD2)=<*(lower_volume(f,MD2))/.1*>^lower_volume(f,D2)
    by FINSEQ_5:32;
then A48:Sum lower_volume(f,MD2)=(lower_volume(f,MD2))/.1+Sum lower_volume(f,D2
)
    by RVSUM_1:106;
        rng MD2 <> {};
    then 1 in dom MD2 by FINSEQ_3:34;
then A49:1 in Seg len MD2 by FINSEQ_1:def 3;
    then A50: lower_volume(f,MD2).1 = (inf rng(f|divset(MD2,1)))*vol(divset(MD2
,1))
    by INTEGRA1:def 8;
        1 in Seg len lower_volume(f,MD2) by A49,INTEGRA1:def 8;
    then 1 in dom lower_volume(f,MD2) by FINSEQ_1:def 3;
    then lower_volume(f,MD2)/.1 = 0 by A47,A50,FINSEQ_4:def 4;
    hence Sum lower_volume(f,D2)-Sum lower_volume(f,D1)<=
    (sup rng f-inf rng f)*delta(D1) by A41,A43,A46,A48,Lm13;
    end;
    suppose len D1 >= 2;
    hence thesis by A1,A3,A4,A5,Th9;
   end;
   end;
   hence thesis;
end;

theorem Th13:
for A be closed-interval Subset of REAL, f be Function of A,REAL,
D1,D2 be Element of divs A st x in divset(D1,len D1) & vol(A)<>0
& D1<=D2 & rng D2 = rng D1 \/ {x} & f is_bounded_on A & x > inf A
holds Sum upper_volume(f,D1)-Sum
upper_volume(f,D2)<=(sup rng f-inf rng f)*delta(D1)
proof
   let A be closed-interval Subset of REAL;
   let f be Function of A,REAL;
   let D1,D2 be Element of divs A;
   assume that A1:x in divset(D1,len D1) and A2:vol(A)<>0 and A3:D1 <= D2
   and A4:rng D2 = rng D1 \/ {x} and A5:f is_bounded_on A
   and A6:x > inf A;
       len D1 <> 0 by FINSEQ_1:25;
   then len D1 in Seg len D1 by FINSEQ_1:5;
then A7:1 <= len D1 by FINSEQ_1:3;
   then len D1 = 1 or len D1 > 1 by REAL_1:def 5;
then A8:len D1 = 1 or len D1 >= 1+1 by NAT_1:13;
       now per cases by A8;
    suppose A9:len D1 = 1;
then A10: D1.1=sup A by INTEGRA1:def 2;
        vol(A) >= 0 by INTEGRA1:11;
    then D1.1 - inf A > 0 by A2,A10,INTEGRA1:def 6;
then A11:inf A < D1.1 by REAL_2:106;
    reconsider MD1 = <*inf A*>^D1 as non empty increasing FinSequence of REAL
      by A2,A9,Lm9;
        MD1 is DivisionPoint of A
    proof
         y in rng MD1 implies y in A
     proof
      assume y in rng MD1;
then A12:   y in rng <*inf A*> \/ rng D1 by FINSEQ_1:44;
      per cases by A12,XBOOLE_0:def 2;
       suppose y in rng <*inf A*>;
       then y in {inf A} by FINSEQ_1:55;
then A13:    y = inf A by TARSKI:def 1;
       consider a,b such that
A14:    a <= b & a = inf A & b = sup A by INTEGRA1:4;
       thus thesis by A13,A14,INTEGRA2:1;
       end;
       suppose A15:y in rng D1;
           rng D1 c= A by INTEGRA1:def 2;
       hence thesis by A15;
     end;
     end;
then A16: rng MD1 c= A by SUBSET_1:7;
         MD1.(len MD1) = sup A
     proof
A17:   len MD1 = len <*inf A*> + len D1 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D1 by A7,XREAL_1:8;
      then MD1.(len MD1)=D1.(len <*inf A*>+len D1-len <*inf A*>) by A17,
FINSEQ_1:36
      .=D1.(len D1);
      hence thesis by INTEGRA1:def 2;
     end;
     hence thesis by A16,INTEGRA1:def 2;
    end;
    then reconsider MD1 as Element of divs A by INTEGRA1:def 4;
        rng D2 <> {};
then A18: 1 in dom D2 by FINSEQ_3:34;
then A19: 1 <= len D2 by FINSEQ_3:27;
A20:D2.1 in rng D2 by A18,FUNCT_1:def 5;
A21:inf A < D2.1
    proof
     per cases by A4,A20,XBOOLE_0:def 2;
      suppose D2.1 in rng D1;
      then consider k such that
A22:   k in dom D1 & D1.k = D2.1 by PARTFUN1:26;
A23:   1 <= k & k <= len D1 by A22,FINSEQ_3:27;
          rng D1 <> {};
      then 1 in dom D1 by FINSEQ_3:34;
      then D1.1 <= D2.1 by A22,A23,GOBOARD2:18;
      hence thesis by A11,XXREAL_0:2;
      end;
      suppose D2.1 in {x};
      hence thesis by A6,TARSKI:def 1;
    end;
    end;
    set MD2=<*inf A*>^D2;
    reconsider MD2 as non empty increasing FinSequence of REAL by A21,Lm10;
        MD2 is DivisionPoint of A
    proof
         y in rng MD2 implies y in A
     proof
      assume y in rng MD2;
then A24:   y in rng <*inf A*> \/ rng D2 by FINSEQ_1:44;
      per cases by A24,XBOOLE_0:def 2;
       suppose y in rng <*inf A*>;
       then y in {inf A} by FINSEQ_1:55;
then A25:    y = inf A by TARSKI:def 1;
       consider a,b such that
A26:    a <= b & a = inf A & b = sup A by INTEGRA1:4;
       thus thesis by A25,A26,INTEGRA2:1;
       end;
       suppose A27:y in rng D2;
           rng D2 c= A by INTEGRA1:def 2;
       hence thesis by A27;
     end;
     end;
then A28: rng MD2 c= A by SUBSET_1:7;
         MD2.(len MD2) = sup A
     proof
A29:   len MD2 = len <*inf A*> + len D2 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D2 by A19,XREAL_1:8;
      then MD2.(len MD2)=D2.(len <*inf A*>+len D2-len <*inf A*>) by A29,
FINSEQ_1:36
      .=D2.(len D2);
      hence thesis by INTEGRA1:def 2;
     end;
     hence thesis by A28,INTEGRA1:def 2;
    end;
    then reconsider MD2 as Element of divs A by INTEGRA1:def 4;
A30: len MD1=len <*inf A*> + len D1 by FINSEQ_1:35 .= 1+len D1 by FINSEQ_1:56;
A31:1+len D1 >= 1+1 by A7,XREAL_1:8;
A32: x in divset(MD1,len MD1)
    proof
A33:  inf divset(D1,len D1) <= x & x <= sup divset(D1,len D1) by A1,INTEGRA2:1;
A34:  len D1 in dom D1 by FINSEQ_5:6;
A35:  len MD1 in dom MD1 by FINSEQ_5:6;
A36: len MD1 <> 1 by A30,A31;
         len MD1 - 1 = len D1 by A30;
     then inf divset(MD1,len MD1) = MD1.(len D1) by A35,A36,INTEGRA1:def 5
     .=inf A by A9,FINSEQ_1:58;
then A37:  inf divset(D1,len D1) = inf divset(MD1,len MD1) by A9,A34,
INTEGRA1:def 5;
         MD1.(len MD1) = MD1.(len <*inf A*> + len D1) by FINSEQ_1:35
     .=D1.(len D1) by A34,FINSEQ_1:def 7;
     then sup divset(MD1,len MD1)=D1.(len D1) by A35,A36,INTEGRA1:def 5
     .= sup divset(D1,len D1) by A9,A34,INTEGRA1:def 5;
     hence thesis by A33,A37,INTEGRA2:1;
    end;
A38:MD1<=MD2
    proof
A39: len D1 <= len D2 & rng D1 c= rng D2 by A3,INTEGRA1:def 20;
     then len D1+len <*inf A*> <= len D2+len <*inf A*> by XREAL_1:8;
     then len MD1 <= len D2+len <*inf A*> by FINSEQ_1:35;
then A40: len MD1 <= len MD2 by FINSEQ_1:35;
         rng D1 \/ rng<*inf A*> c= rng D2 \/ rng <*inf A*> by A39,XBOOLE_1:9;
     then rng MD1 c= rng D2 \/ rng <*inf A*> by FINSEQ_1:44;
     then rng MD1 c= rng MD2 by FINSEQ_1:44;
     hence thesis by A40,INTEGRA1:def 20;
    end;
        rng MD2 = rng MD1 \/ {x}
    proof
         rng MD2 = rng D2 \/ rng <*inf A*> by FINSEQ_1:44
     .=rng D1 \/ rng <*inf A*> \/ {x} by A4,XBOOLE_1:4;
     hence thesis by FINSEQ_1:44;
    end;
then A41:Sum upper_volume(f,MD1)-Sum upper_volume(f,MD2)
    <=(sup rng f-inf rng f)*delta(MD1) by A5,A30,A31,A32,A38,Th10;
A42:vol(divset(MD1,1))=0 by Lm12;
        upper_volume(f,D1)=upper_volume(f,MD1)/^1 by Lm11;
    then upper_volume(f,MD1)=<*upper_volume(f,MD1)/.1*>^upper_volume(f,D1)
    by FINSEQ_5:32;
then A43:Sum upper_volume(f,MD1)=(upper_volume(f,MD1)/.1)+Sum upper_volume(f,D1
)
    by RVSUM_1:106;
        rng MD1 <> {};
    then 1 in dom MD1 by FINSEQ_3:34;
then A44:1 in Seg len MD1 by FINSEQ_1:def 3;
then A45:upper_volume(f,MD1).1 = (sup rng(f|divset(MD1,1)))*vol(divset(MD1,1))
    by INTEGRA1:def 7;
        1 in Seg len upper_volume(f,MD1) by A44,INTEGRA1:def 7;
    then 1 in dom upper_volume(f,MD1) by FINSEQ_1:def 3;
    then A46: upper_volume(f,MD1)/.1 = 0 by A42,A45,FINSEQ_4:def 4;
A47:vol(divset(MD2,1))=0 by Lm12;
        upper_volume(f,D2)=upper_volume(f,MD2)/^1 by Lm11;
    then upper_volume(f,MD2)=<*upper_volume(f,MD2)/.1*>^upper_volume(f,D2)
    by FINSEQ_5:32;
then A48:Sum upper_volume(f,MD2)=(upper_volume(f,MD2)/.1)+Sum upper_volume(f,D2
)
    by RVSUM_1:106;
        rng MD2 <> {};
    then 1 in dom MD2 by FINSEQ_3:34;
then A49:1 in Seg len MD2 by FINSEQ_1:def 3;
then A50:upper_volume(f,MD2).1 = (sup rng(f|divset(MD2,1)))*vol(divset(MD2,1))
    by INTEGRA1:def 7;
        1 in Seg len upper_volume(f,MD2) by A49,INTEGRA1:def 7;
    then 1 in dom upper_volume(f,MD2) by FINSEQ_1:def 3;
    then upper_volume(f,MD2)/.1 = 0 by A47,A50,FINSEQ_4:def 4;
    hence Sum upper_volume(f,D1)-Sum upper_volume(f,D2)<=
    (sup rng f-inf rng f)*delta(D1) by A41,A43,A46,A48,Lm13;
    end;
    suppose len D1 >= 2;
    hence thesis by A1,A3,A4,A5,Th10;
   end;
   end;
   hence thesis;
end;

theorem Th14:
for A be closed-interval Subset of REAL, D1,D2 be Element of divs A,
r be Real, i,j be Element of NAT st i in dom D1 & j in dom D1 & i<=j & D1 <= D2
& r < mid(D2,indx(D2,D1,i),indx(D2,D1,j)).1
holds ex B be closed-interval Subset of REAL, MD1,MD2 be Element of divs B
st r=inf B & sup B=MD2.(len MD2) & sup B=MD1.(len MD1) & MD1 <= MD2
& MD1=mid(D1,i,j) & MD2=mid(D2,indx(D2,D1,i),indx(D2,D1,j))
proof
   let A be closed-interval Subset of REAL;
   let D1,D2 be Element of divs A;
   let r be Real;
   let i,j;
   assume A1:i in dom D1;
   assume A2:j in dom D1;
   assume A3:i <= j;
   assume A4:D1 <= D2;
   assume A5:r < mid(D2,indx(D2,D1,i),indx(D2,D1,j)).1;
    set MD1=mid(D1,i,j);
    set MD2=mid(D2,indx(D2,D1,i),indx(D2,D1,j));
A6: indx(D2,D1,i) in dom D2 & D2.indx(D2,D1,i)=D1.i by A1,A4,INTEGRA1:def 21;
A7: indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.j by A2,A4,INTEGRA1:def 21;
        D1.i <= D1.j by A1,A2,A3,GOBOARD2:18;
then A8:indx(D2,D1,i) <= indx(D2,D1,j) by A6,A7,GOBOARD1:def 1;
    then consider B being closed-interval Subset of REAL such that
A9: r = inf B & sup B=MD2.(len MD2) & len MD2=indx(D2,D1,j)-indx(D2,D1,i)+1
    &MD2 is DivisionPoint of B by A5,A6,A7,Th11;
    reconsider MD2 as Element of divs B by A9,INTEGRA1:def 3;
        indx(D2,D1,j)-indx(D2,D1,i) >= 0 by A8,XREAL_1:50;
then A10:indx(D2,D1,j)-indx(D2,D1,i)+1 >= 0+1 by XREAL_1:8;
A11:1 <= indx(D2,D1,i) & indx(D2,D1,j) <= len D2 by A6,A7,FINSEQ_3:27;
then A12:MD2.1=D2.(1+indx(D2,D1,i)-1) by A8,A10,JORDAN3:31
    .=D1.i by A1,A4,INTEGRA1:def 21;
        j-i >= 0 by A3,XREAL_1:50;
then A13:j-i+1 >= 0+1 by XREAL_1:8;
A14:1 <= i & j <= len D1 by A1,A2,FINSEQ_3:27;
then A15:MD1.1 = D1.(1+i-1) by A3,A13,JORDAN3:31 .= D1.i;
    then consider C being closed-interval Subset of REAL such that
A16:r = inf C & sup C=MD1.(len MD1) & len MD1=j-i+1
    &MD1 is DivisionPoint of C by A1,A2,A3,A5,A12,Th11;
A17:MD1.(len MD1)=D1.(j-i+1-1+i) by A3,A13,A14,A16,JORDAN3:31
    .=D1.j;
A18: MD2.(len MD2)=D2.(indx(D2,D1,j)-indx(D2,D1,i)+1-1+indx(D2,D1,i))
    by A8,A9,A10,A11,JORDAN3:31
    .= D1.j by A2,A4,INTEGRA1:def 21;
A19:B=[.inf B,sup B.] by INTEGRA1:5
    .=C by A9,A16,A17,A18,INTEGRA1:5;
    then reconsider MD1 as Element of divs B by A16,INTEGRA1:def 3;
A20:rng MD1 c= rng MD2
    proof
A21: rng MD1 c= rng D1 by JORDAN3:28;
         rng D1 c= rng D2 by A4,INTEGRA1:def 20;
then A22:  rng MD1 c= rng D2 by A21,XBOOLE_1:1;
      let x1;assume A23:x1 in rng MD1;
      then consider k2 being Element of NAT such that
A24:  k2 in dom D2 & D2.k2=x1 by A22,PARTFUN1:26;
      consider k1 being Element of NAT such that
A25:  k1 in dom MD1 & MD1.k1=x1 by A23,PARTFUN1:26;
A26:  1 <= k1 & k1 <= len MD1 by A25,FINSEQ_3:27;
      then 1 <= len MD1 by XXREAL_0:2;
then A27:  1 in dom MD1 by FINSEQ_3:27;
          len MD1 in dom MD1 by FINSEQ_5:6;
      then MD1.1<=MD1.k1 & MD1.k1<=MD1.(len MD1) by A25,A26,A27,GOBOARD2:18;
then A28:  indx(D2,D1,i) <= k2 & k2 <= indx(D2,D1,j)
      by A6,A7,A15,A17,A24,A25,GOBOARD1:def 1;
      then indx(D2,D1,i)+1<=k2+1 & k2+1<=indx(D2,D1,j)+1 by XREAL_1:8;
then A29:  1<=k2+1-indx(D2,D1,i) & k2+1-indx(D2,D1,i)<=indx(D2,D1,j)+1-indx(D2,
D1,i)
      by XREAL_1:11,21;
          indx(D2,D1,i) <= k2+1 by A28,NAT_1:12;
      then consider k3 being Nat such that
A30:  k2+1 = indx(D2,D1,i)+k3 by NAT_1:10;
       k3 in NAT by ORDINAL1:def 13;
      then A31: MD2.k3 = D2.(k3+indx(D2,D1,i)-1) by A8,A11,A29,A30,JORDAN3:31;
        k3 in dom MD2 by A9,A29,A30,FINSEQ_3:27;
      hence thesis by A24,A30,A31,FUNCT_1:def 5;
    end;
        len MD1 <= len MD2
    proof
         MD1 is one-to-one & MD2 is one-to-one by JORDAN7:17;
     then card(rng MD1) = len MD1 & card(rng MD2) = len MD2 by FINSEQ_4:77;
     hence thesis by A20,CARD_1:80;
    end;
    then MD1 <= MD2 by A20,INTEGRA1:def 20;
    hence thesis by A9,A16,A19;
end;

theorem Th15:
for A be closed-interval Subset of REAL, D be Element of divs A
st x in rng D holds D.1 <= x & x <= D.(len D)
proof
   let A be closed-interval Subset of REAL;
   let D be Element of divs A;
   assume x in rng D;
   then consider i such that
A1:i in dom D & x=D.i by PARTFUN1:26;
A2:1 <= i & i <= len D by A1,FINSEQ_3:27;
   then 1 <= len D by XXREAL_0:2;
   then 1 in dom D & len D in dom D by FINSEQ_3:27;
   hence thesis by A1,A2,GOBOARD2:18;
end;

theorem Th16:
for p be FinSequence of REAL, i,j,k st p is increasing & i in dom p
& j in dom p & k in dom p & p.i <= p.k & p.k <= p.j holds
p.k in rng mid(p,i,j)
proof
   let p be FinSequence of REAL;
   let i,j,k;
   assume that A1:p is increasing and A2:i in dom p and A3:j in dom p
   and A4:k in dom p and A5:p.i <= p.k and A6:p.k <= p.j;
A7:1 <= i & i <= len p by A2,FINSEQ_3:27;
A8:1 <= j & j <= len p by A3,FINSEQ_3:27;
A9:i <= k by A1,A2,A4,A5,GOBOARD1:def 1;
A10:k <= j by A1,A3,A4,A6,GOBOARD1:def 1;
then A11:i <= j by A9,XXREAL_0:2;
then len mid(p,i,j) = j-'i+1 by A7,A8,JORDAN3:27;
then A12:len mid(p,i,j) = j-i+1 by A11,BINARITH:50;
       i <= k+1 by A9,NAT_1:12;
   then consider n being Nat such that
A13:k+1=i+n by NAT_1:10;
       k-i >= 0 by A9,XREAL_1:50;
then A14:k-i+1 >= 0+1 by XREAL_1:8;
       k-i <= j-i by A10,XREAL_1:11;
then A15:k-i+1 <= j-i+1 by XREAL_1:8;
then A16:n in dom mid(p,i,j) by A12,A13,A14,FINSEQ_3:27;
      n in NAT by ORDINAL1:def 13;
     then mid(p,i,j).n = p.(n+i-1)
     by A7,A8,A11,A13,A14,A15,JORDAN3:31
   .=p.k by A13;
   hence thesis by A16,FUNCT_1:def 5;
end;

theorem Th17:
for A be closed-interval Subset of REAL, f be Function of A,REAL,
D be Element of divs A st f is_bounded_on A & i in dom D
holds inf rng(f|divset(D,i)) <= sup rng f
proof
   let A be closed-interval Subset of REAL;
   let f be Function of A,REAL;
   let D be Element of divs A;
   assume A1:f is_bounded_on A;
   assume i in dom D;
   then divset(D,i) c= A by INTEGRA1:10;
   hence thesis by A1,Lm5;
end;

theorem Th18:
for A be closed-interval Subset of REAL, f be Function of A,REAL,
D be Element of divs A st f is_bounded_on A & i in dom D
holds sup rng(f|divset(D,i)) >= inf rng f
proof
   let A be closed-interval Subset of REAL;
   let f be Function of A,REAL;
   let D be Element of divs A;
   assume A1:f is_bounded_on A;
   assume i in dom D;
   then divset(D,i) c= A by INTEGRA1:10;
   hence thesis by A1,Lm5;
end;

begin :: Darboux's Theorem

theorem
    for A be closed-interval Subset of REAL, f be Function of A,REAL,
T be DivSequence of A
st f is_bounded_on A & delta(T) is convergent_to_0 & vol(A)<>0
holds lower_sum(f,T) is convergent & lim lower_sum(f,T) = lower_integral(f)
proof
   let A be closed-interval Subset of REAL;
   let f be Function of A,REAL;
   let T be DivSequence of A;
   assume that A1:f is_bounded_on A and
   A2:delta(T) is convergent_to_0 and
   A3:vol(A)<>0;
A4:delta(T) is_not_0 & delta(T) is convergent & lim delta(T) = 0
   by A2,FDIFF_1:def 1;
A5:for e st e>0 ex n st for m st n<=m holds
   0 < (delta(T)).m & (delta(T)).m < e
   proof
     let e; assume e>0;
     then consider n such that
A6:  for m st n<=m holds abs((delta(T)).m-0)<e by A4,SEQ_2:def 7;
      for m st n<=m holds 0 < (delta(T)).m & (delta(T)).m < e
     proof
       let m; assume n<=m;
then A7:    abs((delta(T)).m-0)<e by A6;
           (delta(T)).m-0<=abs((delta(T)).m-0) by ABSVALUE:11;
then A8:    (delta(T)).m+abs((delta(T)).m-0)<e+abs((delta(T)).m-0) by A7,
XREAL_1:10;
        A9: (delta(T)).m<>0 by A4,SEQ_1:7;
A10:   (delta(T)).m = delta(T.m) by INTEGRA2:def 3;
           delta(T.m) = max rng upper_volume(chi(A,A),T.m) by INTEGRA1:def 19;
       then delta(T.m) in rng upper_volume(chi(A,A),T.m) by PRE_CIRC:def 1;
       then consider i such that
A11:   i in dom upper_volume(chi(A,A),T.m) &
       delta(T.m)=upper_volume(chi(A,A),T.m).i by PARTFUN1:26;
A12:   i in Seg len upper_volume(chi(A,A),T.m) by A11,FINSEQ_1:def 3;
       consider D being Element of divs A such that
A13:   D = T.m;
        i in Seg len D by A12,A13,INTEGRA1:def 7;
       then delta(T.m)=vol(divset(T.m,i)) by A11,A13,INTEGRA1:22;
       hence thesis by A8,A9,A10,XREAL_1:8,INTEGRA1:11;
     end;
     hence thesis;
   end;
A14:for D,D1 be Element of divs A holds ex D2 be Element of divs A st
   D<=D2 & D1<=D2 & rng D2=rng D1 \/
 rng D & 0<=lower_sum(f,D2)-lower_sum(f,D) &
   0<=lower_sum(f,D2)-lower_sum(f,D1)
   proof
     let D,D1 be Element of divs A;
     consider D2 be Element of divs A such that
A15: D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D by Th3;
A16: f is_bounded_below_on A by A1,RFUNCT_1:def 11;
     then lower_sum(f,D2)>=lower_sum(f,D) by A15,INTEGRA1:48;
then A17: lower_sum(f,D2)-lower_sum(f,D)>=0 by XREAL_1:50;
         lower_sum(f,D2)>=lower_sum(f,D1) by A15,A16,INTEGRA1:48;
     then lower_sum(f,D2)-lower_sum(f,D1)>=0 by XREAL_1:50;
     hence thesis by A15,A17;
   end;
A18:sup rng f >= inf rng f by A1,Lm4;
A19:for D,D1 be Element of divs A st delta(D1)<min rng upper_volume(chi(A,A),D)
  holds ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D
  & lower_sum(f,D2)-lower_sum(f,D1) <=
  (len D)*(sup(rng f)-inf(rng f))*delta(D1)
  proof
   let D,D1 be Element of divs A;
   assume A20:delta(D1)<min rng upper_volume(chi(A,A),D);
       ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D
   & lower_sum(f,D2)-lower_sum(f,D1)<=(len D)*(sup(rng f)-inf(rng f))*delta(D1)
   proof
    consider D2 be Element of divs A such that
A21: D<=D2 & D1<=D2 & rng D2=rng D1 \/
 rng D & 0<=lower_sum(f,D2)-lower_sum(f,D)
    & 0<=lower_sum(f,D2)-lower_sum(f,D1) by A14;
        lower_sum(f,D2)-lower_sum(f,D1) <=
    (len D)*(sup(rng f)-inf(rng f))*delta(D1)
    proof
     deffunc PLf(Element of divs A,Nat) = (PartSums(lower_volume(f,$1))).$2;
     deffunc LVf(Element of divs A) = lower_volume(f,$1);
A22:  for i st i in dom D holds ex j st j in dom D1 & D.i in divset(D1,j)
     & PLf(D2,indx(D2,D1,j))-PLf(D1,j)<=i*(sup(rng f)-inf(rng f))*delta(D1)
     proof
      let i; assume A23:i in dom D;
A24:   for i,j st i in dom D & j in dom D1 & D.i in divset(D1,j) holds j >= 2
      proof
       let i,j;
       assume A25:i in dom D;
       assume A26:j in dom D1 & D.i in divset(D1,j);
       assume j<2;
       then j<1+1;
then A27:   j <= 1 by NAT_1:13;
A28:   inf divset(D1,j)<=D.i & D.i<=sup divset(D1,j) by A26,INTEGRA2:1;
           j in Seg len D1 by A26,FINSEQ_1:def 3;
       then j >= 1 by FINSEQ_1:3;
       then j = 1 by A27,XXREAL_0:1;
then A29:   inf divset(D1,j)=inf A & sup divset(D1,j)=D1.j by A26,
INTEGRA1:def 5;
        delta(D1) >= min rng upper_volume(chi(A,A),D)
       proof
        per cases;
         suppose A30:i=1;
          len D <> 0 by FINSEQ_1:25;
         then len D in Seg len D by FINSEQ_1:5;
         then 1 <= len D by FINSEQ_1:3;
then A31:     1 in Seg len D by FINSEQ_1:3;
         then 1 in dom D by FINSEQ_1:def 3;
then A32:     inf divset(D,1)=inf A & sup divset(D,1)=D.1 by INTEGRA1:def 5;
             sup divset(D1,j)-inf A >= D.1-inf A by A28,A30,XREAL_1:11;
         then vol(divset(D1,j)) >= sup divset(D,1)-inf divset(D,1)
         by A29,A32,INTEGRA1:def 6;
then A33:      vol(divset(D1,j)) >= vol(divset(D,1)) by INTEGRA1:def 6;
             vol(divset(D1,j)) <= delta(D1) by A26,Lm6;
then A34:     delta(D1) >= vol(divset(D,1)) by A33,XXREAL_0:2;
             1 in Seg len upper_volume(chi(A,A),D) by A31,INTEGRA1:def 7;
then A35:     1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
             vol(divset(D,1)) = upper_volume(chi(A,A),D).1 by A31,INTEGRA1:22;
         then vol(divset(D,1)) in rng upper_volume(chi(A,A),D)
         by A35,FUNCT_1:def 5;
         then vol(divset(D,1))>=min rng upper_volume(chi(A,A),D) by
PRE_CIRC:def 4;
         hence thesis by A34,XXREAL_0:2;
         end;
         suppose A36:i<>1;
then A37:      inf divset(D,i)=D.(i-1) & sup divset(D,i)=D.i
         by A25,INTEGRA1:def 5;
then A38:      sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-inf A
         by A28,A29,XREAL_1:11;
             D.(i-1) in A by A25,A36,INTEGRA1:9;
         then inf A <= D.(i-1) by INTEGRA2:1;
         then sup divset(D,i)-inf A >= sup divset(D,i)-inf divset(D,i)
         by A37,REAL_2:106;
         then sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-inf divset(
D,i)
         by A38,XXREAL_0:2;
         then vol(divset(D1,j)) >= sup divset(D,i)-inf divset(D,i)
         by INTEGRA1:def 6;
then A39:      vol(divset(D1,j)) >= vol(divset(D,i)) by INTEGRA1:def 6;
             vol(divset(D1,j)) <= delta(D1) by A26,Lm6;
then A40:      delta(D1) >= vol(divset(D,i)) by A39,XXREAL_0:2;
A41:      i in Seg len D by A25,FINSEQ_1:def 3;
         then i in Seg len upper_volume(chi(A,A),D) by INTEGRA1:def 7;
then A42:     i in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
             vol(divset(D,i)) = upper_volume(chi(A,A),D).i by A41,INTEGRA1:22;
         then vol(divset(D,i)) in rng upper_volume(chi(A,A),D)
         by A42,FUNCT_1:def 5;
         then vol(divset(D,i))>=min rng upper_volume(chi(A,A),D) by
PRE_CIRC:def 4;
         hence thesis by A40,XXREAL_0:2;
       end;
       end;
       hence contradiction by A20;
      end;

      defpred P[non empty Element of NAT] means
      $1 in dom D implies ex j st j in dom D1 & D.$1 in divset(D1,j)
      & PLf(D2,indx(D2,D1,j))-PLf(D1,j)<=$1*(sup rng f-inf rng f)*delta(D1);
A43: P[1]
      proof
           len D <> 0 by FINSEQ_1:25;
       then len D in Seg len D by FINSEQ_1:5;
       then 1 <= len D by FINSEQ_1:3;
then A44:   1 in dom D by FINSEQ_3:27;
       then D.1 in A by INTEGRA1:8;
       then consider j such that
A45:    j in dom D1 & D.1 in divset(D1,j) by Th2;
           PLf(D2,indx(D2,D1,j))-PLf(D1,j)<=1*(sup rng f-inf rng f)*delta(D1)
       proof
A46:    j <> 1 by A24,A44,A45;
then A47:     j-1 in NAT & j-1 in dom D1 by A45,INTEGRA1:9;
        reconsider j1=j-1 as Element of NAT by A45,A46,INTEGRA1:9;
            inf divset(D1,j) <= D.1 & D.1 <= sup divset(D1,j)
        by A45,INTEGRA2:1;
then A48:    D1.j1 <= D.1 & D.1 <= D1.j by A45,A46,INTEGRA1:def 5;
A49:     indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) &
         indx(D2,D1,j1) <= len D2
        proof
         thus indx(D2,D1,j1) in dom D2 by A21,A47,INTEGRA1:def 21;
         then indx(D2,D1,j1) in Seg len D2 by FINSEQ_1:def 3;
         hence thesis by FINSEQ_1:3;
        end;
        then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
then A50:     D2|indx(D2,D1,j1) is increasing by A49,JORDAN3:25;
A51:     j1 in dom D1 & 1 <= j1 & j1 <= len D1
        proof
         thus j1 in dom D1 by A45,A46,INTEGRA1:9;
             j1 in Seg len D1 by A47,FINSEQ_1:def 3;
         hence thesis by FINSEQ_1:3;
        end;
        then mid(D1,1,j1) is increasing by INTEGRA1:37;
then A52:     D1|j1 is increasing by A51,JORDAN3:25;
A53:     rng (D2|indx(D2,D1,j1)) = rng (D1|j1)
        proof
             for x1 st x1 in rng(D2|indx(D2,D1,j1)) holds x1 in rng(D1|j1)
         proof
          let x1; assume x1 in rng(D2|indx(D2,D1,j1));
          then consider k such that
A54:      k in dom(D2|indx(D2,D1,j1)) & x1=(D2|indx(D2,D1,j1)).k
by PARTFUN1:26;
              k in Seg len(D2|indx(D2,D1,j1)) by A54,FINSEQ_1:def 3;
then A55:      k in Seg indx(D2,D1,j1) by A49,FINSEQ_1:80;
then A56:      (D2|indx(D2,D1,j1)).k = D2.k & k in dom D2 by A49,RFINSEQ:19;
then A57:       D2.k in rng D2 by FUNCT_1:def 5;
              1 <= k & k <= indx(D2,D1,j1) by A55,FINSEQ_1:3;
          then D2.k <= D2.indx(D2,D1,j1) by A49,A56,GOBOARD2:18;
then A58:      D2.k <= D1.j1 by A21,A47,INTEGRA1:def 21;
A59:      len(D1|j1) = j1 by A51,FINSEQ_1:80;
A60:      D2.k in rng D implies D2.k = D1.j1
          proof
           assume D2.k in rng D;
           then consider n such that
A61:       n in dom D & D2.k=D.n by PARTFUN1:26;
               1 <= n by A61,FINSEQ_3:27;
           then D.1 <= D2.k by A44,A61,GOBOARD2:18;
           then D1.j1 <= D2.k by A48,XXREAL_0:2;
           hence thesis by A58,XXREAL_0:1;
          end;
A62:      D2.k in rng D implies D2.k in rng(D1|j1)
          proof
           assume A63:D2.k in rng D;
               j1 in Seg len(D1|j1) by A51,A59,FINSEQ_1:3;
           then j1 in dom(D1|j1) by FINSEQ_1:def 3;
then A64:       (D1|j1).j1 in rng(D1|j1) by FUNCT_1:def 5;
               j1 in Seg j1 by A51,FINSEQ_1:3;
           hence thesis by A51,A60,A63,A64,RFINSEQ:19;
          end;
              D2.k in rng D1 implies D2.k in rng(D1|j1)
          proof
           assume D2.k in rng D1;
           then consider m such that
A65:       m in dom D1 & D2.k = D1.m by PARTFUN1:26;
               m in Seg len D1 by A65,FINSEQ_1:def 3;
then A66:       1 <= m & m <= j1 by A51,A58,A65,FINSEQ_1:3,GOBOARD1:def 1;
then A67:       m in dom (D1|j1) by A59,FINSEQ_3:27;
               m in Seg j1 by A66,FINSEQ_1:3;
           then D2.k = (D1|j1).m by A51,A65,RFINSEQ:19;
           hence thesis by A67,FUNCT_1:def 5;
          end;
          hence thesis by A21,A49,A54,A55,A57,A62,RFINSEQ:19,XBOOLE_0:def 2;
         end;
then A68:     rng(D2|indx(D2,D1,j1)) c= rng (D1|j1) by TARSKI:def 3;
             for x1 st x1 in rng(D1|j1) holds x1 in rng(D2|indx(D2,D1,j1))
         proof
          let x1; assume x1 in rng(D1|j1);
          then consider k such that
A69:      k in dom(D1|j1) & x1=(D1|j1).k by PARTFUN1:26;
              k in Seg len(D1|j1) by A69,FINSEQ_1:def 3;
then A70:      k in Seg j1 by A51,FINSEQ_1:80;
then A71:      (D1|j1).k = D1.k & k in dom D1 by A51,RFINSEQ:19;
          then D1.k in rng D1 by FUNCT_1:def 5;
          then x1 in rng D2 by A21,A69,A71,XBOOLE_0:def 2;
          then consider n such that
A72:      n in dom D2 & x1=D2.n by PARTFUN1:26;
A73:      indx(D2,D1,k) in dom D2 & D2.indx(D2,D1,k)=D2.n
          by A21,A69,A71,A72,INTEGRA1:def 21;
              k <= j1 by A70,FINSEQ_1:3;
          then D1.k <= D1.j1 by A47,A71,GOBOARD2:18;
          then D2.indx(D2,D1,k) <= D1.j1 by A21,A71,INTEGRA1:def 21;
          then D2.indx(D2,D1,k)<=D2.indx(D2,D1,j1)
          by A21,A47,INTEGRA1:def 21;
then A74:       n <= indx(D2,D1,j1) by A49,A72,A73,GOBOARD1:def 1;
              1 <= n by A72,FINSEQ_3:27;
then A75:       n in Seg indx(D2,D1,j1) by A74,FINSEQ_1:3;
then A76:       D2.n = (D2|indx(D2,D1,j1)).n by A49,RFINSEQ:19;
              n in Seg len(D2|indx(D2,D1,j1)) by A49,A75,FINSEQ_1:80;
          then n in dom(D2|indx(D2,D1,j1)) by FINSEQ_1:def 3;
          hence thesis by A72,A76,FUNCT_1:def 5;
         end;
         then rng(D1|j1) c= rng(D2|indx(D2,D1,j1)) by TARSKI:def 3;
         hence thesis by A68,XBOOLE_0:def 10;
        end;
then A77:    D2|indx(D2,D1,j1)=D1|j1 by A50,A52,Th5;
A78:   for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
        proof
         let k; assume A79:1 <= k & k <= j1;
         assume A80:k<>indx(D2,D1,k);
             now per cases by A80,XXREAL_0:1;
          suppose A81:k > indx(D2,D1,k);
              1 <= k & k <= len D1 by A51,A79,XXREAL_0:2;
then A82:       k in dom D1 by FINSEQ_3:27;
then A83:       indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
          by A21,INTEGRA1:def 21;
          then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
then A84:       1<=indx(D2,D1,k)&indx(D2,D1,k)<=indx(D2,D1,j1)
          by A21,A51,A79,A82,Th6,FINSEQ_1:3;
          then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
then A85:       (D2|indx(D2,D1,j1)).indx(D2,D1,k)=D2.indx(D2,D1,k) by A49,
RFINSEQ:19;
A86:      indx(D2,D1,k) < j1 by A79,A81,XXREAL_0:2;
          then indx(D2,D1,k) <= len D1 by A51,XXREAL_0:2;
          then indx(D2,D1,k) in dom D1 by A84,FINSEQ_3:27;
then A87:       D1.k > D1.indx(D2,D1,k) by A81,A82,GOBOARD1:def 1;
              indx(D2,D1,k) in Seg j1 by A84,A86,FINSEQ_1:3;
          hence contradiction by A51,A77,A83,A85,A87,RFINSEQ:19;

          end;
          suppose A88:k < indx(D2,D1,k);
              k in Seg j1 by A79,FINSEQ_1:3;
then A89:       D1.k = (D1|j1).k by A47,RFINSEQ:19;
              1 <= k & k <= len D1 by A51,A79,XXREAL_0:2;
then A90:       k in dom D1 by FINSEQ_3:27;
then A91:       indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
          by A21,INTEGRA1:def 21;
              indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2 &
          indx(D2,D1,j1) in dom D2 by A21,A51,A79,A90,Th6;
then A92:      k <= indx(D2,D1,j1) by A88,XXREAL_0:2;
          then k <= len D2 by A49,XXREAL_0:2;
          then k in dom D2 by A79,FINSEQ_3:27;
then A93:      D2.k < D2.indx(D2,D1,k) by A88,A91,GOBOARD1:def 1;
              k in Seg indx(D2,D1,j1) by A79,A92,FINSEQ_1:3;
          hence contradiction by A49,A77,A89,A91,A93,RFINSEQ:19;
         end;
         end;
         hence contradiction;
        end;

A94:     len (D2|indx(D2,D1,j1))=len (D1|j1) by A50,A52,A53,Th5;
        len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A49,FINSEQ_1:80;
then A95:     indx(D2,D1,j1) =j1 by A51,A94,FINSEQ_1:80;
            j1 <= len D1 by A47,FINSEQ_3:27;
        then j1 <= len lower_volume(f,D1) by INTEGRA1:def 8;
then A96:   len(lower_volume(f,D1)|j1)=indx(D2,D1,j1) by A95,FINSEQ_1:80;
            indx(D2,D1,j1) in dom D2 by A21,A47,INTEGRA1:def 21;
        then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
        then indx(D2,D1,j1) <= len lower_volume(f,D2) by INTEGRA1:def 8;
then A97:    len(lower_volume(f,D1)|j1)=len(lower_volume(f,D2)|indx(D2,D1,j1))
        by A96,FINSEQ_1:80;
            for k st 1 <= k & k <= len(lower_volume(f,D1)|j1) holds
        (lower_volume(f,D1)|j1).k = (lower_volume(f,D2)|indx(D2,D1,j1)).k
        proof
         let k; assume A98:1 <= k & k <= len(lower_volume(f,D1)|j1);
A99:      len(lower_volume(f,D1)) = len D1 by INTEGRA1:def 8;
then A100:     1 <= k & k <= j1 by A51,A98,FINSEQ_1:80;
then A101:      k in Seg j1 by FINSEQ_1:3;
             1 <= k & k <= len D1 by A51,A100,XXREAL_0:2;
then A102:     k in Seg len D1 by FINSEQ_1:3;
A103:    divset(D1,k)=divset(D2,indx(D2,D1,k))
         proof
A104:       divset(D2,indx(D2,D1,k))= [. inf divset(D2,indx(D2,D1,k)),
          sup divset(D2,indx(D2,D1,k)).] by INTEGRA1:5;
A105:       k in dom D1 by A102,FINSEQ_1:def 3;
then A106:       indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A21,
INTEGRA1:def 21;
              inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
          sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
          proof
           per cases;
            suppose A107:k=1;
then A108:        inf divset(D1,k)=inf A&sup divset(D1,k)=D1.k by A105,
INTEGRA1:def 5;
                indx(D2,D1,k)=1 by A51,A78,A107;
            hence thesis by A106,A108,INTEGRA1:def 5;

            end;
            suppose A109:k<>1;
then A110:        inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
            by A105,INTEGRA1:def 5;
A111:        k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT
             by A105,A109,INTEGRA1:9;
            reconsider k1=k-1 as Element of NAT by A105,A109,INTEGRA1:9;
                k <= k+1 by NAT_1:11;
            then k1 <= k by XREAL_1:22;
then A112:       k1 <= j1 by A100,XXREAL_0:2;
                k1 in Seg len D1 by A111,FINSEQ_1:def 3;
            then 1 <= k1 by FINSEQ_1:3;
then A113:       k1=indx(D2,D1,k1) by A78,A112;
                indx(D2,D1,k)<>1 by A78,A100,A109;
then A114:        inf divset(D2,indx(D2,D1,k))=D2.(indx(D2,D1,k)-1) &
            sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A106,
INTEGRA1:def 5;
                D2.(indx(D2,D1,k)-1)= D2.indx(D2,D1,k1) by A78,A100,A113;
            hence thesis by A21,A105,A110,A111,A114,INTEGRA1:def 21;
          end;
          end;
          hence thesis by A104,INTEGRA1:5;
         end;
             j1 in Seg len(lower_volume(f,D1)) by A51,A99,FINSEQ_1:def 3;
         then j1 in dom(lower_volume(f,D1)) by FINSEQ_1:def 3;
then A115:      (lower_volume(f,D1)|j1).k = lower_volume(f,D1).k by A101,
RFINSEQ:19
         .=(inf(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
         by A102,A103,INTEGRA1:def 8;
             indx(D2,D1,k) in Seg j1 by A78,A100,A101;
then A116:     indx(D2,D1,k) in Seg indx(D2,D1,j1) by A51,A78;
         then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;
         then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A49,XXREAL_0:2;
then A117:     indx(D2,D1,k) in Seg len D2 by FINSEQ_1:3;
             indx(D2,D1,j1) in Seg len D2 by A49,FINSEQ_1:def 3;
         then indx(D2,D1,j1) in Seg len lower_volume(f,D2) by INTEGRA1:def 8;
then A118:     indx(D2,D1,j1) in dom lower_volume(f,D2) by FINSEQ_1:def 3;
             (lower_volume(f,D2)|indx(D2,D1,j1)).k
          =(lower_volume(f,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A78,A100
         .=lower_volume(f,D2).indx(D2,D1,k) by A116,A118,RFINSEQ:19
         .=(inf(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
         by A117,INTEGRA1:def 8;
         hence thesis by A115;
        end;
then A119:    lower_volume(f,D2)|indx(D2,D1,j1)=lower_volume(f,D1)|j1
        by A97,FINSEQ_1:18;
            indx(D2,D1,j1) in Seg len D2 by A49,FINSEQ_1:def 3;
then A120:     indx(D2,D1,j1) in Seg len lower_volume(f,D2) by INTEGRA1:def 8;
            j1 in Seg len D1 by A51,FINSEQ_1:def 3;
then A121:     j1 in Seg len lower_volume(f,D1) by INTEGRA1:def 8;
A122:    PLf(D2,indx(D2,D1,j1))=Sum(lower_volume(f,D2)|indx(D2,D1,j1))
        by A120,INTEGRA1:def 22
        .=PLf(D1,j1) by A119,A121,INTEGRA1:def 22;
A123:     indx(D2,D1,j1)+1 <= indx(D2,D1,j)
        proof
             j < j+1 by NAT_1:13;
         then j1 < j by XREAL_1:21;
         then indx(D2,D1,j1) < indx(D2,D1,j) by A21,A45,A51,Th7;
         hence thesis by NAT_1:13;
        end;

A124:    Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        -Sum mid(lower_volume(f,D1),j,j) <= (sup rng f-inf rng f)*delta(D1)
        proof
A125:      1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len lower_volume(f,D2)
         proof
              indx(D2,D1,j) in dom D2 by A21,A45,INTEGRA1:def 21;
          then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
          then indx(D2,D1,j) in Seg len lower_volume(f,D2) by INTEGRA1:def 8;
          hence thesis by FINSEQ_1:3;
         end;
then A126:      1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len lower_volume(f,
D2)
         by A49,A123,XXREAL_0:2,NAT_1:13;
A127:     indx(D2,D1,j)-indx(D2,D1,j1) <= 2
         proof
          assume A128:indx(D2,D1,j)-indx(D2,D1,j1) > 2;
          reconsider ID1=indx(D2,D1,j1)+1 as Element of NAT;
          reconsider ID2=ID1+1 as Element of NAT;
A129:     indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
          proof
           thus indx(D2,D1,j1) < ID1 by NAT_1:13;
           thus ID1 < ID2 by NAT_1:13;
               indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A128,XREAL_1:22;
           hence thesis;
          end;
A130:     indx(D2,D1,j) in dom D2 by A21,A45,INTEGRA1:def 21;
then A131:     indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A132:     ID1 in dom D2
          proof
               1 <= ID1 & ID1 <= indx(D2,D1,j) by A49,A129,XXREAL_0:2;
           then 1 <= ID1 & ID1 <= len D2 by A131,XXREAL_0:2;
           then ID1 in Seg len D2 by FINSEQ_1:3;
           hence thesis by FINSEQ_1:def 3;
          end;
A133:     ID2 in dom D2
          proof
               indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A129,A131,XXREAL_0:2;
           then 1 <= ID2 & ID2 <= len D2 by A49,XXREAL_0:2;
           then ID2 in Seg len D2 by FINSEQ_1:3;
           hence thesis by FINSEQ_1:def 3;
          end;
then A134:     D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2,D1,
j)
          by A49,A129,A130,A132,GOBOARD1:def 1;
A135:     D2.ID1 in rng D & D2.ID2 in rng D
          proof
           A136: D2.ID1 in rng D \/ rng D1 & D2.ID2 in rng D \/ rng D1
           by A21,A132,A133,FUNCT_1:def 5;
A137:      D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
           by A21,A45,A51,INTEGRA1:def 21;
               not(D2.ID1 in rng D1) & not D2.ID2 in rng D1
           proof
            assume A138:D2.ID1 in rng D1 or D2.ID2 in rng D1;
            per cases by A138;
             suppose D2.ID1 in rng D1;
             then consider n such that
A139:        n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
                 D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
             by A134,XXREAL_0:2;
             then j1<n & n<j by A45,A51,A137,A139,GOBOARD2:18;
             then j<n+1 & n<j by XREAL_1:21;
             hence contradiction by NAT_1:13;
             end;
             suppose D2.ID2 in rng D1;
             then consider n such that
A140:        n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
                 D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
             by A134,XXREAL_0:2;
             then j1<n & n<j by A45,A51,A137,A140,GOBOARD2:18;
             then j<n+1 & n<j by XREAL_1:21;
             hence contradiction by NAT_1:13;
           end;
           end;
           hence thesis by A136,XBOOLE_0:def 2;
          end;
A141:     inf divset(D1,j)=D2.indx(D2,D1,j1)
          & sup divset(D1,j)=D2.indx(D2,D1,j)
          proof
            inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
             by A45,A46,INTEGRA1:def 5;
           hence thesis by A21,A45,A51,INTEGRA1:def 21;
          end;
A142:     D2.ID1 in rng D /\ divset(D1,j)
          proof
               D2.indx(D2,D1,j1)<=D2.ID1&D2.ID1<=D2.indx(D2,D1,j)
           by A134,XXREAL_0:2;
           then D2.ID1 in divset(D1,j) by A141,INTEGRA2:1;
           hence thesis by A135,XBOOLE_0:def 3;
          end;
        D2.ID2 in rng D /\ divset(D1,j)
          proof
               D2.indx(D2,D1,j1)<=D2.ID2&D2.ID2<=D2.indx(D2,D1,j)
           by A134,XXREAL_0:2;
           then D2.ID2 in divset(D1,j) by A141,INTEGRA2:1;
           hence thesis by A135,XBOOLE_0:def 3;
          end;
          then D2.ID1=D2.ID2 by A20,A45,A142,Th4;
          hence contradiction by A129,A132,A133,GOBOARD2:19;
         end;
         1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
         indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
         proof
A143:      indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
           =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A123,BINARITH:50;
           indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
          hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
          thus thesis by A127,A143;
         end;
then A144:      1 <= len mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j
)) &
         len mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
         by A123,A125,A126,JORDAN3:27;
A145:      1 <= j & j <= len lower_volume(f,D1)
         proof
              1 <= j & j <= len D1 by A45,FINSEQ_3:27;
          hence thesis by INTEGRA1:def 8;
         end;
       j-'j+1 = 1 by Lm2;
then A146:      len mid(lower_volume(f,D1),j,j)= 1 by A145,JORDAN3:27;
             mid(lower_volume(f,D1),j,j).1 = lower_volume(f,D1).j by A145,
JORDAN3:27;
         then mid(lower_volume(f,D1),j,j)
          =<*lower_volume(f,D1).j*> by A146,FINSEQ_1:57;
then A147:     Sum mid(lower_volume(f,D1),j,j)=lower_volume(f,D1).j by
FINSOP_1:12;

A148:     indx(D2,D1,j1)+1 in Seg len D2
         proof
              indx(D2,D1,j1)+1 in Seg len lower_volume(f,D2) by A126,FINSEQ_1:3
;
          hence thesis by INTEGRA1:def 8;
         end;
A149:     j in Seg len D1 by A45,FINSEQ_1:def 3;
             now per cases by A144,Lm3;
          suppose
A150:      len mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A151:      indx(D2,D1,j1)+1=indx(D2,D1,j)
          proof
               indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=1
           by A123,A125,A126,A150,JORDAN3:27;
           then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A123,BINARITH:50;
           hence thesis;
          end;
A152:      divset(D2,indx(D2,D1,j))=divset(D1,j)
          proof
               inf divset(D1,j)=D2.indx(D2,D1,j1)
           & sup divset(D1,j)=D2.indx(D2,D1,j)
           proof
                inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
            by A45,A46,INTEGRA1:def 5;
            hence thesis by A21,A45,A51,INTEGRA1:def 21;
           end;
then A153:      divset(D1,j)=[. D2.indx(D2,D1,j1),D2.indx(D2,D1,j).] by
INTEGRA1:5;
A154:      indx(D2,D1,j)-1=indx(D2,D1,j1) by A151;
A155:      indx(D2,D1,j) in dom D2 by A21,A45,INTEGRA1:def 21;
               indx(D2,D1,j)<>1 by A49,A151,NAT_1:13;
           then inf divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j1)
           & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
           by A154,A155,INTEGRA1:def 5;
           hence thesis by A153,INTEGRA1:5;
          end;
              mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
           =lower_volume(f,D2).(indx(D2,D1,j1)+1) by A125,A126,JORDAN3:27;
          then mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =<*lower_volume(f,D2).(indx(D2,D1,j1)+1)*> by A150,FINSEQ_1:57;
          then A156: Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j
))
           =lower_volume(f,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
          .=(inf(rng(f|divset(D2,(indx(D2,D1,j1)+1)))))
          *vol(divset(D2,(indx(D2,D1,j1)+1))) by A148,INTEGRA1:def 8
          .=Sum mid(lower_volume(f,D1),j,j)
            by A147,A149,A151,A152,INTEGRA1:def 8;
A157:      delta(D1) >= 0 by Th8;
              sup rng f - inf rng f >= 0 by A18,XREAL_1:50;
          then (sup rng f - inf rng f)*delta(D1) >= 0*delta(D1) by A157,
XREAL_1:66;
          hence Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          -Sum mid(lower_volume(f,D1),j,j) <= (sup rng f-inf rng f)*delta(D1)
          by A156;
          end;
          suppose
A158:       len mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A159:       mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
           =lower_volume(f,D2).(indx(D2,D1,j1)+1) by A125,A126,JORDAN3:27;
              mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
           =lower_volume(f,D2).(indx(D2,D1,j1)+2)
          proof
A160:       2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;
               mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
            =LVf(D2).(2+(indx(D2,D1,j1)+1)-'1) by A123,A125,A126,A158,
JORDAN3:27
           .=LVf(D2).(2+(indx(D2,D1,j1)+1)-1) by A160,BINARITH:50
           .=LVf(D2).(indx(D2,D1,j1)+(1+1));
           hence thesis;
          end;
          then mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =<*lower_volume(f,D2).(indx(D2,D1,j1)+1),
             lower_volume(f,D2).(indx(D2,D1,j1)+2)*> by A158,A159,FINSEQ_1:61;
then A161:       Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
           =lower_volume(f,D2).(indx(D2,D1,j1)+1)
           +lower_volume(f,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A162:       vol(divset(D1,j))
          =vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
          proof
A163:     inf divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
           proof
                inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
            by A45,A46,INTEGRA1:def 5;
            hence thesis by A21,A45,A51,INTEGRA1:def 21;
           end;
A164:       indx(D2,D1,j)=indx(D2,D1,j1)+2
           proof
                indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
            by A123,A125,A126,A158,JORDAN3:27;
            then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A123,BINARITH:50;
            hence thesis;
           end;
A165:       inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
           & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
           & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
           & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
           proof
A166:        indx(D2,D1,j1)+2 in dom D2 by A21,A45,A164,INTEGRA1:def 21;
                indx(D2,D1,j1)+1 in Seg len lower_volume(f,D2) by A126,
FINSEQ_1:3;
            then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 8;
then A167:        indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A168:        indx(D2,D1,j1)+1 <> 1 by A49,NAT_1:13;
              A169: indx(D2,D1,j1)+1+1 > 1 by A126,NAT_1:13;
A170:        indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A171:        indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;
            thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
            & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
            by A166,A169,A170,INTEGRA1:def 5;
            thus thesis by A167,A168,A171,INTEGRA1:def 5;
           end;
               vol(divset(D1,j))
            =D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
            +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A163,A164,
INTEGRA1:def 6;
           then vol(divset(D1,j))
            =vol(divset(D2,indx(D2,D1,j1)+2))
            +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A165,INTEGRA1:def 6
           .=vol(divset(D2,indx(D2,D1,j1)+2))
            +(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1))
           by A165;
           hence thesis by INTEGRA1:def 6;
          end;
then A172:       lower_volume(f,D1).j=(inf(rng(f|divset(D1,j))))*
          (vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
          by A149,INTEGRA1:def 8;
A173:       vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A174:      vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
          A175: Sum mid(LVf(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))-Sum mid(LVf(D1)
,j,j)
          <=(sup rng f - inf rng f)*(vol(divset(D2,indx(D2,D1,j1)+2))
          +vol(divset(D2,indx(D2,D1,j1)+1)))
          proof
A176:      indx(D2,D1,j) in dom D2 by A21,A45,INTEGRA1:def 21;
A177:      indx(D2,D1,j)=indx(D2,D1,j1)+2
           proof
                indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
            by A123,A125,A126,A158,JORDAN3:27;
            then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A123,BINARITH:50;
            hence thesis;
           end;
then A178:       indx(D2,D1,j1)+2 in Seg len D2 by A176,FINSEQ_1:def 3;
           set ID1=indx(D2,D1,j1)+1;
           set ID2=indx(D2,D1,j1)+2;

A179:       Sum mid(LVf(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
            =(inf rng(f|divset(D2,indx(D2,D1,j1)+2)))
            *vol(divset(D2,indx(D2,D1,j1)+2))
            +LVf(D2).(indx(D2,D1,j1)+1) by A161,A178,INTEGRA1:def 8
           .=(inf rng(f|divset(D2,indx(D2,D1,j1)+2)))
            *vol(divset(D2,indx(D2,D1,j1)+2))
            +(inf rng(f|divset(D2,indx(D2,D1,j1)+1)))
            *vol(divset(D2,indx(D2,D1,j1)+1)) by A148,INTEGRA1:def 8;
                divset(D2,ID2)c=A by A176,A177,INTEGRA1:10;
           then A180: inf rng(f|divset(D2,ID2)) <= sup rng f by A1,Lm5;
               ID1 in dom D2 by A148,FINSEQ_1:def 3;
           then divset(D2,ID1)c=A by INTEGRA1:10;
           then inf rng(f|divset(D2,ID1)) <= sup rng f by A1,Lm5;
then A181:       (inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1))
           <=(sup rng f)*vol(divset(D2,ID1)) by A173,XREAL_1:66;
               divset(D1,j) c=A by A45,INTEGRA1:10;
           then inf rng(f|divset(D1,j)) >= inf rng f by A1,Lm5;
then A182:      (inf rng(f|divset(D1,j)))*vol(divset(D2,ID2))
           >=(inf rng f)*vol(divset(D2,ID2))
           & (inf rng(f|divset(D1,j)))*vol(divset(D2,ID1))
           >=(inf rng f)*vol(divset(D2,ID1)) by A173,A174,XREAL_1:66;
               Sum mid(LVf(D2),ID1,indx(D2,D1,j))
           -(inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1))
           <=(sup rng f)*vol(divset(D2,ID2)) by A174,A179,A180,XREAL_1:66;
           then Sum mid(LVf(D2),ID1,indx(D2,D1,j))
           <=(sup rng f)*vol(divset(D2,ID2))
           +(inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;
           then Sum mid(LVf(D2),ID1,indx(D2,D1,j))-(sup rng f)*vol(divset(D2,
ID2))
           <=(inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;
           then Sum mid(LVf(D2),ID1,indx(D2,D1,j))-(sup rng f)*vol(divset(D2,
ID2))
           <=(sup rng f)*vol(divset(D2,ID1)) by A181,XXREAL_0:2;
then A183:    Sum mid(LVf(D2),ID1,indx(D2,D1,j))<=(sup rng f)*vol(divset(D2,ID2
))+
           (sup rng f)*vol(divset(D2,ID1)) by XREAL_1:22;
           reconsider A = inf(rng(f|divset(D1,j))) as real number;
           set B = vol(divset(D2,ID1));
           set C = vol(divset(D2,ID2));
           lower_volume(f,D1).j-A*B=A*C by A172;
           then Sum mid(LVf(D1),j,j)>=(inf rng(f|divset(D1,j)))*vol(divset(D2,
ID1))
           +(inf rng f)*vol(divset(D2,ID2)) by A147,A182,XREAL_1:21;
           then Sum mid(LVf(D1),j,j)-(inf rng f)*vol(divset(D2,ID2))
           >=(inf rng(f|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:21;
           then Sum mid(LVf(D1),j,j)-(inf rng f)*vol(divset(D2,ID2))
           >=(inf rng f)*vol(divset(D2,ID1)) by A182,XXREAL_0:2;
           then Sum mid(LVf(D1),j,j)
           >=(inf rng f)*vol(divset(D2,ID2))+(inf rng f)*vol(divset(D2,ID1))
           by XREAL_1:21;
           then Sum mid(LVf(D2),ID1,indx(D2,D1,j))-Sum mid(LVf(D1),j,j)
           <=(sup rng f)*vol(divset(D2,ID2))+(sup rng f)*vol(divset(D2,ID1))
           -((inf rng f)*vol(divset(D2,ID2))+(inf rng f)*vol(divset(D2,ID1)))
           by A183,REAL_1:92;
           hence thesis;
          end;
A184:      vol(divset(D1,j)) <= delta(D1) by A45,Lm6;
              sup rng f - inf rng f >= 0 by A18,XREAL_1:50;
          then (sup rng f - inf rng f)*(vol(divset(D1,j)))
          <=(sup rng f - inf rng f)*delta(D1) by A184,XREAL_1:66;
          hence thesis by A162,A175,XXREAL_0:2;
         end;
         end;
         hence thesis;
        end;
A185:    PLf(D2,indx(D2,D1,j1))
        +Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        =PLf(D2,indx(D2,D1,j))
        proof
             indx(D2,D1,j) in dom D2 by A21,A45,INTEGRA1:def 21;
then A186:      indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
         then A187: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
then A188:      1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len LVf(D2) by
INTEGRA1:def 8;
A189:      indx(D2,D1,j) in Seg len LVf(D2) by A186,INTEGRA1:def 8;
A190:      indx(D2,D1,j1) < indx(D2,D1,j) by A123,NAT_1:13;
             indx(D2,D1,j1) in Seg len D2 by A49,FINSEQ_1:def 3;
         then indx(D2,D1,j1) in Seg len LVf(D2) by INTEGRA1:def 8;
         then PLf(D2,indx(D2,D1,j1))
         =Sum(LVf(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
         then PLf(D2,indx(D2,D1,j1))
         +Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =Sum(LVf(D2)|indx(D2,D1,j1)
          ^mid(LVf(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
         .=Sum(mid(LVf(D2),1,indx(D2,D1,j1))
          ^mid(LVf(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A49,JORDAN3:25
         .=Sum(mid(LVf(D2),1,indx(D2,D1,j))) by A49,A188,A190,INTEGRA2:4
         .=Sum(LVf(D2)|indx(D2,D1,j)) by A187,JORDAN3:25;
         hence thesis by A189,INTEGRA1:def 22;
        end;

       PLf(D1,j1)+Sum mid(lower_volume(f,D1),j,j)=PLf(D1,j)
        proof
A191:      j in Seg len D1 by A45,FINSEQ_1:def 3;
         then A192: 1 <= j & j <= len D1 by FINSEQ_1:3;
then A193:      1 <= j & j <= len LVf(D1) by INTEGRA1:def 8;
A194:      j in Seg len LVf(D1) by A191,INTEGRA1:def 8;
             j < j+1 by NAT_1:13;
then A195:      j1 < j by XREAL_1:21;
             j1 in Seg len D1 by A51,FINSEQ_1:def 3;
         then j1 in Seg len LVf(D1) by INTEGRA1:def 8;
         then PLf(D1,j1)=Sum(LVf(D1)|j1) by INTEGRA1:def 22;
         then PLf(D1,j1)+Sum mid(LVf(D1),j,j)
          =Sum((LVf(D1)|j1)^mid(LVf(D1),j,j)) by RVSUM_1:105
         .=Sum(mid(LVf(D1),1,j1)^mid(LVf(D1),j1+1,j)) by A51,JORDAN3:25
         .=Sum(mid(LVf(D1),1,j)) by A51,A193,A195,INTEGRA2:4
         .=Sum(LVf(D1)|j) by A192,JORDAN3:25;
         hence thesis by A194,INTEGRA1:def 22;
        end;
        hence thesis by A122,A124,A185;
       end;
       hence thesis by A45;
      end;
A196: for i being non empty Element of NAT st P[i] holds P[i+1]
      proof
       let i be non empty Element of NAT;
       assume A197:P[i];
A198:    i>=1 by NAT_1:14;

           P[i+1]
       proof
        assume A199:i+1 in dom D;
        then D.(i+1) in A by INTEGRA1:8;
        then consider j such that
A200:     j in dom D1 & D.(i+1) in divset(D1,j) by Th2;
A201:     1 <= i+1 & i+1 <= len D by A199,FINSEQ_3:27;
            i <= i+1 by NAT_1:11;
        then i <= len D by A201,XXREAL_0:2;
then A202:    i in Seg len D by A198,FINSEQ_1:3;
then A203:    i in dom D by FINSEQ_1:def 3;
        consider n1 being Element of NAT such that
A204:     n1 in dom D1 & D.i in divset(D1,n1)
        & PLf(D2,indx(D2,D1,n1))-PLf(D1,n1)<=i*(sup rng f-inf rng f)*delta(D1)
        by A197,A202,FINSEQ_1:def 3;
A205:    indx(D2,D1,n1) in dom D2 & D2.indx(D2,D1,n1) = D1.n1
        by A21,A204,INTEGRA1:def 21;
then A206:    1 <= indx(D2,D1,n1) & indx(D2,D1,n1) <= len D2 by FINSEQ_3:27;

A207:     n1 < j
        proof
         assume A208:n1 >= j;
             now per cases by A208,REAL_1:def 5;
          suppose n1=j;
          then D.i in divset(D1,j) & D.i in rng D by A203,A204,FUNCT_1:def 5;
then A209:       D.i in rng D /\ divset(D1,j) by XBOOLE_0:def 3;
              D.(i+1) in rng D by A199,FUNCT_1:def 5;
          then D.(i+1) in rng D /\ divset(D1,j) by A200,XBOOLE_0:def 3;
then A210:       D.(i+1)=D.i by A20,A200,A209,Th4;
              i+1 > i by XREAL_1:31;
          hence contradiction by A199,A203,A210,GOBOARD2:19;
          end;
          suppose n1>j;
then A211:       n1>=j+1 by NAT_1:13;
then A212:       n1-1 >= j by XREAL_1:21;
A213:       inf divset(D1,n1) <= D.i by A204,INTEGRA2:1;
A214:       D.(i+1)<=sup divset(D1,j) by A200,INTEGRA2:1;
              1 <= j by A200,FINSEQ_3:27;
          then 1+1 <= j+1 by XREAL_1:8;
then A215:      n1 <> 1 by A211,XXREAL_0:2;
          then n1-1 in dom D1 by A204,INTEGRA1:9;
then A216:       D1.j <= D1.(n1-1) by A200,A212,GOBOARD2:18;
A217:       sup divset(D1,j)=D1.j
          proof
           per cases;
            suppose j=1;
            hence thesis by A200,INTEGRA1:def 5;
            end;
            suppose j<>1;
            hence thesis by A200,INTEGRA1:def 5;
          end;
          end;
              D.i >= D1.(n1-1) by A204,A213,A215,INTEGRA1:def 5;
          then D.i >= D1.j by A216,XXREAL_0:2;
then A218:      D.i >= D.(i+1) by A214,A217,XXREAL_0:2;
              i < i+1 by XREAL_1:31;
          hence contradiction by A199,A203,A218,GOBOARD1:def 1;
         end;
         end;
         hence thesis;
        end;
then A219:     n1+1 <= j by NAT_1:13;
then A220:     j-n1 >= 1 by XREAL_1:21;
A221:    n1 >= 1 by A204,FINSEQ_3:27;
A222:    1 <= n1 & 1 <= j & j <= len D1 by A200,A204,FINSEQ_3:27;
then A223:    1 <= n1+1 & n1+1 <= len D1 by A219,XXREAL_0:2,NAT_1:12;
then A224:     n1+1 in dom D1 by FINSEQ_3:27;
then A225:    indx(D2,D1,n1+1) in dom D2 & D2.indx(D2,D1,n1+1)=D1.(n1+1)
        by A21,INTEGRA1:def 21;
A226:    indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.j
        by A21,A200,INTEGRA1:def 21;
        then D2.indx(D2,D1,n1+1) <= D2.indx(D2,D1,j)
        by A200,A219,A224,A225,GOBOARD2:18;
then A227:    indx(D2,D1,n1+1) <= indx(D2,D1,j) by A225,A226,GOBOARD1:def 1;
A228:    1 <= indx(D2,D1,n1+1) & indx(D2,D1,n1+1) <= len D2 by A225,FINSEQ_3:27
;
A229:    1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by A226,FINSEQ_3:27;
            n1 < n1+1 by NAT_1:13;
        then D1.n1 < D1.(n1+1) by A204,A224,GOBOARD1:def 1;
then A230:   indx(D2,D1,n1) < indx(D2,D1,n1+1) by A205,A225,GOBOARD2:18;
            1+indx(D2,D1,n1+1) <= indx(D2,D1,j)+1 by A227,XREAL_1:8;
        then 1 <= indx(D2,D1,j)+1-indx(D2,D1,n1+1) by XREAL_1:21;
then A231:     mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j)).1
        =D2.(1-1+indx(D2,D1,n1+1)) by A227,A228,A229,JORDAN3:31
        .=D1.(n1+1) by A21,A224,INTEGRA1:def 21;
A232:    Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        -Sum mid(LVf(D1),n1+1,j) <= (sup rng f-inf rng f)*delta(D1)
        proof
         now per cases by A219,REAL_1:def 5;
        suppose A233:n1+1=j;
A234:     1 <= n1+1 & n1+1 <= len LVf(D1) by A223,INTEGRA1:def 8;
A235:     n1+1 in Seg len D1 by A224,FINSEQ_1:def 3;
A236:     len mid(LVf(D1),n1+1,j)=j-'(n1+1)+1 by A233,A234,JORDAN3:27
         .=j-j+1 by A233,BINARITH:50
        .= 1;
            (n1+1)+1 <= j+1 by A219,XREAL_1:8;
        then 1 <= j+1-(n1+1) by XREAL_1:21;
        then mid(LVf(D1),n1+1,j).1
         =LVf(D1).(1-1+(n1+1)) by A233,A234,JORDAN3:31
        .=(inf rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))
        by A235,INTEGRA1:def 8;
        then mid(LVf(D1),n1+1,j)
        =<*(inf rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))*>
        by A236,FINSEQ_1:57;
then A237:     Sum mid(LVf(D1),n1+1,j)
        =(inf rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1)) by FINSOP_1:12;
            divset(D1,n1+1) c= A by A224,INTEGRA1:10;
then A238:   inf rng(f|divset(D1,n1+1)) >= inf rng f by A1,Lm5;
            vol(divset(D1,n1+1)) >= 0 by INTEGRA1:11;
then A239:    Sum mid(LVf(D1),n1+1,j)
        >=(inf rng f)*vol(divset(D1,n1+1)) by A237,A238,XREAL_1:66;
A240:    indx(D2,D1,n1)<indx(D2,D1,j)
        proof
             D1.n1 < D1.j by A200,A204,A207,GOBOARD1:def 1;
         hence thesis by A205,A226,GOBOARD2:18;
        end;
then A241:    indx(D2,D1,n1)+1 <= indx(D2,D1,j) by NAT_1:13;
        then indx(D2,D1,n1)+1 <= len D2 by A229,XXREAL_0:2;
then A242:     indx(D2,D1,n1)+1 <= len LVf(D2) by INTEGRA1:def 8;
A243:     1<=indx(D2,D1,n1)+1 by NAT_1:12;
A244:    indx(D2,D1,j) <= len LVf(D2) by A229,INTEGRA1:def 8;
then A245:    len mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        =indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1 by A229,A241,A242,A243,JORDAN3:27
        .=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A241,BINARITH:50
        .=indx(D2,D1,j)-indx(D2,D1,n1);

A246:    indx(D2,D1,j)-indx(D2,D1,n1)<=2
        proof
         assume indx(D2,D1,j) - indx(D2,D1,n1) > 2;
then A247:     indx(D2,D1,n1)+2 < indx(D2,D1,j) by XREAL_1:22;
A248:     indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A249:     indx(D2,D1,n1)+1 < indx(D2,D1,n1)+2 by XREAL_1:8;
A250:     indx(D2,D1,n1)+1 < indx(D2,D1,j) & indx(D2,D1,n1)+1 in dom D2
         proof
          thus indx(D2,D1,n1)+1 < indx(D2,D1,j) by A247,A249,XXREAL_0:2;
          then 1 <= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= len D2
          by A206,A229,XXREAL_0:2,NAT_1:13;
          hence thesis by FINSEQ_3:27;
         end;
A251:     D2.(indx(D2,D1,n1)+1) in rng D
         proof
          A252: D2.(indx(D2,D1,n1)+1) in rng D2 by A250,FUNCT_1:def 5;
              not( D2.(indx(D2,D1,n1)+1) in rng D1 )
          proof
           assume D2.(indx(D2,D1,n1)+1) in rng D1;
           then consider k1 being Element of NAT such that
A253:       k1 in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.k1 by PARTFUN1:26;
               D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
           & D2.(indx(D2,D1,n1)+1) < D2.indx(D2,D1,j)
           by A205,A226,A248,A250,GOBOARD1:def 1;
           then n1 < k1 & k1 < j by A200,A204,A205,A226,A253,GOBOARD2:18;
           hence contradiction by A233,NAT_1:13;
          end;
          hence thesis by A21,A252,XBOOLE_0:def 2;
         end;
A254:     D2.(indx(D2,D1,n1)+1) in rng D /\ divset(D1,j)
         proof
A255:      inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
          by A200,A207,A221,INTEGRA1:def 5;
              D2.(indx(D2,D1,n1)+1) >= D2.indx(D2,D1,n1)
          & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+1)
          by A205,A226,A248,A250,GOBOARD2:18;
          then D2.(indx(D2,D1,n1)+1) in divset(D1,j)
          by A205,A226,A233,A255,INTEGRA2:1;
          hence thesis by A251,XBOOLE_0:def 3;
         end;
A256:     indx(D2,D1,n1) < indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 in dom D2
         proof
          thus indx(D2,D1,n1) < indx(D2,D1,n1)+2 by A249,NAT_1:13;
          then 1 <= indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 <= len D2
          by A206,A229,A247,XXREAL_0:2;
          hence thesis by FINSEQ_3:27;
         end;
A257:     D2.(indx(D2,D1,n1)+2) in rng D
         proof
          A258: D2.(indx(D2,D1,n1)+2) in rng D2 by A256,FUNCT_1:def 5;
              not D2.(indx(D2,D1,n1)+2) in rng D1
          proof
           assume D2.(indx(D2,D1,n1)+2) in rng D1;
           then consider k1 being Element of NAT such that
A259:       k1 in dom D1 & D2.(indx(D2,D1,n1)+2) = D1.k1 by PARTFUN1:26;
               D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+2)
           & D2.(indx(D2,D1,n1)+2) < D2.indx(D2,D1,j)
           by A205,A226,A247,A256,GOBOARD1:def 1;
           then n1 < k1 & k1 < j by A200,A204,A205,A226,A259,GOBOARD2:18;
           hence contradiction by A233,NAT_1:13;
          end;
          hence thesis by A21,A258,XBOOLE_0:def 2;
         end;
       D2.(indx(D2,D1,n1)+2) in rng D /\ divset(D1,j)
         proof
A260:     inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
          by A200,A207,A221,INTEGRA1:def 5;
              D2.(indx(D2,D1,n1)+2) >= D2.indx(D2,D1,n1)
          & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+2)
          by A205,A226,A247,A256,GOBOARD2:18;
          then D2.(indx(D2,D1,n1)+2) in divset(D1,j)
          by A205,A226,A233,A260,INTEGRA2:1;
          hence thesis by A257,XBOOLE_0:def 3;
         end;
         then D2.(indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+2) by A20,A200,A254,
Th4;
         hence contradiction by A249,A250,A256,GOBOARD1:def 1;
        end;
A261:    indx(D2,D1,j)-indx(D2,D1,n1)=1 or indx(D2,D1,j)-indx(D2,D1,n1)=2
        proof
             indx(D2,D1,n1)+1 <= indx(D2,D1,j) by A240,NAT_1:13;
then A262:     indx(D2,D1,n1)+1 = indx(D2,D1,j) or
         indx(D2,D1,n1)+1 < indx(D2,D1,j) by REAL_1:def 5;
             indx(D2,D1,n1)+1<indx(D2,D1,j) implies indx(D2,D1,n1)+2=indx(D2,D1
,
j
)
         proof
          assume indx(D2,D1,n1)+1 < indx(D2,D1,j);
          then A263: indx(D2,D1,n1)+1+1 <= indx(D2,D1,j) by NAT_1:13;
              indx(D2,D1,n1)+2 >= indx(D2,D1,j) by A246,XREAL_1:22;
          hence thesis by A263,XXREAL_0:1;
         end;
         hence thesis by A262;
        end;
            Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        <=(sup rng f)*vol(divset(D1,n1+1))
        proof
         per cases by A261;
          suppose A264:indx(D2,D1,j)-indx(D2,D1,n1)=1;
          then 1=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1;
then A265:      mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).1
          =LVf(D2).(1+(indx(D2,D1,n1)+1)-1) by A243,A244,JORDAN3:31
          .=LVf(D2).(indx(D2,D1,n1)+1);
  indx(D2,D1,n1)+1 in Seg len D2 by A226,A264,FINSEQ_1:def 3;
then A266:      LVf(D2).(indx(D2,D1,n1)+1)
          =(inf rng(f|divset(D2,indx(D2,D1,n1)+1)))
           *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 8;
A267:      divset(D2,indx(D2,D1,n1)+1)=divset(D1,n1+1)
          proof
A268:       divset(D1,n1+1)=[.inf divset(D1,n1+1), sup divset(D1,n1+1).]
           by INTEGRA1:5;
               indx(D2,D1,n1)+1 > 1 by A206,NAT_1:13;
           then inf divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1-1)
           & sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
           by A226,A264,INTEGRA1:def 5;
then A269:       inf divset(D2,indx(D2,D1,n1)+1)=D1.n1
           & sup divset(D2,indx(D2,D1,n1)+1)=D1.j by A21,A200,A204,A264,
INTEGRA1:def 21;
               inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
           by A207,A221,A224,A233,INTEGRA1:def 5;
           hence thesis by A233,A268,A269,INTEGRA1:5;
          end;
A270:      inf rng(f|divset(D2,indx(D2,D1,n1)+1))<=sup rng f by A1,A226,A264,
Th17;
              vol(divset(D2,indx(D2,D1,n1)+1))>=0 by INTEGRA1:11;
then A271:      LVf(D2).(indx(D2,D1,n1)+1)
          <=(sup rng f)*vol(divset(D1,n1+1)) by A266,A267,A270,XREAL_1:66;
              mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          =<*LVf(D2).(indx(D2,D1,n1)+1)*> by A245,A264,A265,FINSEQ_1:57;
          hence thesis by A271,FINSOP_1:12;
          end;
          suppose A272:indx(D2,D1,j)-indx(D2,D1,n1)=2;
A273:      indx(D2,D1,n1)+2-1=indx(D2,D1,n1)+1;
A274:     indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1>=1 by A272;
A275:     indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1=1+1 by A272;

A276:      1 <= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= indx(D2,D1,n1)+2
          by NAT_1:12,XREAL_1:8;
          then indx(D2,D1,n1)+1 <= len D2 by A229,A272,XXREAL_0:2;
then A277:      indx(D2,D1,n1)+1 in dom D2 by A276,FINSEQ_3:27;
A278:     indx(D2,D1,j) <= len LVf(D2) by A229,INTEGRA1:def 8;
then A279:      mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).1
          =LVf(D2).(1+(indx(D2,D1,n1)+1)-1)
          by A272,A274,A276,JORDAN3:31
          .=LVf(D2).(indx(D2,D1,n1)+1);
              mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).2
          =LVf(D2).(2+(indx(D2,D1,n1)+1)-1)
          by A275,A276,A278,JORDAN3:31
          .=LVf(D2).(indx(D2,D1,n1)+0+2);
          then mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          =<*LVf(D2).(indx(D2,D1,n1)+1),LVf(D2).(indx(D2,D1,n1)+2)*>
          by A245,A272,A279,FINSEQ_1:61;
then A280:      Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          =LVf(D2).(indx(D2,D1,n1)+1)+LVf(D2).(indx(D2,D1,n1)+2)
          by RVSUM_1:107;

A281:      LVf(D2).(indx(D2,D1,n1)+1)
          <= (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+1))
          proof
               indx(D2,D1,n1)+1 in Seg len D2 by A277,FINSEQ_1:def 3;
then A282:      LVf(D2).(indx(D2,D1,n1)+1)
           =(inf rng(f|divset(D2,indx(D2,D1,n1)+1)))
            *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 8;
A283:      inf rng(f|divset(D2,indx(D2,D1,n1)+1))
           <=sup rng f by A1,A277,Th17;
               vol(divset(D2,indx(D2,D1,n1)+1)) >= 0 by INTEGRA1:11;
           hence thesis by A282,A283,XREAL_1:66;
          end;
              LVf(D2).(indx(D2,D1,n1)+2)
          <= (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+2))
          proof
               indx(D2,D1,n1)+2 in Seg len D2 by A226,A272,FINSEQ_1:def 3;
then A284:      LVf(D2).(indx(D2,D1,n1)+2)
           =(inf rng(f|divset(D2,indx(D2,D1,n1)+2)))
            *vol(divset(D2,indx(D2,D1,n1)+2)) by INTEGRA1:def 8;
A285:      inf rng(f|divset(D2,indx(D2,D1,n1)+2))
           <=sup rng f by A1,A226,A272,Th17;
               vol(divset(D2,indx(D2,D1,n1)+2)) >= 0 by INTEGRA1:11;
           hence thesis by A284,A285,XREAL_1:66;
          end;
then A286:      Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          <= (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+1))
          + (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+2)) by A280,A281,XREAL_1:9
;
              vol(divset(D2,indx(D2,D1,n1)+1))+vol(divset(D2,indx(D2,D1,n1)+2))
          =vol(divset(D1,n1+1))
          proof
               indx(D2,D1,n1)+1 > 1 by A206,NAT_1:13;
then A287:       inf divset(D2,indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+1-1)
           & sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
           by A277,INTEGRA1:def 5;
               indx(D2,D1,n1)+2 >= 2+1 by A206,XREAL_1:8;
           then indx(D2,D1,n1)+2 <> 1;
then A288:       inf divset(D2,indx(D2,D1,n1)+2) = D2.(indx(D2,D1,n1)+1)
           & sup divset(D2,indx(D2,D1,n1)+2)=D2.indx(D2,D1,j)
           by A226,A272,A273,INTEGRA1:def 5;
A289:      vol(divset(D2,indx(D2,D1,n1)+1))
            =D2.(indx(D2,D1,n1)+1)-D1.n1 by A205,A287,INTEGRA1:def 6;
           A290: vol(divset(D2,indx(D2,D1,n1)+2))
            =D1.j-D2.(indx(D2,D1,n1)+1) by A226,A288,INTEGRA1:def 6;
            inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
            by A207,A221,A224,A233,INTEGRA1:def 5;
then         vol(divset(D1,n1+1))=D1.(n1+1)-D1.n1 by INTEGRA1:def 6;
           hence thesis by A233,A289,A290;
          end;
          hence thesis by A286;
        end;
        end;
then A291: Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))-Sum mid(LVf(D1),n1+1
,j)
        <=(sup rng f)*vol(divset(D1,n1+1))-(inf rng f)*vol(divset(D1,n1+1))
        by A239,REAL_1:92;
            sup rng f >= inf rng f by A1,Lm4;
then A292:    sup rng f-inf rng f >= 0 by XREAL_1:50;
         vol(divset(D1,n1+1))<=delta(D1)
        proof
A293:     n1+1 in Seg len D1 by A224,FINSEQ_1:def 3;
then A294:     vol(divset(D1,n1+1))=upper_volume(chi(A,A),D1).(n1+1) by
INTEGRA1:22;
             n1+1 in Seg len upper_volume(chi(A,A),D1) by A293,INTEGRA1:def 7;
         then n1+1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
then A295:     vol(divset(D1,n1+1)) in rng upper_volume(chi(A,A),D1)
          by A294,FUNCT_1:def 5;
          delta(D1)=max rng upper_volume(chi(A,A),D1) by INTEGRA1:def 19;
         hence thesis by A295,PRE_CIRC:def 1;
        end;
        then (sup rng f-inf rng f)*vol(divset(D1,n1+1))
        <=(sup rng f-inf rng f)*delta(D1) by A292,XREAL_1:66;
        hence Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        -Sum mid(LVf(D1),n1+1,j) <= (sup rng f-inf rng f)*delta(D1)
        by A291,XXREAL_0:2;
        end;
        suppose A296:n1+1 < j;
A297:    n1 < n1+1 by NAT_1:13;
then A298:    D1.n1 < D1.(n1+1) by A204,A224,GOBOARD1:def 1;
        then consider B being closed-interval Subset of REAL,
        MD1,MD2 being Element of divs B such that
A299:    D1.n1=inf B & sup B=MD2.(len MD2) & sup B=MD1.(len MD1) & MD1 <= MD2
        & MD1=mid(D1,n1+1,j) & MD2=mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j))
        by A21,A200,A219,A224,A231,Th14;
A300:   len MD1 = j-'(n1+1)+1 by A219,A222,A223,A299,JORDAN3:27;
            j-'(n1+1) = j-(n1+1) by A219,BINARITH:50;
then A301:     j-'(n1+1)+1=j-n1;
then A302:    len MD1 = j-n1 by A219,A222,A223,A299,JORDAN3:27;
A303:    len MD1+(n1+1)-1 = j-(n1+1)+1+(n1+1)-1 by A219,A300,BINARITH:50
        .=j;
A304:   B c= A
        proof
          let x1; assume A305:x1 in B;
          then reconsider x1 as Real;
A306:       rng D1 c= A by INTEGRA1:def 2;
A307:       D1.n1 <= x1 & x1 <= MD1.(len MD1) by A299,A305,INTEGRA2:1;
              D1.n1 in rng D1 & D1.j in rng D1 by A200,A204,FUNCT_1:def 5;
then A308:       inf A <= D1.n1 & D1.j <= sup A by A306,INTEGRA2:1;
              MD1.(len MD1)=D1.(j-n1-1+(n1+1))
             by A219,A220,A222,A223,A299,A301,A302,JORDAN3:31
          .=D1.j;
          then inf A <= x1 & x1 <= sup A by A307,A308,XXREAL_0:2;
          hence thesis by INTEGRA2:1;
        end;
        then reconsider g=f|B as Function of B,REAL by FUNCT_2:38;
A309:    g is_bounded_on B
        proof
A310:    f is_bounded_above_on A&f is_bounded_below_on A by A1,RFUNCT_1:def 11;
         then consider a be real number such that
A311:     for x being set st x in A /\ dom f holds a<=f.x
         by RFUNCT_1:def 10;
          for x being set st x in B /\ dom g holds a<=g.x
         proof
          let x be set; assume x in B /\ dom g;
then A312:     x in dom g by XBOOLE_0:def 3;
then A313:     x in dom f /\ B by FUNCT_1:68;
              dom f /\ B c= dom f /\ A by A304,XBOOLE_1:26;
          then a <= f.x by A311,A313;
          hence thesis by A312,FUNCT_1:68;
         end;
then A314:     g is_bounded_below_on B by RFUNCT_1:def 10;
         consider a be real number such that
A315:     for x being set st x in A /\ dom f holds f.x<=a
         by A310,RFUNCT_1:def 9;
             for x being set st x in B /\ dom g holds g.x<=a
         proof
          let x be set; assume x in B /\ dom g;
then A316:      x in dom g by XBOOLE_0:def 3;
then A317:      x in dom f /\ B by FUNCT_1:68;
              dom f /\ B c= dom f /\ A by A304,XBOOLE_1:26;
          then a >= f.x by A315,A317;
          hence thesis by A316,FUNCT_1:68;
         end;
         then g is_bounded_above_on B by RFUNCT_1:def 9;
         hence thesis by A314,RFUNCT_1:def 11;
        end;
         rng MD2 <> {};
        then 1 in dom MD2 by FINSEQ_3:34;
then A318:   1 <= len MD2 by FINSEQ_3:27;
A319:   len MD2=indx(D2,D1,j)-'indx(D2,D1,n1+1)+1
        by A227,A228,A229,A299,JORDAN3:27;
then A320:    len MD2 = indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by A227,BINARITH:50;
then A321:     len MD2-1+indx(D2,D1,n1+1)=indx(D2,D1,j);
A322:    rng MD2 = rng MD1 \/ {D.(i+1)}
        proof
             x1 in rng MD2 implies x1 in (rng MD1 \/ {D.(i+1)})
         proof
          assume A323:x1 in rng MD2;
          then reconsider x1 as Real;
A324:     MD2.1=D2.indx(D2,D1,n1+1) by A228,A229,A299,JORDAN3:27;
           MD2.(len MD2)=D2.indx(D2,D1,j)
             by A227,A228,A229,A299,A318,A319,A321,JORDAN3:31;
then A325:      D1.(n1+1) <= x1 & x1 <= D1.j by A225,A226,A323,A324,Th15;
          A326: rng MD2 c= rng D2 by A299,JORDAN3:28;
           now per cases by A21,A323,A326,XBOOLE_0:def 2;
           suppose x1 in rng D1;
           then consider k such that
A327:       k in dom D1 & D1.k = x1 by PARTFUN1:26;
A328:       n1+1 <= k & k <= j by A200,A224,A325,A327,GOBOARD1:def 1;
then A329:       1 <= k-n1 & k-n1 <= len MD1 by A302,XREAL_1:11,21;
               j-(n1+1)+1=j-n1;
then A330:       k-n1 <= j-(n1+1)+1 by A328,XREAL_1:11;
               n1 <= n1+1 by NAT_1:11;
           then n1 <= k by A328,XXREAL_0:2;
           then consider n being Nat such that
A331:       k=n1+n by NAT_1:10;
             n in dom MD1 by A329,A331,FINSEQ_3:27;
then A332:       MD1.n in rng MD1 by FUNCT_1:def 5;
       n in NAT by ORDINAL1:def 13;
      then MD1.n = D1.(k-n1-1+(n1+1)) by A219,A222,A223,A299,A329,A330,A331,
JORDAN3:31
           .= D1.k;
           hence x1 in (rng MD1 \/ {D.(i+1)}) by A327,A332,XBOOLE_0:def 2;
           end;
           suppose x1 in rng D;
           then consider n such that
A333:       n in dom D & D.n = x1 by PARTFUN1:26;
A334:       D.i <= sup divset(D1,n1) by A204,INTEGRA2:1;
               sup divset(D1,n1)=D1.n1
           proof
            per cases;
             suppose n1=1;
             hence thesis by A204,INTEGRA1:def 5;
             end;
             suppose n1<>1;
             hence thesis by A204,INTEGRA1:def 5;
           end;
           end;
           then D.i < D1.(n1+1) by A298,A334,XXREAL_0:2;
           then D.i < D.n by A325,A333,XXREAL_0:2;
           then i < n by A203,A333,GOBOARD2:18;
           then i+1 <= n by NAT_1:13;
then A335:      i+1 = n or i+1 < n by REAL_1:def 5;
            not i+1 < n
           proof
            assume i+1 < n;
then A336:       D.(i+1) < D.n by A199,A333,GOBOARD1:def 1;
             inf divset(D1,j) <= D.(i+1) by A200,INTEGRA2:1;
then A337:       inf divset(D1,j) <= D.n by A336,XXREAL_0:2;
             sup divset(D1,j)=D1.j
            proof
             per cases;
              suppose j=1;
              hence thesis by A200,INTEGRA1:def 5;
              end;
              suppose j<>1;
              hence thesis by A200,INTEGRA1:def 5;
            end;
            end;
            then D.n in rng D&D.n in divset(D1,j)
            by A325,A333,A337,FUNCT_1:def 5,INTEGRA2:1;
then A338:        x1 in rng D /\ divset(D1,j) by A333,XBOOLE_0:def 3;
A339:        D.(i+1) in rng D by A199,FUNCT_1:def 5;
            consider y1 being Real such that
A340:        y1=D.(i+1);
             y1 in rng D /\ divset(D1,j) by A200,A339,A340,XBOOLE_0:def 3;
            hence contradiction by A20,A200,A333,A336,A338,A340,Th4;
           end;
           then x1 in {D.(i+1)} by A333,A335,TARSKI:def 1;
           hence x1 in (rng MD1 \/ {D.(i+1)}) by XBOOLE_0:def 2;
          end;
          end;
          hence thesis;
         end;
then A341:      rng MD2 c= rng MD1 \/ {D.(i+1)} by TARSKI:def 3;
             x1 in (rng MD1 \/ {D.(i+1)}) implies x1 in rng MD2
         proof
          assume A342:x1 in rng MD1 \/ {D.(i+1)};
          then reconsider x1 as Real;
           now per cases by A342,XBOOLE_0:def 2;
           suppose A343:x1 in rng MD1;
            rng MD1 c= rng D1 by A299,JORDAN3:28;
then A344:        x1 in rng D1 by A343;
            rng MD1 <> {};
           then 1 in dom MD1 by FINSEQ_3:34;
then A345:       1 <= len MD1 by FINSEQ_3:27;
A346:        len MD1=j-'(n1+1)+1 by A219,A222,A223,A299,JORDAN3:27;
A347:       MD1.1=D1.(n1+1) by A222,A223,A299,JORDAN3:27;
          len MD1+(n1+1)-1=j-(n1+1)+1+(n1+1)-1 by A219,A346,BINARITH:50
           .=j;
           then MD1.(len MD1)
            =D1.j by A219,A222,A223,A299,A345,A346,JORDAN3:31;
then A348:       D2.indx(D2,D1,n1+1) <= x1 & x1 <= D2.indx(D2,D1,j)
           by A225,A226,A343,A347,Th15;
               rng D1 c= rng D2 by A21,INTEGRA1:def 20;
           then consider k such that
A349:       k in dom D2 & D2.k = x1 by A344,PARTFUN1:26;
A350:       indx(D2,D1,n1+1)<=k & k<=indx(D2,D1,j)
           by A225,A226,A348,A349,GOBOARD1:def 1;
           then indx(D2,D1,n1+1)+1<=k+1 by XREAL_1:8;
           then A351: 1 <= k+1-indx(D2,D1,n1+1) by XREAL_1:21;
            k-indx(D2,D1,n1+1)<=indx(D2,D1,j)-indx(D2,D1,n1+1)
           by A350,XREAL_1:11;
then A352:      k-indx(D2,D1,n1+1)+1<=indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by
XREAL_1:8;
               indx(D2,D1,n1+1)<=k+1 by A350,NAT_1:12;
           then consider n being Nat such that
A353:       k+1 = indx(D2,D1,n1+1)+n by NAT_1:10;
           A354: n in dom MD2 by A320,A351,A352,A353,FINSEQ_3:27;
            n in NAT by ORDINAL1:def 13;
           then MD2.n=D2.(n+indx(D2,D1,n1+1)-1)
           by A227,A228,A229,A299,A351,A352,A353,JORDAN3:31
           .=D2.k by A353;
           hence x1 in rng MD2 by A349,A354,FUNCT_1:def 5;
           end;
           suppose x1 in {D.(i+1)};
then A355:       x1 = D.(i+1) by TARSKI:def 1;
A356:       D.(i+1) in rng D by A199,FUNCT_1:def 5;
               rng D c= rng D2 by A21,INTEGRA1:def 20;
           then consider k such that
A357:       k in dom D2 & x1 = D2.k by A355,A356,PARTFUN1:26;
           inf divset(D1,j) <= D.(i+1) & D.(i+1) <= sup divset(D1,j)
           by A200,INTEGRA2:1;
then A358:       D1.(j-1) <= x1 & x1 <= D1.j by A200,A207,A221,A355,
INTEGRA1:def 5;
A359:       j-1 in dom D1 & j-1 in NAT by A200,A207,A221,INTEGRA1:9;
           reconsider j1 = j-1 as Element of NAT by A200,A207,A221,INTEGRA1:9;
            n1<j1 by A296,XREAL_1:22;
           then n1+1 <= j1 by NAT_1:13;
           then D1.(n1+1) <= D1.(j-1) by A224,A359,GOBOARD2:18;
           then D2.indx(D2,D1,n1+1) <= D2.k & D2.k <= D2.indx(D2,D1,j)
           by A21,A200,A225,A357,A358,XXREAL_0:2,INTEGRA1:def 21;
           hence x1 in rng MD2 by A225,A226,A299,A357,Th16;
          end;
          end;
          hence thesis;
         end;
         then rng MD1 \/ {D.(i+1)} c= rng MD2 by TARSKI:def 3;
         hence thesis by A341,XBOOLE_0:def 10;
        end;
A360:    len MD1 in dom MD1 by FINSEQ_5:6;
then A361:    1 <= len MD1 by FINSEQ_3:27;
A362:    inf divset(MD1,len MD1)=inf divset(D1,j)
        & sup divset(MD1,len MD1)=sup divset(D1,j)
        proof
         per cases;
          suppose A363:len MD1=1;
then A364:      inf divset(MD1,len MD1)=inf B
          & sup divset(MD1,len MD1)=MD1.(len MD1) by A360,INTEGRA1:def 5;
              inf divset(D1,j)=D1.(j-1)
          & sup divset(D1,j)=D1.j by A200,A207,A221,INTEGRA1:def 5;
          hence thesis by A222,A299,A303,A363,A364,JORDAN3:27;
          end;
          suppose A365:len MD1<>1;
then A366:      inf divset(MD1,len MD1)=MD1.(len MD1-1)
          & sup divset(MD1,len MD1)=MD1.(len MD1) by A360,INTEGRA1:def 5;
A367:      len MD1-1+(n1+1)-1=j-1 by A302;
           len MD1-1 in dom MD1 & len MD1-1 in NAT
           by A360,A365,INTEGRA1:9;
           then A368:      len MD1-1 >= 1 by Lm1;
              len MD1 <= len MD1+1 by NAT_1:11;
          then len MD1 -1 <= len MD1 by XREAL_1:22;
then A369:      inf divset(MD1,len MD1)=D1.(j-1) by A219,A222,A223,A299,A300
,A366,A367,A368,JORDAN3:31;
              sup divset(MD1,len MD1)
            =D1.j by A219,A222,A223,A299,A300,A303,A361,A366,JORDAN3:31;
          hence thesis by A200,A207,A221,A369,INTEGRA1:def 5;
        end;
        end;
         inf divset(D1,j)<=D.(i+1) & D.(i+1)<=sup divset(D1,j)
          by A200,INTEGRA2:1;
then A370:    D.(i+1) in divset(MD1,len MD1) by A362,INTEGRA2:1;
A371:     Sum lower_volume(g,MD2)-Sum lower_volume(g,MD1)<=
          (sup rng g-inf rng g)*delta(MD1)
        proof
          vol(B)<>0 & D.(i+1) > inf B
          proof
A372:      vol(B)=sup B-D1.n1 by A299,INTEGRA1:def 6;
A373:      len MD1 in dom MD1 by FINSEQ_5:6;
            sup divset(MD1,len MD1)=MD1.(len MD1)
           proof
            per cases;
             suppose len MD1 = 1;
             hence thesis by A373,INTEGRA1:def 5;
             end;
             suppose len MD1 <> 1;
             hence thesis by A373,INTEGRA1:def 5;
           end;
           end;
then      vol(B)=D1.j-D1.n1 by A200,A207,A221,A299,A362,A372,
INTEGRA1:def 5;
           hence vol(B)<>0 by A200,A204,A207,GOBOARD1:def 1;
            inf divset(D1,j) <= D.(i+1) by A200,INTEGRA2:1;
then A374:        D1.(j-1) <= D.(i+1) by A200,A207,A221,INTEGRA1:def 5;
A375:        n1 < j-1 by A296,XREAL_1:22;
               j-1 in dom D1 by A200,A207,A221,INTEGRA1:9;
           then D1.n1 <D1.(j-1) by A204,A375,GOBOARD1:def 1;
           hence thesis by A299,A374,XXREAL_0:2;
          end;
          hence thesis by A299,A309,A322,A370,Th12;
        end;
         dom g = B by FUNCT_2:def 1;
then A376:   rng g <> {} by RELAT_1:65;
A377:   rng g c= rng f by RELAT_1:99;
            f is_bounded_above_on A & f is_bounded_below_on A
        by A1,RFUNCT_1:def 11;
        then rng f is bounded_above & rng f is bounded_below
        by INTEGRA1:13,15;
        then sup rng f >= sup rng g & inf rng f <= inf rng g
        by A376,A377,SEQ_4:64,65;
then A378:    sup rng f-inf rng f>=sup rng g - inf rng g by REAL_1:92;
            delta(MD1) >= 0 by Th8;
        then (sup rng f-inf rng f)*delta(MD1)>=(sup rng g-inf rng g)*delta(MD1
)
        by A378,XREAL_1:66;
then A379:    Sum lower_volume(g,MD2)-Sum lower_volume(g,MD1)<=
          (sup rng f-inf rng f)*delta(MD1) by A371,XXREAL_0:2;
            delta(MD1)=max rng upper_volume(chi(B,B),MD1) by INTEGRA1:def 19;
        then delta(MD1) in rng upper_volume(chi(B,B),MD1) by PRE_CIRC:def 1;
        then consider k such that
A380:    k in dom upper_volume(chi(B,B),MD1)
        & upper_volume(chi(B,B),MD1).k = delta(MD1) by PARTFUN1:26;
            k in Seg len upper_volume(chi(B,B),MD1) by A380,FINSEQ_1:def 3;
then A381:    k in Seg len MD1 by INTEGRA1:def 7;
then A382:    delta(MD1) = vol(divset(MD1,k)) by A380,INTEGRA1:22;
            n1+1>1 by A221,NAT_1:13;
        then n1>1-1 by XREAL_1:21;
then A383:    1 <= k & k <= len MD1 & k < k+n1 by A381,FINSEQ_1:3,XREAL_1:31;
then A384:    1 < k+n1 by XXREAL_0:2;
A385:    k in dom MD1 by A381,FINSEQ_1:def 3;
            k+n1 <= j by A302,A383,XREAL_1:21;
        then k+n1 <= len D1 by A222,XXREAL_0:2;
then A386:    k+n1 in dom D1 by A384,FINSEQ_3:27;
        A387: divset(MD1,k)=divset(D1,k+n1)
        proof
        inf divset(MD1,k)=inf divset(D1,k+n1)
         & sup divset(MD1,k)=sup divset(D1,k+n1)
         proof
          per cases;
           suppose A388:k=1;
           then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k
           by A385,INTEGRA1:def 5;
then A389:       inf divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
           by A219,A222,A223,A299,A300,A383,JORDAN3:31;
               inf divset(D1,k+n1)=D1.(k+n1-1) & sup divset(D1,k+n1)=D1.(k+n1)
           by A383,A386,INTEGRA1:def 5;
           hence thesis by A388,A389;
           end;
           suppose A390:k<>1;
then A391:       k-1 in dom MD1 & k-1 in NAT by A385,INTEGRA1:9;
then A392:       1 <= k-1 & k-1 <= len MD1 by Lm1;
               inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
           by A385,A390,INTEGRA1:def 5;
           then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
           & sup divset(MD1,k)=D1.(k+(n1+1)-1)
           by A219,A222,A223,A299,A300,A383,A391,A392,JORDAN3:31;
           hence thesis by A383,A386,INTEGRA1:def 5;
         end;
         end;
         then divset(MD1,k)=[.inf divset(D1,k+n1),sup divset(D1,k+n1).]
           by INTEGRA1:5;
         hence thesis by INTEGRA1:5;
        end;
A393:    k+n1 in Seg len D1 by A386,FINSEQ_1:def 3;
then A394:    delta(MD1)=upper_volume(chi(A,A),D1).(k+n1) by A382,A387,
INTEGRA1:22;
            k+n1 in Seg len upper_volume(chi(A,A),D1) by A393,INTEGRA1:def 7;
        then k+n1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
        then delta(MD1) in rng upper_volume(chi(A,A),D1) by A394,FUNCT_1:def 5
;
        then delta(MD1) <= max rng upper_volume(chi(A,A),D1) by PRE_CIRC:def 1
;
then A395:    delta(MD1) <= delta(D1) by INTEGRA1:def 19;
            inf rng f <= sup rng f by A1,Lm4;
        then sup rng f - inf rng f >= 0 by XREAL_1:50;
        then A396: (sup rng f-inf rng f)*delta(MD1) <= (sup rng f-inf rng f)*
delta(D1)
        by A395,XREAL_1:66;
A397:    indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A398:    1 <= indx(D2,D1,n1)+1 by A206,NAT_1:13;
            D1.n1 < D1.(n1+1) by A204,A224,A297,GOBOARD1:def 1;
        then indx(D2,D1,n1) < indx(D2,D1,n1+1) by A205,A225,GOBOARD2:18;
then A399:    indx(D2,D1,n1)+1 <= indx(D2,D1,n1+1) by NAT_1:13;
then A400:    indx(D2,D1,n1)+1 <= len D2 by A228,XXREAL_0:2;
then A401:    indx(D2,D1,n1)+1 <= len LVf(D2) by INTEGRA1:def 8;
A402:    indx(D2,D1,n1+1)=indx(D2,D1,n1)+1
        proof
         assume indx(D2,D1,n1+1)<> indx(D2,D1,n1)+1;
then A403:     indx(D2,D1,n1+1)>indx(D2,D1,n1)+1 by A399,REAL_1:def 5;
A404:     indx(D2,D1,n1)+1 in dom D2 by A398,A400,FINSEQ_3:27;
         then A405: D2.(indx(D2,D1,n1)+1) in rng D2 by FUNCT_1:def 5;
             now per cases by A21,A405,XBOOLE_0:def 2;
          suppose D2.(indx(D2,D1,n1)+1) in rng D1;
          then consider n2 being Element of NAT such that
A406:      n2 in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.n2 by PARTFUN1:26;
              D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
          by A205,A397,A404,GOBOARD1:def 1;
          then n1 < n2 by A204,A205,A406,GOBOARD2:18;
then A407:      n1+1 <= n2 by NAT_1:13;
           D1.n2 < D1.(n1+1) by A225,A403,A404,A406,GOBOARD1:def 1;
          hence contradiction by A224,A406,A407,GOBOARD2:18;
          end;
          suppose D2.(indx(D2,D1,n1)+1) in rng D;
          then consider n2 being Element of NAT such that
A408:      n2 in dom D & D2.(indx(D2,D1,n1)+1) = D.n2 by PARTFUN1:26;
A409:      D1.n1 < D.n2 by A205,A397,A404,A408,GOBOARD1:def 1;
A410:      D.i <= sup divset(D1,n1) by A204,INTEGRA2:1;
           sup divset(D1,n1)=D1.n1
          proof
           per cases;
            suppose n1=1;
            hence thesis by A204,INTEGRA1:def 5;
            end;
            suppose n1<>1;
            hence thesis by A204,INTEGRA1:def 5;
          end;
          end;
          then D.i < D.n2 by A409,A410,XXREAL_0:2;
          then i < n2 by A203,A408,GOBOARD2:18;
then A411:      i+1 <= n2 by NAT_1:13;
A412:      D.n2 < D1.(n1+1) by A225,A403,A404,A408,GOBOARD1:def 1;
A413:      j-1 in dom D1 & j-1 in NAT by A200,A207,A221,INTEGRA1:9;
              n1+1 +1 <= j by A296,NAT_1:13;
          then n1+1 <= j-1 by XREAL_1:21;
then A414:      D1.(n1+1) <= D1.(j-1) by A224,A413,GOBOARD2:18;
A415:      inf divset(D1,j) <= D.(i+1) by A200,INTEGRA2:1;
              inf divset(D1,j) = D1.(j-1) by A200,A207,A221,INTEGRA1:def 5;
          then D1.(n1+1) <= D.(i+1) by A414,A415,XXREAL_0:2;
          then D.n2 < D.(i+1) by A412,XXREAL_0:2;
          hence contradiction by A199,A408,A411,GOBOARD2:18;
         end;
         end;
         hence contradiction;
        end;
A416: Sum lower_volume(g,MD2)=Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        proof
             lower_volume(g,MD2)=mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
         proof
A417:      len lower_volume(g,MD2)=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1
             by A320,A402,INTEGRA1:def 8;
A418:      indx(D2,D1,j) <= len LVf(D2) by A229,INTEGRA1:def 8;
A419:      indx(D2,D1,n1)+1 <= indx(D2,D1,j) by A227,A399,XXREAL_0:2;
then len mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          = indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1 by A229,A398,A401,A418,
JORDAN3:27;
then A420:      len lower_volume(g,MD2)
          =len mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          by A417,A419,BINARITH:50;
              for k st 1<=k & k<=len lower_volume(g,MD2) holds
          lower_volume(g,MD2).k=mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
          proof
           let k; assume A421:1 <= k & k <= len lower_volume(g,MD2);
           then k in Seg len lower_volume(g,MD2) by FINSEQ_1:3;
then A422:       k in Seg len MD2 by INTEGRA1:def 8;
A423:      divset(MD2,k)=[.inf divset(MD2,k),sup divset(MD2,k).] by INTEGRA1:5;
A424:       mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
           =LVf(D2).(k+(indx(D2,D1,n1)+1)-1)
           by A398,A417,A418,A419,A421,JORDAN3:31;
               k <= indx(D2,D1,j)-((indx(D2,D1,n1)+1)-1) by A320,A402,A421,
INTEGRA1:def 8;
           then k+((indx(D2,D1,n1)+1)-1) <= indx(D2,D1,j) by XREAL_1:21;
then A425:       k+(indx(D2,D1,n1)+1)-1 <= len LVf(D2) by A418,XXREAL_0:2;
               1<=indx(D2,D1,n1)+1 by NAT_1:12;
           then 1+1<=k+(indx(D2,D1,n1)+1) by A421,XREAL_1:9;
then A426:       1 <= k+(indx(D2,D1,n1)+1)-1 by XREAL_1:21;
           consider k2 being Element of NAT such that
A427:       indx(D2,D1,n1)+1=1+k2;
             k+k2 in Seg len LVf(D2) by A425,A426,A427,FINSEQ_1:3;
then A428:       k+k2 in Seg len D2 by INTEGRA1:def 8;
then A429:       mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
           =(inf rng(f|divset(D2,k+k2)))*vol(divset(D2,k+k2))
           by A424,A427,INTEGRA1:def 8;
               inf divset(MD2,k)=inf divset(D2,k+k2)
           & sup divset(MD2,k)=sup divset(D2,k+k2)
           proof
              k+k2>=1+1 by A206,A421,A427,XREAL_1:9;
then A430:        k+k2>1 by NAT_1:13;
A431:        k in dom MD2 by A422,FINSEQ_1:def 3;
A432:        k+k2 in dom D2 by A428,FINSEQ_1:def 3;
            per cases;
             suppose A433:k=1;
             then inf divset(MD2,k)=inf B & sup divset(MD2,k)=MD2.k
             by A431,INTEGRA1:def 5;
then A434:         inf divset(MD2,k)=D1.n1
             & sup divset(MD2,k)=D2.(k+(indx(D2,D1,n1)+1)-1)
             by A227,A229,A299,A398,A402,A417,A421,JORDAN3:31;
                 inf divset(D2,k+k2)=D2.(k+k2-1) &sup divset(D2,k+k2)=D2.(k+k2)
             by A430,A432,INTEGRA1:def 5;
             hence thesis by A21,A204,A427,A433,A434,INTEGRA1:def 21;
             end;
             suppose A435:k<>1;
then A436:        k-1 in dom MD2 & k-1 in NAT by A431,INTEGRA1:9;
then A437:        1 <= k-1 by Lm1;
                 k-1 <= k by XREAL_1:148;
then A438:        k-1 <= indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A417,A421,
XXREAL_0:2;
                 inf divset(MD2,k)=MD2.(k-1) & sup divset(MD2,k)=MD2.k
             by A431,A435,INTEGRA1:def 5;
then inf divset(MD2,k)=D2.(k-1+(indx(D2,D1,n1)+1)-1)
             & sup divset(MD2,k)=D2.(k+(indx(D2,D1,n1)+1)-1)
             by A227,A229,A299,A398,A402,A417,A421,A436,A437,A438,JORDAN3:31;
             hence thesis by A427,A430,A432,INTEGRA1:def 5;
           end;
           end;
then A439:       divset(MD2,k)=divset(D2,k+k2) by A423,INTEGRA1:5;
               rng(f|divset(D2,k+k2))=rng(g|divset(D2,k+k2))
           proof
                k in dom MD2 by A422,FINSEQ_1:def 3;
            then divset(D2,k+k2) c= B by A439,INTEGRA1:10;
            hence thesis by FUNCT_1:82;
           end;
           hence thesis by A422,A429,A439,INTEGRA1:def 8;
          end;
          hence thesis by A420,FINSEQ_1:18;
         end;
         hence thesis;
        end;
            Sum lower_volume(g,MD1)=Sum mid(LVf(D1),n1+1,j)
        proof
A440:    len lower_volume(g,MD1)=len MD1 by INTEGRA1:def 8
         .=j-'(n1+1)+1 by A219,A222,A223,A299,JORDAN3:27
         .=j-(n1+1)+1 by A219,BINARITH:50;
A441:    n1+1 <= len LVf(D1) by A223,INTEGRA1:def 8;
A442:    j <= len LVf(D1) by A222,INTEGRA1:def 8;
         then A443: len mid(LVf(D1),n1+1,j)
          =j-'(n1+1)+1 by A219,A222,A223,A441,JORDAN3:27
         .=j-(n1+1)+1 by A219,BINARITH:50;
             lower_volume(g,MD1)=mid(LVf(D1),n1+1,j)
         proof
              for k st 1<=k & k<=len lower_volume(g,MD1) holds
          lower_volume(g,MD1).k=mid(LVf(D1),n1+1,j).k
          proof
           let k; assume A444:1 <= k & k <= len lower_volume(g,MD1);
           then k in Seg len lower_volume(g,MD1) by FINSEQ_1:3;
then A445:      k in Seg len MD1 by INTEGRA1:def 8;
then A446:      lower_volume(g,MD1).k
           =(inf rng(g|divset(MD1,k)))*vol(divset(MD1,k)) by INTEGRA1:def 8;
               k <= j-((n1+1)-1) by A440,A444;
then A447:      k+((n1+1)-1) <= j by XREAL_1:21;
           consider k2 being Element of NAT such that
A448:       n1+1=1+k2;
A449:      k2=(n1+1)-1 by A448;
A450:      1 <= k+k2 by A444,NAT_1:12;
               k+k2 <= len D1 by A222,A447,A448,XXREAL_0:2;
then A451:      k+k2 in Seg len D1 by A450,FINSEQ_1:3;
A452:      mid(LVf(D1),n1+1,j).k
           =LVf(D1).(k+(n1+1)-1) by A219,A223,A440,A442,A444,JORDAN3:31
           .=(inf rng(f|divset(D1,k+k2)))*vol(divset(D1,k+k2))
           by A448,A451,INTEGRA1:def 8;
             1+1 <= k+k2 by A222,A444,A448,XREAL_1:9;
then A453:      1 < k+k2 by NAT_1:13;
A454:      divset(MD1,k)=[.inf divset(MD1,k),sup divset(MD1,k).]
           by INTEGRA1:5;
A455:      k in dom MD1 by A445,FINSEQ_1:def 3;
             A456: k+k2 in dom D1 by A451,FINSEQ_1:def 3;
A457:      divset(D1,k+k2)=divset(MD1,k)
           proof
                inf divset(D1,k+k2)=inf divset(MD1,k)
            & sup divset(D1,k+k2)=sup divset(MD1,k)
            proof
             per cases;
              suppose A458:k=1;
              then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k
              by A455,INTEGRA1:def 5;
              then inf divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
                by A219,A222,A223,A299,A440,A444,JORDAN3:31;
              hence thesis by A449,A453,A456,A458,INTEGRA1:def 5;
              end;
              suppose A459:k<>1;
then A460:         k-1 in dom MD1 & k-1 in NAT by A455,INTEGRA1:9;
then A461:         1 <= k-1 by Lm1;
                  k-1 <= k by XREAL_1:148;
then A462:         k-1 <= j-(n1+1)+1 by A440,A444,XXREAL_0:2;
                  inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
              by A455,A459,INTEGRA1:def 5;
              then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
              & sup divset(MD1,k)=D1.(k+(n1+1)-1)
              by A219,A222,A223,A299,A440,A444,A460,A461,A462,JORDAN3:31;
              hence thesis by A448,A453,A456,INTEGRA1:def 5;
            end;
            end;
            hence thesis by A454,INTEGRA1:5;
           end;
               k in dom MD1 by A445,FINSEQ_1:def 3;
           then divset(D1,k+k2) c= B by A457,INTEGRA1:10;
           hence thesis by A446,A452,A457,FUNCT_1:82;
          end;
          hence thesis by A440,A443,FINSEQ_1:18;
         end;
         hence thesis;
        end;
        hence Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        -Sum
mid(LVf(D1),n1+1,j) <= (sup rng f-inf rng f)*delta(D1) by A379,A396,A416,
XXREAL_0:2;
       end;
       end;
       hence thesis;
       end;
A463:    PLf(D2,indx(D2,D1,j))=
        PLf(D2,indx(D2,D1,n1))+Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        proof
A464:    indx(D2,D1,n1)<indx(D2,D1,j) by A227,A230,XXREAL_0:2;
             indx(D2,D1,j) in Seg len D2 by A226,FINSEQ_1:def 3;
then A465:    indx(D2,D1,j) in Seg len LVf(D2) by INTEGRA1:def 8;
A466:    indx(D2,D1,j) <= len LVf(D2) by A229,INTEGRA1:def 8;
             indx(D2,D1,n1) in Seg len D2 by A205,FINSEQ_1:def 3;
         then indx(D2,D1,n1) in Seg len LVf(D2) by INTEGRA1:def 8;
         then PLf(D2,indx(D2,D1,n1))=Sum(LVf(D2)|indx(D2,D1,n1)) by
INTEGRA1:def 22
         .=Sum mid(LVf(D2),1,indx(D2,D1,n1)) by A206,JORDAN3:25;
         then PLf(D2,indx(D2,D1,n1))+Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,
D1,j))
         =Sum(mid(LVf(D2),1,indx(D2,D1,n1))^
            mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))) by RVSUM_1:105
         .=Sum mid(LVf(D2),1,indx(D2,D1,j)) by A206,A464,A466,INTEGRA2:4
         .=Sum(LVf(D2)|indx(D2,D1,j)) by A229,JORDAN3:25;
         hence thesis by A465,INTEGRA1:def 22;
        end;
A467:    PLf(D1,j)=PLf(D1,n1)+Sum mid(LVf(D1),n1+1,j)
        proof
A468:    j <= len LVf(D1) by A222,INTEGRA1:def 8;
then A469:    j in Seg len LVf(D1) by A222,FINSEQ_1:3;
             n1 in Seg len D1 by A204,FINSEQ_1:def 3;
         then n1 in Seg len LVf(D1) by INTEGRA1:def 8;
         then PLf(D1,n1)=Sum(LVf(D1)|n1) by INTEGRA1:def 22
         .=Sum mid(LVf(D1),1,n1) by A222,JORDAN3:25;
         then PLf(D1,n1)+Sum mid(LVf(D1),n1+1,j)
          =Sum(mid(LVf(D1),1,n1)^mid(LVf(D1),n1+1,j)) by RVSUM_1:105
         .=Sum mid(LVf(D1),1,j) by A207,A222,A468,INTEGRA2:4
         .=Sum(LVf(D1)|j) by A222,JORDAN3:25;
         hence thesis by A469,INTEGRA1:def 22;
        end;
A470:    (PLf(D2,indx(D2,D1,n1))-PLf(D1,n1))+
        (Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
         -Sum mid(LVf(D1),n1+1,j))
        <=i*(sup rng f-inf rng f)*delta(D1)+(sup rng f-inf rng f)*delta(D1)
        by A204,A232,XREAL_1:9;
            (PLf(D2,indx(D2,D1,n1))-PLf(D1,n1))+
        (Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
         -Sum mid(LVf(D1),n1+1,j))
         =PLf(D2,indx(D2,D1,j))-PLf(D1,j) by A463,A467;
        hence thesis by A200,A470;
       end;
       hence thesis;
      end;
A471: for k being non empty Element of NAT holds P[k]
 from BINARITH:sch 1(A43,A196);
          i in Seg len D by A23,FINSEQ_1:def 3;
      then reconsider i as non empty Element of NAT by FINSEQ_1:3;
          P[i] by A471;
      hence thesis by A23;
     end;
         len D in dom D by FINSEQ_5:6;
     then consider j such that
A472:  j in dom D1 & D.(len D) in divset(D1,j) &
       PLf(D2,indx(D2,D1,j))-PLf(D1,j)
     <= (len D)*(sup(rng f)-inf(rng f))*delta(D1) by A22;
A473:  len D1 in dom D1 by FINSEQ_5:6;
A474:  j = len D1
     proof
      assume A475:j<>len D1;
      A476: D.(len D) <= sup divset(D1,j) by A472,INTEGRA2:1;
          j <= len D1 by A472,FINSEQ_3:27;
      then j < len D1 by A475,REAL_1:def 5;
      then D1.j < D1.(len D1) by A472,A473,GOBOARD1:def 1;
then A477: D1.j < sup A by INTEGRA1:def 2;
          sup divset(D1,j) < sup A
      proof
       per cases;
       suppose j=1;
       hence thesis by A472,A477,INTEGRA1:def 5;
       end;
       suppose j<>1;
       hence thesis by A472,A477,INTEGRA1:def 5;
      end;
      end;
      hence contradiction by A476,INTEGRA1:def 2;
     end;
A478:len D2 in dom D2 by FINSEQ_5:6;
A479:indx(D2,D1,len D1) in dom D2 &
     D1.(len D1) = D2.indx(D2,D1,len D1) by A21,A473,INTEGRA1:def 21;
     then sup A = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
     then D2.(len D2) = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
     then indx(D2,D1,len D1)=len D2 by A478,A479,GOBOARD2:19;
     then PLf(D2,len D2)-lower_sum(f,D1)<=(len D)*(sup(rng f)-inf(rng f))*
delta(D1)
     by A472,A474,INTEGRA1:45;
     hence thesis by INTEGRA1:45;
    end;
    hence thesis by A21;
   end;
   hence thesis;
  end;

A480:for e be real number st e>0 ex n st for m st n<=m holds
   abs((lower_sum(f,T)).m-lower_integral(f))<e
   proof
     let e be real number;
     assume A481:e>0;
then A482:e/2>0 by REAL_2:127;
     reconsider e as Real by XREAL_0:def 1;
A483:lower_integral(f) = sup rng lower_sum_set(f) by INTEGRA1:def 16;
A484:rng lower_sum_set(f) is bounded_above by A1,INTEGRA2:36;
         dom lower_sum_set(f) is non empty by INTEGRA1:def 12;
     then rng lower_sum_set(f) is non empty by RELAT_1:65;
     then consider y be real number such that
A485: y in rng lower_sum_set(f) & lower_integral(f)-e/2<y
     by A482,A483,A484,SEQ_4:def 4;
     consider D being Element of divs A such that
A486: D in dom lower_sum_set(f) & y=(lower_sum_set(f)).D & D.1>inf A
     by A3,A485,Lm8;
       A487: y=lower_sum(f,D) by A486,INTEGRA1:def 12;
     set p=len D;
     set H=sup rng f;
     set h=inf rng f;
     deffunc F(Element of NAT)=vol(divset(D,$1));
     consider v being FinSequence of REAL such that
A488:len v = len D & for j st j in Seg len D holds v.j=F(j)
     from FINSEQ_2:sch 1;
     consider v1 being non-decreasing FinSequence of REAL such that
A489: v,v1 are_fiberwise_equipotent by INTEGRA2:3;
     defpred P[Element of NAT] means $1 in dom v1 & v1.$1>0;
A490:ex k st P[k]
     proof
       consider H being Function such that
A491:  dom H = dom v & rng H = dom v1 & H is one-to-one & v=v1*H
       by A489,RFINSEQ:3;
       consider k such that
A492:  k in dom D & vol(divset(D,k)) > 0 by A3,Th1;
           dom D = Seg len v by A488,FINSEQ_1:def 3;
       then k in dom v & v.k > 0 by A488,A492,FINSEQ_1:def 3;
       then H.k in dom v1 & v1.(H.k) > 0 by A491,FUNCT_1:21,22;
       hence thesis;
     end;
     consider k such that
A493: P[k] & for n st P[n] holds k<=n
      from NAT_1:sch 5(A490);
         p <> 0 by FINSEQ_1:25;
then p > 0;
then A494: 2*p >0 by REAL_2:122;
         H >= h by A1,Lm4;
     then H-h >= 0 by XREAL_1:50;
     then H-h+1 > 0+0 by XREAL_1:10;
then A495: 2*p*(H-h+1) > 0 by A494,REAL_2:122;
         min(v1.k,e/(2*p*(H-h+1))) > 0
     proof
       per cases by XXREAL_0:15;
       suppose min(v1.k,e/(2*p*(H-h+1))) = v1.k;
       hence thesis by A493;
       end;
       suppose min(v1.k,e/(2*p*(H-h+1))) = e/(2*p*(H-h+1));
       hence thesis by A481,A495,REAL_2:127;
     end;
     end;
     then consider n such that
A496: for m st n<=m holds 0 < (delta(T)).m
     & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A5;
A497: for m st n<=m holds abs((lower_sum(f,T)).m-lower_integral(f))<e
     proof
       let m; assume A498:n<=m;
then A499:  0 < (delta(T)).m & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A496
;
       reconsider D1 = T.m as Element of divs A;
       consider D2 being Element of divs A such that
A500:   D <= D2 & D1 <= D2 & rng D2 = rng D1 \/ rng D &
       0 <= lower_sum(f,D2)-lower_sum(f,D) &
       0 <= lower_sum(f,D2)-lower_sum(f,D1) by A14;
           f is_bounded_below_on A by A1,RFUNCT_1:def 11;
       then lower_sum(f,D) <= lower_sum(f,D2) by A500,INTEGRA1:48;
then A501:   lower_sum(f,D)-lower_sum(f,D2)<=0 by REAL_2:106;
A502:  delta(D1)=(delta(T)).m by INTEGRA2:def 3;
A503:   delta(D1)<min (v1.k,e/(2*p*(H-h+1))) by A499,INTEGRA2:def 3;
           min (v1.k,e/(2*p*(H-h+1))) <= v1.k by XXREAL_0:17;
then A504:   delta(D1)<v1.k by A503,XXREAL_0:2;
A505:  v1.1 > 0
       proof
A506:   for n1 be Element of NAT st n1 in dom D holds
        vol(divset(D,n1))>0
        proof
         let n1 be Element of NAT;
         assume A507:n1 in dom D;
         then A508: 1 <= n1 by FINSEQ_3:27;
         per cases by A508,REAL_1:def 5;
          suppose A509:n1=1;
          then inf divset(D,n1)=inf A & sup divset(D,n1)=D.n1
          by A507,INTEGRA1:def 5;
          then vol(divset(D,n1))=D.n1-inf A by INTEGRA1:def 6;
          hence thesis by A486,A509,XREAL_1:52;
          end;
          suppose A510:n1>1;
          then inf divset(D,n1)=D.(n1-1) & sup divset(D,n1)=D.n1
          by A507,INTEGRA1:def 5;
then A511:     vol(divset(D,n1))=D.n1-D.(n1-1) by INTEGRA1:def 6;
A512:     n1-1 in dom D by A507,A510,INTEGRA1:9;
              n1 < n1+1 by XREAL_1:31;
          then n1-1 < n1 by XREAL_1:21;
          then D.(n1-1)<D.n1 by A507,A512,GOBOARD1:def 1;
          hence thesis by A511,XREAL_1:52;
        end;
        end;
            1 <= k & k <= len v1 by A493,FINSEQ_3:27;
        then 1 <= len v1 by XXREAL_0:2;
        then 1 in dom v1 by FINSEQ_3:27;
then A513:   v1.1 in rng v1 by FUNCT_1:def 5;
            rng v = rng v1 by A489,RFINSEQ:1;
        then consider n1 being Element of NAT such that
A514:   n1 in dom v & v1.1 = v.n1 by A513,PARTFUN1:26;
A515:   n1 in Seg len D by A488,A514,FINSEQ_1:def 3;
then A516:   v1.1 = vol(divset(D,n1)) by A488,A514;
            n1 in dom D by A515,FINSEQ_1:def 3;
        hence thesis by A506,A516;
       end;
           v1.k = min rng upper_volume(chi(A,A),D)
       proof
A517:   k=1
        proof
         assume A518:k <> 1;
A519:    len v1 = len v by A489,RFINSEQ:16;
A520:    k in Seg len v1 by A493,FINSEQ_1:def 3;
             k in Seg len v by A493,A519,FINSEQ_1:def 3;
then A521:    1 <= k & k <= len D by A488,FINSEQ_1:3;
then A522:    k > 1 by A518,REAL_1:def 5;
             k <= len v1 by A520,FINSEQ_1:3;
         then 1 <= len v1 by A521,XXREAL_0:2;
         then 1 in dom v1 by FINSEQ_3:27;
         hence contradiction by A493,A505,A522;
        end;
       min rng upper_volume(chi(A,A),D) in rng upper_volume(chi(A,A),D)
        & for x st x in rng upper_volume(chi(A,A),D)
        holds min rng upper_volume(chi(A,A),D) <= x by PRE_CIRC:def 4;
        then consider m such that
A523:    m in dom upper_volume(chi(A,A),D)
        & min rng upper_volume(chi(A,A),D)=upper_volume(chi(A,A),D).m
        by PARTFUN1:26;
            m in Seg len upper_volume(chi(A,A),D) by A523,FINSEQ_1:def 3;
then A524:    m in Seg len D by INTEGRA1:def 7;
        then min rng upper_volume(chi(A,A),D)=vol(divset(D,m))
        by A523,INTEGRA1:22;
then A525:    v.m=min rng upper_volume(chi(A,A),D) by A488,A524;
            m in dom v by A488,A524,FINSEQ_1:def 3;
then A526:    min rng upper_volume(chi(A,A),D) in rng v by A525,FUNCT_1:def 5;
A527:    rng v = rng v1 by A489,RFINSEQ:1;
        then consider m1 being Element of NAT such that
A528:    m1 in dom v1 & min rng upper_volume(chi(A,A),D)=v1.m1
        by A526,PARTFUN1:26;
            m1 >= 1 by A528,FINSEQ_3:27;
then A529:   v1.1 <= min rng upper_volume(chi(A,A),D) by A493,A517,A528,
INTEGRA2:2;
            v1.k in rng v1 by A493,FUNCT_1:def 5;
        then consider k2 being Element of NAT such that
A530:   k2 in dom v & v1.k = v.k2 by A527,PARTFUN1:26;
A531:   k2 in Seg len D by A488,A530,FINSEQ_1:def 3;
        then v1.k = vol(divset(D,k2)) by A488,A530;
then A532:   v1.k = upper_volume(chi(A,A),D).k2 by A531,INTEGRA1:22;
            k2 in Seg len upper_volume(chi(A,A),D) by A531,INTEGRA1:def 7;
        then k2 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
        then v1.k in rng upper_volume(chi(A,A),D) by A532,FUNCT_1:def 5;
        then v1.k >= min rng upper_volume(chi(A,A),D) by PRE_CIRC:def 4;
        hence thesis by A517,A529,XXREAL_0:1;
       end;
       then consider D3 being Element of divs A such that
A533:  D<=D3 & D1<=D3 & rng D3=rng D1 \/
 rng D & lower_sum(f,D3)-lower_sum(f,D1)
       <=(len D)*(sup rng f-inf rng f)*delta(D1) by A19,A504;
A534:  lower_sum(f,D2)-lower_sum(f,D1)<=(len D)*(sup rng f-inf rng f)*delta(D1)
         by A500,A533,Th5;
           H-h <= H-h+1 by XREAL_1:31;
       then p*(H-h)<=p*(H-h+1) by XREAL_1:66;
then p*(H-h)*(delta(T)).m <= p*(H-h+1)*(delta(T)).m by A499,XREAL_1:66;
then A535:  lower_sum(f,D2)-lower_sum(f,T.m) <= p*(H-h+1)*(delta(T)).m
       by A502,A534,XXREAL_0:2;
A536:  (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A496,A498;
           min(v1.k,e/(2*p*(H-h+1))) <= e/(2*p*(H-h+1)) by XXREAL_0:17;
       then (delta(T)).m < e/(2*p*(H-h+1)) by A536,XXREAL_0:2;
       then (delta(T)).m*(2*p*(H-h+1))<e by A495,REAL_2:177;
       then ((delta(T)).m*(p*(H-h+1)))*2<e;
then A537:  p*(H-h+1)*(delta(T)).m < e/2 by REAL_2:178;
       set s=lower_integral(f);
       set sD=lower_sum(f,D);
       set sD1=lower_sum(f,T.m);
       set sD2=lower_sum(f,D2);
         s-sD1+sD1 < sD+e/2 by A485,A487,XREAL_1:21;
       then A538: s-sD1 < sD+e/2-sD1 by XREAL_1:22;
         (sD-sD1) - (sD2-sD1) = (sD-sD2);
       then sD-sD1 <= sD2-sD1 by A501,XREAL_1:52;
       then sD-sD1 <= p*(H-h+1)*(delta(T)).m by A535,XXREAL_0:2;
       then sD-sD1 < e/2 by A537,XXREAL_0:2;
       then sD-sD1+e/2 < e/2+e/2 by XREAL_1:8;
       then s-sD1 < e by A538,XXREAL_0:2;
then A539:   lower_integral(f)-(lower_sum(f,T)).m < e by INTEGRA2:def 5;
           T.m in divs A;
then A540:   T.m in dom lower_sum_set(f) by INTEGRA1:def 12;
           (lower_sum(f,T)).m = lower_sum(f,T.m) by INTEGRA2:def 5;
       then (lower_sum(f,T)).m = (lower_sum_set(f)).(T.m) by A540,
INTEGRA1:def 12;
       then (lower_sum(f,T)).m in rng lower_sum_set(f) by A540,FUNCT_1:def 5;
       then sup rng lower_sum_set(f)>=(lower_sum(f,T)).m by A484,SEQ_4:def 4;
       then lower_integral(f)>=(lower_sum(f,T)).m by INTEGRA1:def 16;
       then lower_integral(f)-(lower_sum(f,T)).m >= 0 by XREAL_1:50;
       then abs(lower_integral(f)-(lower_sum(f,T)).m) < e by A539,
ABSVALUE:def 1;
       then abs(-(lower_integral(f)-(lower_sum(f,T)).m)) < e by COMPLEX1:138;
       hence thesis;
     end;
     take n;
     thus thesis by A497;
   end;
   hence lower_sum(f,T) is convergent by SEQ_2:def 6;
   hence thesis by A480,SEQ_2:def 7;
end;

theorem
    for A be closed-interval Subset of REAL, f be Function of A,REAL,
T be DivSequence of A
st f is_bounded_on A & delta(T) is convergent_to_0 & vol(A)<>0
holds upper_sum(f,T) is convergent & lim upper_sum(f,T) = upper_integral(f)
proof
   let A be closed-interval Subset of REAL;
   let f be Function of A,REAL;
   let T be DivSequence of A;
   assume A1:f is_bounded_on A;
   assume A2:delta(T) is convergent_to_0;
   assume A3:vol(A)<>0;
A4:delta(T) is_not_0 & delta(T) is convergent & lim delta(T) = 0
     by A2,FDIFF_1:def 1;
A5:for e st e>0 ex n st for m st n<=m holds
       0 < (delta(T)).m & (delta(T)).m < e
   proof
     let e; assume e>0;
     then consider n such that
A6:  for m st n<=m holds abs((delta(T)).m-0)<e by A4,SEQ_2:def 7;
     take n;
       let m; assume n<=m;
then A7:    abs((delta(T)).m-0)<e by A6;
           (delta(T)).m-0<=abs((delta(T)).m-0) by ABSVALUE:11;
then A8:    (delta(T)).m+abs((delta(T)).m-0)<e+abs((delta(T)).m-0) by A7,
XREAL_1:10;
        A9: (delta(T)).m<>0 by A4,SEQ_1:7;
A10:   (delta(T)).m = delta(T.m) by INTEGRA2:def 3;
           delta(T.m) = max rng upper_volume(chi(A,A),T.m) by INTEGRA1:def 19;
       then delta(T.m) in rng upper_volume(chi(A,A),T.m) by PRE_CIRC:def 1;
       then consider i such that
A11:   i in dom upper_volume(chi(A,A),T.m) &
       delta(T.m)=upper_volume(chi(A,A),T.m).i by PARTFUN1:26;
A12:   i in Seg len upper_volume(chi(A,A),T.m) by A11,FINSEQ_1:def 3;
       reconsider D = T.m as Element of divs A;
           i in Seg len D by A12,INTEGRA1:def 7;
       then delta(T.m)=vol(divset(T.m,i)) by A11,INTEGRA1:22;
       hence thesis by A8,A9,A10,XREAL_1:8,INTEGRA1:11;
   end;
A13:for D,D1 be Element of divs A holds ex D2 be Element of divs A st
   D<=D2 & D1<=D2 & rng D2=rng D1 \/
 rng D & 0<=upper_sum(f,D)-upper_sum(f,D2) &
   0<=upper_sum(f,D1)-upper_sum(f,D2)
   proof
     let D,D1 be Element of divs A;
     consider D2 be Element of divs A such that
A14: D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D by Th3;
A15: f is_bounded_above_on A by A1,RFUNCT_1:def 11;
     then upper_sum(f,D2)<=upper_sum(f,D) by A14,INTEGRA1:47;
then A16: upper_sum(f,D)-upper_sum(f,D2)>=0 by XREAL_1:50;
         upper_sum(f,D2)<=upper_sum(f,D1) by A14,A15,INTEGRA1:47;
     then upper_sum(f,D1)-upper_sum(f,D2)>=0 by XREAL_1:50;
     hence thesis by A14,A16;
   end;
A17:sup rng f >= inf rng f by A1,Lm4;
A18:for D,D1 be Element of divs A st delta(D1)<min rng upper_volume(chi(A,A),D)
  holds ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D
  & upper_sum(f,D1)-upper_sum(f,D2) <=
   (len D)*(sup(rng f)-inf(rng f))*delta(D1)
  proof
   let D,D1 be Element of divs A;
   assume A19:delta(D1)<min rng upper_volume(chi(A,A),D);
       ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D
   & upper_sum(f,D1)-upper_sum(f,D2)<=(len D)*(sup(rng f)-inf(rng f))*delta(D1)
   proof
    consider D2 be Element of divs A such that
A20: D<=D2 & D1<=D2 & rng D2=rng D1 \/
 rng D & 0<=upper_sum(f,D)-upper_sum(f,D2)
    & 0<=upper_sum(f,D1)-upper_sum(f,D2) by A13;
        upper_sum(f,D1)-upper_sum(f,D2) <=
      (len D)*(sup(rng f)-inf(rng f))*delta(D1)
    proof
     deffunc PUf(Element of divs A,Nat) = (PartSums(upper_volume(f,$1))).$2;
     deffunc UVf(Element of divs A) = upper_volume(f,$1);
A21:  for i st i in dom D holds ex j st j in dom D1 & D.i in divset(D1,j)
     & PUf(D1,j)-PUf(D2,indx(D2,D1,j))<=i*(sup(rng f)-inf(rng f))*delta(D1)
     proof
      let i; assume A22:i in dom D;
A23:   for i,j st i in dom D & j in dom D1 & D.i in divset(D1,j) holds j >= 2
      proof
       let i,j;
       assume A24:i in dom D;
       assume A25:j in dom D1 & D.i in divset(D1,j);
       assume j<2;
       then j<1+1;
then A26:   j <= 1 by NAT_1:13;
A27:   inf divset(D1,j)<=D.i & D.i<=sup divset(D1,j) by A25,INTEGRA2:1;
           j in Seg len D1 by A25,FINSEQ_1:def 3;
       then j >= 1 by FINSEQ_1:3;
       then j = 1 by A26,XXREAL_0:1;
then A28:   inf divset(D1,j)=inf A & sup divset(D1,j)=D1.j by A25,
INTEGRA1:def 5;
           delta(D1) >= min rng upper_volume(chi(A,A),D)
       proof
        per cases;
         suppose A29:i=1;
             len D <> 0 by FINSEQ_1:25;
         then len D in Seg len D by FINSEQ_1:5;
         then 1 <= len D by FINSEQ_1:3;
then A30:     1 in dom D by FINSEQ_3:27;
then A31:      inf divset(D,1)=inf A & sup divset(D,1)=D.1 by INTEGRA1:def 5;
             sup divset(D1,j)-inf A >= D.1-inf A by A27,A29,XREAL_1:11;
         then vol(divset(D1,j)) >= sup divset(D,1)-inf divset(D,1)
         by A28,A31,INTEGRA1:def 6;
then A32:      vol(divset(D1,j)) >= vol(divset(D,1)) by INTEGRA1:def 6;
             vol(divset(D1,j)) <= delta(D1) by A25,Lm6;
then A33:      delta(D1) >= vol(divset(D,1)) by A32,XXREAL_0:2;
A34:      1 in Seg len D by A30,FINSEQ_1:def 3;
         then 1 in Seg len upper_volume(chi(A,A),D) by INTEGRA1:def 7;
then A35:     1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
             vol(divset(D,1)) = upper_volume(chi(A,A),D).1 by A34,INTEGRA1:22;
         then vol(divset(D,1)) in rng upper_volume(chi(A,A),D)
                          by A35,FUNCT_1:def 5;
         then vol(divset(D,1))>=min rng upper_volume(chi(A,A),D) by
PRE_CIRC:def 4;
         hence thesis by A33,XXREAL_0:2;
         end;
         suppose A36:i<>1;
then A37:     inf divset(D,i)=D.(i-1) & sup divset(D,i)=D.i by A24,
INTEGRA1:def 5;
         then A38:      sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-
inf A
         by A27,A28,XREAL_1:11;
          D.(i-1) in A by A24,A36,INTEGRA1:9;
         then inf A <= D.(i-1) by INTEGRA2:1;
         then sup divset(D,i)-inf A >= sup divset(D,i)-inf divset(D,i)
         by A37,REAL_2:106;
         then sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-inf divset(
D,i)
         by A38,XXREAL_0:2;
         then vol(divset(D1,j)) >= sup divset(D,i)-inf divset(D,i)
         by INTEGRA1:def 6;
then A39:     vol(divset(D1,j)) >= vol(divset(D,i)) by INTEGRA1:def 6;
             vol(divset(D1,j)) <= delta(D1) by A25,Lm6;
then A40:     delta(D1) >= vol(divset(D,i)) by A39,XXREAL_0:2;
A41:     i in Seg len D by A24,FINSEQ_1:def 3;
         then i in Seg len upper_volume(chi(A,A),D) by INTEGRA1:def 7;
then A42:     i in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
             vol(divset(D,i)) = upper_volume(chi(A,A),D).i by A41,INTEGRA1:22;
         then vol(divset(D,i)) in rng upper_volume(chi(A,A),D)
                          by A42,FUNCT_1:def 5;
         then vol(divset(D,i))>=min rng upper_volume(chi(A,A),D) by
PRE_CIRC:def 4;
         hence thesis by A40,XXREAL_0:2;
       end;
       end;
       hence contradiction by A19;
      end;
      defpred P[non empty Element of NAT] means
      $1 in dom D implies
      ex j st j in dom D1 & D.$1 in divset(D1,j)
      & PUf(D1,j)-PUf(D2,indx(D2,D1,j))<=$1*(sup rng f-inf rng f)*delta(D1);

A43: P[1]
      proof
           len D <> 0 by FINSEQ_1:25;
       then len D in Seg len D by FINSEQ_1:5;
       then 1 <= len D by FINSEQ_1:3;
then A44:   1 in dom D by FINSEQ_3:27;
       then D.1 in A by INTEGRA1:8;
       then consider j such that
A45:   j in dom D1 & D.1 in divset(D1,j) by Th2;
           PUf(D1,j)-PUf(D2,indx(D2,D1,j))<=1*(sup rng f-inf rng f)*delta(D1)
       proof
A46:    j <> 1 by A23,A44,A45;
        then reconsider j1=j-1 as Element of NAT by A45,INTEGRA1:9;
A47:    j-1 in NAT & j-1 in dom D1 by A45,A46,INTEGRA1:9;
         inf divset(D1,j) <= D.1 & D.1 <= sup divset(D1,j) by A45,INTEGRA2:1;
        then A48:    D1.j1 <= D.1 & D.1 <= D1.j by A45,A46,INTEGRA1:def 5;
A49:    indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) &
          indx(D2,D1,j1) <= len D2
        proof
         thus indx(D2,D1,j1) in dom D2 by A20,A47,INTEGRA1:def 21;
         then indx(D2,D1,j1) in Seg len D2 by FINSEQ_1:def 3;
         hence thesis by FINSEQ_1:3;
        end;
        then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
then A50:    D2|indx(D2,D1,j1) is increasing by A49,JORDAN3:25;
A51:    j1 in dom D1 & 1 <= j1 & j1 <= len D1
        proof
         thus j1 in dom D1 by A45,A46,INTEGRA1:9;
             j1 in Seg len D1 by A47,FINSEQ_1:def 3;
         hence thesis by FINSEQ_1:3;
        end;
        then mid(D1,1,j1) is increasing by INTEGRA1:37;
then A52:    D1|j1 is increasing by A51,JORDAN3:25;
A53:    rng (D2|indx(D2,D1,j1)) = rng (D1|j1)
        proof
          for x1 st x1 in rng(D2|indx(D2,D1,j1)) holds x1 in rng(D1|j1)
         proof
          let x1; assume x1 in rng(D2|indx(D2,D1,j1));
          then consider k such that
A54:      k in dom(D2|indx(D2,D1,j1)) & x1=(D2|indx(D2,D1,j1)).k
          by PARTFUN1:26;
              k in Seg len(D2|indx(D2,D1,j1)) by A54,FINSEQ_1:def 3;
then A55:      k in Seg indx(D2,D1,j1) by A49,FINSEQ_1:80;
then A56:      (D2|indx(D2,D1,j1)).k = D2.k & k in dom D2 by A49,RFINSEQ:19;
then A57:       D2.k in rng D2 by FUNCT_1:def 5;
              1 <= k & k <= indx(D2,D1,j1) by A55,FINSEQ_1:3;
          then D2.k <= D2.indx(D2,D1,j1) by A49,A56,GOBOARD2:18;
then A58:      D2.k <= D1.j1 by A20,A47,INTEGRA1:def 21;
A59:      len(D1|j1) = j1 by A51,FINSEQ_1:80;
A60:      D2.k in rng D implies D2.k = D1.j1
          proof
           assume D2.k in rng D;
           then consider n such that
A61:       n in dom D & D2.k=D.n by PARTFUN1:26;
            1 <= n by A61,FINSEQ_3:27;
           then D.1 <= D2.k by A44,A61,GOBOARD2:18;
           then D1.j1 <= D2.k by A48,XXREAL_0:2;
           hence thesis by A58,XXREAL_0:1;
          end;
A62:      D2.k in rng D implies D2.k in rng(D1|j1)
          proof
           assume A63:D2.k in rng D;
               j1 in Seg len(D1|j1) by A51,A59,FINSEQ_1:3;
           then j1 in dom(D1|j1) by FINSEQ_1:def 3;
then A64:       (D1|j1).j1 in rng(D1|j1) by FUNCT_1:def 5;
               j1 in Seg j1 by A51,FINSEQ_1:3;
           hence thesis by A51,A60,A63,A64,RFINSEQ:19;
          end;
              D2.k in rng D1 implies D2.k in rng(D1|j1)
          proof
           assume D2.k in rng D1;
           then consider m such that
A65:       m in dom D1 & D2.k = D1.m by PARTFUN1:26;
               m in Seg len D1 by A65,FINSEQ_1:def 3;
then A66:       1 <= m & m <= j1 by A51,A58,A65,FINSEQ_1:3,GOBOARD1:def 1;
           then m in Seg len(D1|j1) by A59,FINSEQ_1:3;
then A67:       m in dom (D1|j1) by FINSEQ_1:def 3;
               m in Seg j1 by A66,FINSEQ_1:3;
           then D2.k = (D1|j1).m by A51,A65,RFINSEQ:19;
           hence thesis by A67,FUNCT_1:def 5;
          end;
          hence thesis by A20,A49,A54,A55,A57,A62,RFINSEQ:19,XBOOLE_0:def 2;
         end;
then A68:     rng(D2|indx(D2,D1,j1)) c= rng (D1|j1) by TARSKI:def 3;
             for x1 st x1 in rng(D1|j1) holds x1 in rng(D2|indx(D2,D1,j1))
         proof
          let x1; assume x1 in rng(D1|j1);
          then consider k such that
A69:      k in dom(D1|j1) & x1=(D1|j1).k by PARTFUN1:26;
              k in Seg len(D1|j1) by A69,FINSEQ_1:def 3;
then A70:      k in Seg j1 by A51,FINSEQ_1:80;
then A71:      (D1|j1).k = D1.k & k in dom D1 by A51,RFINSEQ:19;
          then D1.k in rng D1 by FUNCT_1:def 5;
          then x1 in rng D2 by A20,A69,A71,XBOOLE_0:def 2;
          then consider n such that
A72:      n in dom D2 & x1=D2.n by PARTFUN1:26;
A73:      indx(D2,D1,k) in dom D2 & D2.indx(D2,D1,k)=D2.n
          by A20,A69,A71,A72,INTEGRA1:def 21;
              k <= j1 by A70,FINSEQ_1:3;
          then D1.k <= D1.j1 by A47,A71,GOBOARD2:18;
          then D2.indx(D2,D1,k) <= D1.j1 by A20,A71,INTEGRA1:def 21;
          then D2.indx(D2,D1,k)<=D2.indx(D2,D1,j1)
          by A20,A47,INTEGRA1:def 21;
then A74:      n <= indx(D2,D1,j1) by A49,A72,A73,GOBOARD1:def 1;
              1 <= n by A72,FINSEQ_3:27;
then A75:      n in Seg indx(D2,D1,j1) by A74,FINSEQ_1:3;
then A76:      D2.n = (D2|indx(D2,D1,j1)).n by A49,RFINSEQ:19;
              n in Seg len(D2|indx(D2,D1,j1)) by A49,A75,FINSEQ_1:80;
          then n in dom(D2|indx(D2,D1,j1)) by FINSEQ_1:def 3;
          hence thesis by A72,A76,FUNCT_1:def 5;
         end;
         then rng(D1|j1) c= rng(D2|indx(D2,D1,j1)) by TARSKI:def 3;
         hence thesis by A68,XBOOLE_0:def 10;
        end;

then A77:   D2|indx(D2,D1,j1)=D1|j1 by A50,A52,Th5;
A78:   for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
        proof
         let k; assume A79:1 <= k & k <= j1;
         assume A80:k<>indx(D2,D1,k);
             now per cases by A80,XXREAL_0:1;
          suppose A81:k > indx(D2,D1,k);
              1 <= k & k <= len D1 by A51,A79,XXREAL_0:2;
then A82:      k in dom D1 by FINSEQ_3:27;
then A83:      indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
          by A20,INTEGRA1:def 21;
          then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
then A84:      1<=indx(D2,D1,k)&indx(D2,D1,k)<=indx(D2,D1,j1)
          by A20,A51,A79,A82,Th6,FINSEQ_1:3;
          then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
then A85:      (D2|indx(D2,D1,j1)).indx(D2,D1,k)=D2.indx(D2,D1,k) by A49,
RFINSEQ:19;
A86:      indx(D2,D1,k) < j1 by A79,A81,XXREAL_0:2;
          then indx(D2,D1,k) <= len D1 by A51,XXREAL_0:2;
          then indx(D2,D1,k) in dom D1 by A84,FINSEQ_3:27;
then A87:       D1.k > D1.indx(D2,D1,k) by A81,A82,GOBOARD1:def 1;
              indx(D2,D1,k) in Seg j1 by A84,A86,FINSEQ_1:3;
          hence contradiction by A51,A77,A83,A85,A87,RFINSEQ:19;

          end;
          suppose A88:k < indx(D2,D1,k);
              k in Seg j1 by A79,FINSEQ_1:3;
then A89:      D1.k = (D1|j1).k by A47,RFINSEQ:19;
         1 <= k & k <= len D1 by A51,A79,XXREAL_0:2;
then A90:      k in dom D1 by FINSEQ_3:27;
then A91:      indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k)
          by A20,INTEGRA1:def 21;
              indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2 &
          indx(D2,D1,j1) in dom D2 by A20,A51,A79,A90,Th6;
then A92:      k <= indx(D2,D1,j1) by A88,XXREAL_0:2;
          then k <= len D2 by A49,XXREAL_0:2;
          then k in dom D2 by A79,FINSEQ_3:27;
then A93:      D2.k < D2.indx(D2,D1,k) by A88,A91,GOBOARD1:def 1;
              k in Seg indx(D2,D1,j1) by A79,A92,FINSEQ_1:3;
          hence contradiction by A49,A77,A89,A91,A93,RFINSEQ:19;
         end;
         end;
         hence contradiction;
        end;

A94:   len (D2|indx(D2,D1,j1))=len (D1|j1) by A50,A52,A53,Th5;
           len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A49,FINSEQ_1:80;
then A95:  indx(D2,D1,j1) =j1 by A51,A94,FINSEQ_1:80;
           j1 <= len D1 by A47,FINSEQ_3:27;
        then j1 <= len upper_volume(f,D1) by INTEGRA1:def 7;
then A96:   len(upper_volume(f,D1)|j1)=indx(D2,D1,j1) by A95,FINSEQ_1:80;
            indx(D2,D1,j1) in dom D2 by A20,A47,INTEGRA1:def 21;
        then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
        then indx(D2,D1,j1) <= len upper_volume(f,D2) by INTEGRA1:def 7;
then A97:    len(upper_volume(f,D1)|j1)=len(upper_volume(f,D2)|indx(D2,D1,j1))
        by A96,FINSEQ_1:80;
            for k st 1 <= k & k <= len(upper_volume(f,D1)|j1) holds
        (upper_volume(f,D1)|j1).k = (upper_volume(f,D2)|indx(D2,D1,j1)).k
        proof
         let k; assume A98:1 <= k & k <= len(upper_volume(f,D1)|j1);
A99:    len(upper_volume(f,D1)) = len D1 by INTEGRA1:def 7;
then A100:    1 <= k & k <= j1 by A51,A98,FINSEQ_1:80;
then A101:    k in Seg j1 by FINSEQ_1:3;
             k <= len D1 by A51,A100,XXREAL_0:2;
then A102:    k in Seg len D1 by A98,FINSEQ_1:3;
A103:    divset(D1,k)=divset(D2,indx(D2,D1,k))
         proof
A104:    divset(D2,indx(D2,D1,k))= [. inf divset(D2,indx(D2,D1,k)),
          sup divset(D2,indx(D2,D1,k)).] by INTEGRA1:5;
A105:     k in dom D1 by A102,FINSEQ_1:def 3;
then A106:     indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A20,
INTEGRA1:def 21;
              inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
          sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
          proof
           per cases;
            suppose A107:k=1;
then A108:       inf divset(D1,k)=inf A&sup divset(D1,k)=D1.k by A105,
INTEGRA1:def 5;
                indx(D2,D1,k)=1 by A51,A78,A107;
            hence thesis by A106,A108,INTEGRA1:def 5;

            end;
            suppose A109:k<>1;
then A110:       inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
            by A105,INTEGRA1:def 5;
A111:       k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT
            by A105,A109,INTEGRA1:9;
            reconsider k1=k-1 as Element of NAT by A105,A109,INTEGRA1:9;
                k <= k+1 by NAT_1:11;
            then k1 <= k by XREAL_1:22;
then A112:       k1 <= j1 by A100,XXREAL_0:2;
                1 <= k1 by A111,FINSEQ_3:27;
then A113:       k1=indx(D2,D1,k1) by A78,A112;
                indx(D2,D1,k)<>1 by A78,A100,A109;
then A114:        inf divset(D2,indx(D2,D1,k))=D2.(indx(D2,D1,k)-1) &
            sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A106,
INTEGRA1:def 5;
                D2.(indx(D2,D1,k)-1)= D2.indx(D2,D1,k1) by A78,A100,A113;
            hence thesis by A20,A105,A110,A111,A114,INTEGRA1:def 21;
          end;
          end;
          hence thesis by A104,INTEGRA1:5;
         end;
             j1 in Seg len(upper_volume(f,D1)) by A51,A99,FINSEQ_1:def 3;
         then j1 in dom(upper_volume(f,D1)) by FINSEQ_1:def 3;
then A115:    (upper_volume(f,D1)|j1).k = upper_volume(f,D1).k by A101,
RFINSEQ:19
         .=(sup(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
         by A102,A103,INTEGRA1:def 7;
             indx(D2,D1,k) in Seg j1 by A78,A100,A101;
then A116:    indx(D2,D1,k) in Seg indx(D2,D1,j1) by A51,A78;
         then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;
         then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A49,XXREAL_0:2;
then A117:    indx(D2,D1,k) in Seg len D2 by FINSEQ_1:3;
             indx(D2,D1,j1) in Seg len D2 by A49,FINSEQ_1:def 3;
         then indx(D2,D1,j1) in Seg len upper_volume(f,D2) by INTEGRA1:def 7;
then A118:    indx(D2,D1,j1) in dom upper_volume(f,D2) by FINSEQ_1:def 3;
             (upper_volume(f,D2)|indx(D2,D1,j1)).k
          =(upper_volume(f,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A78,A100
         .=upper_volume(f,D2).indx(D2,D1,k) by A116,A118,RFINSEQ:19
         .=(sup(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
         by A117,INTEGRA1:def 7;
         hence thesis by A115;
        end;
then A119:    upper_volume(f,D2)|indx(D2,D1,j1)=upper_volume(f,D1)|j1
        by A97,FINSEQ_1:18;
            indx(D2,D1,j1) in Seg len D2 by A49,FINSEQ_1:def 3;
then A120:   indx(D2,D1,j1) in Seg len upper_volume(f,D2) by INTEGRA1:def 7;
            j1 in Seg len D1 by A51,FINSEQ_1:def 3;
then A121:   j1 in Seg len upper_volume(f,D1) by INTEGRA1:def 7;
A122:   indx(D2,D1,j1)+1 <= indx(D2,D1,j)
        proof
          j < j+1 by NAT_1:13;
         then j1 < j by XREAL_1:21;
         then indx(D2,D1,j1) < indx(D2,D1,j) by A20,A45,A51,Th7;
         hence thesis by NAT_1:13;
        end;
A123:    PUf(D2,indx(D2,D1,j1))=Sum(upper_volume(f,D2)|indx(D2,D1,j1))
        by A120,INTEGRA1:def 22
        .=PUf(D1,j1) by A119,A121,INTEGRA1:def 22;
A124:    Sum mid(upper_volume(f,D1),j,j)
        -Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        <= (sup rng f-inf rng f)*delta(D1)
        proof
A125:   1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len upper_volume(f,D2)
         proof
              indx(D2,D1,j) in dom D2 by A20,A45,INTEGRA1:def 21;
          then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
          then indx(D2,D1,j) in Seg len upper_volume(f,D2) by INTEGRA1:def 7;
          hence thesis by FINSEQ_1:3;
         end;
then A126:    1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len upper_volume(f,D2
)
         by A49,A122,XXREAL_0:2,NAT_1:13;
A127:     indx(D2,D1,j)-indx(D2,D1,j1) <= 2
         proof
          assume A128:indx(D2,D1,j)-indx(D2,D1,j1) > 2;
          reconsider ID1=indx(D2,D1,j1)+1 as Element of NAT;
          reconsider ID2=ID1+1 as Element of NAT;
A129:     indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
          proof
           thus indx(D2,D1,j1) < ID1 by NAT_1:13;
           thus ID1 < ID2 by NAT_1:13;
           indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A128,XREAL_1:22;
           hence thesis;
          end;
A130:     indx(D2,D1,j) in dom D2 by A20,A45,INTEGRA1:def 21;
then A131:     indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A132:     ID1 in dom D2
          proof
A133:      1 <= ID1 & ID1 <= indx(D2,D1,j) by A49,A129,XXREAL_0:2;
           then ID1 <= len D2 by A131,XXREAL_0:2;
           hence thesis by A133,FINSEQ_3:27;
          end;
A134:     ID2 in dom D2
          proof
A135:      indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A129,A131,XXREAL_0:2;
           then 1 <= ID2 by A49,XXREAL_0:2;
           hence thesis by A135,FINSEQ_3:27;
          end;
then A136:     D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2,D1,
j)
          by A49,A129,A130,A132,GOBOARD1:def 1;
A137:     D2.ID1 in rng D & D2.ID2 in rng D
          proof
A138:      D2.ID1 in rng D2 & D2.ID2 in rng D2 by A132,A134,FUNCT_1:def 5;
A139:      D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
           by A20,A45,A51,INTEGRA1:def 21;
            not(D2.ID1 in rng D1) & not D2.ID2 in rng D1
           proof
            assume A140:D2.ID1 in rng D1 or D2.ID2 in rng D1;
            per cases by A140;
             suppose D2.ID1 in rng D1;
             then consider n such that
A141:        n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
              D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
             by A136,XXREAL_0:2;
             then j1<n & n<j by A45,A51,A139,A141,GOBOARD2:18;
             then j<n+1 & n<j by XREAL_1:21;
             hence contradiction by NAT_1:13;
             end;
             suppose D2.ID2 in rng D1;
             then consider n such that
A142:        n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
              D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
             by A136,XXREAL_0:2;
             then j1<n & n<j by A45,A51,A139,A142,GOBOARD2:18;
             then j<n+1 & n<j by XREAL_1:21;
             hence contradiction by NAT_1:13;
           end;
           end;
           hence thesis by A20,A138,XBOOLE_0:def 2;
          end;
A143:     inf divset(D1,j)=D2.indx(D2,D1,j1)
          & sup divset(D1,j)=D2.indx(D2,D1,j)
          proof
            inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
           by A45,A46,INTEGRA1:def 5;
           hence thesis by A20,A45,A51,INTEGRA1:def 21;
          end;
A144:     D2.ID1 in rng D /\ divset(D1,j)
          proof
            D2.indx(D2,D1,j1)<=D2.ID1&D2.ID1<=D2.indx(D2,D1,j)
           by A136,XXREAL_0:2;
           then D2.ID1 in divset(D1,j) by A143,INTEGRA2:1;
           hence thesis by A137,XBOOLE_0:def 3;
          end;
        D2.ID2 in rng D /\ divset(D1,j)
          proof
            D2.indx(D2,D1,j1)<=D2.ID2&D2.ID2<=D2.indx(D2,D1,j)
           by A136,XXREAL_0:2;
           then D2.ID2 in divset(D1,j) by A143,INTEGRA2:1;
           hence thesis by A137,XBOOLE_0:def 3;
          end;
          then D2.ID1=D2.ID2 by A19,A45,A144,Th4;
          hence contradiction by A129,A132,A134,GOBOARD2:19;
         end;
         1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
         indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
         proof
A145:     indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
           =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A122,BINARITH:50;
           indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
          hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
          thus thesis by A127,A145;
         end;
then A146:      1 <= len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j
)) &
         len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
         by A122,A125,A126,JORDAN3:27;
             1 <= j & j <= len D1 by A45,FINSEQ_3:27;
then A147:    1 <= j & j <= len upper_volume(f,D1) by INTEGRA1:def 7;
       j-'j+1 = 1 by Lm2;
then A148:    len mid(upper_volume(f,D1),j,j) = 1 by A147,JORDAN3:27;
             mid(upper_volume(f,D1),j,j).1 = upper_volume(f,D1).j
           by A147,JORDAN3:27;
         then mid(upper_volume(f,D1),j,j)
          =<*upper_volume(f,D1).j*> by A148,FINSEQ_1:57;
then A149:     Sum mid(upper_volume(f,D1),j,j)=upper_volume(f,D1).j by
FINSOP_1:12;
A150:     indx(D2,D1,j1)+1 in Seg len D2
         proof
              indx(D2,D1,j1)+1 in Seg len upper_volume(f,D2) by A126,FINSEQ_1:3
;
          hence thesis by INTEGRA1:def 7;
         end;
A151:    j in Seg len D1 by A45,FINSEQ_1:def 3;
             now per cases by A146,Lm3;
          suppose
A152:      len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A153:      indx(D2,D1,j1)+1=indx(D2,D1,j)
          proof
               len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
           = indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 by A122,A125,A126,JORDAN3:27;
           then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A122,A152,BINARITH:50;
           hence thesis;
          end;
A154:     divset(D2,indx(D2,D1,j))=divset(D1,j)
          proof
               inf divset(D1,j)=D2.indx(D2,D1,j1) &
           sup divset(D1,j)=D2.indx(D2,D1,j)
           proof
                inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
            by A45,A46,INTEGRA1:def 5;
            hence thesis by A20,A45,A51,INTEGRA1:def 21;
           end;
then A155:      divset(D1,j)=[. D2.indx(D2,D1,j1),D2.indx(D2,D1,j).] by
INTEGRA1:5;
A156:      indx(D2,D1,j)-1=indx(D2,D1,j1) by A153;
A157:      indx(D2,D1,j) in dom D2 by A20,A45,INTEGRA1:def 21;
               indx(D2,D1,j)<>1 by A49,A153,NAT_1:13;
           then inf divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j1)
           & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
           by A156,A157,INTEGRA1:def 5;
           hence thesis by A155,INTEGRA1:5;
          end;
              mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
           =upper_volume(f,D2).(indx(D2,D1,j1)+1) by A125,A126,JORDAN3:27;
          then mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =<*upper_volume(f,D2).(indx(D2,D1,j1)+1)*> by A152,FINSEQ_1:57;
          then A158: Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j
))
           =upper_volume(f,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
          .=(sup(rng(f|divset(D2,(indx(D2,D1,j1)+1)))))
          *vol(divset(D2,(indx(D2,D1,j1)+1))) by A150,INTEGRA1:def 7
          .=Sum mid(upper_volume(f,D1),j,j)
            by A149,A151,A153,A154,INTEGRA1:def 7;
A159:      delta(D1) >= 0 by Th8;
              sup rng f - inf rng f >= 0 by A17,XREAL_1:50;
          then (sup rng f - inf rng f)*delta(D1) >= 0*delta(D1) by A159,
XREAL_1:66;
          hence Sum mid(upper_volume(f,D1),j,j)
          -Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          <= (sup rng f-inf rng f)*delta(D1) by A158;
          end;
          suppose
A160:       len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A161:       mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
           =upper_volume(f,D2).(indx(D2,D1,j1)+1) by A125,A126,JORDAN3:27;
              mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
           =upper_volume(f,D2).(indx(D2,D1,j1)+2)
          proof
A162:       2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;
               mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
            =UVf(D2).(2+(indx(D2,D1,j1)+1)-'1) by A122,A125,A126,A160,
JORDAN3:27
           .=UVf(D2).(2+(indx(D2,D1,j1)+1)-1) by A162,BINARITH:50
           .=UVf(D2).(indx(D2,D1,j1)+(1+1));
           hence thesis;
          end;
          then mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =<*upper_volume(f,D2).(indx(D2,D1,j1)+1),
             upper_volume(f,D2).(indx(D2,D1,j1)+2)*> by A160,A161,FINSEQ_1:61;
then A163:       Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
           =upper_volume(f,D2).(indx(D2,D1,j1)+1)
           +upper_volume(f,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A164:       vol(divset(D1,j))
          =vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
          proof
A165:    inf divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
           proof
                inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
            by A45,A46,INTEGRA1:def 5;
            hence thesis by A20,A45,A51,INTEGRA1:def 21;
           end;
A166:       indx(D2,D1,j)=indx(D2,D1,j1)+2
           proof
                indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
            by A122,A125,A126,A160,JORDAN3:27;
            then 2=indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1 by A122,BINARITH:50
            .=indx(D2,D1,j)-indx(D2,D1,j1);
            hence thesis;
           end;
A167:       inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
           & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
           & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
           & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
           proof
A168:        indx(D2,D1,j1)+2 in dom D2 by A20,A45,A166,INTEGRA1:def 21;
            indx(D2,D1,j1)+1 in Seg len upper_volume(f,D2) by A126,FINSEQ_1:3;
            then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 7;
then A169:        indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A170:        indx(D2,D1,j1)+1 <> 1 by A49,NAT_1:13;
              A171: indx(D2,D1,j1)+1+1 > 1 by A126,NAT_1:13;
A172:        indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A173:        indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;
            thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
            & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
            by A168,A171,A172,INTEGRA1:def 5;
            thus thesis by A169,A170,A173,INTEGRA1:def 5;
           end;
               vol(divset(D1,j))
            =D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
            +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A165,A166,
INTEGRA1:def 6;
           then vol(divset(D1,j))=vol(divset(D2,indx(D2,D1,j1)+2))
            +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A167,INTEGRA1:def 6
           .=vol(divset(D2,indx(D2,D1,j1)+2))
            +(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1))
           by A167;
           hence thesis by INTEGRA1:def 6;
          end;
then A174:     upper_volume(f,D1).j=(sup(rng(f|divset(D1,j))))*
          (vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
          by A151,INTEGRA1:def 7;
A175:       vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A176:      vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
          A177: Sum mid(UVf(D1),j,j)-Sum mid(UVf(D2),indx(D2,D1,j1)+1,indx(D2,
D1,j))
          <=(sup rng f - inf rng f)*(vol(divset(D2,indx(D2,D1,j1)+2))
          +vol(divset(D2,indx(D2,D1,j1)+1)))
          proof
A178:      indx(D2,D1,j) in dom D2 by A20,A45,INTEGRA1:def 21;
then A179:       indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
A180:      indx(D2,D1,j)=indx(D2,D1,j1)+2
           proof
             indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
              by A122,A125,A126,A160,JORDAN3:27;
            then 2=indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1 by A122,BINARITH:50
            .=indx(D2,D1,j)-indx(D2,D1,j1);
            hence thesis;
           end;
           set ID1=indx(D2,D1,j1)+1;
           set ID2=indx(D2,D1,j1)+2;
A181:       Sum mid(UVf(D2),ID1,indx(D2,D1,j))
            =(sup rng(f|divset(D2,ID2)))*vol(divset(D2,ID2))
            +UVf(D2).ID1 by A163,A179,A180,INTEGRA1:def 7
           .=(sup rng(f|divset(D2,ID2)))*vol(divset(D2,ID2))
            +(sup rng(f|divset(D2,ID1)))
            *vol(divset(D2,ID1)) by A150,INTEGRA1:def 7;
               divset(D2,ID2) c= A by A178,A180,INTEGRA1:10;
           then A182: sup rng(f|divset(D2,ID2)) >= inf rng f by A1,Lm5;
            ID1 in dom D2 by A150,FINSEQ_1:def 3;
           then divset(D2,ID1)c=A by INTEGRA1:10;
           then sup rng(f|divset(D2,ID1)) >= inf rng f by A1,Lm5;
then A183:       (sup rng(f|divset(D2,ID1)))*vol(divset(D2,ID1))
           >=(inf rng f)*vol(divset(D2,ID1)) by A175,XREAL_1:66;
               divset(D1,j)c=A by A45,INTEGRA1:10;
           then sup rng(f|divset(D1,j)) <= sup rng f by A1,Lm5;
then A184:      (sup rng(f|divset(D1,j)))*vol(divset(D2,ID2))
           <=(sup rng f)*vol(divset(D2,ID2))
           & (sup rng(f|divset(D1,j)))*vol(divset(D2,ID1))
           <=(sup rng f)*vol(divset(D2,ID1)) by A175,A176,XREAL_1:66;
           set SR = sup rng(f|divset(D2,ID1)), VR = vol(divset(D2,ID1));
               Sum mid(UVf(D2),ID1,indx(D2,D1,j)) - SR*VR
           >=(inf rng f)*vol(divset(D2,ID2)) by A176,A181,A182,XREAL_1:66;
           then Sum mid(UVf(D2),ID1,indx(D2,D1,j))
           >=(inf rng f)*vol(divset(D2,ID2))+SR*VR by XREAL_1:21;
           then Sum mid(UVf(D2),ID1,indx(D2,D1,j))-(inf rng f)*vol(divset(D2,
ID2))
           >=SR*VR by XREAL_1:21;
           then Sum mid(UVf(D2),ID1,indx(D2,D1,j))-(inf rng f)*vol(divset(D2,
ID2))
           >=(inf rng f)*VR by A183,XXREAL_0:2;
then A185:      Sum mid(UVf(D2),ID1,indx(D2,D1,j))>=(inf rng f)*vol(divset(D2,
ID2))+
           (inf rng f)*VR by XREAL_1:21;
           reconsider A = sup rng(f|divset(D1,j)) as real number;
           set B = vol(divset(D2,ID1));
           set C = vol(divset(D2,ID2));
            upper_volume(f,D1).j-A*B = A*C by A174;
           then Sum mid(UVf(D1),j,j)<=(sup rng(f|divset(D1,j)))*vol(divset(D2,
ID1))
           +(sup rng f)*vol(divset(D2,ID2)) by A149,A184,XREAL_1:22;
           then Sum mid(UVf(D1),j,j)-(sup rng f)*vol(divset(D2,ID2))
           <=(sup rng(f|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:22;
           then Sum mid(UVf(D1),j,j)-(sup rng f)*vol(divset(D2,ID2))
           <=(sup rng f)*vol(divset(D2,ID1)) by A184,XXREAL_0:2;
           then Sum mid(UVf(D1),j,j)
           <=(sup rng f)*vol(divset(D2,ID2))+(sup rng f)*vol(divset(D2,ID1))
           by XREAL_1:22;
           then Sum mid(UVf(D1),j,j)-Sum mid(UVf(D2),ID1,indx(D2,D1,j))
           <=(sup rng f)*vol(divset(D2,ID2))+(sup rng f)*vol(divset(D2,ID1))
           -((inf rng f)*vol(divset(D2,ID2))+(inf rng f)*vol(divset(D2,ID1)))
           by A185,REAL_1:92;
           hence thesis;
          end;
A186:      vol(divset(D1,j)) <= delta(D1) by A45,Lm6;
              sup rng f - inf rng f >= 0 by A17,XREAL_1:50;
          then (sup rng f - inf rng f)*(vol(divset(D1,j)))
          <=(sup rng f - inf rng f)*delta(D1) by A186,XREAL_1:66;
          hence thesis by A164,A177,XXREAL_0:2;
         end;
         end;
         hence thesis;
        end;

A187:    PUf(D2,indx(D2,D1,j1))
        +Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        =PUf(D2,indx(D2,D1,j))
        proof
             indx(D2,D1,j) in dom D2 by A20,A45,INTEGRA1:def 21;
then A188:    indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
         then A189: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
then A190:    1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len UVf(D2) by
INTEGRA1:def 7;
A191:    indx(D2,D1,j) in Seg len UVf(D2) by A188,INTEGRA1:def 7;
A192:    indx(D2,D1,j1) < indx(D2,D1,j) by A122,NAT_1:13;
             indx(D2,D1,j1) in Seg len D2 by A49,FINSEQ_1:def 3;
         then indx(D2,D1,j1) in Seg len UVf(D2) by INTEGRA1:def 7;
         then PUf(D2,indx(D2,D1,j1))
         =Sum(UVf(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
         then PUf(D2,indx(D2,D1,j1))
         +Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =Sum(UVf(D2)|indx(D2,D1,j1)
          ^mid(UVf(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
         .=Sum(mid(UVf(D2),1,indx(D2,D1,j1))
          ^mid(UVf(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A49,JORDAN3:25
         .=Sum(mid(UVf(D2),1,indx(D2,D1,j))) by A49,A190,A192,INTEGRA2:4
         .=Sum(UVf(D2)|indx(D2,D1,j)) by A189,JORDAN3:25;
         hence thesis by A191,INTEGRA1:def 22;
        end;
       PUf(D1,j1)+Sum mid(upper_volume(f,D1),j,j)=PUf(D1,j)
        proof
A193:    j in Seg len D1 by A45,FINSEQ_1:def 3;
         then A194: 1 <= j & j <= len D1 by FINSEQ_1:3;
then A195:    1 <= j & j <= len UVf(D1) by INTEGRA1:def 7;
A196:    j in Seg len UVf(D1) by A193,INTEGRA1:def 7;
             j < j+1 by NAT_1:13;
then A197:    j1 < j by XREAL_1:21;
             j1 in Seg len D1 by A51,FINSEQ_1:def 3;
         then j1 in Seg len UVf(D1) by INTEGRA1:def 7;
         then PUf(D1,j1)=Sum(UVf(D1)|j1) by INTEGRA1:def 22;
         then PUf(D1,j1)+Sum mid(UVf(D1),j,j)
          =Sum((UVf(D1)|j1)^mid(UVf(D1),j,j)) by RVSUM_1:105
         .=Sum(mid(UVf(D1),1,j1)^mid(UVf(D1),j1+1,j)) by A51,JORDAN3:25
         .=Sum(mid(UVf(D1),1,j)) by A51,A195,A197,INTEGRA2:4
         .=Sum(UVf(D1)|j) by A194,JORDAN3:25;
         hence thesis by A196,INTEGRA1:def 22;
        end;
        hence thesis by A123,A124,A187;
       end;
       hence thesis by A45;
      end;
A198: for i being non empty Element of NAT st P[i] holds P[i+1]
      proof
       let i be non empty Element of NAT;
       assume A199:P[i];
A200:  i>=1 by NAT_1:14;
        P[i+1]
       proof
        assume A201:i+1 in dom D;
        then D.(i+1) in A by INTEGRA1:8;
        then consider j such that
A202:   j in dom D1 & D.(i+1) in divset(D1,j) by Th2;
            i+1 in Seg len D by A201,FINSEQ_1:def 3;
then A203:   1 <= i+1 & i+1 <= len D by FINSEQ_1:3;
            i <= i+1 by NAT_1:11;
        then i <= len D by A203,XXREAL_0:2;
then A204:   i in Seg len D by A200,FINSEQ_1:3;
then A205:   i in dom D by FINSEQ_1:def 3;

        consider n1 being Element of NAT such that
A206:     n1 in dom D1 & D.i in divset(D1,n1)
        & PUf(D1,n1)-PUf(D2,indx(D2,D1,n1))<=i*(sup rng f-inf rng f)*delta(D1)
        by A199,A204,FINSEQ_1:def 3;
A207:   indx(D2,D1,n1) in dom D2 & D2.indx(D2,D1,n1) = D1.n1
        by A20,A206,INTEGRA1:def 21;
then A208:   1 <= indx(D2,D1,n1) & indx(D2,D1,n1) <= len D2 by FINSEQ_3:27;
A209:   n1 < j
        proof
         assume A210:n1 >= j;
             now per cases by A210,REAL_1:def 5;
          suppose n1=j;
          then D.i in divset(D1,j) & D.i in rng D by A205,A206,FUNCT_1:def 5;
then A211:     D.i in rng D /\ divset(D1,j) by XBOOLE_0:def 3;
              D.(i+1) in rng D by A201,FUNCT_1:def 5;
          then D.(i+1) in rng D /\ divset(D1,j) by A202,XBOOLE_0:def 3;
then A212:     D.(i+1)=D.i by A19,A202,A211,Th4;
              i+1 > i by XREAL_1:31;
          hence contradiction by A201,A205,A212,GOBOARD2:19;
          end;
          suppose n1>j;
then A213:       n1>=j+1 by NAT_1:13;
then A214:       n1-1 >= j by XREAL_1:21;
A215:       inf divset(D1,n1) <= D.i by A206,INTEGRA2:1;
A216:       D.(i+1)<=sup divset(D1,j) by A202,INTEGRA2:1;
              1 <= j by A202,FINSEQ_3:27;
          then 1+1 <= j+1 by XREAL_1:8;
then A217:     n1 <> 1 by A213,XXREAL_0:2;
          then n1-1 in dom D1 by A206,INTEGRA1:9;
then A218:     D1.j <= D1.(n1-1) by A202,A214,GOBOARD2:18;
A219:     sup divset(D1,j)=D1.j
          proof
           per cases;
            suppose j=1;
            hence thesis by A202,INTEGRA1:def 5;
            end;
            suppose j<>1;
            hence thesis by A202,INTEGRA1:def 5;
          end;
          end;
              inf divset(D1,n1)=D1.(n1-1) by A206,A217,INTEGRA1:def 5;
          then D.i >= D1.j by A215,A218,XXREAL_0:2;
then A220:     D.i >= D.(i+1) by A216,A219,XXREAL_0:2;
              i < i+1 by XREAL_1:31;
          hence contradiction by A201,A205,A220,GOBOARD1:def 1;
         end;
         end;
         hence thesis;
        end;
then A221:    n1+1 <= j by NAT_1:13;
then A222:    j-n1 >= 1 by XREAL_1:21;
A223:    n1 >= 1 by A206,FINSEQ_3:27;
A224:    1 <= n1 & 1 <= j & j <= len D1 by A202,A206,FINSEQ_3:27;
then A225:    1 <= n1+1 & n1+1 <= len D1 by A221,XXREAL_0:2,NAT_1:12;
then A226:    n1+1 in dom D1 by FINSEQ_3:27;
then A227:    indx(D2,D1,n1+1) in dom D2 & D2.indx(D2,D1,n1+1)=D1.(n1+1)
        by A20,INTEGRA1:def 21;
A228:    indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.j
        by A20,A202,INTEGRA1:def 21;
            D1.(n1+1) <= D1.j by A202,A221,A226,GOBOARD2:18;
then A229:    indx(D2,D1,n1+1) <= indx(D2,D1,j) by A227,A228,GOBOARD1:def 1;
A230:    1 <= indx(D2,D1,n1+1) & indx(D2,D1,n1+1) <= len D2 by A227,FINSEQ_3:27
;
A231:    1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by A228,FINSEQ_3:27;
            n1 < n1+1 by NAT_1:13;
        then D1.n1 < D1.(n1+1) by A206,A226,GOBOARD1:def 1;
then A232:   indx(D2,D1,n1) < indx(D2,D1,n1+1) by A207,A227,GOBOARD2:18;
            1+indx(D2,D1,n1+1) <= indx(D2,D1,j)+1 by A229,XREAL_1:8;
        then 1 <= indx(D2,D1,j)+1-indx(D2,D1,n1+1) by XREAL_1:21;
then A233:     mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j)).1
        =D2.(1-1+indx(D2,D1,n1+1)) by A229,A230,A231,JORDAN3:31
        .=D1.(n1+1) by A20,A226,INTEGRA1:def 21;
A234: Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        <= (sup rng f-inf rng f)*delta(D1)
        proof
        per cases by A221,REAL_1:def 5;
        suppose A235:n1+1=j;
A236:     1 <= n1+1 & n1+1 <= len UVf(D1) by A225,INTEGRA1:def 7;
A237:     j-'(n1+1)+1=j-(n1+1)+1 by A235,BINARITH:50;
A238:     n1+1 in Seg len D1 by A226,FINSEQ_1:def 3;
A239:     len mid(UVf(D1),n1+1,j)= 1 by A235,A236,A237,JORDAN3:27;
            (n1+1)+1 <= j+1 by A221,XREAL_1:8;
        then 1 <= j+1-(n1+1) by XREAL_1:21;
        then mid(UVf(D1),n1+1,j).1 = UVf(D1).(1+(n1+1)-1)
        by A235,A236,JORDAN3:31
        .=(sup rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))
        by A238,INTEGRA1:def 7;
        then mid(UVf(D1),n1+1,j)
        =<*(sup rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))*>
        by A239,FINSEQ_1:57;
then A240:     Sum mid(UVf(D1),n1+1,j)
        =(sup rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1)) by FINSOP_1:12;
             divset(D1,n1+1) c= A by A226,INTEGRA1:10;
then A241:    sup rng(f|divset(D1,n1+1)) <= sup rng f by A1,Lm5;
            vol(divset(D1,n1+1)) >= 0 by INTEGRA1:11;
then A242:    Sum mid(UVf(D1),n1+1,j)
        <=(sup rng f)*vol(divset(D1,n1+1)) by A240,A241,XREAL_1:66;
            D1.n1 < D1.j by A202,A206,A209,GOBOARD1:def 1;
then A243:    indx(D2,D1,n1)<indx(D2,D1,j) by A207,A228,GOBOARD2:18;
then A244:   indx(D2,D1,n1)+1 <= indx(D2,D1,j) by NAT_1:13;
        then indx(D2,D1,n1)+1 <= len D2 by A231,XXREAL_0:2;
then A245:   indx(D2,D1,n1)+1 <= len UVf(D2) by INTEGRA1:def 7;
A246:   1<=indx(D2,D1,n1)+1 by NAT_1:12;
A247:   indx(D2,D1,j) <= len UVf(D2) by A231,INTEGRA1:def 7;
then A248:   len mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        =indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1 by A231,A244,A245,A246,JORDAN3:27
        .=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A244,BINARITH:50
        .=indx(D2,D1,j)-indx(D2,D1,n1);
A249:    indx(D2,D1,j)-indx(D2,D1,n1)<=2
        proof
         assume indx(D2,D1,j) - indx(D2,D1,n1) > 2;
then A250:     indx(D2,D1,n1)+2 < indx(D2,D1,j) by XREAL_1:22;
A251:     indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A252:     indx(D2,D1,n1)+1 < indx(D2,D1,n1)+2 by XREAL_1:8;
A253:     indx(D2,D1,n1)+1 < indx(D2,D1,j) & indx(D2,D1,n1)+1 in dom D2
         proof
          thus indx(D2,D1,n1)+1 < indx(D2,D1,j) by A250,A252,XXREAL_0:2;
          then 1 <= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= len D2
          by A208,A231,XXREAL_0:2,NAT_1:13;
          hence thesis by FINSEQ_3:27;
         end;
A254:    D2.(indx(D2,D1,n1)+1) in rng D
         proof
          A255: D2.(indx(D2,D1,n1)+1) in rng D2 by A253,FUNCT_1:def 5;
              not D2.(indx(D2,D1,n1)+1) in rng D1
          proof
           assume D2.(indx(D2,D1,n1)+1) in rng D1;
           then consider k1 being Element of NAT such that
A256:       k1 in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.k1 by PARTFUN1:26;
               D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
           & D2.(indx(D2,D1,n1)+1) < D2.indx(D2,D1,j)
           by A207,A228,A251,A253,GOBOARD1:def 1;
           then n1 < k1 & k1 < j by A202,A206,A207,A228,A256,GOBOARD2:18;
           hence contradiction by A235,NAT_1:13;
          end;
          hence thesis by A20,A255,XBOOLE_0:def 2;
         end;
A257:    D2.(indx(D2,D1,n1)+1) in rng D /\ divset(D1,j)
         proof
A258:      inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
          by A202,A209,A223,INTEGRA1:def 5;
              D2.(indx(D2,D1,n1)+1) >= D2.indx(D2,D1,n1)
          & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+1)
          by A207,A228,A251,A253,GOBOARD2:18;
          then D2.(indx(D2,D1,n1)+1) in divset(D1,j) by A207,A228,A235,A258,
INTEGRA2:1;
          hence thesis by A254,XBOOLE_0:def 3;
         end;
A259:     indx(D2,D1,n1) < indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 in dom D2
         proof
          thus indx(D2,D1,n1) < indx(D2,D1,n1)+2 by A252,NAT_1:13;
          then 1 <= indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 <= len D2
          by A208,A231,A250,XXREAL_0:2;
          hence thesis by FINSEQ_3:27;
         end;
A260:     D2.(indx(D2,D1,n1)+2) in rng D
         proof
          A261: D2.(indx(D2,D1,n1)+2) in rng D2 by A259,FUNCT_1:def 5;
              not D2.(indx(D2,D1,n1)+2) in rng D1
          proof
           assume D2.(indx(D2,D1,n1)+2) in rng D1;
           then consider k1 being Element of NAT such that
A262:       k1 in dom D1 & D2.(indx(D2,D1,n1)+2) = D1.k1 by PARTFUN1:26;
               D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+2)
           & D2.(indx(D2,D1,n1)+2) < D2.indx(D2,D1,j)
           by A207,A228,A250,A259,GOBOARD1:def 1;
           then n1 < k1 & k1 < j by A202,A206,A207,A228,A262,GOBOARD2:18;
           hence contradiction by A235,NAT_1:13;
          end;
          hence thesis by A20,A261,XBOOLE_0:def 2;
         end;
       D2.(indx(D2,D1,n1)+2) in rng D /\ divset(D1,j)
         proof
A263:      inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
          by A202,A209,A223,INTEGRA1:def 5;
              D2.(indx(D2,D1,n1)+2) >= D2.indx(D2,D1,n1)
          & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+2)
          by A207,A228,A250,A259,GOBOARD2:18;
          then D2.(indx(D2,D1,n1)+2) in divset(D1,j) by A207,A228,A235,A263,
INTEGRA2:1;
          hence thesis by A260,XBOOLE_0:def 3;
         end;
         then D2.(indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+2) by A19,A202,A257,
Th4;
         hence contradiction by A252,A253,A259,GOBOARD1:def 1;
        end;
A264:    indx(D2,D1,j)-indx(D2,D1,n1)=1 or indx(D2,D1,j)-indx(D2,D1,n1)=2
        proof
             indx(D2,D1,n1)+1 <= indx(D2,D1,j) by A243,NAT_1:13;
then A265:     indx(D2,D1,n1)+1 = indx(D2,D1,j) or
         indx(D2,D1,n1)+1 < indx(D2,D1,j) by REAL_1:def 5;
             indx(D2,D1,n1)+1<indx(D2,D1,j) implies indx(D2,D1,n1)+2=indx(D2,D1
,
j
)
         proof
          assume indx(D2,D1,n1)+1 < indx(D2,D1,j);
          then A266: indx(D2,D1,n1)+1+1 <= indx(D2,D1,j) by NAT_1:13;
              indx(D2,D1,n1)+2 >= indx(D2,D1,j) by A249,XREAL_1:22;
          hence thesis by A266,XXREAL_0:1;
         end;
         hence thesis by A265;
        end;
            Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        >=(inf rng f)*vol(divset(D1,n1+1))
        proof
             now per cases by A264;
          suppose A267:indx(D2,D1,j)-indx(D2,D1,n1)=1;
          then 1=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1;
then A268:      mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).1
          =UVf(D2).(1+(indx(D2,D1,n1)+1)-1) by A246,A247,JORDAN3:31
          .=UVf(D2).(indx(D2,D1,n1)+1);
  indx(D2,D1,n1)+1 in Seg len D2 by A228,A267,FINSEQ_1:def 3;
then A269:      UVf(D2).(indx(D2,D1,n1)+1)
          =(sup rng(f|divset(D2,indx(D2,D1,n1)+1)))
           *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 7;
A270:      divset(D2,indx(D2,D1,n1)+1)=divset(D1,n1+1)
          proof
A271:       divset(D1,n1+1)=[.inf divset(D1,n1+1), sup divset(D1,n1+1).]
           by INTEGRA1:5;
               indx(D2,D1,n1)+1 >= 1+1 by A208,XREAL_1:8;
           then indx(D2,D1,n1)+1 <>1;
           then inf divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1-1)
           & sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
           by A228,A267,INTEGRA1:def 5;
then A272:       inf divset(D2,indx(D2,D1,n1)+1)=D1.n1
           & sup divset(D2,indx(D2,D1,n1)+1)=D1.j by A20,A202,A206,A267,
INTEGRA1:def 21;
               inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
           by A209,A223,A226,A235,INTEGRA1:def 5;
           hence thesis by A235,A271,A272,INTEGRA1:5;
          end;
A273:      sup rng(f|divset(D2,indx(D2,D1,n1)+1))>=inf rng f by A1,A228,A267,
Th18;
              vol(divset(D2,indx(D2,D1,n1)+1))>=0 by INTEGRA1:11;
then A274:      UVf(D2).(indx(D2,D1,n1)+1)
          >=(inf rng f)*vol(divset(D1,n1+1)) by A269,A270,A273,XREAL_1:66;
              mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          =<*UVf(D2).(indx(D2,D1,n1)+1)*> by A248,A267,A268,FINSEQ_1:57;
          hence Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          >=(inf rng f)*vol(divset(D1,n1+1)) by A274,FINSOP_1:12;
          end;
          suppose A275:indx(D2,D1,j)-indx(D2,D1,n1)=2;
A276:      indx(D2,D1,n1)+2-1=indx(D2,D1,n1)+1;
A277:     indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1>=1 by A275;
A278:     indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1=1+1 by A275;
A279:      1 <= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= indx(D2,D1,n1)+2
          by NAT_1:12,XREAL_1:8;
          then indx(D2,D1,n1)+1 <= len D2 by A231,A275,XXREAL_0:2;
then A280:      indx(D2,D1,n1)+1 in dom D2 by A279,FINSEQ_3:27;
A281:     indx(D2,D1,j) <= len UVf(D2) by A231,INTEGRA1:def 7;
then A282:      mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).1
          =UVf(D2).(1+(indx(D2,D1,n1)+1)-1) by A275,A277,A279,JORDAN3:31
          .=UVf(D2).(indx(D2,D1,n1)+1);
              mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).2
          =UVf(D2).(2+(indx(D2,D1,n1)+1)-1)
          by A278,A279,A281,JORDAN3:31
          .=UVf(D2).(indx(D2,D1,n1)+0+2);
          then mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          =<*UVf(D2).(indx(D2,D1,n1)+1),UVf(D2).(indx(D2,D1,n1)+2)*>
          by A248,A275,A282,FINSEQ_1:61;
then A283:      Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          =UVf(D2).(indx(D2,D1,n1)+1)+UVf(D2).(indx(D2,D1,n1)+2)
          by RVSUM_1:107;
A284:      UVf(D2).(indx(D2,D1,n1)+1)
          >= (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+1))
          proof
               indx(D2,D1,n1)+1 in Seg len D2 by A280,FINSEQ_1:def 3;
then A285:      UVf(D2).(indx(D2,D1,n1)+1)
           =(sup rng(f|divset(D2,indx(D2,D1,n1)+1)))
            *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 7;
A286:      sup rng(f|divset(D2,indx(D2,D1,n1)+1))
           >=inf rng f by A1,A280,Th18;
               vol(divset(D2,indx(D2,D1,n1)+1)) >= 0 by INTEGRA1:11;
           hence thesis by A285,A286,XREAL_1:66;
          end;
              UVf(D2).(indx(D2,D1,n1)+2)
          >= (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+2))
          proof
               indx(D2,D1,n1)+2 in Seg len D2 by A228,A275,FINSEQ_1:def 3;
then A287:      UVf(D2).(indx(D2,D1,n1)+2)
           =(sup rng(f|divset(D2,indx(D2,D1,n1)+2)))
            *vol(divset(D2,indx(D2,D1,n1)+2)) by INTEGRA1:def 7;
A288:      sup rng(f|divset(D2,indx(D2,D1,n1)+2))
           >=inf rng f by A1,A228,A275,Th18;
               vol(divset(D2,indx(D2,D1,n1)+2)) >= 0 by INTEGRA1:11;
           hence thesis by A287,A288,XREAL_1:66;
          end;
then A289:      Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          >= (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+1))
          + (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+2)) by A283,A284,XREAL_1:9
;
         vol(divset(D2,indx(D2,D1,n1)+1))+vol(divset(D2,indx(D2,D1,n1)+2))
          =vol(divset(D1,n1+1))
          proof
               indx(D2,D1,n1)+1 > 1 by A208,NAT_1:13;
then A290:       inf divset(D2,indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+1-1)
           & sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
           by A280,INTEGRA1:def 5;
               indx(D2,D1,n1)+2 >= 2+1 by A208,XREAL_1:8;
           then indx(D2,D1,n1)+2 <> 1;
then A291:       inf divset(D2,indx(D2,D1,n1)+2) = D2.(indx(D2,D1,n1)+1)
           & sup divset(D2,indx(D2,D1,n1)+2)=D2.indx(D2,D1,j)
           by A228,A275,A276,INTEGRA1:def 5;
A292:       vol(divset(D2,indx(D2,D1,n1)+1))
           =D2.(indx(D2,D1,n1)+1)-D1.n1 by A207,A290,INTEGRA1:def 6;
           A293: vol(divset(D2,indx(D2,D1,n1)+2))
           =D1.j-D2.(indx(D2,D1,n1)+1) by A228,A291,INTEGRA1:def 6;
            inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
            by A209,A223,A226,A235,INTEGRA1:def 5;
then         vol(divset(D1,n1+1))=D1.(n1+1)-D1.n1 by INTEGRA1:def 6;
           hence thesis by A235,A292,A293;
          end;
          hence Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          >=(inf rng f)*vol(divset(D1,n1+1)) by A289;
         end;
         end;
         hence thesis;
        end;
        then A294: Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,
indx(D2,
D1,j))
        <=(sup rng f)*vol(divset(D1,n1+1))-(inf rng f)*vol(divset(D1,n1+1))
        by A242,REAL_1:92;
            sup rng f >= inf rng f by A1,Lm4;
then A295:    sup rng f-inf rng f >= 0 by XREAL_1:50;
            vol(divset(D1,n1+1))<=delta(D1)
        proof
A296:     n1+1 in Seg len D1 by A226,FINSEQ_1:def 3;
then A297:     vol(divset(D1,n1+1))=upper_volume(chi(A,A),D1).(n1+1) by
INTEGRA1:22;
             n1+1 in Seg len upper_volume(chi(A,A),D1) by A296,INTEGRA1:def 7;
         then n1+1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
then A298:     vol(divset(D1,n1+1)) in rng upper_volume(chi(A,A),D1)
         by A297,FUNCT_1:def 5;
             delta(D1)=max rng upper_volume(chi(A,A),D1) by INTEGRA1:def 19;
         hence thesis by A298,PRE_CIRC:def 1;
        end;
        then (sup rng f-inf rng f)*vol(divset(D1,n1+1))
        <=(sup rng f-inf rng f)*delta(D1) by A295,XREAL_1:66;
        hence thesis by A294,XXREAL_0:2;
        end;
        suppose A299:n1+1 < j;
A300:    n1 < n1+1 by NAT_1:13;
then A301:    D1.n1 < D1.(n1+1) by A206,A226,GOBOARD1:def 1;
        then consider B being closed-interval Subset of REAL,
        MD1,MD2 being Element of divs B such that
A302:    D1.n1=inf B & sup B=MD2.(len MD2) & sup B=MD1.(len MD1) & MD1 <= MD2
        & MD1=mid(D1,n1+1,j) & MD2=mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j))
        by A20,A202,A221,A226,A233,Th14;
A303:    len MD1 = j-'(n1+1)+1 by A221,A224,A225,A302,JORDAN3:27;
A304:    j-'(n1+1) = j-(n1+1) by A221,BINARITH:50;
A305:    len MD1 = j-(n1+1)+1 by A221,A303,BINARITH:50;
A306:     j-'(n1+1)+1=j-n1 by A304;
A307:    len MD1+(n1+1)-1 =j by A305;
A308:   B c= A
        proof
          let x1; assume A309:x1 in B;
          then reconsider x1 as Real;
A310:     rng D1 c= A by INTEGRA1:def 2;
A311:     D1.n1 <= x1 & x1 <= MD1.(len MD1) by A302,A309,INTEGRA2:1;
              D1.n1 in rng D1 & D1.j in rng D1 by A202,A206,FUNCT_1:def 5;
then A312:     inf A <= D1.n1 & D1.j <= sup A by A310,INTEGRA2:1;
              MD1.(len MD1)=D1.(j-n1-1+(n1+1))
            by A221,A222,A224,A225,A302,A303,A304,JORDAN3:31
          .=D1.j;
          then inf A <= x1 & x1 <= sup A by A311,A312,XXREAL_0:2;
          hence thesis by INTEGRA2:1;
        end;
        then reconsider g=f|B as Function of B,REAL by FUNCT_2:38;
A313:   g is_bounded_on B
        proof
A314:    f is_bounded_above_on A&f is_bounded_below_on A by A1,RFUNCT_1:def 11;
         then consider a be real number such that
A315:     for x being set st x in A /\ dom f holds a<=f.x
         by RFUNCT_1:def 10;
             for x being set st x in B /\ dom g holds a<=g.x
         proof
          let x be set; assume x in B /\ dom g;
then A316:      x in dom g by XBOOLE_0:def 3;
then A317:      x in dom f /\ B by FUNCT_1:68;
              dom f /\ B c= dom f /\ A by A308,XBOOLE_1:26;
          then a <= f.x by A315,A317;
          hence thesis by A316,FUNCT_1:68;
         end;
then A318:    g is_bounded_below_on B by RFUNCT_1:def 10;
         consider a be real number such that
A319:    for x being set st x in A /\ dom f holds f.x<=a
         by A314,RFUNCT_1:def 9;
          for x being set st x in B /\ dom g holds g.x<=a
         proof
          let x be set; assume x in B /\ dom g;
then A320:     x in dom g by XBOOLE_0:def 3;
then A321:     x in dom f /\ B by FUNCT_1:68;
              dom f /\ B c= dom f /\ A by A308,XBOOLE_1:26;
          then a >= f.x by A319,A321;
          hence thesis by A320,FUNCT_1:68;
         end;
         then g is_bounded_above_on B by RFUNCT_1:def 9;
         hence thesis by A318,RFUNCT_1:def 11;
        end;
            rng MD2 <> {};
        then 1 in dom MD2 by FINSEQ_3:34;
then A322:   1 <= len MD2 by FINSEQ_3:27;
A323:   len MD2=indx(D2,D1,j)-'indx(D2,D1,n1+1)+1
        by A229,A230,A231,A302,JORDAN3:27;
then A324:   len MD2 = indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by A229,BINARITH:50;
then A325:   len MD2-1+indx(D2,D1,n1+1)=indx(D2,D1,j);
A326:   rng MD2 = rng MD1 \/ {D.(i+1)}
        proof
          x1 in rng MD2 implies x1 in (rng MD1 \/ {D.(i+1)})
         proof
          assume A327:x1 in rng MD2;
          then reconsider x1 as Real;
A328:       MD2.1 <= x1 & x1 <= MD2.(len MD2) by A327,Th15;
A329:       MD2.1=D2.indx(D2,D1,n1+1) by A230,A231,A302,JORDAN3:27;
          A330: MD2.(len MD2)=D2.indx(D2,D1,j) by A229,A230,A231,A302,A322,A323
,A325,JORDAN3:31;
A331:     D1.(n1+1) <= x1 & x1 <= D1.j by A20,A226,A228,A229,A230,A231,A302
,A322,A323,A325,A328,A329,INTEGRA1:def 21,JORDAN3:31;
          A332: rng MD2 c= rng D2 by A302,JORDAN3:28;
              now per cases by A20,A327,A332,XBOOLE_0:def 2;
           suppose x1 in rng D1;
           then consider k such that
A333:      k in dom D1 & D1.k = x1 by PARTFUN1:26;
A334:      n1+1 <= k & k <= j by A202,A226,A227,A228,A328,A329,A330,A333,
GOBOARD1:def 1;
then A335:      1 <= k-n1 & k-n1 <= j-n1 by XREAL_1:11,21;
A336:      1 <= k-n1 & k-n1 <= len MD1 by A303,A306,A334,XREAL_1:11,
21;
           A337: j-(n1+1)+1=j-n1;
               n1 <= n1+1 by NAT_1:11;
           then n1 <= k by A334,XXREAL_0:2;
           then consider n being Nat such that
A338:      k=n1+n by NAT_1:10;
            n in dom MD1 by A336,A338,FINSEQ_3:27;
           then A339:      MD1.n in rng MD1 by FUNCT_1:def 5;
            n in NAT by ORDINAL1:def 13;
           then MD1.n = D1.(k-n1-1+(n1+1))
             by A221,A224,A225,A302,A335,A337,A338,JORDAN3:31
           .= D1.k;
           hence x1 in (rng MD1 \/ {D.(i+1)}) by A333,A339,XBOOLE_0:def 2;
           end;
           suppose x1 in rng D;
           then consider n such that
A340:      n in dom D & D.n = x1 by PARTFUN1:26;
A341:      D.i <= sup divset(D1,n1) by A206,INTEGRA2:1;
            sup divset(D1,n1)=D1.n1
           proof
            per cases;
             suppose n1=1;
             hence thesis by A206,INTEGRA1:def 5;
             end;
             suppose n1<>1;
             hence thesis by A206,INTEGRA1:def 5;
           end;
           end;
           then D.i < D1.(n1+1) by A301,A341,XXREAL_0:2;
           then D.i < D.n by A227,A328,A329,A340,XXREAL_0:2;
           then i < n by A205,A340,GOBOARD2:18;
           then i+1 <= n by NAT_1:13;
then A342:      i+1 = n or i+1 < n by REAL_1:def 5;
            not i+1 < n
           proof
            assume i+1 < n;
then A343:       D.(i+1) < D.n by A201,A340,GOBOARD1:def 1;
                inf divset(D1,j) <= D.(i+1) by A202,INTEGRA2:1;
then A344:       inf divset(D1,j) <= D.n by A343,XXREAL_0:2;
             sup divset(D1,j)=D1.j
            proof
             per cases;
              suppose j=1;
              hence thesis by A202,INTEGRA1:def 5;
              end;
              suppose j<>1;
              hence thesis by A202,INTEGRA1:def 5;
            end;
            end;
            then D.n in rng D&D.n in divset(D1,j)
            by A331,A340,A344,FUNCT_1:def 5,INTEGRA2:1;
then A345:       x1 in rng D /\ divset(D1,j) by A340,XBOOLE_0:def 3;
A346:       D.(i+1) in rng D by A201,FUNCT_1:def 5;
            consider y1 being Real such that
A347:       y1=D.(i+1);
             y1 in rng D /\ divset(D1,j) by A202,A346,A347,XBOOLE_0:def 3;
            hence contradiction by A19,A202,A340,A343,A345,A347,Th4;
           end;
           then x1 in {D.(i+1)} by A340,A342,TARSKI:def 1;
           hence x1 in (rng MD1 \/ {D.(i+1)}) by XBOOLE_0:def 2;
          end;
          end;
          hence thesis;
         end;
then A348:    rng MD2 c= rng MD1 \/ {D.(i+1)} by TARSKI:def 3;
          x1 in rng MD1 \/ {D.(i+1)} implies x1 in rng MD2
         proof
          assume A349:x1 in rng MD1 \/ {D.(i+1)};
          then reconsider x1 as Real;
           now per cases by A349,XBOOLE_0:def 2;
           suppose A350:x1 in rng MD1;
               rng MD1 c= rng D1 by A302,JORDAN3:28;
then A351:      x1 in rng D1 by A350;
A352:      MD1.1 <= x1 & x1 <= MD1.(len MD1) by A350,Th15;
               rng MD1 <> {};
           then 1 in dom MD1 by FINSEQ_3:34;
then A353:      1 <= len MD1 by FINSEQ_3:27;
A354:      len MD1=j-'(n1+1)+1 by A221,A224,A225,A302,JORDAN3:27;
A355:       MD1.1=D1.(n1+1) by A224,A225,A302,JORDAN3:27;
          len MD1+(n1+1)-1=j-(n1+1)+1+(n1+1)-1 by A221,A354,BINARITH:50
           .=j;
           then A356: MD1.(len MD1)=D1.j
           by A221,A224,A225,A302,A353,A354,JORDAN3:31;
               rng D1 c= rng D2 by A20,INTEGRA1:def 20;
           then consider k such that
A357:       k in dom D2 & D2.k = x1 by A351,PARTFUN1:26;
A358:       indx(D2,D1,n1+1)<=k & k<=indx(D2,D1,j)
           by A227,A228,A352,A355,A356,A357,GOBOARD1:def 1;
           then indx(D2,D1,n1+1)+1<=k+1 by XREAL_1:8;
           then A359: 1 <= k+1-indx(D2,D1,n1+1) by XREAL_1:21;
               k-indx(D2,D1,n1+1)<=indx(D2,D1,j)-indx(D2,D1,n1+1)
           by A358,XREAL_1:11;
then A360:   k-indx(D2,D1,n1+1)+1<=indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by
XREAL_1:8;
               indx(D2,D1,n1+1)<=k+1 by A358,NAT_1:12;
           then consider n being Nat such that
A361:      k+1 = indx(D2,D1,n1+1)+n by NAT_1:10;
A362:        n in NAT by ORDINAL1:def 13;
              n in dom MD2 by A324,A359,A360,A361,FINSEQ_3:27;
then A363:      MD2.n in rng MD2 by FUNCT_1:def 5;
         n+indx(D2,D1,n1+1)-1=k by A361;
           hence x1 in rng MD2 by A229,A230,A231,A302,A357,A359,A360,A363,
JORDAN3:31,A362;
           end;
           suppose x1 in {D.(i+1)};
then A364:       x1 = D.(i+1) by TARSKI:def 1;
A365:       D.(i+1) in rng D by A201,FUNCT_1:def 5;
               rng D c= rng D2 by A20,INTEGRA1:def 20;
           then consider k such that
A366:       k in dom D2 & x1 = D2.k by A364,A365,PARTFUN1:26;
               inf divset(D1,j)<=D.(i+1) & D.(i+1)<=sup divset(D1,j)
           by A202,INTEGRA2:1;
then A367:       D1.(j-1) <= x1 & x1 <= D1.j by A202,A209,A223,A364,
INTEGRA1:def 5;
A368:       j-1 in dom D1 & j-1 in NAT by A202,A209,A223,INTEGRA1:9;
           reconsider j1 = j-1 as Element of NAT by A202,A209,A223,INTEGRA1:9;
               n1<j1 by A299,XREAL_1:22;
           then n1+1 <= j1 by NAT_1:13;
           then D1.(n1+1) <= D1.(j-1) by A226,A368,GOBOARD2:18;
           then D2.indx(D2,D1,n1+1) <= D2.k & D2.k <= D2.indx(D2,D1,j)
           by A20,A202,A227,A366,A367,XXREAL_0:2,INTEGRA1:def 21;
           hence x1 in rng MD2 by A227,A228,A302,A366,Th16;
          end;
          end;
          hence thesis;
         end;
         then rng MD1 \/ {D.(i+1)} c= rng MD2 by TARSKI:def 3;
         hence thesis by A348,XBOOLE_0:def 10;
        end;
A369:    len MD1 in dom MD1 by FINSEQ_5:6;
then A370:    1 <= len MD1 by FINSEQ_3:27;
A371:    inf divset(MD1,len MD1)=inf divset(D1,j)
        & sup divset(MD1,len MD1)=sup divset(D1,j)
        proof
         per cases;
          suppose A372:len MD1=1;
then A373:      inf divset(MD1,len MD1)=inf B
          & sup divset(MD1,len MD1)=MD1.(len MD1) by A369,INTEGRA1:def 5;
              inf divset(D1,j)=D1.(j-1)
          & sup divset(D1,j)=D1.j by A202,A209,A223,INTEGRA1:def 5;
          hence thesis by A224,A302,A305,A372,A373,JORDAN3:27;
          end;
          suppose A374:len MD1<>1;
then A375:      inf divset(MD1,len MD1)=MD1.(len MD1-1)
          & sup divset(MD1,len MD1)=MD1.(len MD1) by A369,INTEGRA1:def 5;
A376:      len MD1-1+(n1+1)-1=j-1 by A303,A304;
       len MD1-1 in dom MD1 & len MD1-1 in NAT
           by A369,A374,INTEGRA1:9;
then A377:      len MD1-1 >= 1 by Lm1;
              len MD1 <= len MD1+1 by NAT_1:11;
          then len MD1 -1 <= len MD1 by XREAL_1:22;
then A378:      inf divset(MD1,len MD1) = D1.(j-1)
            by A221,A224,A225,A302,A303,A375,A376,A377,JORDAN3:31;
              sup divset(MD1,len MD1)=D1.j
          by A221,A224,A225,A302,A303,A307,A370,A375,JORDAN3:31;
          hence thesis by A202,A209,A223,A378,INTEGRA1:def 5;
        end;
        end;
            inf divset(D1,j)<=D.(i+1) & D.(i+1)<=sup divset(D1,j)
        by A202,INTEGRA2:1;
then A379:    D.(i+1) in divset(MD1,len MD1) by A371,INTEGRA2:1;
A380:   Sum upper_volume(g,MD1)-Sum upper_volume(g,MD2)<=
        (sup rng g-inf rng g)*delta(MD1)
        proof
A381:     vol(B)=sup B-D1.n1 by A302,INTEGRA1:def 6;
A382:     len MD1 in dom MD1 by FINSEQ_5:6;
              vol(B)<>0 & D.(i+1) > inf B
          proof
               sup divset(MD1,len MD1)=MD1.(len MD1)
           proof
            per cases;
             suppose len MD1 = 1;
             hence thesis by A382,INTEGRA1:def 5;
             end;
             suppose len MD1 <> 1;
             hence thesis by A382,INTEGRA1:def 5;
           end;
           end;
then      vol(B)=D1.j-D1.n1 by A202,A209,A223,A302,A371,A381,
INTEGRA1:def 5;
           hence vol(B)<>0 by A202,A206,A209,GOBOARD1:def 1;
               inf divset(D1,j) <= D.(i+1) by A202,INTEGRA2:1;
then A383:      D1.(j-1) <= D.(i+1) by A202,A209,A223,INTEGRA1:def 5;
A384:      n1 < j-1 by A299,XREAL_1:22;
               j-1 in dom D1 by A202,A209,A223,INTEGRA1:9;
           then D1.n1 <D1.(j-1) by A206,A384,GOBOARD1:def 1;
           hence thesis by A302,A383,XXREAL_0:2;
          end;
          hence thesis by A302,A313,A326,A379,Th13;
        end;
            dom g = B by FUNCT_2:def 1;
then A385:   rng g <> {} by RELAT_1:65;
A386:   rng g c= rng f by RELAT_1:99;
            f is_bounded_above_on A & f is_bounded_below_on A
        by A1,RFUNCT_1:def 11;
        then rng f is bounded_above & rng f is bounded_below
        by INTEGRA1:13,15;
        then sup rng f >= sup rng g & inf rng f <= inf rng g
        by A385,A386,SEQ_4:64,65;
then A387:    sup rng f-inf rng f>=sup rng g - inf rng g by REAL_1:92;
            delta(MD1) >= 0 by Th8;
        then (sup rng f-inf rng f)*delta(MD1)>=(sup rng g-inf rng g)*delta(MD1
)
        by A387,XREAL_1:66;
then A388:   Sum upper_volume(g,MD1)-Sum upper_volume(g,MD2)<=
          (sup rng f-inf rng f)*delta(MD1) by A380,XXREAL_0:2;
            delta(MD1)=max rng upper_volume(chi(B,B),MD1) by INTEGRA1:def 19;
        then delta(MD1) in rng upper_volume(chi(B,B),MD1) by PRE_CIRC:def 1;
        then consider k such that
A389:   k in dom upper_volume(chi(B,B),MD1)
        & upper_volume(chi(B,B),MD1).k = delta(MD1) by PARTFUN1:26;
            k in Seg len upper_volume(chi(B,B),MD1) by A389,FINSEQ_1:def 3;
then A390:    k in Seg len MD1 by INTEGRA1:def 7;
then A391:    delta(MD1) = vol(divset(MD1,k)) by A389,INTEGRA1:22;
            n1+1>1 by A223,NAT_1:13;
        then n1>1-1 by XREAL_1:21;
then A392:   1 <= k & k <= len MD1 & k < k+n1 by A390,FINSEQ_1:3,XREAL_1:31;
then A393:   1 < k+n1 by XXREAL_0:2;
A394:   k in dom MD1 by A390,FINSEQ_1:def 3;
            k+n1 <= j by A303,A306,A392,XREAL_1:21;
        then k+n1 <= len D1 by A224,XXREAL_0:2;
then A395:   k+n1 in dom D1 by A393,FINSEQ_3:27;
        A396: divset(MD1,k)=divset(D1,k+n1)
        proof
        inf divset(MD1,k)=inf divset(D1,k+n1)
         & sup divset(MD1,k)=sup divset(D1,k+n1)
         proof
          per cases;
           suppose A397:k=1;
           then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k
           by A394,INTEGRA1:def 5;
then A398:       inf divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
           by A221,A224,A225,A302,A303,A392,JORDAN3:31;
               inf divset(D1,k+n1)=D1.(k+n1-1) & sup divset(D1,k+n1)=D1.(k+n1)
           by A392,A395,INTEGRA1:def 5;
           hence thesis by A397,A398;
           end;
           suppose A399:k<>1;
then A400:      k-1 in dom MD1 & k-1 in NAT by A394,INTEGRA1:9;
then A401:      1 <= k-1 & k-1 <= len MD1 by Lm1;
               inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
                    by A394,A399,INTEGRA1:def 5;
           then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
             & sup divset(MD1,k)=D1.(k+(n1+1)-1)
           by A221,A224,A225,A302,A303,A392,A400,A401,JORDAN3:31;
           hence thesis by A392,A395,INTEGRA1:def 5;
         end;
         end;
         then divset(MD1,k)=[.inf divset(D1,k+n1),sup divset(D1,k+n1).]
           by INTEGRA1:5;
         hence thesis by INTEGRA1:5;
        end;
A402:   k+n1 in Seg len D1 by A395,FINSEQ_1:def 3;
then A403:   delta(MD1)=upper_volume(chi(A,A),D1).(k+n1) by A391,A396,
INTEGRA1:22;
            k+n1 in Seg len upper_volume(chi(A,A),D1) by A402,INTEGRA1:def 7;
        then k+n1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
        then delta(MD1) in rng upper_volume(chi(A,A),D1) by A403,FUNCT_1:def 5
;
        then delta(MD1) <= max rng upper_volume(chi(A,A),D1) by PRE_CIRC:def 1
;
then A404:   delta(MD1) <= delta(D1) by INTEGRA1:def 19;
            inf rng f <= sup rng f by A1,Lm4;
        then sup rng f - inf rng f >= 0 by XREAL_1:50;
        then A405: (sup rng f-inf rng f)*delta(MD1) <= (sup rng f-inf rng f)*
delta(D1)
        by A404,XREAL_1:66;
A406:   indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A407:   1 <= indx(D2,D1,n1)+1 by A208,NAT_1:13;
            D1.n1 < D1.(n1+1) by A206,A226,A300,GOBOARD1:def 1;
        then indx(D2,D1,n1) < indx(D2,D1,n1+1) by A207,A227,GOBOARD2:18;
then A408:   indx(D2,D1,n1)+1 <= indx(D2,D1,n1+1) by NAT_1:13;
then A409:   indx(D2,D1,n1)+1 <= len D2 by A230,XXREAL_0:2;
then A410:   indx(D2,D1,n1)+1 <= len UVf(D2) by INTEGRA1:def 7;
A411:   indx(D2,D1,n1+1)=indx(D2,D1,n1)+1
        proof
         assume indx(D2,D1,n1+1)<> indx(D2,D1,n1)+1;
then A412:    indx(D2,D1,n1+1)>indx(D2,D1,n1)+1 by A408,REAL_1:def 5;
A413:    indx(D2,D1,n1)+1 in dom D2 by A407,A409,FINSEQ_3:27;
         then A414: D2.(indx(D2,D1,n1)+1) in rng D2 by FUNCT_1:def 5;
             now per cases by A20,A414,XBOOLE_0:def 2;
          suppose D2.(indx(D2,D1,n1)+1) in rng D1;
          then consider n2 being Element of NAT such that
A415:     n2 in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.n2 by PARTFUN1:26;
              D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
          by A207,A406,A413,GOBOARD1:def 1;
          then n1 < n2 by A206,A207,A415,GOBOARD2:18;
then A416:     n1+1 <= n2 by NAT_1:13;
              D1.n2 < D1.(n1+1) by A227,A412,A413,A415,GOBOARD1:def 1;
          hence contradiction by A226,A415,A416,GOBOARD2:18;
          end;
          suppose D2.(indx(D2,D1,n1)+1) in rng D;
          then consider n2 being Element of NAT such that
A417:     n2 in dom D & D2.(indx(D2,D1,n1)+1) = D.n2 by PARTFUN1:26;
A418:     D1.n1 < D.n2 by A207,A406,A413,A417,GOBOARD1:def 1;
A419:     D.i <= sup divset(D1,n1) by A206,INTEGRA2:1;
              sup divset(D1,n1)=D1.n1
          proof
           per cases;
            suppose n1=1;
            hence thesis by A206,INTEGRA1:def 5;
            end;
            suppose n1<>1;
            hence thesis by A206,INTEGRA1:def 5;
          end;
          end;
          then D.i < D.n2 by A418,A419,XXREAL_0:2;
          then i < n2 by A205,A417,GOBOARD2:18;
then A420:     i+1 <= n2 by NAT_1:13;
A421:     D.n2 < D1.(n1+1) by A227,A412,A413,A417,GOBOARD1:def 1;
A422:     j-1 in dom D1 & j-1 in NAT by A202,A209,A223,INTEGRA1:9;
              n1+1 +1 <= j by A299,NAT_1:13;
          then n1+1 <= j-1 by XREAL_1:21;
then A423:     D1.(n1+1) <= D1.(j-1) by A226,A422,GOBOARD2:18;
A424:     inf divset(D1,j) <= D.(i+1) by A202,INTEGRA2:1;
              inf divset(D1,j) = D1.(j-1) by A202,A209,A223,INTEGRA1:def 5;
          then D1.(n1+1) <= D.(i+1) by A423,A424,XXREAL_0:2;
          then D.n2 < D.(i+1) by A421,XXREAL_0:2;
          hence contradiction by A201,A417,A420,GOBOARD2:18;
         end;
         end;
         hence contradiction;
        end;
A425: Sum upper_volume(g,MD2)=Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        proof
          upper_volume(g,MD2)=mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
         proof
A426:      len upper_volume(g,MD2)=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1
             by A324,A411,INTEGRA1:def 7;
A427:      indx(D2,D1,j) <= len UVf(D2) by A231,INTEGRA1:def 7;
A428:      indx(D2,D1,n1)+1 <= indx(D2,D1,j) by A229,A408,XXREAL_0:2;
then len mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          = indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1
          by A231,A407,A410,A427,JORDAN3:27;
then A429:      len upper_volume(g,MD2)
          =len mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
          by A426,A428,BINARITH:50;
           for k st 1<=k & k<=len upper_volume(g,MD2) holds
          upper_volume(g,MD2).k=mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
          proof
           let k; assume A430:1 <= k & k <= len upper_volume(g,MD2);
           then k in Seg len upper_volume(g,MD2) by FINSEQ_1:3;
then A431:       k in Seg len MD2 by INTEGRA1:def 7;
then A432:       upper_volume(g,MD2).k
           =(sup rng(g|divset(MD2,k)))*vol(divset(MD2,k)) by INTEGRA1:def 7;
A433:      divset(MD2,k)=[.inf divset(MD2,k),sup divset(MD2,k).] by INTEGRA1:5;
A434:       mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
           =UVf(D2).(k+(indx(D2,D1,n1)+1)-1)
           by A407,A426,A427,A428,A430,JORDAN3:31;
               k <= indx(D2,D1,j)-((indx(D2,D1,n1)+1)-1) by A324,A411,A430,
INTEGRA1:def 7;
           then k+((indx(D2,D1,n1)+1)-1) <= indx(D2,D1,j) by XREAL_1:21;
then A435:       k+(indx(D2,D1,n1)+1)-1 <= len UVf(D2) by A427,XXREAL_0:2;
               1<=indx(D2,D1,n1)+1 by NAT_1:12;
           then 1+1<=k+(indx(D2,D1,n1)+1) by A430,XREAL_1:9;
then A436:       1 <= k+(indx(D2,D1,n1)+1)-1 by XREAL_1:21;
           consider k2 being Element of NAT such that
A437:       indx(D2,D1,n1)+1=1+k2;
             k+k2 in Seg len UVf(D2) by A435,A436,A437,FINSEQ_1:3;
then A438:       k+k2 in Seg len D2 by INTEGRA1:def 7;
then A439:       mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
           =(sup rng(f|divset(D2,k+k2)))*vol(divset(D2,k+k2))
           by A434,A437,INTEGRA1:def 7;
            inf divset(MD2,k)=inf divset(D2,k+k2)
           & sup divset(MD2,k)=sup divset(D2,k+k2)
           proof
              k+k2>=1+1 by A208,A430,A437,XREAL_1:9;
then A440:        k+k2>1 by NAT_1:13;
A441:        k in dom MD2 by A431,FINSEQ_1:def 3;
A442:        k+k2 in dom D2 by A438,FINSEQ_1:def 3;
            per cases;
             suppose A443:k=1;
then A444:        inf divset(MD2,k)=inf B & sup divset(MD2,k)=MD2.k
             by A441,INTEGRA1:def 5;
then A445:         sup divset(MD2,k)=D2.(1+indx(D2,D1,n1+1)-1)
             by A229,A231,A302,A407,A411,A426,A430,A443,JORDAN3:31
             .=D1.(n1+1) by A20,A226,INTEGRA1:def 21;
                 inf divset(D2,k+k2)=D2.(1+k2-1) & sup divset(D2,k+k2)=D2.(1+k2
)
             by A440,A442,A443,INTEGRA1:def 5;
             hence inf divset(MD2,k)=inf divset(D2,k+k2)
             & sup divset(MD2,k)=sup divset(D2,k+k2)
             by A20,A206,A226,A302,A411,A437,A444,A445,INTEGRA1:def 21
;
             end;
             suppose A446:k<>1;
then A447:        k-1 in dom MD2 & k-1 in NAT by A441,INTEGRA1:9;
then A448:        1 <= k-1 by Lm1;
                 k-1 <= k by XREAL_1:148;
then A449:        k-1 <= indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A426,A430,
XXREAL_0:2;
                 inf divset(MD2,k)=MD2.(k-1) & sup divset(MD2,k)=MD2.k
             by A441,A446,INTEGRA1:def 5;
then inf divset(MD2,k)=D2.(k-1+(indx(D2,D1,n1)+1)-1)
             & sup divset(MD2,k)=D2.(k+(indx(D2,D1,n1)+1)-1)
             by A229,A231,A302,A407,A411,A426,A430,A447,A448,A449,JORDAN3:31;
             hence inf divset(MD2,k)=inf divset(D2,k+k2)
             & sup divset(MD2,k)=sup divset(D2,k+k2) by A437,A440,A442,
INTEGRA1:def 5;
            end;
           end;
then A450:       divset(MD2,k)=divset(D2,k+k2) by A433,INTEGRA1:5;
               k in dom MD2 by A431,FINSEQ_1:def 3;
           then divset(D2,k+k2) c= B by A450,INTEGRA1:10;
           hence thesis by A432,A439,A450,FUNCT_1:82;
          end;
          hence thesis by A429,FINSEQ_1:18;
         end;
         hence thesis;
        end;
         Sum upper_volume(g,MD1)=Sum mid(UVf(D1),n1+1,j)
        proof
          upper_volume(g,MD1)=mid(UVf(D1),n1+1,j)
         proof
A451:      j-'(n1+1)+1=j-(n1+1)+1 by A221,BINARITH:50;
A452:      len upper_volume(g,MD1)=len MD1 by INTEGRA1:def 7
          .=j-(n1+1)+1 by A221,A224,A225,A302,A451,JORDAN3:27;
A453:      n1+1 <= len UVf(D1) by A225,INTEGRA1:def 7;
A454:      j <= len UVf(D1) by A224,INTEGRA1:def 7;
then A455:      len upper_volume(g,MD1)=len mid(UVf(D1),n1+1,j)
             by A221,A224,A225,A451,A452,A453,JORDAN3:27;
           for k st 1<=k & k<=len upper_volume(g,MD1) holds
          upper_volume(g,MD1).k=mid(UVf(D1),n1+1,j).k
          proof
           let k; assume A456:1 <= k & k <= len upper_volume(g,MD1);
           then k in Seg len upper_volume(g,MD1) by FINSEQ_1:3;
then A457:      k in Seg len MD1 by INTEGRA1:def 7;
then A458:      upper_volume(g,MD1).k
           =(sup rng(g|divset(MD1,k)))*vol(divset(MD1,k)) by INTEGRA1:def 7;
               k <= j-((n1+1)-1) by A452,A456;
then A459:      k+((n1+1)-1) <= j by XREAL_1:21;
           consider k2 being Element of NAT such that
A460:       n1+1=1+k2;
A461:      k2=(n1+1)-1 by A460;
A462:      1 <= k+k2 by A456,NAT_1:12;
               k+k2 <= len D1 by A224,A459,A460,XXREAL_0:2;
then A463:      k+k2 in Seg len D1 by A462,FINSEQ_1:3;
A464:      mid(UVf(D1),n1+1,j).k
           =UVf(D1).(k+(n1+1)-1) by A221,A225,A452,A454,A456,JORDAN3:31
           .=(sup rng(f|divset(D1,k+k2)))*vol(divset(D1,k+k2))
           by A460,A463,INTEGRA1:def 7;
A465:      divset(D1,k+k2)=divset(MD1,k)
           proof
              1+1 <= k+k2 by A224,A456,A460,XREAL_1:9;
then A466:       1 < k+k2 by NAT_1:13;
A467:       divset(MD1,k)=[.inf divset(MD1,k),sup divset(MD1,k).]
            by INTEGRA1:5;
A468:       k in dom MD1 by A457,FINSEQ_1:def 3;
              A469: k+k2 in dom D1 by A463,FINSEQ_1:def 3;
                inf divset(D1,k+k2)=inf divset(MD1,k)
            & sup divset(D1,k+k2)=sup divset(MD1,k)
            proof
             per cases;
              suppose A470:k=1;
              then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k
              by A468,INTEGRA1:def 5;
              then inf divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
              by A221,A224,A225,A302,A452,A456,JORDAN3:31;
              hence thesis by A461,A466,A469,A470,INTEGRA1:def 5;
              end;
              suppose A471:k<>1;
then A472:         k-1 in dom MD1 & k-1 in NAT by A468,INTEGRA1:9;
then A473:         1 <= k-1 by Lm1;
                  k-1 <= k by XREAL_1:148;
then A474:         k-1 <= j-(n1+1)+1 by A452,A456,XXREAL_0:2;
                  inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
              by A468,A471,INTEGRA1:def 5;
              then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
              & sup divset(MD1,k)=D1.(k+(n1+1)-1)
              by A221,A224,A225,A302,A452,A456,A472,A473,A474,JORDAN3:31;
              hence thesis by A460,A466,A469,INTEGRA1:def 5;
            end;
            end;
            hence thesis by A467,INTEGRA1:5;
           end;
            k in dom MD1 by A457,FINSEQ_1:def 3;
           then divset(D1,k+k2) c= B by A465,INTEGRA1:10;
           hence thesis by A458,A464,A465,FUNCT_1:82;
          end;
          hence thesis by A455,FINSEQ_1:18;
         end;
         hence thesis;
        end;
        hence thesis by A388,A405,A425,XXREAL_0:2;
       end;
       end;
A475:  PUf(D2,indx(D2,D1,j))=
        PUf(D2,indx(D2,D1,n1))+Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
        proof
A476:    indx(D2,D1,n1)<indx(D2,D1,j) by A229,A232,XXREAL_0:2;
             indx(D2,D1,j) in Seg len D2 by A228,FINSEQ_1:def 3;
then A477:    indx(D2,D1,j) in Seg len UVf(D2) by INTEGRA1:def 7;
A478:    indx(D2,D1,j) <= len UVf(D2) by A231,INTEGRA1:def 7;
             indx(D2,D1,n1) in Seg len D2 by A207,FINSEQ_1:def 3;
         then indx(D2,D1,n1) in Seg len UVf(D2) by INTEGRA1:def 7;
         then PUf(D2,indx(D2,D1,n1))=Sum(UVf(D2)|indx(D2,D1,n1)) by
INTEGRA1:def 22
         .=Sum mid(UVf(D2),1,indx(D2,D1,n1)) by A208,JORDAN3:25;
         then PUf(D2,indx(D2,D1,n1))+Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,
D1,j))
         =Sum(mid(UVf(D2),1,indx(D2,D1,n1))^
            mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))) by RVSUM_1:105
         .=Sum mid(UVf(D2),1,indx(D2,D1,j)) by A208,A476,A478,INTEGRA2:4
         .=Sum(UVf(D2)|indx(D2,D1,j)) by A231,JORDAN3:25;
         hence thesis by A477,INTEGRA1:def 22;
        end;
A479:    j <= len UVf(D1) by A224,INTEGRA1:def 7;
then A480:    j in Seg len UVf(D1) by A224,FINSEQ_1:3;
             n1 in Seg len D1 by A206,FINSEQ_1:def 3;
         then n1 in Seg len UVf(D1) by INTEGRA1:def 7;
         then PUf(D1,n1)=Sum(UVf(D1)|n1) by INTEGRA1:def 22
         .=Sum mid(UVf(D1),1,n1) by A224,JORDAN3:25;
         then PUf(D1,n1)+Sum mid(UVf(D1),n1+1,j)
          =Sum(mid(UVf(D1),1,n1)^mid(UVf(D1),n1+1,j)) by RVSUM_1:105
         .=Sum mid(UVf(D1),1,j) by A209,A224,A479,INTEGRA2:4
         .=Sum(UVf(D1)|j) by A224,JORDAN3:25;
then A481:    PUf(D1,j)=PUf(D1,n1)+Sum mid(UVf(D1),n1+1,j) by A480,
INTEGRA1:def 22;
A482:    (PUf(D1,n1)-PUf(D2,indx(D2,D1,n1)))+
   (Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)))
        <=i*(sup rng f-inf rng f)*delta(D1)+(sup rng f-inf rng f)*delta(D1)
        by A206,A234,XREAL_1:9;
            (PUf(D1,n1)-PUf(D2,indx(D2,D1,n1)))+
   (Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)))
         =PUf(D1,j)-PUf(D2,indx(D2,D1,j)) by A475,A481;
        hence thesis by A202,A482;
       end;
       hence thesis;
      end;
A483: for k being non empty Element of NAT holds P[k]
 from BINARITH:sch 1(A43,A198);
       i in Seg len D by A22,FINSEQ_1:def 3;
      then reconsider i as non empty Element of NAT by FINSEQ_1:3;
       P[i] by A483;
      hence thesis by A22;
     end;
      len D in dom D by FINSEQ_5:6;
     then consider j such that
A484:  j in dom D1 & D.(len D) in divset(D1,j) &
       PUf(D1,j)-PUf(D2,indx(D2,D1,j))
     <= (len D)*(sup(rng f)-inf(rng f))*delta(D1) by A21;
A485:len D1 in dom D1 by FINSEQ_5:6;
A486:j = len D1
     proof
      assume A487:j<>len D1;
      A488: D.(len D) <= sup divset(D1,j) by A484,INTEGRA2:1;
          j in Seg len D1 by A484,FINSEQ_1:def 3;
      then j <= len D1 by FINSEQ_1:3;
      then j < len D1 by A487,REAL_1:def 5;
      then D1.j < D1.(len D1) by A484,A485,GOBOARD1:def 1;
then A489: D1.j < sup A by INTEGRA1:def 2;
       sup divset(D1,j) < sup A
      proof
       per cases;
       suppose j=1;
       hence thesis by A484,A489,INTEGRA1:def 5;
       end;
       suppose j<>1;
       hence thesis by A484,A489,INTEGRA1:def 5;
      end;
      end;
      hence contradiction by A488,INTEGRA1:def 2;
     end;
A490: len D2 in dom D2 by FINSEQ_5:6;
    indx(D2,D1,len D1)=len D2
     proof
A491: indx(D2,D1,len D1) in dom D2 &
      D1.(len D1) = D2.indx(D2,D1,len D1) by A20,A485,INTEGRA1:def 21;
      then sup A = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
      then D2.(len D2) = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
      hence thesis by A490,A491,GOBOARD2:19;
     end;
     then upper_sum(f,D1)-PUf(D2,len D2)<=(len D)*(sup(rng f)-inf(rng f))*
delta(D1)
     by A484,A486,INTEGRA1:44;
     hence thesis by INTEGRA1:44;
    end;
    hence thesis by A20;
   end;
   hence thesis;
  end;
A492:for e be real number st e>0 ex n st for m st n<=m holds
   abs((upper_sum(f,T)).m-upper_integral(f))<e
   proof
     let e be real number;
     assume A493:e>0;
then A494: e/2>0 by REAL_2:127;
     reconsider e as Real by XREAL_0:def 1;
A495: upper_integral(f) = inf rng upper_sum_set(f) by INTEGRA1:def 15;
A496: rng upper_sum_set(f) is bounded_below by A1,INTEGRA2:35;
         dom upper_sum_set(f) is non empty by INTEGRA1:def 11;
     then rng upper_sum_set(f) is non empty by RELAT_1:65;
     then consider y be real number such that
A497: y in rng upper_sum_set(f) & upper_integral(f)+e/2>y
      by A494,A495,A496,SEQ_4:def 5;
         ex D being Element of divs A st D in dom upper_sum_set(f) &
     y=(upper_sum_set(f)).D & D.1 > inf A
     proof
      consider D3 being Element of divs A such that
A498:   D3 in dom upper_sum_set(f) & y=(upper_sum_set(f)).D3 by A497,
PARTFUN1:26;
       len D3 <> 0 by FINSEQ_1:25;
then A499: len D3 in Seg len D3 by FINSEQ_1:5;
      then 1 <= len D3 by FINSEQ_1:3;
then A500: 1 in Seg len D3 by FINSEQ_1:3;
then A501: 1 in dom D3 by FINSEQ_1:def 3;
      per cases;
       suppose A502:D3.1 <> inf A;
        D3.1 in A by A501,INTEGRA1:8;
       then inf A <= D3.1 by INTEGRA2:1;
       then D3.1 > inf A by A502,REAL_1:def 5;
       hence ex D being Element of divs A st D in dom upper_sum_set(f) &
       y=(upper_sum_set(f)).D & D.1 > inf A by A498;
       end;
       suppose A503:D3.1 = inf A;
        ex D being Element of divs A st D in dom upper_sum_set(f) &
       y=(upper_sum_set(f)).D & D.1 > inf A
       proof
A504:   D3.(len D3) = sup A by INTEGRA1:def 2;
A505:   len D3 in dom D3 by A499,FINSEQ_1:def 3;
            vol(A) >= 0 by INTEGRA1:11;
        then sup A - inf A > 0 by A3,INTEGRA1:def 6;
        then A506: sup A > inf A by REAL_2:106;
then A507:   len D3 > 1 by A501,A503,A504,A505,GOBOARD2:18;
        then reconsider D=D3/^1 as increasing FinSequence of REAL
         by INTEGRA1:36;
A508:   len D = len D3 - 1 &
 for m be Element of NAT st m in dom D holds D.m = D3.(m+1)
        by A507,RFINSEQ:def 2;
then A509:   len D <> 0 by A503,A506,INTEGRA1:def 2;
        then reconsider D as non empty increasing FinSequence of REAL
        by FINSEQ_1:25;
         rng D c= rng D3 & rng D3 c= A by FINSEQ_5:36,INTEGRA1:def 2;
then A510:   rng D c= A by XBOOLE_1:1;
A511:   len D+1=len D3 by A508;
A512:   len D in Seg len D by A509,FINSEQ_1:5;
         len D in dom D by FINSEQ_5:6;
        then D.(len D)=sup A by A504,A507,A511,RFINSEQ:def 2;
        then D is DivisionPoint of A by A510,INTEGRA1:def 2;
        then reconsider D as Element of divs A by INTEGRA1:def 4;
         D in divs A;
then A513:   D in dom upper_sum_set(f) by INTEGRA1:def 11;
A514:   y=(upper_sum_set(f)).D
        proof
A515:    y=upper_sum(f,D3) by A498,INTEGRA1:def 11
         .=Sum(upper_volume(f,D3)) by INTEGRA1:def 9
         .=Sum((upper_volume(f,D3)|1)^(upper_volume(f,D3)/^1)) by RFINSEQ:21;
A516:    1 <= len upper_volume(f,D3) by A507,INTEGRA1:def 7;
then A517:    len (upper_volume(f,D3)|1)=1 by FINSEQ_1:80;
A518:    1 in dom upper_volume(f,D3) by A516,FINSEQ_3:27;
             1 in Seg 1 by FINSEQ_1:3;
         then (upper_volume(f,D3)|1).1 = upper_volume(f,D3).1 by A518,
RFINSEQ:19;
         then A519:    upper_volume(f,D3)|1 = <*upper_volume(f,D3).1*> by A517,
FINSEQ_1:57;
A520:    vol(divset(D3,1))=sup divset(D3,1)-inf divset(D3,1) by INTEGRA1:def 6
          .=sup divset(D3,1) - inf A by A501,INTEGRA1:def 5
          .=D3.1 - inf A by A501,INTEGRA1:def 5
          .=0 by A503;
         A521: upper_volume(f,D3).1=(sup rng(f|divset(D3,1)))*vol(divset(D3,1))
           by A500,INTEGRA1:def 7;
          upper_volume(f,D3)/^1 = upper_volume(f,D)
         proof
A522:      2-'1=2-1 by BINARITH:50 .= 1;
A523:      len D3 >= 1+1 by A507,NAT_1:13;
          then len upper_volume(f,D3) >= 2 by INTEGRA1:def 7;
then A524:      mid(upper_volume(f,D3),2,len upper_volume(f,D3))
           =upper_volume(f,D3)/^1 by A522,JORDAN3:26;
A525:      2 <= len upper_volume(f,D3) & 1 <= len upper_volume(f,D3)
          by A507,A523,INTEGRA1:def 7;
          then A526: len(mid(upper_volume(f,D3),2,len upper_volume(f,D3)))
           =len upper_volume(f,D3)-'2+1 by JORDAN3:27
           .=len D3-'2+1 by INTEGRA1:def 7
           .=len D3-2+1 by A523,BINARITH:50
           .=len D3-1;
then A527:      len(mid(upper_volume(f,D3),2,len upper_volume(f,D3)))
          =len upper_volume(f,D) by A508,INTEGRA1:def 7;
              for i st 1<=i&i<=len mid(upper_volume(f,D3),2,len upper_volume(f,
D3))
          holds mid(upper_volume(f,D3),2,len upper_volume(f,D3)).i
          =upper_volume(f,D).i
          proof
           let i; assume
A528:      1<=i&i<=len mid(upper_volume(f,D3),2,len upper_volume(f,D3));
           then i <= len upper_volume(f,D3) - 1
           by A526,INTEGRA1:def 7;
           then i <= len upper_volume(f,D3)-2+1;
then A529:      mid(upper_volume(f,D3),2,len upper_volume(f,D3)).i
           =upper_volume(f,D3).(i+2-1) by A525,A528,JORDAN3:31
           .=upper_volume(f,D3).(i+1);
               1 <= i+1 & i+1 <= len D3 by A526,A528,NAT_1:12,XREAL_1:21;
then A530:      i+1 in Seg len D3 by FINSEQ_1:3;
then A531:      mid(upper_volume(f,D3),2,len upper_volume(f,D3)).i
           =(sup rng(f|divset(D3,i+1)))*vol(divset(D3,i+1))
           by A529,INTEGRA1:def 7;
           A532: divset(D3,i+1)=divset(D,i)
           proof
A533:       1<>i+1 by A528,NAT_1:13;
                i+1 in dom D3 by A530,FINSEQ_1:def 3;
            then A534: sup divset(D3,i+1)=D3.(i+1) & inf divset(D3,i+1)=D3.(i+1
-1)
            by A533,INTEGRA1:def 5;
A535:       i in dom D by A508,A526,A528,FINSEQ_3:27;
then A536:       D.i=D3.(i+1) by A507,RFINSEQ:def 2;
            per cases;
             suppose A537:i=1;
then A538:        inf divset(D,i)=inf A & sup divset(D,i)=D.i
             by A535,INTEGRA1:def 5;
              divset(D3,i+1)=[.inf A, D.i.] by A503,A534,A536,A537,INTEGRA1:5;
             hence divset(D3,i+1)=divset(D,i) by A538,INTEGRA1:5;
             end;
             suppose A539:i<>1;
then A540:        inf divset(D,i)=D.(i-1) & sup divset(D,i)=D.i
             by A535,INTEGRA1:def 5;
                 i-1 in dom D & i-1 in NAT by A535,A539,INTEGRA1:9;
                then i-1 in dom D & i-1 is Nat by ORDINAL1:def 13;
then D.(i-1)=D3.(i-1+1) by A507,RFINSEQ:def 2 .=D3.i;
             then divset(D3,i+1)=[.inf divset(D,i),sup divset(D,i).]
             by A534,A536,A540,INTEGRA1:5;
             hence thesis by INTEGRA1:5;
            end;
           end;
            i in Seg len D by A508,A526,A528,FINSEQ_1:3;
           hence thesis by A531,A532,INTEGRA1:def 7;
          end;
          hence thesis by A524,A527,FINSEQ_1:18;
         end;
         then y=0+Sum(upper_volume(f,D)) by A515,A519,A520,A521,RVSUM_1:106
         .=upper_sum(f,D) by INTEGRA1:def 9;
         hence thesis by A513,INTEGRA1:def 11;
        end;
         1 <= len D by A512,FINSEQ_1:3;
        then 1 in dom D by FINSEQ_3:27;
then A541:   D.1=D3.(1+1) by A507,RFINSEQ:def 2 .=D3.2;
         1+1 <= len D3 by A507,NAT_1:13;
        then 2 in dom D3 by FINSEQ_3:27;
        then D3.1 < D3.2 by A501,GOBOARD1:def 1;
        hence thesis by A503,A513,A514,A541;
       end;
       hence thesis;
      end;
     end;
     then consider D being Element of divs A such that
A542: D in dom upper_sum_set(f) & y=(upper_sum_set(f)).D & D.1>inf A;
       A543: y=upper_sum(f,D) by A542,INTEGRA1:def 11;
     set p=len D, H=sup rng f, h=inf rng f;
     deffunc F(Element of NAT)=vol(divset(D,$1));
     consider v being FinSequence of REAL such that
A544: len v = len D & for j st j in Seg len D holds v.j=F(j)
     from FINSEQ_2:sch 1;
     consider v1 being non-decreasing FinSequence of REAL such that
A545: v,v1 are_fiberwise_equipotent by INTEGRA2:3;
defpred P[Element of NAT] means $1 in dom v1 & v1.$1 > 0;
A546: ex k st P[k]
     proof
       consider H being Function such that
A547:   dom H = dom v & rng H = dom v1 & H is one-to-one & v=v1*H
        by A545,RFINSEQ:3;
       consider k such that
A548:  k in dom D & vol(divset(D,k)) > 0 by A3,Th1;
           dom D = Seg len D by FINSEQ_1:def 3;
       then k in dom v & v.k > 0 by A544,A548,FINSEQ_1:def 3;
       then H.k in dom v1 & v1.(H.k) > 0 by A547,FUNCT_1:21,22;
       hence thesis;
     end;
     consider k such that
A549: P[k] & for n st P[n] holds k<=n
      from NAT_1:sch 5(A546);
         p <> 0 by FINSEQ_1:25;
then p > 0;
then A550: 2*p >0 by REAL_2:122;
      H >= h by A1,Lm4;
     then H-h >= 0 by XREAL_1:50;
     then H-h+1 > 0+0 by XREAL_1:10;
then A551: 2*p*(H-h+1) > 0 by A550,REAL_2:122;
      min(v1.k,e/(2*p*(H-h+1))) > 0
     proof
       per cases by XXREAL_0:15;
       suppose min(v1.k,e/(2*p*(H-h+1))) = v1.k;
       hence thesis by A549;
       end;
       suppose min(v1.k,e/(2*p*(H-h+1))) = e/(2*p*(H-h+1));
       hence thesis by A493,A551,REAL_2:127;
     end;
     end;
     then consider n such that
A552: for m st n<=m holds 0 < (delta(T)).m
     & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A5;
A553: for m st n<=m holds abs((upper_sum(f,T)).m-upper_integral(f))<e
     proof
       let m; assume A554:n<=m;
then A555:  0 < (delta(T)).m & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A552
;
       reconsider D1 = T.m as Element of divs A;
       consider D2 being Element of divs A such that
A556:   D <= D2 & D1 <= D2 & rng D2 = rng D1 \/ rng D &
       0 <= upper_sum(f,D)-upper_sum(f,D2) &
       0 <= upper_sum(f,D1)-upper_sum(f,D2) by A13;
           f is_bounded_above_on A by A1,RFUNCT_1:def 11;
       then A557: upper_sum(f,D2) <= upper_sum(f,D) by A556,INTEGRA1:47;
A558:  delta(D1)=(delta(T)).m by INTEGRA2:def 3;
           min (v1.k,e/(2*p*(H-h+1))) <= v1.k by XXREAL_0:17;
then A559:   delta(D1)<v1.k by A555,A558,XXREAL_0:2;
A560:  v1.1 > 0
       proof
A561:   for n1 be Element of NAT st n1 in dom D holds vol(divset(D,n1))>0
        proof
         let n1 be Element of NAT;
         assume A562:n1 in dom D;
         then A563: 1 <= n1 by FINSEQ_3:27;
         per cases by A563,REAL_1:def 5;
          suppose A564:n1=1;
          then inf divset(D,n1)=inf A & sup divset(D,n1)=D.n1
          by A562,INTEGRA1:def 5;
          then vol(divset(D,n1))=D.n1-inf A by INTEGRA1:def 6;
          hence thesis by A542,A564,XREAL_1:52;
          end;
          suppose A565:n1>1;
          then inf divset(D,n1)=D.(n1-1) & sup divset(D,n1)=D.n1
          by A562,INTEGRA1:def 5;
then A566:     vol(divset(D,n1))=D.n1-D.(n1-1) by INTEGRA1:def 6;
A567:     n1-1 in dom D by A562,A565,INTEGRA1:9;
              n1 < n1+1 by XREAL_1:31;
          then n1-1 < n1 by XREAL_1:21;
          then D.(n1-1)<D.n1 by A562,A567,GOBOARD1:def 1;
          hence thesis by A566,XREAL_1:52;
        end;
        end;
         1 <= k & k <= len v1 by A549,FINSEQ_3:27;
        then 1 <= len v1 by XXREAL_0:2;
        then 1 in dom v1 by FINSEQ_3:27;
then A568:   v1.1 in rng v1 by FUNCT_1:def 5;
            rng v = rng v1 by A545,RFINSEQ:1;
        then consider n1 being Element of NAT such that
A569:   n1 in dom v & v1.1 = v.n1 by A568,PARTFUN1:26;
A570:   n1 in Seg len D by A544,A569,FINSEQ_1:def 3;
then A571:   v1.1 = vol(divset(D,n1)) by A544,A569;
            n1 in dom D by A570,FINSEQ_1:def 3;
        hence thesis by A561,A571;
       end;
           v1.k = min rng upper_volume(chi(A,A),D)
       proof
A572:    k=1
        proof
         assume A573:k <> 1;
A574:    len v1 = len v by A545,RFINSEQ:16;
A575:    k in Seg len v1 by A549,FINSEQ_1:def 3;
          k in Seg len v by A549,A574,FINSEQ_1:def 3;
then A576:    1 <= k & k <= len D by A544,FINSEQ_1:3;
then A577:    k > 1 by A573,REAL_1:def 5;
             k <= len v1 by A575,FINSEQ_1:3;
         then 1 <= len v1 by A576,XXREAL_0:2;
         then 1 in dom v1 by FINSEQ_3:27;
         hence contradiction by A549,A560,A577;
        end;
      min rng upper_volume(chi(A,A),D) in rng upper_volume(chi(A,A),D)
        & for x st x in rng upper_volume(chi(A,A),D)
        holds min rng upper_volume(chi(A,A),D) <= x by PRE_CIRC:def 4;
        then consider m such that
A578:   m in dom upper_volume(chi(A,A),D)
        & min rng upper_volume(chi(A,A),D)=upper_volume(chi(A,A),D).m
        by PARTFUN1:26;
            m in Seg len upper_volume(chi(A,A),D) by A578,FINSEQ_1:def 3;
then A579:   m in Seg len D by INTEGRA1:def 7;
        then min rng upper_volume(chi(A,A),D)=vol(divset(D,m))
        by A578,INTEGRA1:22;
then A580:   v.m=min rng upper_volume(chi(A,A),D) by A544,A579;
         m in dom v by A544,A579,FINSEQ_1:def 3;
then A581:   min rng upper_volume(chi(A,A),D) in rng v by A580,FUNCT_1:def 5;
A582:   rng v = rng v1 by A545,RFINSEQ:1;
        then consider m1 being Element of NAT such that
A583:   m1 in dom v1 & min rng upper_volume(chi(A,A),D)=v1.m1
        by A581,PARTFUN1:26;
         m1 >= 1 by A583,FINSEQ_3:27;
then A584:   v1.1 <= min rng upper_volume(chi(A,A),D) by A549,A572,A583,
INTEGRA2:2;
         v1.k in rng upper_volume(chi(A,A),D)
        proof
          v1.k in rng v by A549,A582,FUNCT_1:def 5;
         then consider k2 being Element of NAT such that
A585:     k2 in dom v & v1.k = v.k2 by PARTFUN1:26;
A586:     k2 in Seg len D by A544,A585,FINSEQ_1:def 3;
         then v1.k = vol(divset(D,k2)) by A544,A585;
then A587:     v1.k = upper_volume(chi(A,A),D).k2 by A586,INTEGRA1:22;
          k2 in Seg len upper_volume(chi(A,A),D) by A586,INTEGRA1:def 7;
         then k2 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
         hence thesis by A587,FUNCT_1:def 5;
        end;
        then v1.k >= min rng upper_volume(chi(A,A),D) by PRE_CIRC:def 4;
        hence thesis by A572,A584,XXREAL_0:1;
       end;
       then consider D3 being Element of divs A such that
A588:  D<=D3 & D1<=D3 & rng D3=rng D1 \/
         rng D & upper_sum(f,D1)-upper_sum(f,D3)
       <=(len D)*(sup rng f-inf rng f)*delta(D1) by A18,A559;
A589:  upper_sum(f,D1)-upper_sum(f,D2)<=(len D)*(sup rng f-inf rng f)*delta(D1)
       by A556,A588,Th5;
           H-h <= H-h+1 by XREAL_1:31;
       then p*(H-h)<=p*(H-h+1) by XREAL_1:66;
then p*(H-h)*(delta(T)).m <= p*(H-h+1)*(delta(T)).m by A555,XREAL_1:66;
then A590:  upper_sum(f,T.m)-upper_sum(f,D2) <= p*(H-h+1)*(delta(T)).m
       by A558,A589,XXREAL_0:2;
A591:  (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A552,A554;
        min(v1.k,e/(2*p*(H-h+1))) <= e/(2*p*(H-h+1)) by XXREAL_0:17;
       then (delta(T)).m < e/(2*p*(H-h+1)) by A591,XXREAL_0:2;
       then (delta(T)).m*(2*p*(H-h+1))<e by A551,REAL_2:177;
       then ((delta(T)).m*(p*(H-h+1)))*2<e;
then A592:  p*(H-h+1)*(delta(T)).m < e/2 by REAL_2:178;
       set s=upper_integral(f), sD=upper_sum(f,D);
       set sD1=upper_sum(f,T.m), sD2=upper_sum(f,D2);
        sD+sD1-sD1-s < e/2 by A497,A543,XREAL_1:21;
       then sD1-s+sD-sD1 < e/2;
       then sD1-s+sD < sD1+e/2 by XREAL_1:21;
       then A593: sD1-s < sD1+e/2-sD by XREAL_1:22;
        sD1-sD <= sD1-sD2 by A557,REAL_2:106;
       then sD1-sD <= p*(H-h+1)*(delta(T)).m by A590,XXREAL_0:2;
       then sD1-sD < e/2 by A592,XXREAL_0:2;
       then sD1-sD+e/2 < e/2+e/2 by XREAL_1:8;
       then sD1-s < e by A593,XXREAL_0:2;
then A594:  (upper_sum(f,T)).m-upper_integral(f) < e by INTEGRA2:def 4;
           T.m in divs A;
then A595:  T.m in dom upper_sum_set(f) by INTEGRA1:def 11;
           (upper_sum(f,T)).m = upper_sum(f,T.m) by INTEGRA2:def 4;
       then (upper_sum(f,T)).m = (upper_sum_set(f)).(T.m) by A595,
INTEGRA1:def 11;
       then (upper_sum(f,T)).m in rng upper_sum_set(f) by A595,FUNCT_1:def 5;
       then inf rng upper_sum_set(f)<=(upper_sum(f,T)).m by A496,SEQ_4:def 5;
       then upper_integral(f)<=(upper_sum(f,T)).m by INTEGRA1:def 15;
       then (upper_sum(f,T)).m-upper_integral(f) >= 0 by XREAL_1:50;
       hence thesis by A594,ABSVALUE:def 1;
     end;
     take n;
     thus thesis by A553;
   end;
   hence upper_sum(f,T) is convergent by SEQ_2:def 6;
   hence thesis by A492,SEQ_2:def 7;
end;

