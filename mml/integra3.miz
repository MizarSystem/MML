:: Darboux's Theorem
::  by Noboru Endou , Katsumi Wasaki and Yasunari Shidama
::
:: Received December 7, 1999
:: Copyright (c) 1999 Association of Mizar Users

environ

 vocabularies FINSEQ_1, ARYTM_1, INTEGRA1, MEASURE5, RELAT_1, ORDINAL2, BOOLE,
      FUNCT_1, CARD_1, FUNCT_3, SQUARE_1, ABSVALUE, RFUNCT_1, RLVECT_1, SEQ_2,
      LATTICES, JORDAN3, RCOMP_1, PARTFUN1, RFINSEQ, INTEGRA2, FDIFF_1, SEQ_1,
      ARYTM_3, PROB_1, FINSEQ_4, ARYTM;
 notations TARSKI, XBOOLE_0, SUBSET_1, ORDINAL1, CARD_1, NUMBERS, XXREAL_0,
      XREAL_0, COMPLEX1, REAL_1, NAT_1, RELAT_1, FUNCT_1, FUNCT_2,
      XXREAL_2, SEQ_4,
      PARTFUN1, PSCOMP_1, FINSEQ_1, RFUNCT_1, RVSUM_1, INTEGRA1, SEQ_1, SEQ_2,
      JORDAN3, PRE_CIRC, RCOMP_1, FDIFF_1, GOBOARD1, SQUARE_1, RFINSEQ,
      BINARITH, INTEGRA2;
 constructors PARTFUN1, REAL_1, SQUARE_1, NAT_1, COMPLEX1, FINSOP_1, RFUNCT_1,
      FDIFF_1, RFINSEQ, BINARITH, PRE_CIRC, PSCOMP_1, JORDAN3, INTEGRA2, SEQ_1,
      BINOP_2, XXREAL_2;
 registrations XBOOLE_0, RELAT_1, ORDINAL1, NUMBERS, XXREAL_0, XREAL_0, NAT_1,
      MEMBERED, FINSEQ_1, GOBOARD1, INTEGRA1, INTEGRA2, VALUED_0, FUNCT_2,
      FINSET_1, XXREAL_2;
 requirements REAL, NUMERALS, BOOLE, SUBSET, ARITHM;
 definitions TARSKI, RVSUM_1;
 theorems REAL_1, SEQ_4, SUBSET_1, REAL_2, PARTFUN1, INTEGRA1, RFUNCT_1,
      FUNCT_1, FINSEQ_1, RVSUM_1, SEQ_1, SEQ_2, FDIFF_1, ABSVALUE, PRE_CIRC,
      NAT_1, GOBOARD2, RFINSEQ, TARSKI, GOBOARD1, CARD_1, FINSEQ_5, FINSEQ_3,
      FINSEQ_4, JORDAN7, JORDAN3, BINARITH, INTEGRA2, RELAT_1, XREAL_0,
      FUNCT_2, XBOOLE_0, XBOOLE_1, RCOMP_1, XREAL_1, COMPLEX1, XXREAL_0,
      FINSOP_1, ORDINAL1, CARD_2, XXREAL_2;
 schemes FINSEQ_2, NAT_1;

begin :: Lemmas of Division

reserve a,b,e,x,y for Real,
  i,j,k,n,m for Element of NAT,
  x1 for set,
  p,q for FinSequence of REAL;

Lm1: a in dom p implies 1<=a & a<=len p by FINSEQ_3:27;

Lm2: j-'j+1 = 1
proof
  j-'j=j-j by BINARITH:50
    .= 0;
  hence thesis;
end;

Lm3: for n st 1 <= n & n <= 2 holds n = 1 or n = 2
proof
  let n;
  assume
A1: 1<=n & n<=2;
  per cases by A1,REAL_1:def 5;
  suppose n=1;
    hence thesis;
  end;
  suppose n>1;
    then n >= 1+1 by NAT_1:13;
    hence thesis by A1,XXREAL_0:1;
  end;
end;

theorem Th1:
  for A be closed-interval Subset of REAL, D be Element of divs A
  st vol(A) <> 0 holds ex i st i in dom D & vol(divset(D,i)) > 0
proof
  let A be closed-interval Subset of REAL;
  let D be Element of divs A;
  assume
A1: vol(A) <>0;
  assume
A2: for i st i in dom D holds vol(divset(D,i))<=0;
A3: i in dom D implies vol(divset(D,i))=0
  proof
    assume i in dom D;
    then vol(divset(D,i)) <= 0 by A2;
    hence thesis by INTEGRA1:11;
  end;
A4: i in dom D implies sup divset(D,i)=inf divset(D,i)
  proof
    assume i in dom D;
    then vol(divset(D,i))=0 by A3;
    then sup divset(D,i)-inf divset(D,i)=0 by INTEGRA1:def 6;
    hence thesis;
  end;
A5: len D in dom D by FINSEQ_5:6;
  len D = 1
  proof
    assume
A6: len D <> 1;
    then
A7: inf divset(D,len D)=D.(len D-1) & sup divset(D,len D)=D.(len D)
    by A5,INTEGRA1:def 5;
A8: len D-1 in dom D & len D-1 in NAT by A5,A6,INTEGRA1:9;
    len D < len D+1 by NAT_1:13;
    then len D-1 < len D by XREAL_1:21;
    then inf divset(D,len D)<sup divset(D,len D) by A5,A7,A8,GOBOARD1:def 1;
    hence contradiction by A4,A5;
  end;
  then inf divset(D,len D)=inf A & sup divset(D,len D)=D.(len D)
  by A5,INTEGRA1:def 5;
  then inf divset(D,len D)=inf A & sup divset(D,len D)=sup A
  by INTEGRA1:def 2;
  then sup A = inf A+0 by A4,A5;
  then sup A- inf A = 0;
  hence contradiction by A1,INTEGRA1:def 6;
end;

theorem Th2:
  for A be closed-interval Subset of REAL,
  D be Element of divs A st x in A holds ex j st j in dom D & x in divset(D,j)
proof
  let A be closed-interval Subset of REAL;
  let D be Element of divs A;
  assume x in A;
  then
A1: inf A <= x & x <= sup A by INTEGRA2:1;
A2: rng D <> {};
  then
A3: 1 in dom D by FINSEQ_3:34;
  per cases;
  suppose x in rng D;
    then consider j such that
A4: j in dom D & D.j = x by PARTFUN1:26;
    x in divset(D,j)
    proof
      per cases;
      suppose j=1;
        then
A5:     inf divset(D,j)=inf A & sup divset(D,j)=D.j by A4,INTEGRA1 :def 5;
        consider a,b such that
A6:     a <= b & a=inf divset(D,j) & b=sup divset(D,j) by INTEGRA1:4;
        thus thesis by A4,A5,A6,INTEGRA2:1;
      end;
      suppose j<>1;
        then
A7:     sup divset(D,j)=D.j by A4,INTEGRA1:def 5;
        consider a,b such that
A8:     a <= b & a=inf divset(D,j) & b=sup divset(D,j) by INTEGRA1:4;
        thus thesis by A4,A7,A8,INTEGRA2:1;
      end;
    end;
    hence thesis by A4;
  end;
  suppose
A9: not x in rng D;
    defpred MIN[Nat] means x < sup divset(D,$1) & $1 in dom D;
    defpred MAX[Nat] means x >= inf divset(D,$1) & $1 in dom D;
A10: len D in dom D by FINSEQ_5:6;
    sup divset(D,len D)=D.(len D)
    proof
      per cases;
      suppose len D=1;
        hence thesis by A10,INTEGRA1:def 5;
      end;
      suppose len D<>1;
        hence thesis by A10,INTEGRA1:def 5;
      end;
    end;
    then
A11: sup divset(D,len D) = sup A by INTEGRA1:def 2;
    x < sup divset(D,len D)
    proof
      x <> sup A
      proof
        assume x = sup A;
        then x = D.(len D) by INTEGRA1:def 2;
        hence contradiction by A9,A10,FUNCT_1:def 5;
      end;
      hence thesis by A1,A11,REAL_1:def 5;
    end;
    then
A12: ex k be Nat st MIN[k] by A10;
    consider k be Nat such that
A13: MIN[k] & for n be Nat st MIN[n] holds k <= n from NAT_1:sch 5(A12);
    inf divset(D,1)=inf A by A3,INTEGRA1:def 5;
    then
A14: ex k be Nat st MAX[k] by A1,A2,FINSEQ_3:34;
A15: for k be Nat holds MAX[k] implies k <= len D by FINSEQ_3:27;
    consider j be Nat such that
A16: MAX[j] & for n be Nat st MAX[n] holds n <= j from NAT_1:sch 6(A15,A14);
    k=j
    proof
      assume
A17:  k<>j;
      per cases by A17,XXREAL_0:1;
      suppose
A18:    k < j;
A19:    1 <= k & k <= len D by A13,FINSEQ_3:27;
        then
A20:    j-1 in dom D & j-1 in NAT by A16,A18,INTEGRA1:9;
A21:    sup divset(D,k)=D.k
        proof
          per cases;
          suppose k=1;
            hence thesis by A13,INTEGRA1:def 5;
          end;
          suppose k<>1;
            hence thesis by A13,INTEGRA1:def 5;
          end;
        end;
        D.(j-1) <= x by A16,A18,A19,INTEGRA1:def 5;
        then D.(j-1) < D.k by A13,A21,XXREAL_0:2;
        then j-1 < k by A13,A20,GOBOARD2:18;
        then j < k+1 by XREAL_1:21;
        hence contradiction by A18,NAT_1:13;
      end;
      suppose
A22:    k > j;
        x < sup divset(D,j)
        proof
          assume
A23:      x >= sup divset(D,j);
A24:      sup divset(D,j)=D.j
          proof
            per cases;
            suppose j=1;
              hence thesis by A16,INTEGRA1:def 5;
            end;
            suppose j<>1;
              hence thesis by A16,INTEGRA1:def 5;
            end;
          end;
A25:      j+1 in dom D & j+1 > 1
          proof
A26:        1 <= j & k <= len D by A13,A16,FINSEQ_3:27;
            j < j+1 & j+1 <= k by A22,NAT_1:13;
            then 1 <= j+1 & j+1 <= len D by A26,XXREAL_0:2;
            hence j+1 in dom D by FINSEQ_3:27;
            thus thesis by A26,NAT_1:13;
          end;
          then inf divset(D,j+1) = D.(j+1-1) by INTEGRA1:def 5
            .=D.j;
          then j+1 <= j by A16,A23,A24,A25;
          hence contradiction by NAT_1:13;
        end;
        hence contradiction by A13,A16,A22;
      end;
    end;
    then x in divset(D,k) & k in dom D by A13,A16,INTEGRA2:1;
    hence thesis;
  end;
end;

theorem Th3:
  for A be closed-interval Subset of REAL, D1,D2 be Element of divs A holds
  ex D be Element of divs A st D1 <= D & D2 <= D & rng D = rng D1 \/ rng D2
proof
  let A be closed-interval Subset of REAL;
  let D1,D2 be Element of divs A;
  consider D being FinSequence of REAL such that
A1: rng D = rng(D1^D2) & len D = card rng(D1^D2) & D is increasing
  by GOBOARD2:21;
  reconsider D as increasing FinSequence of REAL by A1;
  reconsider D as non empty increasing FinSequence of REAL by A1;
A2: rng(D1^D2) = rng D1 \/ rng D2 by FINSEQ_1:44;
  rng D1 c= A & rng D2 c= A by INTEGRA1:def 2;
  then
A3: rng D c= A by A1,A2,XBOOLE_1:8;
A4: rng D1 c= rng(D1^D2) by A2,XBOOLE_1:7;
A5: rng D2 c= rng(D1^D2) by A2,XBOOLE_1:7;
  D.len D = sup A
  proof
    assume
A6: D.len D <> sup A;
A7: len D in dom D by FINSEQ_5:6;
    then D.len D in rng D by FUNCT_1:def 5;
    then D.len D <= sup A by A3,INTEGRA2:1;
    then
A8: D.len D < sup A by A6,REAL_1:def 5;
A9: D1.len D1 = sup A by INTEGRA1:def 2;
    len D1 in dom D1 by FINSEQ_5:6;
    then D1.len D1 in rng D1 by FUNCT_1:def 5;
    then consider k such that
A10: k in dom D & D1.len D1=D.k by A1,A4,PARTFUN1:26;
    k > len D by A7,A8,A9,A10,GOBOARD2:18;
    hence contradiction by A10,FINSEQ_3:27;
  end;
  then D is DivisionPoint of A by A3,INTEGRA1:def 2;
  then reconsider D as Element of divs A by INTEGRA1:def 3;
  take D;
A11: card rng D1 <= len D by A1,A2,NAT_1:44,XBOOLE_1:7;
  D1 is one-to-one by JORDAN7:17;
  then len D1 <= len D by A11,FINSEQ_4:77;
  hence D1 <= D by A1,A4,INTEGRA1:def 20;
A12: card rng D2 <= len D by A1,A2,NAT_1:44,XBOOLE_1:7;
  D2 is one-to-one by JORDAN7:17;
  then len D2 <= len D by A12,FINSEQ_4:77;
  hence D2 <= D by A1,A5,INTEGRA1:def 20;
  thus thesis by A1,FINSEQ_1:44;
end;

theorem Th4:
  for A be closed-interval Subset of REAL, D,D1 be Element of divs A
  st delta(D1)<min rng upper_volume(chi(A,A),D)
  holds (for x,y,i st i in dom D1 & x in rng D /\ divset(D1,i)
  & y in rng D /\ divset(D1,i) holds x=y)
proof
  let A be closed-interval Subset of REAL;
  let D,D1 be Element of divs A;
  assume
A1: delta(D1)<min rng upper_volume(chi(A,A),D);
  let x,y,i;
  assume
A2: i in dom D1;
  assume
A3: x in rng D /\ divset(D1,i);
  assume
A4: y in rng D /\ divset(D1,i);
  assume
A5: x<>y;
  x in rng D by A3,XBOOLE_0:def 3;
  then consider n such that
A6: n in dom D & x=D.n by PARTFUN1:26;
  y in rng D by A4,XBOOLE_0:def 3;
  then consider m such that
A7: m in dom D & y=D.m by PARTFUN1:26;
A8: abs( D.n-D.m ) >= min rng upper_volume(chi(A,A),D)
  proof
    per cases by A5,A6,A7,XXREAL_0:1;
    suppose n<m;
      then
A9:   n+1<=m by NAT_1:13;
      n in Seg len D & m in Seg len D by A6,A7,FINSEQ_1:def 3;
      then
A10:  1<=n & m<=len D by FINSEQ_1:3;
      then 1<=n+1 & n+1<=len D by A9,NAT_1:12,XXREAL_0:2;
      then
A11:  n+1 in Seg len D by FINSEQ_1:3;
      then
A12:  n+1 in dom D by FINSEQ_1:def 3;
      -abs( D.n-D.m ) <= D.n-D.m by ABSVALUE:11;
      then
A13:  abs( D.n-D.m ) >= -(D.n-D.m) by REAL_2:110;
      D.m>=D.(n+1) by A7,A9,A12,GOBOARD2:18;
      then D.n-D.m <= D.n-D.(n+1) by REAL_2:106;
      then
A14:  -(D.n-D.m) >= -(D.n-D.(n+1)) by XREAL_1:26;
A15:  D.(n+1)-D.n=(upper_volume(chi(A,A),D)).(n+1)
      proof
        n+1 <> 1 by A10,NAT_1:13;
        then inf divset(D,n+1)=D.((n+1)-1)
        & sup divset(D,n+1)=D.(n+1) by A12,INTEGRA1:def 5;
        then vol(divset(D,n+1))=D.(n+1)-D.n by INTEGRA1:def 6;
        hence thesis by A12,INTEGRA1:22;
      end;
      n+1 in Seg len upper_volume(chi(A,A),D) by A11,INTEGRA1:def 7;
      then n+1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
      then (upper_volume(chi(A,A),D)).(n+1) in rng upper_volume(chi(A,A),D)
      by FUNCT_1:def 5;
      then D.(n+1)-D.n>=min rng upper_volume(chi(A,A),D) by A15,XXREAL_2:def 7;
      then -(D.n-D.m) >= min rng upper_volume(chi(A,A),D) by A14,XXREAL_0:2;
      hence thesis by A13,XXREAL_0:2;
    end;
    suppose n>m;
      then
A16:  m+1<=n by NAT_1:13;
      n in Seg len D & m in Seg len D by A6,A7,FINSEQ_1:def 3;
      then
A17:  1<=m & n<=len D by FINSEQ_1:3;
      then
A18:  1<=m+1 & m+1<=len D by A16,NAT_1:12,XXREAL_0:2;
      then
A19:  m+1 in Seg len D by FINSEQ_1:3;
A20:  m+1 in dom D by A18,FINSEQ_3:27;
A21:  abs( D.n-D.m ) >= D.n-D.m by ABSVALUE:11;
      D.(m+1)<=D.n by A6,A16,A20,GOBOARD2:18;
      then
A22:  D.n-D.m >= D.(m+1)-D.m by XREAL_1:11;
A23:  D.(m+1)-D.m=(upper_volume(chi(A,A),D)).(m+1)
      proof
        1 < m+1 by A17,NAT_1:13;
        then inf divset(D,m+1)=D.((m+1)-1)
        & sup divset(D,m+1)=D.(m+1) by A20,INTEGRA1:def 5;
        then vol(divset(D,m+1))=D.(m+1)-D.m by INTEGRA1:def 6;
        hence thesis by A20,INTEGRA1:22;
      end;
      m+1 in Seg len upper_volume(chi(A,A),D) by A19,INTEGRA1:def 7;
      then m+1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
      then (upper_volume(chi(A,A),D)).(m+1) in rng upper_volume(chi(A,A),D)
      by FUNCT_1:def 5;
      then D.(m+1)-D.m>=min rng upper_volume(chi(A,A),D) by A23,XXREAL_2:def 7;
      then D.n-D.m >= min rng upper_volume(chi(A,A),D) by A22,XXREAL_0:2;
      hence thesis by A21,XXREAL_0:2;
    end;
  end;
  abs (D.n-D.m) <= delta D1
  proof
    per cases by A5,A6,A7,XXREAL_0:1;
    suppose n<m;
      then D.n<D.m by A6,A7,GOBOARD1:def 1;
      then D.n-D.m<0 by REAL_2:105;
      then
A24:  abs( D.n-D.m )=-(D.n-D.m) by ABSVALUE:def 1
        .= D.m-D.n;
      D.n in divset(D1,i) by A3,A6,XBOOLE_0:def 3;
      then
A25:  D.n >= inf divset(D1,i) by INTEGRA2:1;
      D.m in divset(D1,i) by A4,A7,XBOOLE_0:def 3;
      then D.m <= sup divset(D1,i) by INTEGRA2:1;
      then
A26:  D.m-inf divset(D1,i)<= sup divset(D1,i)-inf divset(D1,i) by XREAL_1:11;
      D.m-D.n <= D.m-inf divset(D1,i) by A25,REAL_2:106;
      then D.m-D.n <= sup divset(D1,i)-inf divset(D1,i) by A26,XXREAL_0:2;
      then
A27:  D.m-D.n <= vol(divset(D1,i)) by INTEGRA1:def 6;
A28:  i in Seg len D1 by A2,FINSEQ_1:def 3;
A29:  D.m-D.n <= upper_volume(chi(A,A),D1).i by A27,INTEGRA1:22,A2;
      i in Seg len upper_volume(chi(A,A),D1) by A28,INTEGRA1:def 7;
      then i in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
      then upper_volume(chi(A,A),D1).i in rng upper_volume(chi(A,A),D1)
      by FUNCT_1:def 5;
      then upper_volume(chi(A,A),D1).i <= max rng upper_volume(chi(A,A),D1)
      by XXREAL_2:def 8;
      then upper_volume(chi(A,A),D1).i<=delta(D1) by INTEGRA1:def 19;
      hence thesis by A24,A29,XXREAL_0:2;
    end;
    suppose n>m;
      then D.n>D.m by A6,A7,GOBOARD1:def 1;
      then D.n-D.m>0 by XREAL_1:52;
      then
A30:  abs( D.n-D.m )=D.n-D.m by ABSVALUE:def 1;
      D.m in divset(D1,i) by A4,A7,XBOOLE_0:def 3;
      then
A31:  D.m >= inf divset(D1,i) by INTEGRA2:1;
      D.n in divset(D1,i) by A3,A6,XBOOLE_0:def 3;
      then D.n <= sup divset(D1,i) by INTEGRA2:1;
      then
A32:  D.n-inf divset(D1,i)<= sup divset(D1,i)-inf divset(D1,i) by XREAL_1:11;
      D.n-D.m <= D.n-inf divset(D1,i) by A31,REAL_2:106;
      then D.n-D.m <= sup divset(D1,i)-inf divset(D1,i) by A32,XXREAL_0:2;
      then
A33:  D.n-D.m <= vol(divset(D1,i)) by INTEGRA1:def 6;
A34:  i in Seg len D1 by A2,FINSEQ_1:def 3;
A35:  D.n-D.m <= upper_volume(chi(A,A),D1).i by A33,INTEGRA1:22,A2;
      i in Seg len upper_volume(chi(A,A),D1) by A34,INTEGRA1:def 7;
      then i in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
      then upper_volume(chi(A,A),D1).i in rng upper_volume(chi(A,A),D1)
      by FUNCT_1:def 5;
      then upper_volume(chi(A,A),D1).i <= max rng upper_volume(chi(A,A),D1)
      by XXREAL_2:def 8;
      then upper_volume(chi(A,A),D1).i<=delta(D1) by INTEGRA1:def 19;
      hence thesis by A30,A35,XXREAL_0:2;
    end;
  end;
  hence contradiction by A1,A8,XXREAL_0:2;
end;

theorem Th5:
  for p,q st rng p = rng q & p is increasing & q is increasing holds p = q
proof
  let p,q;
  assume
A1: rng p = rng q;
  assume
A2: p is increasing & q is increasing;
  then p is one-to-one & q is one-to-one by JORDAN7:17;
  then len p = len q by A1,FINSEQ_1:65;
  hence thesis by A1,A2,GOBOARD2:22;
end;

theorem Th6:
  for A be closed-interval Subset of REAL, D,D1 be Element of divs A st
  D <= D1 & i in dom D & j in dom D & i <= j holds
  indx(D1,D,i) <= indx(D1,D,j) & indx(D1,D,i) in dom D1
proof
  let A be closed-interval Subset of REAL;
  let D,D1 be Element of divs A;
  assume
A1: D <= D1 & i in dom D & j in dom D & i <= j;
  then
A2: D.i = D1.indx(D1,D,i) & indx(D1,D,i) in dom D1 by INTEGRA1:def 21;
A3: D.j = D1.indx(D1,D,j) & indx(D1,D,j) in dom D1 by A1,INTEGRA1:def 21;
  D.i <= D.j by A1,GOBOARD2:18;
  hence thesis by A2,A3,GOBOARD1:def 1;
end;

theorem Th7:
  for A be closed-interval Subset of REAL, D,D1 be Element of divs A
  st D <= D1 & i in dom D & j in dom D & i < j holds
  indx(D1,D,i) < indx(D1,D,j)
proof
  let A be closed-interval Subset of REAL;
  let D,D1 be Element of divs A;
  assume
A1: D <= D1 & i in dom D & j in dom D & i < j;
  then
A2: D.i = D1.indx(D1,D,i) & indx(D1,D,i) in dom D1 by INTEGRA1:def 21;
A3: D.j = D1.indx(D1,D,j) & indx(D1,D,j) in dom D1 by A1,INTEGRA1:def 21;
  D.i < D.j by A1,GOBOARD1:def 1;
  hence thesis by A2,A3,GOBOARD2:18;
end;

theorem Th8:
  for A be closed-interval Subset of REAL,
  D be Element of divs A holds delta(D) >= 0
proof
  let A be closed-interval Subset of REAL;
  let D be Element of divs A;
  consider y such that
A1: y in rng D by SUBSET_1:10;
  consider n such that
A2: n in dom D & y=D.n by A1,PARTFUN1:26;
A3: n in Seg len D by A2,FINSEQ_1:def 3;
  vol(divset(D,n))=upper_volume(chi(A,A),D).n by INTEGRA1:22,A2;
  then
A4: upper_volume(chi(A,A),D).n >= 0 by INTEGRA1:11;
  n in Seg len upper_volume(chi(A,A),D) by A3,INTEGRA1:def 7;
  then n in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
  then upper_volume(chi(A,A),D).n in rng upper_volume(chi(A,A),D)
  by FUNCT_1:def 5;
  then upper_volume(chi(A,A),D).n <= max rng upper_volume(chi(A,A),D)
  by XXREAL_2:def 8;
  hence thesis by A4,INTEGRA1:def 19;
end;

Lm4: for A be closed-interval Subset of REAL, g be Function of A,REAL st
g is_bounded_on A holds sup rng g >= inf rng g
proof
  let A be closed-interval Subset of REAL;
  let g be Function of A,REAL;
  assume g is_bounded_on A;
  then g is_bounded_below_on A & g is_bounded_above_on A by RFUNCT_1:def 11;
  then rng g is bounded_above & rng g is bounded_below by INTEGRA1:13,15;
  then rng g is bounded;
  hence thesis by SEQ_4:24;
end;

Lm5: for A,B be closed-interval Subset of REAL,
f be Function of A,REAL st f is_bounded_on A & B c= A holds
inf rng(f|B) >= inf rng f & inf rng f <= sup rng(f|B) &
sup rng(f|B) <= sup rng f & inf rng(f|B) <= sup rng f
proof
  let A,B be closed-interval Subset of REAL, f be Function of A,REAL;
  assume
A1: f is_bounded_on A & B c= A;
  then f is_bounded_above_on A & f is_bounded_below_on A by RFUNCT_1:def 11;
  then
A2: rng f is bounded_above & rng f is bounded_below by INTEGRA1:13,15;
  consider x such that
A3: x in B by SUBSET_1:10;
  B c=dom f by A1,FUNCT_2:def 1;
  then
A4: dom(f|B)=B by RELAT_1:91;
  then
A5: (f|B).x in rng(f|B) by A3,FUNCT_1:def 5;
A6: rng(f|B) <> {} by A4,RELAT_1:65;
  rng(f|B) c= rng f by RELAT_1:99;
  then
A7: rng(f|B) is bounded_above & rng(f|B) is bounded_below by A2,XXREAL_2:44,43;
  thus
A8: inf rng(f|B) >= inf rng f by A2,A6,RELAT_1:99,SEQ_4:64;
A9: inf rng(f|B)<=(f|B).x by A5,A7,SEQ_4:def 5;
  sup rng(f|B)>=(f|B).x by A5,A7,SEQ_4:def 4;
  then
A10: inf rng(f|B) <= sup rng(f|B) by A9,XXREAL_0:2;
  hence sup rng(f|B) >= inf rng f by A8,XXREAL_0:2;
  thus sup rng(f|B) <= sup rng f by A2,A6,RELAT_1:99,SEQ_4:65;
  hence thesis by A10,XXREAL_0:2;
end;

Lm6: for A be closed-interval Subset of REAL,
D1 be Element of divs A st j in dom D1 holds vol(divset(D1,j)) <= delta D1
proof
  let A be closed-interval Subset of REAL, D1 be Element of divs A;
  assume
Z: j in dom D1;
  then j in Seg len D1 by FINSEQ_1:def 3;
  then j in Seg len upper_volume(chi(A,A),D1) by INTEGRA1:def 7;
  then j in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
  then upper_volume(chi(A,A),D1).j in rng upper_volume(chi(A,A),D1)
  by FUNCT_1:def 5;
  then upper_volume(chi(A,A),D1).j <= max rng upper_volume(chi(A,A),D1)
  by XXREAL_2:def 8;
  then vol(divset(D1,j)) <= max rng upper_volume(chi(A,A),D1) by Z,INTEGRA1:
  22;
  hence thesis by INTEGRA1:def 19;
end;

Lm7: for A be closed-interval Subset of REAL, j1 be Element of NAT,
D1,D2 be Element of divs A st
j1 = len D1 - 1 & x in divset(D1,len D1) & len D1 >= 2 &
D1 <= D2 & rng D2 = rng D1 \/ {x} holds rng (D2|indx(D2,D1,j1)) = rng (D1|j1)
proof
  let A be closed-interval Subset of REAL, j1 be Element of NAT,
  D1,D2 be Element of divs A;
  assume
A1: j1 = len D1 - 1 & x in divset(D1,len D1) & len D1 >= 2;
  assume
A2: D1<=D2 & rng D2 = rng D1 \/ {x};
A3: len D1 in dom D1 & len D2 in dom D2 by FINSEQ_5:6;
A4: len D1 <> 1 by A1;
  then
A5: len D1-1 in NAT & len D1-1 in dom D1 by A3,INTEGRA1:9;
  inf divset(D1,len D1) <= x & x <= sup divset(D1,len D1) by A1,INTEGRA2:1;
  then
A6: D1.j1 <= x & x <= D1.(len D1) by A1,A3,A4,INTEGRA1:def 5;
A7: indx(D2,D1,j1) in dom D2 by A1,A2,A5,INTEGRA1:def 21;
  then
A8: 1 <= indx(D2,D1,j1) & indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
A9: j1 in dom D1 by A1,A3,A4,INTEGRA1:9;
  then
A10: 1 <= j1 & j1 <= len D1 by FINSEQ_3:27;
  for x1 st x1 in rng(D2|indx(D2,D1,j1)) holds x1 in rng(D1|j1)
  proof
    let x1;
    assume x1 in rng(D2|indx(D2,D1,j1));
    then consider k such that
A11: k in dom(D2|indx(D2,D1,j1)) & x1=(D2|indx(D2,D1,j1)).k by PARTFUN1:26;
    k in Seg len(D2|indx(D2,D1,j1)) by A11,FINSEQ_1:def 3;
    then
A12: k in Seg indx(D2,D1,j1) by A8,FINSEQ_1:80;
    then
A13: (D2|indx(D2,D1,j1)).k = D2.k & k in dom D2 by A7,RFINSEQ:19;
    then
A14: D2.k in rng D2 by FUNCT_1:def 5;
    1 <= k & k <= indx(D2,D1,j1) by A12,FINSEQ_1:3;
    then D2.k <= D2.indx(D2,D1,j1) by A7,A13,GOBOARD2:18;
    then
A15: D2.k <= D1.j1 by A1,A2,A5,INTEGRA1:def 21;
A16: len(D1|j1) = j1 by A10,FINSEQ_1:80;
A17: D2.k in {x} implies D2.k = D1.j1
    proof
      assume D2.k in {x};
      then D1.j1 <= D2.k by A6,TARSKI:def 1;
      hence thesis by A15,XXREAL_0:1;
    end;
A18: D2.k in {x} implies D2.k in rng(D1|j1)
    proof
      assume
A19:  D2.k in {x};
      j1 in dom(D1|j1) by A10,A16,FINSEQ_3:27;
      then
A20:  (D1|j1).j1 in rng(D1|j1) by FUNCT_1:def 5;
      j1 in Seg j1 by A10,FINSEQ_1:3;
      hence thesis by A9,A17,A19,A20,RFINSEQ:19;
    end;
    D2.k in rng D1 implies D2.k in rng(D1|j1)
    proof
      assume D2.k in rng D1;
      then consider m such that
A21:  m in dom D1 & D2.k = D1.m by PARTFUN1:26;
      m in Seg len D1 by A21,FINSEQ_1:def 3;
      then
A22:  1 <= m & m <= j1 by A9,A15,A21,FINSEQ_1:3,GOBOARD1:def 1;
      then
A23:  m in dom (D1|j1) by A16,FINSEQ_3:27;
      m in Seg j1 by A22,FINSEQ_1:3;
      then D2.k = (D1|j1).m by A9,A21,RFINSEQ:19;
      hence thesis by A23,FUNCT_1:def 5;
    end;
    hence thesis by A2,A7,A11,A12,A14,A18,RFINSEQ:19,XBOOLE_0:def 2;
  end;
  then
A24: rng(D2|indx(D2,D1,j1)) c= rng (D1|j1) by TARSKI:def 3;
  for x1 st x1 in rng(D1|j1) holds x1 in rng(D2|indx(D2,D1,j1))
  proof
    let x1;
    assume x1 in rng(D1|j1);
    then consider k such that
A25: k in dom(D1|j1) & x1=(D1|j1).k by PARTFUN1:26;
    k in Seg len(D1|j1) by A25,FINSEQ_1:def 3;
    then
A26: k in Seg j1 by A10,FINSEQ_1:80;
    then
A27: (D1|j1).k = D1.k & k in dom D1 by A9,RFINSEQ:19;
    then D1.k in rng D1 by FUNCT_1:def 5;
    then x1 in rng D2 by A2,A25,A27,XBOOLE_0:def 2;
    then consider n such that
A28: n in dom D2 & x1=D2.n by PARTFUN1:26;
A29: indx(D2,D1,k) in dom D2 & D2.indx(D2,D1,k)=D2.n
    by A2,A25,A27,A28,INTEGRA1:def 21;
    k <= j1 by A26,FINSEQ_1:3;
    then D1.k <= D1.j1 by A1,A5,A27,GOBOARD2:18;
    then D2.indx(D2,D1,k) <= D1.j1 by A2,A27,INTEGRA1:def 21;
    then D2.indx(D2,D1,k)<=D2.indx(D2,D1,j1) by A1,A2,A5,INTEGRA1:def 21;
    then
A30: n <= indx(D2,D1,j1) by A7,A28,A29,GOBOARD1:def 1;
    1 <= n by A28,FINSEQ_3:27;
    then
A31: n in Seg indx(D2,D1,j1) by A30,FINSEQ_1:3;
    then
A32: D2.n = (D2|indx(D2,D1,j1)).n by A7,RFINSEQ:19;
    n in Seg len(D2|indx(D2,D1,j1)) by A8,A31,FINSEQ_1:80;
    then n in dom(D2|indx(D2,D1,j1)) by FINSEQ_1:def 3;
    hence thesis by A28,A32,FUNCT_1:def 5;
  end;
  then rng(D1|j1) c= rng(D2|indx(D2,D1,j1)) by TARSKI:def 3;
  hence thesis by A24,XBOOLE_0:def 10;
end;

theorem Th9:
  for A be closed-interval Subset of REAL, g be Function of A,REAL,
  D1,D2 be Element of divs A st x in divset(D1,len D1) & len D1 >= 2
  & D1<=D2 & rng D2 = rng D1 \/ {x} & g is_bounded_on A
  holds Sum lower_volume(g,D2)-Sum
  lower_volume(g,D1)<=(sup rng g-inf rng g)*delta(D1)
proof
  let A be closed-interval Subset of REAL;
  let g be Function of A,REAL;
  let D1,D2 be Element of divs A;
  assume
A1: x in divset(D1,len D1) & len D1 >= 2;
  assume
A2: D1<=D2 & rng D2 = rng D1 \/ {x};
  assume
A3: g is_bounded_on A;
  deffunc PLg(Element of divs A,Nat) = (PartSums(lower_volume(g,$1))).$2;
  deffunc LVg(Element of divs A) = lower_volume(g,$1);
  set j = len D1;
    len D1 <> 0 & len D2 <> 0 by CARD_2:59;
  then
A5: len D1 in Seg len D1 & len D2 in Seg len D2 by FINSEQ_1:5;
A6: len D1 in dom D1 & len D2 in dom D2 by FINSEQ_5:6;
A7: len D1 <> 1 by A1;
A8: indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.(len D1)
  by A2,A6,INTEGRA1:def 21;
  then
A9: indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
A10: indx(D2,D1,j) >= len lower_volume(g,D2)
  proof
    assume indx(D2,D1,j) < len lower_volume(g,D2);
    then indx(D2,D1,j) < len D2 by INTEGRA1:def 8;
    then
A11: D1.(len D1) < D2.(len D2) by A6,A8,GOBOARD1:def 1;
A12: not D2.(len D2) in rng D1
    proof
      assume
A13:  D2.(len D2) in rng D1;
      rng D1 c= A by INTEGRA1:def 2;
      then inf A <= D2.(len D2) & D2.(len D2) <= sup A by A13,INTEGRA2:1;
      hence contradiction by A11,INTEGRA1:def 2;
    end;
    D2.(len D2) in rng D2 by A6,FUNCT_1:def 5;
    then D2.(len D2) in rng D1 or D2.(len D2) in {x} by A2,XBOOLE_0:def 2;
    then D2.(len D2) = x by A12,TARSKI:def 1;
    then D2.(len D2) <= sup divset(D1,len D1) by A1,INTEGRA2:1;
    hence contradiction by A6,A7,A11,INTEGRA1:def 5;
  end;
  then
A14: indx(D2,D1,j) in Seg len lower_volume(g,D2)
  & indx(D2,D1,j) >= len lower_volume(g,D2) by A9,INTEGRA1:def 8;
A15: j in Seg len lower_volume(g,D1)
  & j >= len lower_volume(g,D1) by A5,INTEGRA1:def 8;
A16: len D1-1 in NAT & len D1-1 in dom D1 by A6,A7,INTEGRA1:9;
  reconsider j1=len D1-1 as Element of NAT by A6,A7,INTEGRA1:9;
A17: indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) & indx(D2,D1,j1) <= len D2
  proof
    thus indx(D2,D1,j1) in dom D2 by A2,A16,INTEGRA1:def 21;
    hence thesis by FINSEQ_3:27;
  end;
  then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
  then
A18: D2|indx(D2,D1,j1) is increasing by A17,JORDAN3:25;
A19: j1 in dom D1 & 1 <= j1 & j1 <= len D1
  proof
    thus j1 in dom D1 by A6,A7,INTEGRA1:9;
    hence thesis by FINSEQ_3:27;
  end;
  then mid(D1,1,j1) is increasing by INTEGRA1:37;
  then
A20: D1|j1 is increasing by A19,JORDAN3:25;
A21: rng (D2|indx(D2,D1,j1)) = rng (D1|j1) by A1,A2,Lm7;
  then
A22: D2|indx(D2,D1,j1)=D1|j1 by A18,A20,Th5;
A23: for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
  proof
    let k;
    assume
A24: 1 <= k & k <= j1;
    assume
A25: k<>indx(D2,D1,k);
    per cases by A25,XXREAL_0:1;
    suppose
A26:  k > indx(D2,D1,k);
      1 <= k & k <= len D1 by A19,A24,XXREAL_0:2;
      then
A27:  k in dom D1 by FINSEQ_3:27;
      then
A28:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2,INTEGRA1 :def 21;
      then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
      then
A29:  1<=indx(D2,D1,k)&indx(D2,D1,k)<=indx(D2,D1,j1)
      by A2,A19,A24,A27,Th6,FINSEQ_1:3;
      then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
      then
A30:  (D2|indx(D2,D1,j1)).indx(D2,D1,k)=D2.indx(D2,D1,k) by A17, RFINSEQ:19;
A31:  indx(D2,D1,k) < j1 by A24,A26,XXREAL_0:2;
      then indx(D2,D1,k) <= len D1 by A19,XXREAL_0:2;
      then indx(D2,D1,k) in dom D1 by A29,FINSEQ_3:27;
      then
A32:  D1.k > D1.indx(D2,D1,k) by A26,A27,GOBOARD1:def 1;
      indx(D2,D1,k) in Seg j1 by A29,A31,FINSEQ_1:3;
      hence contradiction by A19,A22,A28,A30,A32,RFINSEQ:19;
    end;
    suppose
A33:  k < indx(D2,D1,k);
      k in Seg j1 by A24,FINSEQ_1:3;
      then
A34:  D1.k = (D1|j1).k by A16,RFINSEQ:19;
      1 <= k & k <= len D1 by A19,A24,XXREAL_0:2;
      then
A35:  k in dom D1 by FINSEQ_3:27;
      then
A36:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2,INTEGRA1 :def 21;
      indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2 &
      indx(D2,D1,j1) in dom D2 by A2,A19,A24,A35,Th6;
      then
A37:  k <= indx(D2,D1,j1) by A33,XXREAL_0:2;
      then k <= len D2 by A17,XXREAL_0:2;
      then k in dom D2 by A24,FINSEQ_3:27;
      then
A38:  D2.k < D2.indx(D2,D1,k) by A33,A36,GOBOARD1:def 1;
      k in Seg indx(D2,D1,j1) by A24,A37,FINSEQ_1:3;
      hence contradiction by A17,A22,A34,A36,A38,RFINSEQ:19;
    end;
  end;
A39: len (D2|indx(D2,D1,j1))=len (D1|j1) by A18,A20,A21,Th5;
  len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A17,FINSEQ_1:80;
  then
A40: indx(D2,D1,j1) =j1 by A19,A39,FINSEQ_1:80;
  j1 <= len D1 by A16,FINSEQ_3:27;
  then j1 <= len lower_volume(g,D1) by INTEGRA1:def 8;
  then
A41: len(lower_volume(g,D1)|j1)=indx(D2,D1,j1) by A40,FINSEQ_1:80;
  indx(D2,D1,j1) in dom D2 by A2,A16,INTEGRA1:def 21;
  then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
  then indx(D2,D1,j1) <= len lower_volume(g,D2) by INTEGRA1:def 8;
  then
A42: len(lower_volume(g,D1)|j1)=len(lower_volume(g,D2)|indx(D2,D1,j1))
  by A41,FINSEQ_1:80;
  for k be Nat st 1 <= k & k <= len(lower_volume(g,D1)|j1) holds
  (lower_volume(g,D1)|j1).k = (lower_volume(g,D2)|indx(D2,D1,j1)).k
  proof
    let k be Nat;
    assume
A43: 1 <= k & k <= len(lower_volume(g,D1)|j1);
    reconsider k as Element of NAT by ORDINAL1:def 13;
A44: len(lower_volume(g,D1)) = len D1 by INTEGRA1:def 8;
    then
A45: 1 <= k & k <= j1 by A19,A43,FINSEQ_1:80;
    then
A46: k in Seg j1 by FINSEQ_1:3;
    k <= len D1 by A19,A45,XXREAL_0:2;
    then
A47: k in Seg len D1 by A43,FINSEQ_1:3;
A50:  k in dom D1 by A47,FINSEQ_1:def 3;
      then
A51:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2, INTEGRA1:def 21;
A48: divset(D1,k)=divset(D2,indx(D2,D1,k))
    proof
A49:  divset(D1,k)=[. inf divset(D1,k), sup divset(D1,k) .] by INTEGRA1:5;
      inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
      sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
      proof
        per cases;
        suppose
A52:      k=1;
          then
A53:      inf divset(D1,k)=inf A & sup divset(D1,k)=D1.k by A50,
          INTEGRA1:def 5;
          indx(D2,D1,k)=1 by A19,A23,A52;
          hence thesis by A51,A53,INTEGRA1:def 5;
        end;
        suppose
A54:      k<>1;
          then
A55:      inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
          by A50,INTEGRA1:def 5;
A56:      k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT by A50,A54,INTEGRA1:9;
          reconsider k1=k-1 as Element of NAT by A50,A54,INTEGRA1:9;
          k <= k+1 by NAT_1:11;
          then k1 <= k by XREAL_1:22;
          then
A57:      k1 <= j1 by A45,XXREAL_0:2;
A58:      1 <= k1 by A56,FINSEQ_3:27;
          indx(D2,D1,k)<>1 by A23,A45,A54;
          then
A59:      inf divset(D2,indx(D2,D1,k))=D2.(indx(D2,D1,k)-1) &
          sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A51,INTEGRA1:def 5;
          D2.(indx(D2,D1,k)-1)=D2.(k-1) by A23,A45
            .= D2.indx(D2,D1,k1) by A23,A57,A58;
          hence thesis by A2,A50,A55,A56,A59,INTEGRA1:def 21;
        end;
      end;
      hence thesis by A49,INTEGRA1:5;
    end;
    j1 in Seg len(lower_volume(g,D1)) by A19,A44,FINSEQ_1:def 3;
    then j1 in dom(lower_volume(g,D1)) by FINSEQ_1:def 3;
    then
A60: (lower_volume(g,D1)|j1).k = lower_volume(g,D1).k by A46,RFINSEQ: 19
      .=(inf(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
    by A48,INTEGRA1:def 8,A50;
    indx(D2,D1,k) in Seg j1 by A23,A45,A46;
    then
A61: indx(D2,D1,k) in Seg indx(D2,D1,j1) by A19,A23;
    then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;
    then
Y:   1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A17,XXREAL_0:2;
X:  indx(D2,D1,k) in dom D2 by Y,FINSEQ_3:27;
    indx(D2,D1,j1) in Seg len D2 by A17,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len lower_volume(g,D2) by INTEGRA1:def 8;
    then
A63: indx(D2,D1,j1) in dom lower_volume(g,D2) by FINSEQ_1:def 3;
    (lower_volume(g,D2)|indx(D2,D1,j1)).k
    =(lower_volume(g,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A23,A45
      .=lower_volume(g,D2).indx(D2,D1,k) by A61,A63,RFINSEQ:19
      .=(inf(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
    by INTEGRA1:def 8,X;
    hence thesis by A60;
  end;
  then
A64: lower_volume(g,D2)|indx(D2,D1,j1)=lower_volume(g,D1)|j1
  by A42,FINSEQ_1:18;
X: len D2 = len lower_volume(g,D2) by INTEGRA1:def 8;
B65: indx(D2,D1,j1) in dom lower_volume(g,D2) by X,A17,FINSEQ_3:31;
    len D1 = len lower_volume(g,D1) by INTEGRA1:def 8;
    then
Y:  j1 in dom lower_volume(g,D1) by A19,FINSEQ_3:31;
A67: PLg(D2,indx(D2,D1,j1))=Sum(lower_volume(g,D2)|indx(D2,D1,j1))
  by INTEGRA1:def 22,B65
    .=PLg(D1,j1) by A64,INTEGRA1:def 22,Y;
A68: indx(D2,D1,j1)+1 <= indx(D2,D1,len D1)
  proof
    len D1 < len D1+1 by NAT_1:13;
    then j1 < len D1 by XREAL_1:21;
    then indx(D2,D1,j1) < indx(D2,D1,len D1) by A2,A6,A19,Th7;
    hence thesis by NAT_1:13;
  end;
A69: Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,len D1))
  -Sum mid(lower_volume(g,D1),len D1,len D1) <=
  (sup rng g-inf rng g)*delta(D1)
  proof
A70: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len lower_volume(g,D2)
    proof
      indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
      then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
      then indx(D2,D1,j) in Seg len lower_volume(g,D2) by INTEGRA1:def 8;
      hence thesis by FINSEQ_1:3;
    end;
    then
A71: 1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len lower_volume(g,D2 )
    by A17,A68,NAT_1:13,XXREAL_0:2;
A72: indx(D2,D1,j)-indx(D2,D1,j1) <= 2
    proof
      assume
A73:  indx(D2,D1,j)-indx(D2,D1,j1) > 2;
      set ID1=indx(D2,D1,j1)+1;
      set ID2=ID1+1;
A74:  indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
      proof
        thus indx(D2,D1,j1) < ID1 by NAT_1:13;
        thus ID1 < ID2 by NAT_1:13;
        indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A73,XREAL_1:22;
        hence thesis;
      end;
A75:  indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
      then
A76:  indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A77:  ID1 in dom D2
      proof
A78:    1 <= ID1 & ID1 <= indx(D2,D1,j) by A17,A74,XXREAL_0:2;
        then ID1 <= len D2 by A76,XXREAL_0:2;
        hence thesis by A78,FINSEQ_3:27;
      end;
A79:  ID2 in dom D2
      proof
A80:    indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A74,A76,XXREAL_0:2;
        then 1 <= ID2 by A17,XXREAL_0:2;
        hence thesis by A80,FINSEQ_3:27;
      end;
      then
A81:  D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2, D1,j)
      by A17,A74,A75,A77,GOBOARD1:def 1;
A82:  D2.ID1 in rng D2 & D2.ID2 in rng D2 by A77,A79,FUNCT_1:def 5;
A83:  D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
      by A2,A6,A19,INTEGRA1:def 21;
A84:  D2.ID1 in {x} & D2.ID2 in {x}
      proof
        not(D2.ID1 in rng D1) & not(D2.ID2 in rng D1)
        proof
          assume
A85:      D2.ID1 in rng D1 or D2.ID2 in rng D1;
          per cases by A85;
          suppose D2.ID1 in rng D1;
            then consider n such that
A86:        n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
            D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
            by A81,XXREAL_0:2;
            then j1<n & n<j by A6,A19,A83,A86,GOBOARD2:18;
            then j<n+1 & n<j by XREAL_1:21;
            hence contradiction by NAT_1:13;
          end;
          suppose D2.ID2 in rng D1;
            then consider n such that
A87:        n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
            D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
            by A81,XXREAL_0:2;
            then j1<n & n<j by A6,A19,A83,A87,GOBOARD2:18;
            then j<n+1 & n<j by XREAL_1:21;
            hence contradiction by NAT_1:13;
          end;
        end;
        hence thesis by A2,A82,XBOOLE_0:def 2;
      end;
      then D2.ID1 = x by TARSKI:def 1;
      then D2.ID1=D2.ID2 by A84,TARSKI:def 1;
      hence contradiction by A74,A77,A79,GOBOARD2:19;
    end;
    1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
    indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
    proof
A88:  indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
      =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A68,BINARITH:50;
      indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
      hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
      thus thesis by A72,A88;
    end;
    then
A89: 1 <= len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)) &
    len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
    by A68,A70,A71,JORDAN3:27;
A90: 1 <= j & j <= len lower_volume(g,D1) by A5,FINSEQ_1:3,INTEGRA1:def 8;
    j-'j+1 = 1 by Lm2;
    then
A91: len mid(lower_volume(g,D1),j,j)=1 by A90,JORDAN3:27;
    mid(lower_volume(g,D1),j,j).1 = lower_volume(g,D1).j by A90,JORDAN3:27;
    then
A92: mid(lower_volume(g,D1),j,j)=<*lower_volume(g,D1).j*> by A91, FINSEQ_1:57;
    indx(D2,D1,j1)+1 in Seg len lower_volume(g,D2) by A71,FINSEQ_1:3;
    then
A93: indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 8;
::::::::::::::::::::
X: len lower_volume(g,D2) = len D2 by INTEGRA1:def 8;
    indx(D2,D1,j1)+1 in dom lower_volume(g,D2) by A71,FINSEQ_3:27;
    then
B93: indx(D2,D1,j1)+1 in dom D2 by X,FINSEQ_3:31;
    now per cases by A89,Lm3;
      suppose
A95:    len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A96:    indx(D2,D1,j1)+1=indx(D2,D1,j)
        proof
          len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          = indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 by A68,A70,A71,JORDAN3:27;
          then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A68,A95,BINARITH:50;
          hence thesis;
        end;
A97:    divset(D2,indx(D2,D1,j))=divset(D1,j)
        proof
          inf divset(D1,j)=D2.indx(D2,D1,j1)
          & sup divset(D1,j)=D2.indx(D2,D1,j)
          proof
            inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
            by A6,A7,INTEGRA1:def 5;
            hence thesis by A2,A6,A19,INTEGRA1:def 21;
          end;
          then
A98:      divset(D1,j)=[. D2.indx(D2,D1,j1),D2.indx(D2,D1,j).] by INTEGRA1:5;
A99:      indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
          indx(D2,D1,j)<>1 by A17,A96,NAT_1:13;
          then inf divset(D2,indx(D2,D1,j))=D2.(indx(D2,D1,j)-1)
          & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
          by A99,INTEGRA1:def 5;
          hence thesis by A96,A98,INTEGRA1:5;
        end;
        mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
        =lower_volume(g,D2).(indx(D2,D1,j1)+1) by A70,A71,JORDAN3:27;
        then mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        =<*lower_volume(g,D2).(indx(D2,D1,j1)+1)*> by A95,FINSEQ_1:57;
        then
A100:   Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j ))
        =lower_volume(g,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
          .=(inf(rng(g|divset(D2,(indx(D2,D1,j1)+1)))))
        *vol(divset(D2,(indx(D2,D1,j1)+1))) by INTEGRA1:def 8,B93
          .=lower_volume(g,D1).j by A96,A97,INTEGRA1:def 8,A6
          .=Sum mid(lower_volume(g,D1),j,j) by A92,FINSOP_1:12;
A101:   delta(D1) >= 0 by Th8;
        sup rng g - inf rng g >= 0 by A3,Lm4,XREAL_1:50;

then (sup rng g - inf rng g)*delta(D1) >= 0*delta(D1) by A101;
        hence Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        -Sum mid(lower_volume(g,D1),j,j) <= (sup rng g-inf rng g)*delta(D1)
        by A100;
      end;
      suppose
A102:   len mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A103:   mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
        =lower_volume(g,D2).(indx(D2,D1,j1)+1) by A70,A71,JORDAN3:27;
        mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
        =lower_volume(g,D2).(indx(D2,D1,j1)+2)
        proof
A104:     2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;
          mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
          =LVg(D2).(2+(indx(D2,D1,j1)+1)-'1) by A68,A70,A71,A102,JORDAN3:27
            .=LVg(D2).(2+(indx(D2,D1,j1)+1)-1) by A104,BINARITH:50
            .=LVg(D2).(indx(D2,D1,j1)+(1+1));
          hence thesis;
        end;
        then mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        =<*lower_volume(g,D2).(indx(D2,D1,j1)+1),
        lower_volume(g,D2).(indx(D2,D1,j1)+2)*> by A102,A103,FINSEQ_1:61;
        then
A105:   Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j ))
        =lower_volume(g,D2).(indx(D2,D1,j1)+1)
        +lower_volume(g,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A106:   vol(divset(D1,j))
        =vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
        proof
A107:     inf divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
          proof

inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j by A6,A7,INTEGRA1:def 5;
            hence thesis by A2,A6,A19,INTEGRA1:def 21;
          end;
A108:     indx(D2,D1,j)=indx(D2,D1,j1)+2
          proof

indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A68,A70,A71,A102,JORDAN3:27;
            then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A68,BINARITH:50;
            hence thesis;
          end;
A109:     inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
          & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
          & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
          & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
          proof
A110:       indx(D2,D1,j1)+2 in dom D2 by A2,A6,A108,INTEGRA1:def 21;
            indx(D2,D1,j1)+1 in Seg len lower_volume(g,D2) by A71,FINSEQ_1:3;
            then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 8;
            then
A111:       indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A112:       indx(D2,D1,j1)+1 <> 1 by A17,NAT_1:13;
A113:       indx(D2,D1,j1)+1+1 > 1 by A71,NAT_1:13;
A114:       indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A115:       indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;
            thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
            & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
            by A110,A113,A114,INTEGRA1:def 5;
            thus thesis by A111,A112,A115,INTEGRA1:def 5;
          end;
          vol(divset(D1,j))=D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
          +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A107,A108,INTEGRA1:def 6;
          then vol(divset(D1,j))=vol(divset(D2,indx(D2,D1,j1)+2))
          +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A109,INTEGRA1:def 6
            .=vol(divset(D2,indx(D2,D1,j1)+2))
          +(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1))
          by A109;
          hence thesis by INTEGRA1:def 6;
        end;
        then
A116:   lower_volume(g,D1).j=(inf(rng(g|divset(D1,j))))*
        (vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
        by INTEGRA1:def 8,A6;
A117:   vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A118:   vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
A119:   Sum mid(LVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))-Sum mid(LVg(D1),j,j)
        <=(sup rng g - inf rng g)*(vol(divset(D2,indx(D2,D1,j1)+2))
        +vol(divset(D2,indx(D2,D1,j1)+1)))
        proof
A120:     indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
A121:     indx(D2,D1,j)=indx(D2,D1,j1)+2
          proof

indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A68,A70,A71,A102,JORDAN3:27;
            then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A68,BINARITH:50;
            hence thesis;
          end;
          set ID1=indx(D2,D1,j1)+1, ID2=indx(D2,D1,j1)+2;
A123:     Sum mid(LVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =(inf rng(g|divset(D2,indx(D2,D1,j1)+2)))
          *vol(divset(D2,indx(D2,D1,j1)+2))
          +LVg(D2).(indx(D2,D1,j1)+1) by A105,INTEGRA1:def 8,A120,A121
            .=(inf rng(g|divset(D2,indx(D2,D1,j1)+2)))
          *vol(divset(D2,indx(D2,D1,j1)+2))
          +(inf rng(g|divset(D2,indx(D2,D1,j1)+1)))
          *vol(divset(D2,indx(D2,D1,j1)+1)) by INTEGRA1:def 8,B93;
          divset(D2,ID2)c=A by A120,A121,INTEGRA1:10;
          then
A124:     inf rng(g|divset(D2,ID2)) <= sup rng g by A3,Lm5;
          ID1 in dom D2 by A93,FINSEQ_1:def 3;
          then divset(D2,ID1) c= A by INTEGRA1:10;
          then inf rng(g|divset(D2,ID1)) <= sup rng g by A3,Lm5;
          then
A125:     (inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
          <=(sup rng g)*vol(divset(D2,ID1)) by A117,XREAL_1:66;
          divset(D1,j)c=A by A6,INTEGRA1:10;
          then
A126:     inf rng(g|divset(D1,j)) >= inf rng g by A3,Lm5;
          then
A127:     (inf rng(g|divset(D1,j)))*vol(divset(D2,ID2))
          >=(inf rng g)*vol(divset(D2,ID2))
          & (inf rng(g|divset(D1,j)))*vol(divset(D2,ID1))
          >=(inf rng g)*vol(divset(D2,ID1)) by A117,A118,XREAL_1:66;
          Sum mid(LVg(D2),ID1,indx(D2,D1,j))
          -(inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
          <=(sup rng g)*vol(divset(D2,ID2)) by A118,A123,A124,XREAL_1:66;
          then Sum mid(LVg(D2),ID1,indx(D2,D1,j))
          <=(sup rng g)*vol(divset(D2,ID2))
          +(inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;

then Sum mid(LVg(D2),ID1,indx(D2,D1,j))-(sup rng g)*vol(divset(D2,ID2))
          <=(inf rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;

then Sum mid(LVg(D2),ID1,indx(D2,D1,j))-(sup rng g)*vol(divset(D2,ID2))
          <=(sup rng g)*vol(divset(D2,ID1)) by A125,XXREAL_0:2;
          then
A128:     Sum mid(LVg(D2),ID1,indx(D2,D1,j))<=(sup rng g)*vol( divset(D2,ID2))
          + (sup rng g)*vol(divset(D2,ID1)) by XREAL_1:22;
          set IR = (inf rng g)*vol(divset(D2,ID2));
          Sum mid(LVg(D1),j,j)=(inf rng(g|divset(D1,j)))*vol(divset(D2,indx(D2
          , D1,j1)+2))

+(inf rng(g|divset(D1,j)))*vol(divset(D2,indx(D2,D1,j1)+1)) by A92,A116,
          FINSOP_1:12;

then Sum mid(LVg(D1),j,j)-(inf rng(g|divset(D1,j)))*vol(divset(D2,ID1))
          >=IR by A118,A126,XREAL_1:66;

then Sum mid(LVg(D1),j,j)>=(inf rng(g|divset(D1,j)))*vol(divset(D2,ID1))
          +IR by XREAL_1:21;
          then Sum mid(LVg(D1),j,j)-(inf rng g)*vol(divset(D2,ID2))
          >=(inf rng(g|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:21;
          then Sum mid(LVg(D1),j,j)-(inf rng g)*vol(divset(D2,ID2))
          >=(inf rng g)*vol(divset(D2,ID1)) by A127,XXREAL_0:2;
          then Sum mid(LVg(D1),j,j) >=IR+(inf rng g)*vol(divset(D2,ID1))
          by XREAL_1:21;
          then Sum mid(LVg(D2),ID1,indx(D2,D1,j))-Sum mid(LVg(D1),j,j)
          <=(sup rng g)*vol(divset(D2,ID2))+(sup rng g)*vol(divset(D2,ID1))
          -(IR+(inf rng g)*vol(divset(D2,ID1))) by A128,REAL_1:92;
          hence thesis;
        end;
        sup rng g - inf rng g >= 0 by A3,Lm4,XREAL_1:50;
        then (sup rng g - inf rng g)*(vol(divset(D1,j)))
        <=(sup rng g - inf rng g)*delta(D1) by A6,Lm6,XREAL_1:66;
        hence thesis by A106,A119,XXREAL_0:2;
      end;
    end;
    hence thesis;
  end;
A129: PLg(D2,indx(D2,D1,j1))
  +Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
  =PLg(D2,indx(D2,D1,j))
  proof
U:  indx(D2,D1,j) in dom D2 by A2,A6,INTEGRA1:def 21;
    then
      indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
    then
A131: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
    then
A132: indx(D2,D1,j) <= len LVg(D2) by INTEGRA1:def 8;
T:  len D2 = len LVg(D2) by INTEGRA1:def 8;
    then
B133: indx(D2,D1,j) in dom LVg(D2) by U,FINSEQ_3:31;
A134: indx(D2,D1,j1) < indx(D2,D1,j) by A68,NAT_1:13;
    indx(D2,D1,j1) in dom LVg(D2) by T,A17,FINSEQ_3:31;
    then PLg(D2,indx(D2,D1,j1))
    =Sum(LVg(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
    then PLg(D2,indx(D2,D1,j1))
    +Sum mid(lower_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
    =Sum(LVg(D2)|indx(D2,D1,j1)
    ^mid(LVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
      .=Sum(mid(LVg(D2),1,indx(D2,D1,j1))
    ^mid(LVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A17,JORDAN3:25
      .=Sum(mid(LVg(D2),1,indx(D2,D1,j))) by A17,A132,A134,INTEGRA2:4
      .=Sum(LVg(D2)|indx(D2,D1,j)) by A131,JORDAN3:25;
    hence thesis by INTEGRA1:def 22,B133;
  end;
A135: PLg(D1,j1)+Sum mid(lower_volume(g,D1),j,j)=PLg(D1,j)
  proof
A136: 1 <= j & j <= len LVg(D1) by A5,FINSEQ_1:3,INTEGRA1:def 8;
   then
A137: j in dom LVg(D1) by FINSEQ_3:27; :::A5,INTEGRA1:def 8;
    j < j+1 by NAT_1:13;
    then
A138: j1 < j by XREAL_1:21;
    j1 < len LVg(D1) by A138,A136,XXREAL_0:2;
    then j1 in dom LVg(D1) by FINSEQ_3:27,A19;
    then PLg(D1,j1)=Sum(LVg(D1)|j1) by INTEGRA1:def 22;
    then PLg(D1,j1)+Sum mid(LVg(D1),j,j)
    =Sum((LVg(D1)|j1)^mid(LVg(D1),j,j)) by RVSUM_1:105
      .=Sum(mid(LVg(D1),1,j1)^mid(LVg(D1),j1+1,j)) by A19,JORDAN3:25
      .=Sum(mid(LVg(D1),1,j)) by A19,A136,A138,INTEGRA2:4
      .=Sum(LVg(D1)|j) by A136,JORDAN3:25;
    hence thesis by A137,INTEGRA1:def 22;
  end;
B14: indx(D2,D1,j) in dom lower_volume(g,D2) by A14,FINSEQ_1:def 3;
B15: j in dom lower_volume(g,D1) by A15,FINSEQ_1:def 3;
A139: PLg(D2,indx(D2,D1,j))=Sum(lower_volume(g,D2)|indx(D2,D1,j))
  by B14,INTEGRA1:def 22
    .=Sum lower_volume(g,D2) by A10,FINSEQ_1:79;
  PLg(D1,j)=Sum(lower_volume(g,D1)|j) by B15,INTEGRA1:def 22
    .=Sum lower_volume(g,D1) by A15,FINSEQ_1:79;
  hence thesis by A67,A69,A129,A135,A139;
end;

theorem Th10:
  for A be closed-interval Subset of REAL, g be Function of A,REAL,
  D1,D2 be Element of divs A st x in divset(D1,len D1) & len D1 >= 2
  & D1<=D2 & rng D2 = rng D1 \/ {x} & g is_bounded_on A
  holds Sum upper_volume(g,D1)-Sum
  upper_volume(g,D2)<=(sup rng g-inf rng g)*delta(D1)
proof
  let A be closed-interval Subset of REAL;
  let g be Function of A,REAL;
  let D1,D2 be Element of divs A;
  assume
A1: x in divset(D1,len D1) & len D1 >= 2;
  assume
A2: D1<=D2 & rng D2 = rng D1 \/ {x};
  assume
A3: g is_bounded_on A;
  deffunc PUg(Element of divs A,Nat) = (PartSums(upper_volume(g,$1))).$2;
  deffunc UVg(Element of divs A) = upper_volume(g,$1);
  set j = len D1;
  len D1 <> 0 & len D2 <> 0 by CARD_2:59;
  then
A4: len D1 in Seg len D1 & len D2 in Seg len D2 by FINSEQ_1:5;
  then
A5: len D1 in dom D1 & len D2 in dom D2 by FINSEQ_1:def 3;
A6: len D1 <> 1 by A1;
A7: indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.(len D1)
  by A2,A5,INTEGRA1:def 21;
  then
A8: indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
A9: indx(D2,D1,j) >= len upper_volume(g,D2)
  proof
    assume indx(D2,D1,j) < len upper_volume(g,D2);
    then indx(D2,D1,j) < len D2 by INTEGRA1:def 7;
    then
A10: D1.(len D1) < D2.(len D2) by A5,A7,GOBOARD1:def 1;
A11: not(D2.(len D2) in rng D1)
    proof
      assume
A12:  D2.(len D2) in rng D1;
      rng D1 c= A by INTEGRA1:def 2;
      then inf A <= D2.(len D2) & D2.(len D2) <= sup A by A12,INTEGRA2:1;
      hence contradiction by A10,INTEGRA1:def 2;
    end;
    D2.(len D2) in rng D2 by A5,FUNCT_1:def 5;
    then D2.(len D2) in rng D1 or D2.(len D2) in {x} by A2,XBOOLE_0:def 2;
    then D2.(len D2) = x by A11,TARSKI:def 1;
    then D2.(len D2) <= sup divset(D1,len D1) by A1,INTEGRA2:1;
    hence contradiction by A5,A6,A10,INTEGRA1:def 5;
  end;
  then
A13: indx(D2,D1,j) in Seg len upper_volume(g,D2)
  & indx(D2,D1,j) >= len upper_volume(g,D2) by A8,INTEGRA1:def 7;
A14: j in Seg len upper_volume(g,D1)
  & j >= len upper_volume(g,D1) by A4,INTEGRA1:def 7;
A15: len D1-1 in NAT & len D1-1 in dom D1 by A5,A6,INTEGRA1:9;
  reconsider j1=len D1-1 as Element of NAT by A5,A6,INTEGRA1:9;
A16: indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) & indx(D2,D1,j1) <= len D2
  proof
    thus indx(D2,D1,j1) in dom D2 by A2,A15,INTEGRA1:def 21;
    hence thesis by FINSEQ_3:27;
  end;
  then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
  then
A17: D2|indx(D2,D1,j1) is increasing by A16,JORDAN3:25;
A18: j1 in dom D1 & 1 <= j1 & j1 <= len D1 by A15,FINSEQ_3:27;
  then mid(D1,1,j1) is increasing by INTEGRA1:37;
  then
A19: D1|j1 is increasing by A18,JORDAN3:25;
A20: rng (D2|indx(D2,D1,j1)) = rng (D1|j1) by A1,A2,Lm7;
  then
A21: D2|indx(D2,D1,j1)=D1|j1 by A17,A19,Th5;
A22: for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
  proof
    let k;
    assume
A23: 1 <= k & k <= j1;
    assume
A24: k<>indx(D2,D1,k);
    now per cases by A24,XXREAL_0:1;
      suppose
A25:    k > indx(D2,D1,k);
        1 <= k & k <= len D1 by A18,A23,XXREAL_0:2;
        then
A26:    k in dom D1 by FINSEQ_3:27;
        then
A27:    indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2,
        INTEGRA1:def 21;
        then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
        then
A28:    1<=indx(D2,D1,k)&indx(D2,D1,k)<=indx(D2,D1,j1)
        by A2,A15,A23,A26,Th6,FINSEQ_1:3;
        then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
        then
A29:    (D2|indx(D2,D1,j1)).indx(D2,D1,k)=D2.indx(D2,D1,k) by A16, RFINSEQ:19;
A30:    indx(D2,D1,k) < j1 by A23,A25,XXREAL_0:2;
        then indx(D2,D1,k) <= len D1 by A18,XXREAL_0:2;
        then indx(D2,D1,k) in Seg len D1 by A28,FINSEQ_1:3;
        then indx(D2,D1,k) in dom D1 by FINSEQ_1:def 3;
        then
A31:    D1.k > D1.indx(D2,D1,k) by A25,A26,GOBOARD1:def 1;
        indx(D2,D1,k) in Seg j1 by A28,A30,FINSEQ_1:3;
        hence contradiction by A15,A21,A27,A29,A31,RFINSEQ:19;
      end;
      suppose
A32:    k < indx(D2,D1,k);
        k in Seg j1 by A23,FINSEQ_1:3;
        then
A33:    D1.k = (D1|j1).k by A15,RFINSEQ:19;
        1 <= k & k <= len D1 by A18,A23,XXREAL_0:2;
        then
A34:    k in dom D1 by FINSEQ_3:27;
        then
A35:    indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2,
        INTEGRA1:def 21;
        indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2 &
        indx(D2,D1,j1) in dom D2 by A2,A15,A23,A34,Th6;
        then
A36:    k <= indx(D2,D1,j1) by A32,XXREAL_0:2;
        then k <= len D2 by A16,XXREAL_0:2;
        then k in dom D2 by A23,FINSEQ_3:27;
        then
A37:    D2.k < D2.indx(D2,D1,k) by A32,A35,GOBOARD1:def 1;
        k in Seg indx(D2,D1,j1) by A23,A36,FINSEQ_1:3;
        hence contradiction by A16,A21,A33,A35,A37,RFINSEQ:19;
      end;
    end;
    hence contradiction;
  end;
A38: len (D2|indx(D2,D1,j1))=len (D1|j1) by A17,A19,A20,Th5;
  len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A16,FINSEQ_1:80;
  then
A39: indx(D2,D1,j1) =j1 by A18,A38,FINSEQ_1:80;
  j1 in Seg len D1 by A15,FINSEQ_1:def 3;
  then j1 <= len D1 by FINSEQ_1:3;
  then j1 <= len upper_volume(g,D1) by INTEGRA1:def 7;
  then
A40: len(upper_volume(g,D1)|j1)=indx(D2,D1,j1) by A39,FINSEQ_1:80;
  indx(D2,D1,j1) in dom D2 by A2,A15,INTEGRA1:def 21;
  then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
  then indx(D2,D1,j1) <= len upper_volume(g,D2) by INTEGRA1:def 7;
  then
A41: len(upper_volume(g,D1)|j1)=len(upper_volume(g,D2)|indx(D2,D1,j1))
  by A40,FINSEQ_1:80;
  for k be Nat st 1 <= k & k <= len(upper_volume(g,D1)|j1) holds
  (upper_volume(g,D1)|j1).k = (upper_volume(g,D2)|indx(D2,D1,j1)).k
  proof
    let k be Nat;
    assume
A42: 1 <= k & k <= len(upper_volume(g,D1)|j1);
    reconsider k as Element of NAT by ORDINAL1:def 13;
A43: len(upper_volume(g,D1)) = len D1 by INTEGRA1:def 7;
    then
A44: 1 <= k & k <= j1 by A18,A42,FINSEQ_1:80;
    then
A45: k in Seg j1 by FINSEQ_1:3;
X:  1 <= k & k <= len D1 by A18,A44,XXREAL_0:2;
    then
A46: k in Seg len D1 by FINSEQ_1:3;
B46: k in dom D1 by X,FINSEQ_3:27;
A47: divset(D1,k)=divset(D2,indx(D2,D1,k))
    proof
A48:  divset(D1,k)=[. inf divset(D1,k), sup divset(D1,k) .] by INTEGRA1:5;
A49:  k in dom D1 by A46,FINSEQ_1:def 3;
      then
A50:  indx(D2,D1,k) in dom D2 & D1.k=D2.indx(D2,D1,k) by A2, INTEGRA1:def 21;
      inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
      sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
      proof
        per cases;
        suppose
A51:      k=1;
          then
A52:      inf divset(D1,k)=inf A&sup divset(D1,k)=D1.k by A49, INTEGRA1:def 5;
          indx(D2,D1,k)=1 by A18,A22,A51;
          hence thesis by A50,A52,INTEGRA1:def 5;
        end;
        suppose
A53:      k<>1;
          then
A54:      inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
          by A49,INTEGRA1:def 5;
A55:      k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT by A49,A53,INTEGRA1:9;
          reconsider k1=k-1 as Element of NAT by A49,A53,INTEGRA1:9;
          k <= k+1 by NAT_1:11;
          then k1 <= k by XREAL_1:22;
          then
A56:      k1 <= j1 by A44,XXREAL_0:2;
          1 <= k1 by A55,FINSEQ_3:27;
          then
A57:      k1=indx(D2,D1,k1) by A22,A56;
          indx(D2,D1,k)<>1 by A22,A44,A53;
          then
A58:      inf divset(D2,indx(D2,D1,k))=D2.(indx(D2,D1,k)-1) &
          sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A50,INTEGRA1:def 5;
          D2.(indx(D2,D1,k)-1)= D2.indx(D2,D1,k1) by A22,A44,A57;
          hence thesis by A2,A49,A54,A55,A58,INTEGRA1:def 21;
        end;
      end;
      hence thesis by A48,INTEGRA1:5;
    end;
    j1 in Seg len(upper_volume(g,D1)) by A15,A43,FINSEQ_1:def 3;
    then j1 in dom(upper_volume(g,D1)) by FINSEQ_1:def 3;
    then
A59: (upper_volume(g,D1)|j1).k = upper_volume(g,D1).k by A45,RFINSEQ: 19
      .=(sup(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
    by A47,INTEGRA1:def 7,B46;
    indx(D2,D1,k) in Seg j1 by A22,A44,A45;
    then
A60: indx(D2,D1,k) in Seg indx(D2,D1,j1) by A18,A22;
    then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;
    then
Y:     1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A16,XXREAL_0:2;
B61: indx(D2,D1,k) in dom D2 by Y,FINSEQ_3:27;
    indx(D2,D1,j1) in Seg len D2 by A16,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len upper_volume(g,D2) by INTEGRA1:def 7;
    then
A62: indx(D2,D1,j1) in dom upper_volume(g,D2) by FINSEQ_1:def 3;
    (upper_volume(g,D2)|indx(D2,D1,j1)).k
    =(upper_volume(g,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A22,A44
      .=upper_volume(g,D2).indx(D2,D1,k) by A60,A62,RFINSEQ:19
      .=(sup(rng(g|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
    by INTEGRA1:def 7,B61;
    hence thesis by A59;
  end;
  then
A63: upper_volume(g,D2)|indx(D2,D1,j1)=upper_volume(g,D1)|j1
  by A41,FINSEQ_1:18;
  indx(D2,D1,j1) in Seg len D2 by A16,FINSEQ_1:def 3;
  then
A64: indx(D2,D1,j1) in Seg len upper_volume(g,D2) by INTEGRA1:def 7;
B64: indx(D2,D1,j1) in dom upper_volume(g,D2) by A64,FINSEQ_1:def 3;
  j1 in Seg len D1 by A15,FINSEQ_1:def 3;
  then
     j1 in Seg len upper_volume(g,D1) by INTEGRA1:def 7;
   then
B65: j1 in dom upper_volume(g,D1) by FINSEQ_1:def 3;
A66: PUg(D2,indx(D2,D1,j1))=Sum(upper_volume(g,D2)|indx(D2,D1,j1))
  by INTEGRA1:def 22,B64
    .=PUg(D1,j1) by A63,INTEGRA1:def 22,B65;
A67: indx(D2,D1,j1)+1 <= indx(D2,D1,len D1)
  proof
    len D1 < len D1+1 by NAT_1:13;
    then j1 < len D1 by XREAL_1:21;
    then indx(D2,D1,j1) < indx(D2,D1,len D1) by A2,A5,A15,Th7;
    hence thesis by NAT_1:13;
  end;
A68: Sum mid(upper_volume(g,D1),len D1,len D1)
  -Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,len D1))
  <= (sup rng g-inf rng g)*delta(D1)
  proof
A69: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len upper_volume(g,D2)
    proof
      indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
      then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
      then indx(D2,D1,j) in Seg len upper_volume(g,D2) by INTEGRA1:def 7;
      hence thesis by FINSEQ_1:3;
    end;
    then
A70: 1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len upper_volume(g,D2 )
    by A16,A67,NAT_1:13,XXREAL_0:2;
A71: indx(D2,D1,j)-indx(D2,D1,j1) <= 2
    proof
      assume
A72:  indx(D2,D1,j)-indx(D2,D1,j1) > 2;
      reconsider ID1=indx(D2,D1,j1)+1 as Element of NAT;
      reconsider ID2=ID1+1 as Element of NAT;
A73:  indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
      proof
        thus indx(D2,D1,j1) < ID1 by NAT_1:13;
        thus ID1 < ID2 by NAT_1:13;
        indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A72,XREAL_1:22;
        hence thesis;
      end;
A74:  indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
      then
A75:  indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A76:  ID1 in dom D2
      proof
A77:    1 <= ID1 & ID1 <= indx(D2,D1,j) by A16,A73,XXREAL_0:2;
        then ID1 <= len D2 by A75,XXREAL_0:2;
        hence thesis by A77,FINSEQ_3:27;
      end;
A78:  ID2 in dom D2
      proof
A79:    indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A73,A75,XXREAL_0:2;
        then 1 <= ID2 by A16,XXREAL_0:2;
        hence thesis by A79,FINSEQ_3:27;
      end;
      then
A80:  D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2, D1,j)
      by A16,A73,A74,A76,GOBOARD1:def 1;
A81:  D2.ID1 in {x} & D2.ID2 in {x}
      proof
A82:    D2.ID1 in rng D2 & D2.ID2 in rng D2 by A76,A78,FUNCT_1:def 5;
A83:    D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
        by A2,A5,A15,INTEGRA1:def 21;
        not(D2.ID1 in rng D1) & not(D2.ID2 in rng D1)
        proof
          assume
A84:      D2.ID1 in rng D1 or D2.ID2 in rng D1;
          now per cases by A84;
            suppose D2.ID1 in rng D1;
              then consider n such that
A85:          n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
              D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
              by A80,XXREAL_0:2;
              then j1<n & n<j by A5,A15,A83,A85,GOBOARD2:18;
              then j<n+1 & n<j by XREAL_1:21;
              hence contradiction by NAT_1:13;
            end;
            suppose D2.ID2 in rng D1;
              then consider n such that
A86:          n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
              D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
              by A80,XXREAL_0:2;
              then j1<n & n<j by A5,A15,A83,A86,GOBOARD2:18;
              then j<n+1 & n<j by XREAL_1:21;
              hence contradiction by NAT_1:13;
            end;
          end;
          hence thesis;
        end;
        hence thesis by A2,A82,XBOOLE_0:def 2;
      end;
      then D2.ID1 = x by TARSKI:def 1;
      then D2.ID1=D2.ID2 by A81,TARSKI:def 1;
      hence contradiction by A73,A76,A78,GOBOARD2:19;
    end;
    1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
    indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
    proof
A87:  indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
      =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A67,BINARITH:50;
      indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
      hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
      thus thesis by A71,A87;
    end;
    then
A88: 1 <= len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)) &
    len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
    by A67,A69,A70,JORDAN3:27;
A89: 1 <= j & j <= len upper_volume(g,D1) by A4,FINSEQ_1:3,INTEGRA1:def 7;
    j-'j+1 = 1 by Lm2;
    then
A90: len mid(upper_volume(g,D1),j,j)=1 by A89,JORDAN3:27;
    mid(upper_volume(g,D1),j,j).1 = upper_volume(g,D1).j by A89,JORDAN3:27;
    then mid(upper_volume(g,D1),j,j)=<*upper_volume(g,D1).j*> by A90,
    FINSEQ_1:57;
    then
A91: Sum mid(upper_volume(g,D1),j,j)=upper_volume(g,D1).j by FINSOP_1: 12;
A92: indx(D2,D1,j1)+1 in Seg len D2
    proof
      indx(D2,D1,j1)+1 in Seg len upper_volume(g,D2) by A70,FINSEQ_1:3;
      hence thesis by INTEGRA1:def 7;
    end;
B92: indx(D2,D1,j1)+1 in dom D2 by A92,FINSEQ_1:def 3;
    now per cases by A88,Lm3;
      suppose
A93:    len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A94:    indx(D2,D1,j1)+1=indx(D2,D1,j)
        proof
          len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          = indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 by A67,A69,A70,JORDAN3:27;
          then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A67,A93,BINARITH:50;
          hence thesis;
        end;
A95:    divset(D2,indx(D2,D1,j))=divset(D1,j)
        proof
          inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
          by A5,A6,INTEGRA1:def 5;
          then inf divset(D1,j)=D2.indx(D2,D1,j1)
          & sup divset(D1,j)=D2.indx(D2,D1,j) by A2,A5,A15,INTEGRA1:def 21;
          then
A96:      divset(D1,j)=[. D2.indx(D2,D1,j1),D2.indx(D2,D1,j).] by INTEGRA1:5;
A97:      indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
          indx(D2,D1,j)<>1 by A16,A94,NAT_1:13;
          then inf divset(D2,indx(D2,D1,j))=D2.(indx(D2,D1,j)-1)
          & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
          by A97,INTEGRA1:def 5;
          hence thesis by A94,A96,INTEGRA1:5;
        end;
        mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
        =upper_volume(g,D2).(indx(D2,D1,j1)+1) by A69,A70,JORDAN3:27;
        then mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        =<*upper_volume(g,D2).(indx(D2,D1,j1)+1)*> by A93,FINSEQ_1:57;
        then
A98:    Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j ))
        =upper_volume(g,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
          .=(sup(rng(g|divset(D2,(indx(D2,D1,j1)+1)))))
        *vol(divset(D2,(indx(D2,D1,j1)+1))) by INTEGRA1:def 7,B92
          .=Sum
        mid(upper_volume(g,D1),j,j) by A91,A94,A95,INTEGRA1:def 7,A5;
A99:    delta(D1) >= 0 by Th8;
        sup rng g - inf rng g >= 0 by A3,Lm4,XREAL_1:50;

then (sup rng g - inf rng g)*delta(D1) >= 0*delta(D1) by A99;
        hence Sum mid(upper_volume(g,D1),j,j)-
        Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        <= (sup rng g-inf rng g)*delta(D1) by A98;
      end;
      suppose
A100:   len mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A101:   mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1
        =upper_volume(g,D2).(indx(D2,D1,j1)+1) by A69,A70,JORDAN3:27;
        mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
        =upper_volume(g,D2).(indx(D2,D1,j1)+2)
        proof
A102:     2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;
          mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
          =UVg(D2).(2+(indx(D2,D1,j1)+1)-'1) by A67,A69,A70,A100,JORDAN3:27
            .=UVg(D2).(2+(indx(D2,D1,j1)+1)-1) by A102,BINARITH:50
            .=UVg(D2).(indx(D2,D1,j1)+(1+1));
          hence thesis;
        end;
        then mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
        =<*upper_volume(g,D2).(indx(D2,D1,j1)+1),
        upper_volume(g,D2).(indx(D2,D1,j1)+2)*> by A100,A101,FINSEQ_1:61;
        then
A103:   Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j ))
        =upper_volume(g,D2).(indx(D2,D1,j1)+1)
        +upper_volume(g,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A104:   vol(divset(D1,j))
        =vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
        proof
A105:     inf divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
          proof

inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j by A5,A6,INTEGRA1:def 5;
            hence thesis by A2,A5,A15,INTEGRA1:def 21;
          end;
A106:     indx(D2,D1,j)=indx(D2,D1,j1)+2
          proof
            indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A67,A69,A70,A100,JORDAN3:
            27;
            then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A67,BINARITH:50;
            hence thesis;
          end;
A107:     inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
          & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
          & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
          & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
          proof
A108:       indx(D2,D1,j1)+2 in dom D2 by A2,A5,A106,INTEGRA1:def 21;
            indx(D2,D1,j1)+1 in Seg len upper_volume(g,D2) by A70,FINSEQ_1:3;
            then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 7;
            then
A109:       indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A110:       indx(D2,D1,j1)+1 <> 1 by A16,NAT_1:13;
A111:       indx(D2,D1,j1)+1+1 > 1 by A70,NAT_1:13;
A112:       indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A113:       indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;
            thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
            & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
            by A108,A111,A112,INTEGRA1:def 5;
            thus thesis by A109,A110,A113,INTEGRA1:def 5;
          end;
          vol(divset(D1,j)) =D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
          +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A105,A106,INTEGRA1:def 6;
          then vol(divset(D1,j)) =vol(divset(D2,indx(D2,D1,j1)+2))
          +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A107,INTEGRA1:def 6
            .=vol(divset(D2,indx(D2,D1,j1)+2))
          +(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1))
          by A107;
          hence thesis by INTEGRA1:def 6;
        end;
        then
A114:   upper_volume(g,D1).j=(sup(rng(g|divset(D1,j))))*
        (vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
        by INTEGRA1:def 7,A5;
A115:   vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A116:   vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
A117:   Sum mid(UVg(D1),j,j)-Sum mid(UVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))
        <=(sup rng g - inf rng g)*(vol(divset(D2,indx(D2,D1,j1)+2))
        +vol(divset(D2,indx(D2,D1,j1)+1)))
        proof
A118:     indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
A120:     indx(D2,D1,j)=indx(D2,D1,j1)+2
          proof
            indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2 by A67,A69,A70,A100,JORDAN3:
            27;
            then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A67,BINARITH:50;
            hence thesis;
          end;
          set ID1=indx(D2,D1,j1)+1, ID2=indx(D2,D1,j1)+2;
A121:     Sum mid(UVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
          =(sup rng(g|divset(D2,indx(D2,D1,j1)+2)))
          *vol(divset(D2,indx(D2,D1,j1)+2))
          +UVg(D2).(indx(D2,D1,j1)+1) by A103,A120,INTEGRA1:def 7,A118
            .=(sup rng(g|divset(D2,indx(D2,D1,j1)+2)))
          *vol(divset(D2,indx(D2,D1,j1)+2))
          +(sup rng(g|divset(D2,indx(D2,D1,j1)+1)))
          *vol(divset(D2,indx(D2,D1,j1)+1)) by INTEGRA1:def 7,B92;
          divset(D2,ID2)c=A by A118,A120,INTEGRA1:10;
          then
A122:     sup rng(g|divset(D2,ID2)) >= inf rng g by A3,Lm5;
          ID1 in dom D2 by A92,FINSEQ_1:def 3;
          then divset(D2,ID1)c=A by INTEGRA1:10;
          then sup rng(g|divset(D2,ID1)) >= inf rng g by A3,Lm5;
          then
A123:     (sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
          >=(inf rng g)*vol(divset(D2,ID1)) by A115,XREAL_1:66;
          divset(D1,j)c=A by A5,INTEGRA1:10;
          then sup rng(g|divset(D1,j)) <= sup rng g by A3,Lm5;
          then
A124:     (sup rng(g|divset(D1,j)))*vol(divset(D2,ID2))
          <=(sup rng g)*vol(divset(D2,ID2))
          & (sup rng(g|divset(D1,j)))*vol(divset(D2,ID1))
          <=(sup rng g)*vol(divset(D2,ID1)) by A115,A116,XREAL_1:66;
          Sum mid(UVg(D2),ID1,indx(D2,D1,j))
          -(sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1))
          >=(inf rng g)*vol(divset(D2,ID2)) by A116,A121,A122,XREAL_1:66;
          then Sum mid(UVg(D2),ID1,indx(D2,D1,j))
          >=(inf rng g)*vol(divset(D2,ID2))
          +(sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:21;

then Sum mid(UVg(D2),ID1,indx(D2,D1,j))-(inf rng g)*vol(divset(D2,ID2))
          >=(sup rng(g|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:21;

then Sum mid(UVg(D2),ID1,indx(D2,D1,j))-(inf rng g)*vol(divset(D2,ID2))
          >=(inf rng g)*vol(divset(D2,ID1)) by A123,XXREAL_0:2;
          then
A125:     Sum mid(UVg(D2),ID1,indx(D2,D1,j)) >= (inf rng g)*vol(
          divset(D2,ID2) ) + (inf rng g)*vol(divset(D2,ID1)) by XREAL_1:21;
          Sum mid(UVg(D1),j,j)-(sup rng(g|divset(D1,j)))*vol(divset(D2,ID1))
          = (sup rng(g|divset(D1,j)))*vol(divset(D2,ID2)) by A91,A114;

then Sum mid(UVg(D1),j,j)<=(sup rng(g|divset(D1,j)))*vol(divset(D2,ID1))
          +(sup rng g)*vol(divset(D2,ID2)) by A124,XREAL_1:22;
          then Sum mid(UVg(D1),j,j)-(sup rng g)*vol(divset(D2,ID2))
          <=(sup rng(g|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:22;
          then Sum mid(UVg(D1),j,j)-(sup rng g)*vol(divset(D2,ID2))
          <=(sup rng g)*vol(divset(D2,ID1)) by A124,XXREAL_0:2;
          then Sum mid(UVg(D1),j,j)
          <=(sup rng g)*vol(divset(D2,ID2))+(sup rng g)*vol(divset(D2,ID1))
          by XREAL_1:22;
          then Sum mid(UVg(D1),j,j)-Sum mid(UVg(D2),ID1,indx(D2,D1,j))
          <=(sup rng g)*vol(divset(D2,ID2))+(sup rng g)*vol(divset(D2,ID1))
          -((inf rng g)*vol(divset(D2,ID2))+(inf rng g)*vol(divset(D2,ID1)))
          by A125,REAL_1:92;
          hence thesis;
        end;
        sup rng g - inf rng g >= 0 by A3,Lm4,XREAL_1:50;
        then (sup rng g - inf rng g)*(vol(divset(D1,j)))
        <=(sup rng g - inf rng g)*delta(D1) by A5,Lm6,XREAL_1:66;
        hence thesis by A104,A117,XXREAL_0:2;
      end;
    end;
    hence thesis;
  end;
A126: PUg(D2,indx(D2,D1,j1))
  +Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
  =PUg(D2,indx(D2,D1,j))
  proof
    indx(D2,D1,j) in dom D2 by A2,A5,INTEGRA1:def 21;
    then
      indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
    then
A128: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
    then
A129: 1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len UVg(D2) by INTEGRA1: def 7;
B130: indx(D2,D1,j) in dom UVg(D2) by A129,FINSEQ_3:27;
A131: indx(D2,D1,j1) < indx(D2,D1,j) by A67,NAT_1:13;
    indx(D2,D1,j1) in Seg len D2 by A16,FINSEQ_1:def 3;
    then indx(D2,D1,j1) in Seg len UVg(D2) by INTEGRA1:def 7;
    then indx(D2,D1,j1) in dom UVg(D2) by FINSEQ_1:def 3;
    then PUg(D2,indx(D2,D1,j1))
    =Sum(UVg(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
    then PUg(D2,indx(D2,D1,j1))
    +Sum mid(upper_volume(g,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
    =Sum(UVg(D2)|indx(D2,D1,j1)
    ^mid(UVg(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
      .=Sum(mid(UVg(D2),1,indx(D2,D1,j1))
    ^mid(UVg(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A16,JORDAN3:25
      .=Sum(mid(UVg(D2),1,indx(D2,D1,j))) by A16,A129,A131,INTEGRA2:4
      .=Sum(UVg(D2)|indx(D2,D1,j)) by A128,JORDAN3:25;
    hence thesis by INTEGRA1:def 22,B130;
  end;
A132: PUg(D1,j1)+Sum mid(upper_volume(g,D1),j,j)=PUg(D1,j)
  proof
A133: 1 <= j & j <= len UVg(D1) by A4,FINSEQ_1:3,INTEGRA1:def 7;
B134: j in dom UVg(D1) by A133,FINSEQ_3:27;
    j < j+1 by NAT_1:13;
    then
A135: j1 < j by XREAL_1:21;
    j1 in Seg len D1 by A15,FINSEQ_1:def 3;
    then j1 in Seg len UVg(D1) by INTEGRA1:def 7;
    then j1 in dom UVg(D1) by FINSEQ_1:def 3;
    then PUg(D1,j1)=Sum(UVg(D1)|j1) by INTEGRA1:def 22;
    then PUg(D1,j1)+Sum mid(UVg(D1),j,j)
    =Sum((UVg(D1)|j1)^mid(UVg(D1),j,j)) by RVSUM_1:105
      .=Sum(mid(UVg(D1),1,j1)^mid(UVg(D1),j1+1,j)) by A18,JORDAN3:25
      .=Sum(mid(UVg(D1),1,j)) by A18,A133,A135,INTEGRA2:4
      .=Sum(UVg(D1)|j) by A133,JORDAN3:25;
    hence thesis by INTEGRA1:def 22,B134;
  end;
B13: indx(D2,D1,j) in dom upper_volume(g,D2) by A13,FINSEQ_1:def 3;
B14: j in dom upper_volume(g,D1) by A14,FINSEQ_1:def 3;
A136: PUg(D2,indx(D2,D1,j))=Sum(upper_volume(g,D2)|indx(D2,D1,j))
  by INTEGRA1:def 22,B13
    .=Sum upper_volume(g,D2) by A9,FINSEQ_1:79;
  PUg(D1,j)=Sum(upper_volume(g,D1)|j) by INTEGRA1:def 22,B14
    .=Sum upper_volume(g,D1) by A14,FINSEQ_1:79;
  hence thesis by A66,A68,A126,A132,A136;
end;

Lm8: for A be closed-interval Subset of REAL, f be PartFunc of A,REAL
st vol(A)<>0 & y in rng lower_sum_set(f) holds ex D being Element of divs A st
D in dom lower_sum_set(f) & y=(lower_sum_set(f)).D & D.1 > inf A
proof
  let A be closed-interval Subset of REAL;
  let f be PartFunc of A,REAL;
  assume
A1: vol(A)<>0;
  assume y in rng lower_sum_set(f);
  then consider D3 being Element of divs A such that
A2: D3 in dom lower_sum_set(f) & y=(lower_sum_set(f)).D3 by PARTFUN1:26;
  len D3 <> 0 by CARD_2:59;
  then
A3: len D3 in Seg len D3 by FINSEQ_1:5;
  rng D3 <> {};
  then
A5: 1 in dom D3 by FINSEQ_3:34;
  now per cases;
    suppose
A6:   D3.1 <> inf A;
      D3.1 in A by A5,INTEGRA1:8;
      then inf A <= D3.1 by INTEGRA2:1;
      then D3.1 > inf A by A6,REAL_1:def 5;
      hence ex D being Element of divs A st D in dom lower_sum_set(f) &
      y=(lower_sum_set(f)).D & D.1 > inf A by A2;
    end;
    suppose
A7:   D3.1 = inf A;
      ex D being Element of divs A st D in dom lower_sum_set(f) &
      y=(lower_sum_set(f)).D & D.1 > inf A
      proof
A8:     D3.(len D3) = sup A by INTEGRA1:def 2;
A9:     len D3 in dom D3 by A3,FINSEQ_1:def 3;
        vol(A) >= 0 by INTEGRA1:11;
        then sup A - inf A > 0 by A1,INTEGRA1:def 6;
        then
A10:    sup A > inf A by REAL_2:106;
        then
A11:    len D3 > 1 by A5,A7,A8,A9,GOBOARD2:18;
        then reconsider D=D3/^1 as increasing FinSequence of REAL by
        INTEGRA1:36;
A12:    len D = len D3 - 1 & for m be Element of NAT st m in dom D
        holds D.m = D3.(m+1) by A11,RFINSEQ:def 2;
        then len D <> 0 by A7,A10,INTEGRA1:def 2;
        then reconsider D as non empty increasing FinSequence of REAL by
        CARD_1:47;
        rng D c= rng D3 & rng D3 c= A by FINSEQ_5:36,INTEGRA1:def 2;
        then
A13:    rng D c= A by XBOOLE_1:1;
A14:    len D+1=len D3 by A12;
        len D in dom D by FINSEQ_5:6;
        then D.(len D)=sup A by A8,A11,A14,RFINSEQ:def 2;
        then D is DivisionPoint of A by A13,INTEGRA1:def 2;
        then reconsider D as Element of divs A by INTEGRA1:def 4;
        D in divs A;
        then
A15:    D in dom lower_sum_set(f) by INTEGRA1:def 12;
A16:    y=(lower_sum_set(f)).D
        proof
A17:      y=lower_sum(f,D3) by A2,INTEGRA1:def 12
            .=Sum(lower_volume(f,D3)) by INTEGRA1:def 10

.=Sum((lower_volume(f,D3)|1)^(lower_volume(f,D3)/^1)) by RFINSEQ:21;
A18:      lower_volume(f,D3)|1 = <*lower_volume(f,D3).1*>
          proof
A19:        1 <= len lower_volume(f,D3) by A11,INTEGRA1:def 8;
            then
A20:        len (lower_volume(f,D3)|1)=1 by FINSEQ_1:80;
A21:        1 in dom lower_volume(f,D3) by A19,FINSEQ_3:27;
            1 in Seg 1 by FINSEQ_1:3;
            then (lower_volume(f,D3)|1).1 = lower_volume(f,D3).1 by A21,
            RFINSEQ:19;
            hence thesis by A20,FINSEQ_1:57;
          end;
A22:      vol(divset(D3,1))=sup divset(D3,1)-inf divset(D3,1) by INTEGRA1:def 6
            .=sup divset(D3,1) - inf A by A5,INTEGRA1:def 5
            .=D3.1 - inf A by A5,INTEGRA1:def 5
            .=0 by A7;
A23:      lower_volume(f,D3).1=(inf rng(f|divset(D3,1)))*vol(divset(D3,1))
          by INTEGRA1:def 8,A5;
          lower_volume(f,D3)/^1 = lower_volume(f,D)
          proof
A24:        2-'1=2-1 by BINARITH:50
              .= 1;
A25:        len D3 >= 1+1 by A11,NAT_1:13;
            then len lower_volume(f,D3) >= 2 by INTEGRA1:def 8;
            then
A26:        mid(lower_volume(f,D3),2,len lower_volume(f,D3))
            =lower_volume(f,D3)/^1 by A24,JORDAN3:26;
A27:        2 <= len lower_volume(f,D3) & 1 <= len lower_volume(f,D3)
            by A11,A25,INTEGRA1:def 8;
A28:        len(mid(lower_volume(f,D3),2,len lower_volume(f,D3)))
            =len lower_volume(f,D)
            proof
              len(mid(lower_volume(f,D3),2,len lower_volume(f,D3)))
              =len lower_volume(f,D3)-'2+1 by A27,JORDAN3:27
                .=len D3-'2+1 by INTEGRA1:def 8
                .=len D3-2+1 by A25,BINARITH:50
                .=len D3-1;
              hence thesis by A12,INTEGRA1:def 8;
            end;
            for i be Nat st 1<=i&i<=len mid(lower_volume(f,D3),2,len
            lower_volume(f,D3))
            holds mid(lower_volume(f,D3),2,len lower_volume(f,D3)).i
            =lower_volume(f,D).i
            proof
              let i be Nat;
A29:          i in NAT by ORDINAL1:def 13;
              assume
A30:          1<=i&i<=len mid(lower_volume(f,D3),2,len lower_volume(f,D3));
              then
A31:          1 <= i & i <= len D by A28,INTEGRA1:def 8;
              then 1<=i & i<=len lower_volume(f,D3) - 1 by A12,INTEGRA1:def 8;
              then 1 <= i & i <= len lower_volume(f,D3)-2+1;
              then
A32:          mid(lower_volume(f,D3),2,len lower_volume(f,D3 )).i
              =lower_volume(f,D3).(i+2-1) by A27,A29,JORDAN3:31
                .=lower_volume(f,D3).(i+1);
              1 <= i+1 & i+1 <= len D3 by A12,A31,NAT_1:12,XREAL_1:21;
              then
A33:          i+1 in Seg len D3 by FINSEQ_1:3;
  then i+1 in dom D3 by FINSEQ_1:def 3;
              then
A34:          mid(lower_volume(f,D3),2,len lower_volume(f,D3 )).i
              =(inf rng(f|divset(D3,i+1)))*vol(divset(D3,i+1))
              by A32,INTEGRA1:def 8;
A35:          divset(D3,i+1)=divset(D,i)
              proof
A36:            1<>i+1 by A30,NAT_1:13;
                i+1 in dom D3 by A33,FINSEQ_1:def 3;
                then
A37:            sup divset(D3,i+1)=D3.(i+1) & inf divset( D3,i+1)=D3.(i+1- 1)
                by A36,INTEGRA1:def 5;
A38:            i in dom D by A31,FINSEQ_3:27;
                then
A39:            D.i=D3.(i+1) by A11,RFINSEQ:def 2;
                per cases;
                suppose
A40:              i=1;
                  then
A41:              inf divset(D,i)=inf A & sup divset(D,i )=D.i
                  by A38,INTEGRA1:def 5;
                  divset(D3,i+1)=[.inf A, D.i.] by A7,A37,A39,A40,INTEGRA1:5;
                  hence thesis by A41,INTEGRA1:5;
                end;
                suppose
A42:              i<>1;
                  then
A43:              inf divset(D,i)=D.(i-1) & sup divset(D,i)=D.i
                  by A38,INTEGRA1:def 5;
                  i-1 in dom D & i-1 in NAT by A38,A42,INTEGRA1:9;
                  then i-1 in dom D & i-1 is Nat;
                  then D.(i-1)=D3.(i-1+1) by A11,RFINSEQ:def 2
                    .=D3.i;
                  then divset(D3,i+1)=[.inf divset(D,i),sup divset(D,i).]
                  by A37,A39,A43,INTEGRA1:5;
                  hence thesis by INTEGRA1:5;
                end;
              end;
              i in Seg len D by A31,FINSEQ_1:3;
  then i in dom D by FINSEQ_1:def 3;
              hence thesis by A34,A35,INTEGRA1:def 8;
            end;
            hence thesis by A26,A28,FINSEQ_1:18;
          end;
          then y=0+Sum(lower_volume(f,D)) by A17,A18,A22,A23,RVSUM_1:106
            .=lower_sum(f,D) by INTEGRA1:def 10;
          hence thesis by A15,INTEGRA1:def 12;
        end;
        rng D <> {};
        then 1 in dom D by FINSEQ_3:34;
        then
A44:    D.1=D3.(1+1) by A11,RFINSEQ:def 2
          .=D3.2;
        1+1 <= len D3 by A11,NAT_1:13;
        then 2 in dom D3 by FINSEQ_3:27;
        then D3.1 < D3.2 by A5,GOBOARD1:def 1;
        hence thesis by A7,A15,A16,A44;
      end;
      hence thesis;
    end;
  end;
  hence thesis;
end;

theorem Th11:
  for A be closed-interval Subset of REAL, D be Element of divs A,
  r be Real, i,j be Element of NAT
  st i in dom D & j in dom D & i<=j & r < mid(D,i,j).1
  holds ex B be closed-interval Subset of REAL
  st r=inf B & sup B=mid(D,i,j).(len mid(D,i,j))
  & len mid(D,i,j)=j-i+1 & mid(D,i,j) is DivisionPoint of B
proof
  let A be closed-interval Subset of REAL;
  let D be Element of divs A;
  let r be Real;
  let i,j be Element of NAT;
  assume
A1: i in dom D;
  assume
A2: j in dom D;
  assume
A3: i <= j;
  assume
A4: r < mid(D,i,j).1;
  consider C being closed-interval Subset of REAL such that
A5: inf C=mid(D,i,j).1 & sup C=mid(D,i,j).(len mid(D,i,j))
  & len mid(D,i,j)=j-i+1 & mid(D,i,j) is DivisionPoint of C
  by A1,A2,A3,INTEGRA1:38;
  consider a,b such that
A6: a <= b & a = inf C & b = sup C by INTEGRA1:4;
  r <= sup C by A4,A5,A6,XXREAL_0:2;
  then reconsider B=[.r,sup C.] as closed-interval Subset of REAL by
  INTEGRA1:def 1;
  reconsider MD=mid(D,i,j) as non empty increasing FinSequence of REAL by A5;
  B=[.inf B,sup B.] by INTEGRA1:5;
  then
A7: inf B = r & sup B = sup C by INTEGRA1:6;
A8: rng mid(D,i,j) c= C&mid(D,i,j).(len mid(D,i,j))=sup C by A5,INTEGRA1:def 2;
  x in C implies x in B
  proof
    assume x in C;
    then inf C <= x & x <= sup C by INTEGRA2:1;
    then r <= x & x <= sup C by A4,A5,XXREAL_0:2;
    hence thesis by A7,INTEGRA2:1;
  end;
  then C c= B by SUBSET_1:7;
  then rng mid(D,i,j) c= B by A8,XBOOLE_1:1;
  then MD is DivisionPoint of B by A5,A7,INTEGRA1:def 2;
  hence thesis by A5,A7;
end;

Lm9: for A be closed-interval Subset of REAL,
D1 be Element of divs A st vol(A)<>0 & len D1 = 1 holds
<*inf A*>^D1 is non empty increasing FinSequence of REAL
proof
  let A be closed-interval Subset of REAL, D1 be Element of divs A;
  assume
A1: vol(A)<>0;
  assume len D1 = 1;
  then
A2: D1.1=sup A by INTEGRA1:def 2;
  vol(A) >= 0 by INTEGRA1:11;
  then D1.1 - inf A > 0 by A1,A2,INTEGRA1:def 6;
  then
A3: inf A < D1.1 by REAL_2:106;
  set MD1 = <*inf A*>^D1;
  n in dom MD1 & m in dom MD1 & n<m implies MD1.n < MD1.m
  proof
    assume
A4: n in dom MD1 & m in dom MD1 & n<m;
A5: not m in dom <*inf A*>
    proof
      assume m in dom <*inf A*>;
      then m in Seg len <*inf A*> by FINSEQ_1:def 3;
      then m in {1} by FINSEQ_1:4,56;
      then
A6:   n < 1 by A4,TARSKI:def 1;
      n in Seg len MD1 by A4,FINSEQ_1:def 3;
      hence contradiction by A6,FINSEQ_1:3;
    end;
    MD1.m in rng MD1 by A4,FUNCT_1:def 5;
    then
A7: MD1.m in rng <*inf A*> \/ rng D1 by FINSEQ_1:44;
    not(MD1.m in rng <*inf A*>)
    proof
      assume MD1.m in rng <*inf A*>;
      then MD1.m in {inf A} by FINSEQ_1:55;
      then
A8:   MD1.m = inf A by TARSKI:def 1;
      consider n being Nat such that
A9:   n in dom D1 & m=len <*inf A*>+n by A4,A5,FINSEQ_1:38;
      n in Seg len D1 by A9,FINSEQ_1:def 3;
      then
A10:  1 <= n & n <= len D1 by FINSEQ_1:3;
      rng D1 <> {};
      then
A11:  1 in dom D1 by FINSEQ_3:34;
      D1.n=MD1.m by A9,FINSEQ_1:def 7;
      hence contradiction by A3,A8,A9,A10,A11,GOBOARD2:18;
    end;
    then
A12: MD1.m in rng D1 by A7,XBOOLE_0:def 2;
    now per cases by A4,FINSEQ_1:38;
      suppose
A13:    n in dom <*inf A*>;
        then n in Seg len <*inf A*> by FINSEQ_1:def 3;
        then n in {1} by FINSEQ_1:4,56;
        then
A14:    n = 1 by TARSKI:def 1;
        consider k such that
A15:    k in dom D1 & MD1.m = D1.k by A12,PARTFUN1:26;
A16:    1 <= k & k <= len D1 by A15,FINSEQ_3:27;
        rng D1 <> {};
        then 1 in dom D1 by FINSEQ_3:34;
        then
A17:    D1.1 <= MD1.m by A15,A16,GOBOARD2:18;
        MD1.n = <*inf A*>.n by A13,FINSEQ_1:def 7
          .= inf A by A14,
        FINSEQ_1:def 8;
        hence MD1.n < MD1.m by A3,A17,XXREAL_0:2;
      end;
      suppose ex i be Nat st i in dom D1 & n = len <*inf A*> + i;
        then consider i such that
A18:    i in dom D1 & n=len <*inf A*> + i;
        consider j be Nat such that
A19:    j in dom D1 & m=len <*inf A*> + j by A4,A5,FINSEQ_1:38;
A20:    i < j by A4,A18,A19,XREAL_1:8;
A21:    D1.i=MD1.n by A18,FINSEQ_1:def 7;
        D1.j=MD1.m by A19,FINSEQ_1:def 7;
        hence thesis by A18,A19,A20,A21,GOBOARD1:def 1;
      end;
    end;
    hence thesis;
  end;
  hence thesis by GOBOARD1:def 1;
end;

Lm10: for A be closed-interval Subset of REAL,
D2 be Element of divs A st inf A < D2.1 holds
<*inf A*>^D2 is non empty increasing FinSequence of REAL
proof
  let A be closed-interval Subset of REAL, D2 be Element of divs A;
  assume
A1: inf A < D2.1;
  set MD2=<*inf A*>^D2;
  n in dom MD2 & m in dom MD2 & n<m implies MD2.n < MD2.m
  proof
    assume
A2: n in dom MD2 & m in dom MD2 & n<m;
A3: not m in dom <*inf A*>
    proof
      assume m in dom <*inf A*>;
      then m in Seg len <*inf A*> by FINSEQ_1:def 3;
      then m in {1} by FINSEQ_1:4,56;
      then
A4:   n < 1 by A2,TARSKI:def 1;
      n in Seg len MD2 by A2,FINSEQ_1:def 3;
      hence contradiction by A4,FINSEQ_1:3;
    end;
    MD2.m in rng MD2 by A2,FUNCT_1:def 5;
    then MD2.m in rng <*inf A*> \/ rng D2 by FINSEQ_1:44;
    then
A5: MD2.m in rng <*inf A*> or MD2.m in rng D2 by XBOOLE_0:def 2;
A6: not MD2.m in rng <*inf A*>
    proof
      assume MD2.m in rng <*inf A*>;
      then MD2.m in {inf A} by FINSEQ_1:55;
      then
A7:   MD2.m = inf A by TARSKI:def 1;
      consider n be Nat such that
A8:   n in dom D2 & m=len <*inf A*>+n by A2,A3,FINSEQ_1:38;
      n in Seg len D2 by A8,FINSEQ_1:def 3;
      then
A9:   1 <= n & n <= len D2 by FINSEQ_1:3;
      rng D2 <> {};
      then
A10:  1 in dom D2 by FINSEQ_3:34;
      D2.n=MD2.m by A8,FINSEQ_1:def 7;
      hence contradiction by A1,A7,A8,A9,A10,GOBOARD2:18;
    end;
    now per cases by A2,FINSEQ_1:38;
      suppose
A11:    n in dom <*inf A*>;
        then n in Seg len <*inf A*> by FINSEQ_1:def 3;
        then n in {1} by FINSEQ_1:4,56;
        then
A12:    n = 1 by TARSKI:def 1;
        consider k such that
A13:    k in dom D2 & MD2.m = D2.k by A5,A6,PARTFUN1:26;
        k in Seg len D2 by A13,FINSEQ_1:def 3;
        then
A14:    1 <= k & k <= len D2 by FINSEQ_1:3;
        rng D2 <> {};
        then 1 in dom D2 by FINSEQ_3:34;
        then
A15:    D2.1 <= MD2.m by A13,A14,GOBOARD2:18;
        MD2.n = <*inf A*>.n by A11,FINSEQ_1:def 7
          .= inf A by A12,
        FINSEQ_1:def 8;
        hence MD2.n < MD2.m by A1,A15,XXREAL_0:2;
      end;
      suppose ex i be Nat st i in dom D2 & n = len <*inf A*> + i;
        then consider i such that
A16:    i in dom D2 & n=len <*inf A*> + i;
        consider j be Nat such that
A17:    j in dom D2 & m=len <*inf A*> + j by A2,A3,FINSEQ_1:38;
A18:    i < j by A2,A16,A17,XREAL_1:8;
A19:    D2.i=MD2.n by A16,FINSEQ_1:def 7;
        D2.j=MD2.m by A17,FINSEQ_1:def 7;
        hence thesis by A16,A17,A18,A19,GOBOARD1:def 1;
      end;
    end;
    hence thesis;
  end;
  hence thesis by GOBOARD1:def 1;
end;

Lm11: for A be closed-interval Subset of REAL, f being PartFunc of A,REAL,
D1, MD1 being Element of divs A st MD1 = <*inf A*>^D1 holds
(for i st i in Seg len D1 holds divset(MD1,i+1)=divset(D1,i)) &
upper_volume(f,D1)=upper_volume(f,MD1)/^1 &
lower_volume(f,D1)=lower_volume(f,MD1)/^1
proof
  let A be closed-interval Subset of REAL, f being PartFunc of A,REAL,
  D1, MD1 being Element of divs A;
  assume
A1: MD1 = <*inf A*>^D1;
  then
A2: len MD1=len <*inf A*> + len D1 by FINSEQ_1:35
    .= 1+len D1 by FINSEQ_1:56;
  thus
A3: for i st i in Seg len D1 holds divset(MD1,i+1)=divset(D1,i)
  proof
    let i;
    assume
A4: i in Seg len D1;
    then
A5: 1 <= i & i <= len D1 by FINSEQ_1:3;
A6: i in dom D1 by A4,FINSEQ_1:def 3;
A7: 1 <= i+1 by NAT_1:11;
    i+1 <= len D1+1 by A5,XREAL_1:8;
    then i+1 <= len D1 + len<*inf A*> by FINSEQ_1:56;
    then i+1 <= len MD1 by A1,FINSEQ_1:35;
    then
A8: i+1 in dom MD1 by A7,FINSEQ_3:27;
A9: divset(D1,i)=[.inf divset(D1,i), sup divset(D1,i).] by INTEGRA1:5;
    inf divset(D1,i)=inf divset(MD1,i+1)
    & sup divset(D1,i)=sup divset(MD1,i+1)
    proof
      per cases;
      suppose
A10:    i=1;
        i+1 > 1 by A5,NAT_1:13;
        then
A11:    inf divset(MD1,i+1)=MD1.(i+1-1) & sup divset(MD1,i+1)=MD1. (i+1)
        by A8,INTEGRA1:def 5;
        then
A12:    inf divset(MD1,i+1) = inf A by A1,A10,FINSEQ_1:58;
        MD1.(i+1) = MD1.(i+len <*inf A*>) by FINSEQ_1:57
          .= D1.i by A1,A6,FINSEQ_1:def 7;
        hence thesis by A6,A10,A11,A12,INTEGRA1:def 5;
      end;
      suppose
A13:    i<>1;
A14:    i+1 > 1 by A5,NAT_1:13;
A15:    i-1 in dom D1 by A6,A13,INTEGRA1:9;
        D1.(i-1) = MD1.(i-1+len <*inf A*>) by A1,A15,FINSEQ_1:def 7
          .=MD1.(i-1+1) by FINSEQ_1:56
          .=MD1.(i+1-1);
        then
A16:    inf divset(D1,i)=MD1.(i+1-1) by A6,A13,INTEGRA1:def 5
          .=inf divset(MD1,i+1) by A8,A14,INTEGRA1:def 5;
        MD1.(i+1) = MD1.(i+len <*inf A*>) by FINSEQ_1:57
          .= D1.i by A1,A6,FINSEQ_1:def 7;
        then sup divset(MD1,i+1)=D1.i by A8,A14,INTEGRA1:def 5
          .= sup divset(D1,i) by A6,A13,INTEGRA1:def 5;
        hence thesis by A16;
      end;
    end;
    hence thesis by A9,INTEGRA1:5;
  end;
  thus upper_volume(f,D1)=upper_volume(f,MD1)/^1
  proof
    set D2 = D1, MD2 = MD1;
A17: len upper_volume(f,D2)=len (upper_volume(f,MD2)/^1)
    proof
      rng upper_volume(f,MD2) <> {};
      then 1 in dom upper_volume(f,MD2) by FINSEQ_3:34;
      then 1 <= len upper_volume(f,MD2) by FINSEQ_3:27;
      then len (upper_volume(f,MD2)/^1)=len upper_volume(f,MD2)-1 by
      RFINSEQ:def 2
        .=len MD2 -1 by INTEGRA1:def 7
        .=len D2 by A2;
      hence thesis by INTEGRA1:def 7;
    end;
    for k be Nat holds 1 <= k & k <= len upper_volume(f,D2) implies
    upper_volume(f,D2).k = (upper_volume(f,MD2)/^1).k
    proof
      let k be Nat;
      assume
A18:  1 <= k & k <= len upper_volume(f,D2);
      then k in Seg len upper_volume(f,D2) by FINSEQ_1:3;
      then
A19:  k in Seg len D2 by INTEGRA1:def 7;
      then k in dom D2 by FINSEQ_1:def 3;
      then
A20:  upper_volume(f,D2).k=(sup rng(f|divset(D2,k)))*vol(divset(D2,k ))
      by INTEGRA1:def 7
        .=(sup rng(f|divset(MD2,k+1)))*vol(divset(D2,k))
      by A3,A19
        .=(sup rng(f|divset(MD2,k+1)))*vol(divset(MD2,k+1)) by A3,A19;
A21:  1 <= k+1 by NAT_1:11;
      k+1 <= len upper_volume(f,D2)+1 by A18,XREAL_1:8;
      then k+1 <= len D2+1 by INTEGRA1:def 7;
      then
A22:  k+1 in Seg len MD2 by A2,A21,FINSEQ_1:3;
B22:  k+1 in dom MD2 by A22,FINSEQ_1:def 3;
A23:  k in dom (upper_volume(f,MD2)/^1) by A17,A18,FINSEQ_3:27;
A24:  len (upper_volume(f,MD2)/^1) <= len upper_volume(f,MD2) by FINSEQ_5:28;
      1 <= len upper_volume(f,D2) by A18,XXREAL_0:2;
      then 1 <= len upper_volume(f,MD2) by A17,A24,XXREAL_0:2;
      then (upper_volume(f,MD2)/^1).k=upper_volume(f,MD2).(k+1) by A23,
      RFINSEQ:def 2
        .=(sup rng(f|divset(MD2,k+1)))*vol(divset(MD2,k+1))
      by INTEGRA1:def 7,B22;
      hence thesis by A20;
    end;
    hence thesis by A17,FINSEQ_1:18;
  end;
A25: len lower_volume(f,D1)=len (lower_volume(f,MD1)/^1)
  proof
    rng lower_volume(f,MD1) <> {};
    then 1 in dom lower_volume(f,MD1) by FINSEQ_3:34;
    then 1 <= len lower_volume(f,MD1) by FINSEQ_3:27;
    then len (lower_volume(f,MD1)/^1)=len lower_volume(f,MD1)-1 by
    RFINSEQ:def 2
      .=len MD1 -1 by INTEGRA1:def 8
      .=len D1 by A2;
    hence thesis by INTEGRA1:def 8;
  end;
  for k be Nat holds 1 <= k & k <= len lower_volume(f,D1) implies
  lower_volume(f,D1).k = (lower_volume(f,MD1)/^1).k
  proof
    let k be Nat;
    assume
A26: 1 <= k & k <= len lower_volume(f,D1);
    then k in Seg len lower_volume(f,D1) by FINSEQ_1:3;
    then
A27: k in Seg len D1 by INTEGRA1:def 8;
    then k in dom D1 by FINSEQ_1:def 3;
    then
A28: lower_volume(f,D1).k=(inf rng(f|divset(D1,k)))*vol(divset(D1,k))
    by INTEGRA1:def 8
      .=(inf rng(f|divset(MD1,k+1)))*vol(divset(D1,k))
    by A3,A27
      .=(inf rng(f|divset(MD1,k+1)))*vol(divset(MD1,k+1)) by A3,A27;
A29: 1 <= k+1 by NAT_1:11;
A30: len MD1=len <*inf A*>+len D1 by A1,FINSEQ_1:35
      .=len D1 + 1 by FINSEQ_1:56;
    k+1 <= len lower_volume(f,D1)+1 by A26,XREAL_1:8;
    then k+1 <= len D1+1 by INTEGRA1:def 8;
    then
A31: k+1 in Seg len MD1 by A29,A30,FINSEQ_1:3;
B31: k+1 in dom MD1 by A31,FINSEQ_1:def 3;
A32: k in dom (lower_volume(f,MD1)/^1) by A25,A26,FINSEQ_3:27;
A33: len (lower_volume(f,MD1)/^1) <= len lower_volume(f,MD1) by FINSEQ_5:28;
    1 <= len (lower_volume(f,MD1)/^1) by A25,A26,XXREAL_0:2;
    then 1 <= len lower_volume(f,MD1) by A33,XXREAL_0:2;
    then (lower_volume(f,MD1)/^1).k=lower_volume(f,MD1).(k+1) by A32,
    RFINSEQ:def 2
      .=(inf rng(f|divset(MD1,k+1)))*vol(divset(MD1,k+1))
    by INTEGRA1:def 8,B31;
    hence thesis by A28;
  end;
  hence thesis by A25,FINSEQ_1:18;
end;

Lm12: for A be closed-interval Subset of REAL, D2, MD2 being Element of divs A
st MD2 = <*inf A*>^D2 holds vol(divset(MD2,1))=0
proof
  let A be closed-interval Subset of REAL, D2,MD2 be Element of divs A;
  assume
A1: MD2 = <*inf A*>^D2;
  rng MD2 <> {};
  then 1 in dom MD2 by FINSEQ_3:34;
  then inf divset(MD2,1) = inf A & sup divset(MD2,1) = MD2.1 by
  INTEGRA1:def 5;
  then vol(divset(MD2,1)) = MD2.1 - inf A by INTEGRA1:def 6
    .=inf A-inf A
  by A1,FINSEQ_1:58;
  hence thesis;
end;

Lm13: for A be closed-interval Subset of REAL, f be Function of A,REAL,
D1,MD1 be Element of divs A st MD1 = <*inf A*>^D1 holds delta(MD1)=delta(D1)
proof
  let A be closed-interval Subset of REAL, f be Function of A,REAL,
  D1,MD1 be Element of divs A;
  assume
A1: MD1 = <*inf A*>^D1;
  then
A2: vol(divset(MD1,1))=0 by Lm12;
A3: delta(D1)=max rng upper_volume(chi(A,A),D1) by INTEGRA1:def 19;
  then delta(D1) in rng upper_volume(chi(A,A),D1)
  & for x st x in rng upper_volume(chi(A,A),D1) holds x <= delta(D1)
  by XXREAL_2:def 8;
  then consider i such that
A4: i in dom upper_volume(chi(A,A),D1) & upper_volume(chi(A,A),D1).i=delta(D1)
  by PARTFUN1:26;
A5: delta(MD1)=max rng upper_volume(chi(A,A),MD1) by INTEGRA1:def 19;
  then delta(MD1) in rng upper_volume(chi(A,A),MD1)
  &for x st x in rng upper_volume(chi(A,A),MD1) holds x <= delta(MD1)
  by XXREAL_2:def 8;
  then consider j such that
A6: j in dom upper_volume(chi(A,A),MD1)&upper_volume(chi(A,A),MD1).j=delta(MD1
  ) by PARTFUN1:26;
  i in Seg len upper_volume(chi(A,A),D1) by A4,FINSEQ_1:def 3;
  then
A7: i in Seg len D1 by INTEGRA1:def 7;
  then i in dom D1 by FINSEQ_1:def 3;
  then
A8: delta(D1)=(sup rng (chi(A,A)|divset(D1,i)))*vol(divset(D1,i))
  by A4,INTEGRA1:def 7
    .=(sup rng(chi(A,A)|divset(MD1,i+1)))*vol(divset(D1,i)) by A1,A7,Lm11
    .=(sup rng (chi(A,A)|divset(MD1,i+1)))*vol(divset(MD1,i+1)) by A1,A7,Lm11;
  i in dom D1 by A7,FINSEQ_1:def 3;
  then len <*inf A*>+i in dom MD1 by A1,FINSEQ_1:41;
  then i+1 in dom MD1 by FINSEQ_1:56;
  then
A9: i+1 in Seg len MD1 by FINSEQ_1:def 3;
  then i+1 in dom MD1 by FINSEQ_1:def 3;
  then
A10: delta(D1)=upper_volume(chi(A,A),MD1).(i+1) by A8,INTEGRA1:def 7;
  i+1 in Seg len upper_volume(chi(A,A),MD1) by A9,INTEGRA1:def 7;
  then i+1 in dom upper_volume(chi(A,A),MD1) by FINSEQ_1:def 3;
  then delta(D1) in rng upper_volume(chi(A,A),MD1) by A10,FUNCT_1:def 5;
  then
A11: delta(D1) <= delta(MD1) by A5,XXREAL_2:def 8;
  j in Seg len upper_volume(chi(A,A),MD1) by A6,FINSEQ_1:def 3;
  then
A12: j in Seg len MD1 by INTEGRA1:def 7;
  then
B12:   j in dom MD1 by FINSEQ_1:def 3;
  then
A13: delta(MD1)=(sup rng(chi(A,A)|divset(MD1,j)))*vol(divset(MD1,j))
  by A6,INTEGRA1:def 7;
  delta(MD1) <= delta(D1)
  proof
    per cases;
    suppose j=1;
      hence thesis by A2,A13,Th8;
    end;
    suppose j<>1;
      then not(j in Seg 1) by FINSEQ_1:4,TARSKI:def 1;
      then not(j in Seg len <*inf A*>) by FINSEQ_1:56;
      then
A14:  not(j in dom <*inf A*>) by FINSEQ_1:def 3;
      j in dom MD1 by A12,FINSEQ_1:def 3;
      then consider k be Nat such that
A15:  k in dom D1 & j=len <*inf A*>+k by A1,A14,FINSEQ_1:38;
A16:  k in Seg len D1 by A15,FINSEQ_1:def 3;
  then
B16:  k in dom D1 by FINSEQ_1:def 3;
      divset(D1,k)=divset(MD1,k+1) by A1,Lm11,A16
        .=divset(MD1,j) by A15,FINSEQ_1:56;
      then delta(MD1) = (sup rng(chi(A,A)|divset(D1,k)))*vol(divset(D1,k))
      by A6,INTEGRA1:def 7,B12;
      then
A17:  delta(MD1)=upper_volume(chi(A,A),D1).k by INTEGRA1:def 7,B16;
      k in Seg len upper_volume(chi(A,A),D1) by A16,INTEGRA1:def 7;
      then k in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
      then delta(MD1) in rng upper_volume(chi(A,A),D1) by A17,FUNCT_1:def 5;
      hence thesis by A3,XXREAL_2:def 8;
    end;
  end;
  hence thesis by A11,XXREAL_0:1;
end;

theorem Th12:
  for A be closed-interval Subset of REAL, f be Function of A,REAL,
  D1,D2 be Element of divs A st x in divset(D1,len D1) & vol(A)<>0
  & D1<=D2 & rng D2 = rng D1 \/ {x} & f is_bounded_on A & x > inf A
  holds Sum lower_volume(f,D2)-Sum
  lower_volume(f,D1)<=(sup rng f-inf rng f)*delta(D1)
proof
  let A be closed-interval Subset of REAL;
  let f be Function of A,REAL;
  let D1,D2 be Element of divs A;
  assume that
A1: x in divset(D1,len D1) and
A2: vol(A)<>0 and
A3: D1 <= D2 and
A4: rng D2 = rng D1 \/ {x} and
A5: f is_bounded_on A and
A6: x > inf A;
  len D1 <> 0 by CARD_2:59;
  then len D1 in Seg len D1 by FINSEQ_1:5;
  then
A7: 1 <= len D1 by FINSEQ_1:3;
  then len D1 = 1 or len D1 > 1 by REAL_1:def 5;
  then
A8: len D1 = 1 or len D1 >= 1+1 by NAT_1:13;
  now per cases by A8;
    suppose
A9:   len D1 = 1;
      then
A10:  D1.1=sup A by INTEGRA1:def 2;
      vol(A) >= 0 by INTEGRA1:11;
      then D1.1 - inf A > 0 by A2,A10,INTEGRA1:def 6;
      then
A11:  inf A < D1.1 by REAL_2:106;
      reconsider MD1 = <*inf A*>^D1
      as non empty increasing FinSequence of REAL by A2,A9,Lm9;
      MD1 is DivisionPoint of A
      proof
        y in rng MD1 implies y in A
        proof
          assume y in rng MD1;
          then
A12:      y in rng <*inf A*> \/ rng D1 by FINSEQ_1:44;
          per cases by A12,XBOOLE_0:def 2;
          suppose y in rng <*inf A*>;
            then y in {inf A} by FINSEQ_1:55;
            then
A13:        y = inf A by TARSKI:def 1;
            consider a,b such that
A14:        a <= b & a = inf A & b = sup A by INTEGRA1:4;
            thus thesis by A13,A14,INTEGRA2:1;
          end;
          suppose
A15:        y in rng D1;
            rng D1 c= A by INTEGRA1:def 2;
            hence thesis by A15;
          end;
        end;
        then
A16:    rng MD1 c= A by SUBSET_1:7;
        MD1.(len MD1) = sup A
        proof
A17:      len MD1 = len <*inf A*> + len D1 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D1 by A7,XREAL_1:8;
          then MD1.(len MD1)=D1.(len <*inf A*>+len D1-len <*inf A*>) by A17,
          FINSEQ_1:36
            .=D1.(len D1);
          hence thesis by INTEGRA1:def 2;
        end;
        hence thesis by A16,INTEGRA1:def 2;
      end;
      then reconsider MD1 as Element of divs A by INTEGRA1:def 4;
      rng D2 <> {};
      then
A18:  1 in dom D2 by FINSEQ_3:34;
      then
A19:  1 <= len D2 by FINSEQ_3:27;
A20:  D2.1 in rng D2 by A18,FUNCT_1:def 5;
A21:  inf A < D2.1
      proof
        per cases by A4,A20,XBOOLE_0:def 2;
        suppose D2.1 in rng D1;
          then consider k such that
A22:      k in dom D1 & D1.k = D2.1 by PARTFUN1:26;
A23:      1 <= k & k <= len D1 by A22,FINSEQ_3:27;
          rng D1 <> {};
          then 1 in dom D1 by FINSEQ_3:34;
          then D1.1 <= D2.1 by A22,A23,GOBOARD2:18;
          hence thesis by A11,XXREAL_0:2;
        end;
        suppose D2.1 in {x};
          hence thesis by A6,TARSKI:def 1;
        end;
      end;
      set MD2=<*inf A*>^D2;
      reconsider MD2 as non empty increasing FinSequence of REAL by A21,Lm10;
      MD2 is DivisionPoint of A
      proof
        y in rng MD2 implies y in A
        proof
          assume y in rng MD2;
          then
A24:      y in rng <*inf A*> \/ rng D2 by FINSEQ_1:44;
          per cases by A24,XBOOLE_0:def 2;
          suppose y in rng <*inf A*>;
            then y in {inf A} by FINSEQ_1:55;
            then
A25:        y = inf A by TARSKI:def 1;
            consider a,b such that
A26:        a <= b & a = inf A & b = sup A by INTEGRA1:4;
            thus thesis by A25,A26,INTEGRA2:1;
          end;
          suppose
A27:        y in rng D2;
            rng D2 c= A by INTEGRA1:def 2;
            hence thesis by A27;
          end;
        end;
        then
A28:    rng MD2 c= A by SUBSET_1:7;
        MD2.(len MD2) = sup A
        proof
A29:      len MD2 = len <*inf A*> + len D2 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D2 by A19,XREAL_1:8;
          then MD2.(len MD2)=D2.(len <*inf A*>+len D2-len <*inf A*>) by A29,
          FINSEQ_1:36
            .=D2.(len D2);
          hence thesis by INTEGRA1:def 2;
        end;
        hence thesis by A28,INTEGRA1:def 2;
      end;
      then reconsider MD2 as Element of divs A by INTEGRA1:def 4;
A30:  len MD1=len <*inf A*> + len D1 by FINSEQ_1:35
        .= 1+len D1 by FINSEQ_1:56;
A31:  1+len D1 >= 1+1 by A7,XREAL_1:8;
A32:  x in divset(MD1,len MD1)
      proof
A33:    inf
        divset(D1,len D1) <= x & x <= sup divset(D1,len D1) by A1,INTEGRA2:1;
A34:    len D1 in dom D1 by FINSEQ_5:6;
A35:    len MD1 in dom MD1 by FINSEQ_5:6;
A36:    len MD1 <> 1 by A30,A31;
        len MD1 - 1 =len D1 by A30;
        then inf divset(MD1,len MD1) = MD1.(len D1) by A35,A36,INTEGRA1:def 5
          .=inf A by A9,FINSEQ_1:58;
        then
A37:    inf divset(D1,len D1) = inf divset(MD1,len MD1) by A9,A34,
        INTEGRA1:def 5;
        MD1.(len MD1) = MD1.(len <*inf A*> + len D1) by FINSEQ_1:35
          .=D1.(len D1) by A34,FINSEQ_1:def 7;
        then sup divset(MD1,len MD1)=D1.(len D1) by A35,A36,INTEGRA1:def 5
          .= sup divset(D1,len D1) by A9,A34,INTEGRA1:def 5;
        hence thesis by A33,A37,INTEGRA2:1;
      end;
A38:  MD1<=MD2
      proof
A39:    len D1 <= len D2 & rng D1 c= rng D2 by A3,INTEGRA1:def 20;
        then len D1+len <*inf A*> <= len D2+len <*inf A*> by XREAL_1:8;
        then len MD1 <= len D2+len <*inf A*> by FINSEQ_1:35;
        then
A40:    len MD1 <= len MD2 by FINSEQ_1:35;
        rng D1 \/ rng<*inf A*> c= rng D2 \/ rng <*inf A*> by A39,XBOOLE_1:9;
        then rng MD1 c= rng D2 \/ rng <*inf A*> by FINSEQ_1:44;
        then rng MD1 c= rng MD2 by FINSEQ_1:44;
        hence thesis by A40,INTEGRA1:def 20;
      end;
      rng MD2 = rng D2 \/ rng <*inf A*> by FINSEQ_1:44
        .=rng D1 \/ rng <*inf A*> \/ {x} by A4,XBOOLE_1:4;
      then rng MD2 = rng MD1 \/ {x} by FINSEQ_1:44;
      then
A41:  Sum lower_volume(f,MD2)-Sum
      lower_volume(f,MD1)<=(sup rng f-inf rng f)*delta(MD1)
      by A5,A30,A31,A32,A38,Th9;
A42:  vol(divset(MD1,1))=0 by Lm12;
      lower_volume(f,D1)=lower_volume(f,MD1)/^1 by Lm11;
      then lower_volume(f,MD1)=<*(lower_volume(f,MD1))/.1*>^lower_volume(f,D1)
      by FINSEQ_5:32;
      then
A43:  Sum lower_volume(f,MD1)=((lower_volume(f,MD1))/.1)+Sum lower_volume(f,
      D1) by RVSUM_1:106;
      rng MD1 <> {};
      then 1 in dom MD1 by FINSEQ_3:34;
      then
A44:  1 in Seg len MD1 by FINSEQ_1:def 3;
  then 1 in dom MD1 by FINSEQ_1:def 3;
      then
A45:  lower_volume(f,MD1).1 = (inf rng(f|divset(MD1,1)))*vol(divset( MD1,1))
      by INTEGRA1:def 8;
      1 in Seg len lower_volume(f,MD1) by A44,INTEGRA1:def 8;
      then 1 in dom lower_volume(f,MD1) by FINSEQ_1:def 3;
      then
A46:  lower_volume(f,MD1)/.1 = 0 by A42,A45,PARTFUN1:def 8;
A47:  vol(divset(MD2,1))=0 by Lm12;
      lower_volume(f,D2)=lower_volume(f,MD2)/^1 by Lm11;
      then lower_volume(f,MD2)=<*(lower_volume(f,MD2))/.1*>^lower_volume(f,D2)
      by FINSEQ_5:32;
      then
A48:  Sum lower_volume(f,MD2)=(lower_volume(f,MD2))/.1+Sum lower_volume(f,D2 )
      by RVSUM_1:106;
      rng MD2 <> {};
      then 1 in dom MD2 by FINSEQ_3:34;
      then
A49:  1 in Seg len MD2 by FINSEQ_1:def 3;
  then 1 in dom MD2 by FINSEQ_1:def 3;
      then
A50:  lower_volume(f,MD2).1 = (inf rng(f|divset(MD2,1)))*vol(divset( MD2,1))
      by INTEGRA1:def 8;
      1 in Seg len lower_volume(f,MD2) by A49,INTEGRA1:def 8;
      then 1 in dom lower_volume(f,MD2) by FINSEQ_1:def 3;
      then lower_volume(f,MD2)/.1 = 0 by A47,A50,PARTFUN1:def 8;
      hence Sum lower_volume(f,D2)-Sum lower_volume(f,D1)<=
      (sup rng f-inf rng f)*delta(D1) by A41,A43,A46,A48,Lm13;
    end;
    suppose len D1 >= 2;
      hence thesis by A1,A3,A4,A5,Th9;
    end;
  end;
  hence thesis;
end;

theorem Th13:
  for A be closed-interval Subset of REAL, f be Function of A,REAL,
  D1,D2 be Element of divs A st x in divset(D1,len D1) & vol(A)<>0
  & D1<=D2 & rng D2 = rng D1 \/ {x} & f is_bounded_on A & x > inf A
  holds Sum upper_volume(f,D1)-Sum
  upper_volume(f,D2)<=(sup rng f-inf rng f)*delta(D1)
proof
  let A be closed-interval Subset of REAL;
  let f be Function of A,REAL;
  let D1,D2 be Element of divs A;
  assume that
A1: x in divset(D1,len D1) and
A2: vol(A)<>0 and
A3: D1 <= D2 and
A4: rng D2 = rng D1 \/ {x} and
A5: f is_bounded_on A and
A6: x > inf A;
  len D1 <> 0 by CARD_2:59;
  then len D1 in Seg len D1 by FINSEQ_1:5;
  then
A7: 1 <= len D1 by FINSEQ_1:3;
  then len D1 = 1 or len D1 > 1 by REAL_1:def 5;
  then
A8: len D1 = 1 or len D1 >= 1+1 by NAT_1:13;
  now per cases by A8;
    suppose
A9:   len D1 = 1;
      then
A10:  D1.1=sup A by INTEGRA1:def 2;
      vol(A) >= 0 by INTEGRA1:11;
      then D1.1 - inf A > 0 by A2,A10,INTEGRA1:def 6;
      then
A11:  inf A < D1.1 by REAL_2:106;
      reconsider MD1 = <*inf A*>^D1 as non empty increasing FinSequence of REAL
      by A2,A9,Lm9;
      MD1 is DivisionPoint of A
      proof
        y in rng MD1 implies y in A
        proof
          assume y in rng MD1;
          then
A12:      y in rng <*inf A*> \/ rng D1 by FINSEQ_1:44;
          per cases by A12,XBOOLE_0:def 2;
          suppose y in rng <*inf A*>;
            then y in {inf A} by FINSEQ_1:55;
            then
A13:        y = inf A by TARSKI:def 1;
            consider a,b such that
A14:        a <= b & a = inf A & b = sup A by INTEGRA1:4;
            thus thesis by A13,A14,INTEGRA2:1;
          end;
          suppose
A15:        y in rng D1;
            rng D1 c= A by INTEGRA1:def 2;
            hence thesis by A15;
          end;
        end;
        then
A16:    rng MD1 c= A by SUBSET_1:7;
        MD1.(len MD1) = sup A
        proof
A17:      len MD1 = len <*inf A*> + len D1 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D1 by A7,XREAL_1:8;
          then MD1.(len MD1)=D1.(len <*inf A*>+len D1-len <*inf A*>) by A17,
          FINSEQ_1:36
            .=D1.(len D1);
          hence thesis by INTEGRA1:def 2;
        end;
        hence thesis by A16,INTEGRA1:def 2;
      end;
      then reconsider MD1 as Element of divs A by INTEGRA1:def 4;
      rng D2 <> {};
      then
A18:  1 in dom D2 by FINSEQ_3:34;
      then
A19:  1 <= len D2 by FINSEQ_3:27;
A20:  D2.1 in rng D2 by A18,FUNCT_1:def 5;
A21:  inf A < D2.1
      proof
        per cases by A4,A20,XBOOLE_0:def 2;
        suppose D2.1 in rng D1;
          then consider k such that
A22:      k in dom D1 & D1.k = D2.1 by PARTFUN1:26;
A23:      1 <= k & k <= len D1 by A22,FINSEQ_3:27;
          rng D1 <> {};
          then 1 in dom D1 by FINSEQ_3:34;
          then D1.1 <= D2.1 by A22,A23,GOBOARD2:18;
          hence thesis by A11,XXREAL_0:2;
        end;
        suppose D2.1 in {x};
          hence thesis by A6,TARSKI:def 1;
        end;
      end;
      set MD2=<*inf A*>^D2;
      reconsider MD2 as non empty increasing FinSequence of REAL by A21,Lm10;
      MD2 is DivisionPoint of A
      proof
        y in rng MD2 implies y in A
        proof
          assume y in rng MD2;
          then
A24:      y in rng <*inf A*> \/ rng D2 by FINSEQ_1:44;
          per cases by A24,XBOOLE_0:def 2;
          suppose y in rng <*inf A*>;
            then y in {inf A} by FINSEQ_1:55;
            then
A25:        y = inf A by TARSKI:def 1;
            consider a,b such that
A26:        a <= b & a = inf A & b = sup A by INTEGRA1:4;
            thus thesis by A25,A26,INTEGRA2:1;
          end;
          suppose
A27:        y in rng D2;
            rng D2 c= A by INTEGRA1:def 2;
            hence thesis by A27;
          end;
        end;
        then
A28:    rng MD2 c= A by SUBSET_1:7;
        MD2.(len MD2) = sup A
        proof
A29:      len MD2 = len <*inf A*> + len D2 by FINSEQ_1:35;
          len <*inf A*> + 1 <= len <*inf A*> + len D2 by A19,XREAL_1:8;
          then MD2.(len MD2)=D2.(len <*inf A*>+len D2-len <*inf A*>) by A29,
          FINSEQ_1:36
            .=D2.(len D2);
          hence thesis by INTEGRA1:def 2;
        end;
        hence thesis by A28,INTEGRA1:def 2;
      end;
      then reconsider MD2 as Element of divs A by INTEGRA1:def 4;
A30:  len MD1=len <*inf A*> + len D1 by FINSEQ_1:35
        .= 1+len D1 by FINSEQ_1:56;
A31:  1+len D1 >= 1+1 by A7,XREAL_1:8;
A32:  x in divset(MD1,len MD1)
      proof
A33:    inf
        divset(D1,len D1) <= x & x <= sup divset(D1,len D1) by A1,INTEGRA2:1;
A34:    len D1 in dom D1 by FINSEQ_5:6;
A35:    len MD1 in dom MD1 by FINSEQ_5:6;
A36:    len MD1 <> 1 by A30,A31;
        len MD1 - 1 = len D1 by A30;
        then inf divset(MD1,len MD1) = MD1.(len D1) by A35,A36,INTEGRA1:def 5
          .=inf A by A9,FINSEQ_1:58;
        then
A37:    inf divset(D1,len D1) = inf divset(MD1,len MD1) by A9,A34,
        INTEGRA1:def 5;
        MD1.(len MD1) = MD1.(len <*inf A*> + len D1) by FINSEQ_1:35
          .=D1.(len D1) by A34,FINSEQ_1:def 7;
        then sup divset(MD1,len MD1)=D1.(len D1) by A35,A36,INTEGRA1:def 5
          .= sup divset(D1,len D1) by A9,A34,INTEGRA1:def 5;
        hence thesis by A33,A37,INTEGRA2:1;
      end;
A38:  MD1<=MD2
      proof
A39:    len D1 <= len D2 & rng D1 c= rng D2 by A3,INTEGRA1:def 20;
        then len D1+len <*inf A*> <= len D2+len <*inf A*> by XREAL_1:8;
        then len MD1 <= len D2+len <*inf A*> by FINSEQ_1:35;
        then
A40:    len MD1 <= len MD2 by FINSEQ_1:35;
        rng D1 \/ rng<*inf A*> c= rng D2 \/ rng <*inf A*> by A39,XBOOLE_1:9;
        then rng MD1 c= rng D2 \/ rng <*inf A*> by FINSEQ_1:44;
        then rng MD1 c= rng MD2 by FINSEQ_1:44;
        hence thesis by A40,INTEGRA1:def 20;
      end;
      rng MD2 = rng MD1 \/ {x}
      proof
        rng MD2 = rng D2 \/ rng <*inf A*> by FINSEQ_1:44
          .=rng D1 \/ rng <*inf A*> \/ {x} by A4,XBOOLE_1:4;
        hence thesis by FINSEQ_1:44;
      end;
      then
A41:  Sum upper_volume(f,MD1)-Sum upper_volume(f,MD2)
      <=(sup rng f-inf rng f)*delta(MD1) by A5,A30,A31,A32,A38,Th10;
A42:  vol(divset(MD1,1))=0 by Lm12;
      upper_volume(f,D1)=upper_volume(f,MD1)/^1 by Lm11;
      then upper_volume(f,MD1)=<*upper_volume(f,MD1)/.1*>^upper_volume(f,D1)
      by FINSEQ_5:32;
      then
A43:  Sum upper_volume(f,MD1)=(upper_volume(f,MD1)/.1)+Sum upper_volume(f,D1 )
      by RVSUM_1:106;
      rng MD1 <> {};
      then 1 in dom MD1 by FINSEQ_3:34;
      then
A44:  1 in Seg len MD1 by FINSEQ_1:def 3;
  then 1 in dom MD1 by FINSEQ_1:def 3;
      then
A45:  upper_volume(f,MD1).1 = (sup rng(f|divset(MD1,1)))*vol(divset( MD1,1))
      by INTEGRA1:def 7;
      1 in Seg len upper_volume(f,MD1) by A44,INTEGRA1:def 7;
      then 1 in dom upper_volume(f,MD1) by FINSEQ_1:def 3;
      then
A46:  upper_volume(f,MD1)/.1 = 0 by A42,A45,PARTFUN1:def 8;
A47:  vol(divset(MD2,1))=0 by Lm12;
      upper_volume(f,D2)=upper_volume(f,MD2)/^1 by Lm11;
      then upper_volume(f,MD2)=<*upper_volume(f,MD2)/.1*>^upper_volume(f,D2)
      by FINSEQ_5:32;
      then
A48:  Sum upper_volume(f,MD2)=(upper_volume(f,MD2)/.1)+Sum upper_volume(f,D2 )
      by RVSUM_1:106;
      rng MD2 <> {};
      then 1 in dom MD2 by FINSEQ_3:34;
      then
A49:  1 in Seg len MD2 by FINSEQ_1:def 3;
  then 1 in dom MD2 by FINSEQ_1:def 3;
      then
A50:  upper_volume(f,MD2).1 = (sup rng(f|divset(MD2,1)))*vol(divset( MD2,1))
      by INTEGRA1:def 7;
      1 in Seg len upper_volume(f,MD2) by A49,INTEGRA1:def 7;
      then 1 in dom upper_volume(f,MD2) by FINSEQ_1:def 3;
      then upper_volume(f,MD2)/.1 = 0 by A47,A50,PARTFUN1:def 8;
      hence Sum upper_volume(f,D1)-Sum upper_volume(f,D2)<=
      (sup rng f-inf rng f)*delta(D1) by A41,A43,A46,A48,Lm13;
    end;
    suppose len D1 >= 2;
      hence thesis by A1,A3,A4,A5,Th10;
    end;
  end;
  hence thesis;
end;

theorem Th14:
  for A be closed-interval Subset of REAL, D1,D2 be Element of divs A,

r be Real, i,j be Element of NAT st i in dom D1 & j in dom D1 & i<=j & D1 <= D2
  & r < mid(D2,indx(D2,D1,i),indx(D2,D1,j)).1
  holds ex B be closed-interval Subset of REAL, MD1,MD2 be Element of divs B
  st r=inf B & sup B=MD2.(len MD2) & sup B=MD1.(len MD1) & MD1 <= MD2
  & MD1=mid(D1,i,j) & MD2=mid(D2,indx(D2,D1,i),indx(D2,D1,j))
proof
  let A be closed-interval Subset of REAL;
  let D1,D2 be Element of divs A;
  let r be Real;
  let i,j;
  assume
A1: i in dom D1;
  assume
A2: j in dom D1;
  assume
A3: i <= j;
  assume
A4: D1 <= D2;
  assume
A5: r < mid(D2,indx(D2,D1,i),indx(D2,D1,j)).1;
  set MD1=mid(D1,i,j);
  set MD2=mid(D2,indx(D2,D1,i),indx(D2,D1,j));
A6: indx(D2,D1,i) in dom D2 & D2.indx(D2,D1,i)=D1.i by A1,A4,INTEGRA1:def 21;
A7: indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.j by A2,A4,INTEGRA1:def 21;
  D1.i <= D1.j by A1,A2,A3,GOBOARD2:18;
  then
A8: indx(D2,D1,i) <= indx(D2,D1,j) by A6,A7,GOBOARD1:def 1;
  then consider B being closed-interval Subset of REAL such that
A9: r = inf B & sup B=MD2.(len MD2) & len MD2=indx(D2,D1,j)-indx(D2,D1,i)+1
  &MD2 is DivisionPoint of B by A5,A6,A7,Th11;
  reconsider MD2 as Element of divs B by A9,INTEGRA1:def 3;
  indx(D2,D1,j)-indx(D2,D1,i) >= 0 by A8,XREAL_1:50;
  then
A10: indx(D2,D1,j)-indx(D2,D1,i)+1 >= 0+1 by XREAL_1:8;
A11: 1 <= indx(D2,D1,i) & indx(D2,D1,j) <= len D2 by A6,A7,FINSEQ_3:27;
  then
A12: MD2.1=D2.(1+indx(D2,D1,i)-1) by A8,A10,JORDAN3:31
    .=D1.i by A1,A4,INTEGRA1:def 21;
  j-i >= 0 by A3,XREAL_1:50;
  then
A13: j-i+1 >= 0+1 by XREAL_1:8;
A14: 1 <= i & j <= len D1 by A1,A2,FINSEQ_3:27;
  then
A15: MD1.1 = D1.(1+i-1) by A3,A13,JORDAN3:31
    .= D1.i;
  then consider C being closed-interval Subset of REAL such that
A16: r = inf C & sup C=MD1.(len MD1) & len MD1=j-i+1
  &MD1 is DivisionPoint of C by A1,A2,A3,A5,A12,Th11;
A17: MD1.(len MD1)=D1.(j-i+1-1+i) by A3,A13,A14,A16,JORDAN3:31
    .=D1.j;
A18: MD2.(len MD2)=D2.(indx(D2,D1,j)-indx(D2,D1,i)+1-1+indx(D2,D1,i))
  by A8,A9,A10,A11,JORDAN3:31
    .= D1.j by A2,A4,INTEGRA1:def 21;
A19: B=[.inf B,sup B.] by INTEGRA1:5
    .=C by A9,A16,A17,A18,INTEGRA1:5;
  then reconsider MD1 as Element of divs B by A16,INTEGRA1:def 3;
A20: rng MD1 c= rng MD2
  proof
A21: rng MD1 c= rng D1 by JORDAN3:28;
    rng D1 c= rng D2 by A4,INTEGRA1:def 20;
    then
A22: rng MD1 c= rng D2 by A21,XBOOLE_1:1;
    let x1;
    assume
A23: x1 in rng MD1;
    then consider k2 being Element of NAT such that
A24: k2 in dom D2 & D2.k2=x1 by A22,PARTFUN1:26;
    consider k1 being Element of NAT such that
A25: k1 in dom MD1 & MD1.k1=x1 by A23,PARTFUN1:26;
A26: 1 <= k1 & k1 <= len MD1 by A25,FINSEQ_3:27;
    then 1 <= len MD1 by XXREAL_0:2;
    then
A27: 1 in dom MD1 by FINSEQ_3:27;
    len MD1 in dom MD1 by FINSEQ_5:6;
    then MD1.1<=MD1.k1 & MD1.k1<=MD1.(len MD1) by A25,A26,A27,GOBOARD2:18;
    then
A28: indx(D2,D1,i) <= k2 & k2 <= indx(D2,D1,j)
    by A6,A7,A15,A17,A24,A25,GOBOARD1:def 1;
    then indx(D2,D1,i)+1<=k2+1 & k2+1<=indx(D2,D1,j)+1 by XREAL_1:8;
    then
A29: 1<=k2+1-indx(D2,D1,i) & k2+1-indx(D2,D1,i)<=indx(D2,D1,j)+1-indx( D2,
    D1,i) by XREAL_1:11,21;
    indx(D2,D1,i) <= k2+1 by A28,NAT_1:12;
    then consider k3 being Nat such that
A30: k2+1 = indx(D2,D1,i)+k3 by NAT_1:10;
    k3 in NAT by ORDINAL1:def 13;
    then
A31: MD2.k3 = D2.(k3+indx(D2,D1,i)-1) by A8,A11,A29,A30,JORDAN3:31;
    k3 in dom MD2 by A9,A29,A30,FINSEQ_3:27;
    hence thesis by A24,A30,A31,FUNCT_1:def 5;
  end;
  len MD1 <= len MD2
  proof
    MD1 is one-to-one & MD2 is one-to-one by JORDAN7:17;
    then card(rng MD1) = len MD1 & card(rng MD2) = len MD2 by FINSEQ_4:77;
    hence thesis by A20,NAT_1:44;
  end;
  then MD1 <= MD2 by A20,INTEGRA1:def 20;
  hence thesis by A9,A16,A19;
end;

theorem Th15:
  for A be closed-interval Subset of REAL, D be Element of divs A
  st x in rng D holds D.1 <= x & x <= D.(len D)
proof
  let A be closed-interval Subset of REAL;
  let D be Element of divs A;
  assume x in rng D;
  then consider i such that
A1: i in dom D & x=D.i by PARTFUN1:26;
A2: 1 <= i & i <= len D by A1,FINSEQ_3:27;
  then 1 <= len D by XXREAL_0:2;
  then 1 in dom D & len D in dom D by FINSEQ_3:27;
  hence thesis by A1,A2,GOBOARD2:18;
end;

theorem Th16:
  for p be FinSequence of REAL, i,j,k st p is increasing & i in dom p
  & j in dom p & k in dom p & p.i <= p.k & p.k <= p.j holds
  p.k in rng mid(p,i,j)
proof
  let p be FinSequence of REAL;
  let i,j,k;
  assume that
A1: p is increasing and
A2: i in dom p and
A3: j in dom p and
A4: k in dom p and
A5: p.i <= p.k and
A6: p.k <= p.j;
A7: 1 <= i & i <= len p by A2,FINSEQ_3:27;
A8: 1 <= j & j <= len p by A3,FINSEQ_3:27;
A9: i <= k by A1,A2,A4,A5,GOBOARD1:def 1;
A10: k <= j by A1,A3,A4,A6,GOBOARD1:def 1;
  then
A11: i <= j by A9,XXREAL_0:2;
  then len mid(p,i,j) = j-'i+1 by A7,A8,JORDAN3:27;
  then
A12: len mid(p,i,j) = j-i+1 by A9,A10,BINARITH:50,XXREAL_0:2;
  i <= k+1 by A9,NAT_1:12;
  then consider n being Nat such that
A13: k+1=i+n by NAT_1:10;
  k-i >= 0 by A9,XREAL_1:50;
  then
A14: k-i+1 >= 0+1 by XREAL_1:8;
  k-i <= j-i by A10,XREAL_1:11;
  then
A15: k-i+1 <= j-i+1 by XREAL_1:8;
  then
A16: n in dom mid(p,i,j) by A12,A13,A14,FINSEQ_3:27;
  n in NAT by ORDINAL1:def 13;
  then mid(p,i,j).n = p.(n+i-1) by A7,A8,A11,A13,A14,A15,JORDAN3:31
    .=p.k by A13;
  hence thesis by A16,FUNCT_1:def 5;
end;

theorem Th17:
  for A be closed-interval Subset of REAL, f be Function of A,REAL,
  D be Element of divs A st f is_bounded_on A & i in dom D
  holds inf rng(f|divset(D,i)) <= sup rng f
proof
  let A be closed-interval Subset of REAL;
  let f be Function of A,REAL;
  let D be Element of divs A;
  assume
A1: f is_bounded_on A;
  assume i in dom D;
  then divset(D,i) c= A by INTEGRA1:10;
  hence thesis by A1,Lm5;
end;

theorem Th18:
  for A be closed-interval Subset of REAL, f be Function of A,REAL,
  D be Element of divs A st f is_bounded_on A & i in dom D
  holds sup rng(f|divset(D,i)) >= inf rng f
proof
  let A be closed-interval Subset of REAL;
  let f be Function of A,REAL;
  let D be Element of divs A;
  assume
A1: f is_bounded_on A;
  assume i in dom D;
  then divset(D,i) c= A by INTEGRA1:10;
  hence thesis by A1,Lm5;
end;

begin :: Darboux's Theorem

theorem
  for A be closed-interval Subset of REAL, f be Function of A,REAL,
  T be DivSequence of A
  st f is_bounded_on A & delta(T) is convergent_to_0 & vol(A)<>0
  holds lower_sum(f,T) is convergent & lim lower_sum(f,T) = lower_integral(f)
proof
  let A be closed-interval Subset of REAL;
  let f be Function of A,REAL;
  let T be DivSequence of A;
  assume that
A1: f is_bounded_on A and
A2: delta(T) is convergent_to_0 and
A3: vol(A)<>0;
A4: delta(T) is_not_0 & delta(T) is convergent & lim delta(T) = 0
  by A2,FDIFF_1:def 1;
A5: for e st e>0 ex n st for m st n<=m holds
  0 < (delta(T)).m & (delta(T)).m < e
  proof
    let e;
    assume e>0;
    then consider n such that
A6: for m st n<=m holds abs((delta(T)).m-0)<e by A4,SEQ_2:def 7;
    for m st n<=m holds 0 < (delta(T)).m & (delta(T)).m < e
    proof
      let m;
      assume n<=m;
      then
A7:   abs((delta(T)).m-0)<e by A6;
      (delta(T)).m-0<=abs((delta(T)).m-0) by ABSVALUE:11;
      then
A8:   (delta(T)).m+abs((delta(T)).m-0)<e+abs((delta(T)).m-0) by A7,
      XREAL_1:10;
A9:   (delta(T)).m<>0 by A4,SEQ_1:7;
A10:  (delta(T)).m = delta(T.m) by INTEGRA2:def 3;
      delta(T.m) = max rng upper_volume(chi(A,A),T.m) by INTEGRA1:def 19;
      then delta(T.m) in rng upper_volume(chi(A,A),T.m) by XXREAL_2:def 8;
      then consider i such that
A11:  i in dom upper_volume(chi(A,A),T.m) &
      delta(T.m)=upper_volume(chi(A,A),T.m).i by PARTFUN1:26;
A12:  i in Seg len upper_volume(chi(A,A),T.m) by A11,FINSEQ_1:def 3;
      consider D being Element of divs A such that
A13:  D = T.m;
      i in Seg len D by A12,A13,INTEGRA1:def 7;
  then i in dom D by FINSEQ_1:def 3;
      then delta(T.m)=vol(divset(T.m,i)) by A11,A13,INTEGRA1:22;
      hence thesis by A8,A9,A10,INTEGRA1:11,XREAL_1:8;
    end;
    hence thesis;
  end;
A14: for D,D1 be Element of divs A holds ex D2 be Element of divs A st
  D<=D2 & D1<=D2 & rng D2=rng D1 \/
  rng D & 0<=lower_sum(f,D2)-lower_sum(f,D) &
  0<=lower_sum(f,D2)-lower_sum(f,D1)
  proof
    let D,D1 be Element of divs A;
    consider D2 be Element of divs A such that
A15: D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D by Th3;
A16: f is_bounded_below_on A by A1,RFUNCT_1:def 11;
    then
A17: lower_sum(f,D2)-lower_sum(f,D)>=0 by A15,INTEGRA1:48,XREAL_1:50;
    lower_sum(f,D2)-lower_sum(f,D1)>=0 by A15,A16,INTEGRA1:48,XREAL_1:50;
    hence thesis by A15,A17;
  end;
A18: for
  D,D1 be Element of divs A st delta(D1)<min rng upper_volume(chi(A,A),D)
  holds ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D
  & lower_sum(f,D2)-lower_sum(f,D1) <=
  (len D)*(sup(rng f)-inf(rng f))*delta(D1)
  proof
    let D,D1 be Element of divs A;
    assume
A19: delta(D1)<min rng upper_volume(chi(A,A),D);
    ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D

& lower_sum(f,D2)-lower_sum(f,D1)<=(len D)*(sup(rng f)-inf(rng f))*delta(D1)
    proof
      consider D2 be Element of divs A such that
A20:  D<=D2 & D1<=D2 & rng D2=rng D1 \/
      rng D & 0<=lower_sum(f,D2)-lower_sum(f,D)
      & 0<=lower_sum(f,D2)-lower_sum(f,D1) by A14;
      lower_sum(f,D2)-lower_sum(f,D1) <=
      (len D)*(sup(rng f)-inf(rng f))*delta(D1)
      proof
        deffunc PLf(Element of divs A,Nat) = (PartSums(lower_volume(f,$1))).$2;
        deffunc LVf(Element of divs A) = lower_volume(f,$1);
A21:    for i st i in dom D holds ex j st j in dom D1 & D.i in divset(D1,j)
        & PLf(D2,indx(D2,D1,j))-PLf(D1,j)<=i*(sup(rng f)-inf(rng f))*delta(D1)
        proof
          let i;
          assume
A22:      i in dom D;
A23:      for
          i,j st i in dom D & j in dom D1 & D.i in divset(D1,j) holds j >= 2
          proof
            let i,j;
            assume
A24:        i in dom D;
            assume
A25:        j in dom D1 & D.i in divset(D1,j);
            assume j<2;
            then j<1+1;
            then
A26:        j <= 1 by NAT_1:13;
A27:        inf divset(D1,j)<=D.i & D.i<=sup divset(D1,j) by A25,INTEGRA2:1;
            j in Seg len D1 by A25,FINSEQ_1:def 3;
            then j >= 1 by FINSEQ_1:3;
            then j = 1 by A26,XXREAL_0:1;
            then
A28:        inf divset(D1,j)=inf A & sup divset(D1,j)=D1.j by A25,
            INTEGRA1:def 5;
            delta(D1) >= min rng upper_volume(chi(A,A),D)
            proof
              per cases;
              suppose
A29:            i=1;
                len D <> 0 by CARD_2:59;
                then len D in Seg len D by FINSEQ_1:5;
                then 1 <= len D by FINSEQ_1:3;
                then
A30:            1 in Seg len D by FINSEQ_1:3;
                then
B30:                 1 in dom D by FINSEQ_1:def 3;
                then
A31:            inf divset(D,1)=inf A & sup divset(D,1)=D.
                1 by INTEGRA1:def 5;
                sup divset(D1,j)-inf A >= D.1-inf A by A27,A29,XREAL_1:11;
                then vol(divset(D1,j)) >= sup divset(D,1)-inf divset(D,1)
                by A28,A31,INTEGRA1:def 6;
                then
A32:            vol(divset(D1,j)) >= vol(divset(D,1)) by INTEGRA1:def 6;
                vol(divset(D1,j)) <= delta(D1) by A25,Lm6;
                then
A33:            delta(D1) >= vol(divset(D,1)) by A32, XXREAL_0:2;
                1 in Seg len upper_volume(chi(A,A),D) by A30,INTEGRA1:def 7;
                then
A34:            1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;

vol(divset(D,1)) = upper_volume(chi(A,A),D).1 by INTEGRA1:22,B30;
                then vol(divset(D,1)) in rng upper_volume(chi(A,A),D)
                by A34,FUNCT_1:def 5;
                then vol(divset(D,1))>=min rng upper_volume(chi(A,A),D) by
                XXREAL_2:def 7;
                hence thesis by A33,XXREAL_0:2;
              end;
              suppose
A35:            i<>1;
                then
A36:            inf divset(D,i)=D.(i-1) & sup divset(D,i)= D.i
                by A24,INTEGRA1:def 5;
                then
A37:            sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-inf A
                by A27,A28,XREAL_1:11;
                D.(i-1) in A by A24,A35,INTEGRA1:9;
                then inf A <= D.(i-1) by INTEGRA2:1;
                then sup divset(D,i)-inf A >= sup divset(D,i)-inf divset(D,i)
                by A36,REAL_2:106;

then sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-inf divset( D,i)
                by A37,XXREAL_0:2;
                then vol(divset(D1,j)) >= sup divset(D,i)-inf divset(D,i)
                by INTEGRA1:def 6;
                then
A38:            vol(divset(D1,j)) >= vol(divset(D,i)) by INTEGRA1:def 6;
                vol(divset(D1,j)) <= delta(D1) by A25,Lm6;
                then
A39:            delta(D1) >= vol(divset(D,i)) by A38, XXREAL_0:2;
A40:            i in Seg len D by A24,FINSEQ_1:def 3;
                then i in Seg len upper_volume(chi(A,A),D) by INTEGRA1:def 7;
                then
A41:            i in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;

            i in dom D by A40,FINSEQ_1:def 3;
            then
vol(divset(D,i)) = upper_volume(chi(A,A),D).i by INTEGRA1:22;
                then vol(divset(D,i)) in rng upper_volume(chi(A,A),D)
                by A41,FUNCT_1:def 5;
                then vol(divset(D,i))>=min rng upper_volume(chi(A,A),D) by
                XXREAL_2:def 7;
                hence thesis by A39,XXREAL_0:2;
              end;
            end;
            hence contradiction by A19;
          end;
          defpred P[non empty Nat] means
          $1 in dom D implies ex j st j in dom D1 & D.$1 in divset(D1,j)

& PLf(D2,indx(D2,D1,j))-PLf(D1,j)<=$1*(sup rng f-inf rng f)*delta(D1);
A42:      P[1]
          proof
            len D <> 0 by CARD_2:59;
            then len D in Seg len D by FINSEQ_1:5;
            then 1 <= len D by FINSEQ_1:3;
            then
A43:        1 in dom D by FINSEQ_3:27;
            then D.1 in A by INTEGRA1:8;
            then consider j such that
A44:        j in dom D1 & D.1 in divset(D1,j) by Th2;
            PLf(D2,indx(D2,D1,j))-PLf(D1,j)<=1*(sup rng f-inf rng f)*delta(D1)
            proof
A45:          j <> 1 by A23,A43,A44;
              then
A46:          j-1 in NAT & j-1 in dom D1 by A44,INTEGRA1:9;
              reconsider j1=j-1 as Element of NAT by A44,A45,INTEGRA1:9;
              inf divset(D1,j) <= D.1 & D.1 <= sup divset(D1,j)
              by A44,INTEGRA2:1;
              then
A47:          D1.j1 <= D.1 & D.1 <= D1.j by A44,A45,INTEGRA1 :def 5;
A48:          indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) &
              indx(D2,D1,j1) <= len D2
              proof
                thus indx(D2,D1,j1) in dom D2 by A20,A46,INTEGRA1:def 21;
                then indx(D2,D1,j1) in Seg len D2 by FINSEQ_1:def 3;
                hence thesis by FINSEQ_1:3;
              end;
              then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
              then
A49:          D2|indx(D2,D1,j1) is increasing by A48,JORDAN3 :25;
A50:          j1 in dom D1 & 1 <= j1 & j1 <= len D1
              proof
                thus j1 in dom D1 by A44,A45,INTEGRA1:9;
                j1 in Seg len D1 by A46,FINSEQ_1:def 3;
                hence thesis by FINSEQ_1:3;
              end;
              then mid(D1,1,j1) is increasing by INTEGRA1:37;
              then
A51:          D1|j1 is increasing by A50,JORDAN3:25;
A52:          rng (D2|indx(D2,D1,j1)) = rng (D1|j1)
              proof
                for x1 st x1 in rng(D2|indx(D2,D1,j1)) holds x1 in rng(D1|j1)
                proof
                  let x1;
                  assume x1 in rng(D2|indx(D2,D1,j1));
                  then consider k such that
A53:              k in dom(D2|indx(D2,D1,j1)) & x1=(D2|indx(D2,D1,j1)).k
                  by PARTFUN1:26;
                  k in Seg len(D2|indx(D2,D1,j1)) by A53,FINSEQ_1:def 3;
                  then
A54:              k in Seg indx(D2,D1,j1) by A48, FINSEQ_1:80;
                  then
A55:              (D2|indx(D2,D1,j1)).k = D2.k & k in
                  dom D2 by A48,RFINSEQ:19;
                  then
A56:              D2.k in rng D2 by FUNCT_1:def 5;
                  1 <= k & k <= indx(D2,D1,j1) by A54,FINSEQ_1:3;
                  then D2.k <= D2.indx(D2,D1,j1) by A48,A55,GOBOARD2:18;
                  then
A57:              D2.k <= D1.j1 by A20,A46,INTEGRA1:def 21;
A58:              len(D1|j1) = j1 by A50,FINSEQ_1:80;
A59:              D2.k in rng D implies D2.k = D1.j1
                  proof
                    assume D2.k in rng D;
                    then consider n such that
A60:                n in dom D & D2.k=D.n by PARTFUN1:26;
                    1 <= n by A60,FINSEQ_3:27;
                    then D.1 <= D2.k by A43,A60,GOBOARD2:18;
                    then D1.j1 <= D2.k by A47,XXREAL_0:2;
                    hence thesis by A57,XXREAL_0:1;
                  end;
A61:              D2.k in rng D implies D2.k in rng(D1|j1)
                  proof
                    assume
A62:                D2.k in rng D;
                    j1 in Seg len(D1|j1) by A50,A58,FINSEQ_1:3;
                    then j1 in dom(D1|j1) by FINSEQ_1:def 3;
                    then
A63:                (D1|j1).j1 in rng(D1|j1) by FUNCT_1:def 5;
                    j1 in Seg j1 by A50,FINSEQ_1:3;
                    hence thesis by A50,A59,A62,A63,RFINSEQ:19;
                  end;
                  D2.k in rng D1 implies D2.k in rng(D1|j1)
                  proof
                    assume D2.k in rng D1;
                    then consider m such that
A64:                m in dom D1 & D2.k = D1.m by PARTFUN1:26;
                    m in Seg len D1 by A64,FINSEQ_1:def 3;
                    then
A65:                1 <= m & m <= j1 by A50,A57,A64,
                    FINSEQ_1:3,GOBOARD1:def 1;
                    then
A66:                m in dom (D1|j1) by A58,FINSEQ_3: 27;
                    m in Seg j1 by A65,FINSEQ_1:3;
                    then D2.k = (D1|j1).m by A50,A64,RFINSEQ:19;
                    hence thesis by A66,FUNCT_1:def 5;
                  end;

hence thesis by A20,A48,A53,A54,A56,A61,RFINSEQ:19,XBOOLE_0:def 2;
                end;
                then
A67:            rng(D2|indx(D2,D1,j1)) c= rng (D1|j1) by TARSKI:def 3;
                for x1 st x1 in rng(D1|j1) holds x1 in rng(D2|indx(D2,D1,j1))
                proof
                  let x1;
                  assume x1 in rng(D1|j1);
                  then consider k such that
A68:              k in dom(D1|j1) & x1=(D1|j1).k by PARTFUN1:26;
                  k in Seg len(D1|j1) by A68,FINSEQ_1:def 3;
                  then
A69:              k in Seg j1 by A50,FINSEQ_1:80;
                  then
A70:              (D1|j1).k = D1.k & k in dom D1 by A50, RFINSEQ:19;
                  then D1.k in rng D1 by FUNCT_1:def 5;
                  then x1 in rng D2 by A20,A68,A70,XBOOLE_0:def 2;
                  then consider n such that
A71:              n in dom D2 & x1=D2.n by PARTFUN1:26;
A72:              indx(D2,D1,k) in dom D2 & D2.indx(D2,D1,k)=D2.n
                  by A20,A68,A70,A71,INTEGRA1:def 21;
                  k <= j1 by A69,FINSEQ_1:3;
                  then D1.k <= D1.j1 by A46,A70,GOBOARD2:18;
                  then D2.indx(D2,D1,k) <= D1.j1 by A20,A70,INTEGRA1:def 21;
                  then D2.indx(D2,D1,k)<=D2.indx(D2,D1,j1)
                  by A20,A46,INTEGRA1:def 21;
                  then
A73:              n <= indx(D2,D1,j1) by A48,A71,A72, GOBOARD1:def 1;
                  1 <= n by A71,FINSEQ_3:27;
                  then
A74:              n in Seg indx(D2,D1,j1) by A73, FINSEQ_1:3;
                  then
A75:              D2.n = (D2|indx(D2,D1,j1)).n by A48, RFINSEQ:19;
                  n in Seg len(D2|indx(D2,D1,j1)) by A48,A74,FINSEQ_1:80;
                  then n in dom(D2|indx(D2,D1,j1)) by FINSEQ_1:def 3;
                  hence thesis by A71,A75,FUNCT_1:def 5;
                end;
                then rng(D1|j1) c= rng(D2|indx(D2,D1,j1)) by TARSKI:def 3;
                hence thesis by A67,XBOOLE_0:def 10;
              end;
              then
A76:          D2|indx(D2,D1,j1)=D1|j1 by A49,A51,Th5;
A77:          for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
              proof
                let k;
                assume
A78:            1 <= k & k <= j1;
                assume
A79:            k<>indx(D2,D1,k);
                now per cases by A79,XXREAL_0:1;
                  suppose
A80:                k > indx(D2,D1,k);
                    1 <= k & k <= len D1 by A50,A78,XXREAL_0:2;
                    then
A81:                k in dom D1 by FINSEQ_3:27;
                    then
A82:                indx(D2,D1,k) in dom D2 & D1.k=D2. indx(D2,D1,k)
                    by A20,INTEGRA1:def 21;
                    then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
                    then
A83:                1<=indx(D2,D1,k)&indx(D2,D1,k)<= indx(D2,D1,j1)
                    by A20,A50,A78,A81,Th6,FINSEQ_1:3;
                    then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
                    then
A84:                (D2|indx(D2,D1,j1)).indx(D2,D1,k)=
                    D2.indx(D2,D1,k) by A48, RFINSEQ:19;
A85:                indx(D2,D1,k) < j1 by A78,A80,XXREAL_0:2;
                    then indx(D2,D1,k) <= len D1 by A50,XXREAL_0:2;
                    then indx(D2,D1,k) in dom D1 by A83,FINSEQ_3:27;
                    then
A86:                D1.k > D1.indx(D2,D1,k) by A80,A81,GOBOARD1:def 1;
                    indx(D2,D1,k) in Seg j1 by A83,A85,FINSEQ_1:3;
                    hence contradiction by A50,A76,A82,A84,A86,RFINSEQ:19;
                  end;
                  suppose
A87:                k < indx(D2,D1,k);
                    k in Seg j1 by A78,FINSEQ_1:3;
                    then
A88:                D1.k = (D1|j1).k by A46,RFINSEQ:19;
                    1 <= k & k <= len D1 by A50,A78,XXREAL_0:2;
                    then
A89:                k in dom D1 by FINSEQ_3:27;
                    then
A90:                indx(D2,D1,k) in dom D2 & D1.k=D2. indx(D2,D1,k)
                    by A20,INTEGRA1:def 21;
                    indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2
                    & indx(D2,D1,j1) in dom D2 by A20,A50,A78,A89,Th6;
                    then
A91:                k <= indx(D2,D1,j1) by A87, XXREAL_0:2;
                    then k <= len D2 by A48,XXREAL_0:2;
                    then k in dom D2 by A78,FINSEQ_3:27;
                    then
A92:                D2.k < D2.indx(D2,D1,k) by A87,A90,GOBOARD1:def 1;
                    k in Seg indx(D2,D1,j1) by A78,A91,FINSEQ_1:3;
                    hence contradiction by A48,A76,A88,A90,A92,RFINSEQ:19;
                  end;
                end;
                hence contradiction;
              end;
A93:          len (D2|indx(D2,D1,j1))=len (D1|j1) by A49,A51,A52,Th5;
              len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A48,FINSEQ_1:80;
              then
A94:          indx(D2,D1,j1) =j1 by A50,A93,FINSEQ_1:80;
              j1 <= len D1 by A46,FINSEQ_3:27;
              then j1 <= len lower_volume(f,D1) by INTEGRA1:def 8;
              then
A95:          len(lower_volume(f,D1)|j1)=indx(D2,D1,j1) by A94,FINSEQ_1:80;
              indx(D2,D1,j1) in dom D2 by A20,A46,INTEGRA1:def 21;
              then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
              then indx(D2,D1,j1) <= len lower_volume(f,D2) by INTEGRA1:def 8;
              then
A96:          len(lower_volume(f,D1)|j1)=len(lower_volume(f,
              D2)|indx(D2,D1,j1)) by A95,FINSEQ_1:80;
              for k be Nat st 1 <= k & k <= len(lower_volume(f,D1)|j1) holds
              (lower_volume(f,D1)|j1).k = (lower_volume(f,D2)|indx(D2,D1,j1)).k
              proof
                let k be Nat;
                assume
A97:            1 <= k & k <= len(lower_volume(f,D1)|j1);
                reconsider k as Element of NAT by ORDINAL1:def 13;
A98:            len(lower_volume(f,D1)) = len D1 by INTEGRA1:def 8;
                then
A99:            1 <= k & k <= j1 by A50,A97,FINSEQ_1:80;
                then
A100:           k in Seg j1 by FINSEQ_1:3;
                1 <= k & k <= len D1 by A50,A99,XXREAL_0:2;
                then
A101:           k in Seg len D1 by FINSEQ_1:3;
  then
B101:  k in dom D1 by FINSEQ_1:def 3;
A102:           divset(D1,k)=divset(D2,indx(D2,D1,k))
                proof
A103:             divset(D2,indx(D2,D1,k))= [. inf divset(D2,indx(D2,D1,k)),
                  sup divset(D2,indx(D2,D1,k)).] by INTEGRA1:5;
A104:             k in dom D1 by A101,FINSEQ_1:def 3;
                  then
A105:             indx(D2,D1,k) in dom D2 & D1.k=D2.indx (D2,D1,k) by A20,
                  INTEGRA1:def 21;
                  inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
                  sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
                  proof
                    per cases;
                    suppose
A106:                 k=1;
                      then
A107:                 inf divset(D1,k)=inf A&sup divset(D1,k)=D1.k by A104,
                      INTEGRA1:def 5;
                      indx(D2,D1,k)=1 by A50,A77,A106;
                      hence thesis by A105,A107,INTEGRA1:def 5;
                    end;
                    suppose
A108:                 k<>1;
                      then
A109:                 inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
                      by A104,INTEGRA1:def 5;
A110:                 k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT
                      by A104,A108,INTEGRA1:9;

reconsider k1=k-1 as Element of NAT by A104,A108,INTEGRA1:9;
                      k <= k+1 by NAT_1:11;
                      then k1 <= k by XREAL_1:22;
                      then
A111:                 k1 <= j1 by A99,XXREAL_0:2;
                      k1 in Seg len D1 by A110,FINSEQ_1:def 3;
                      then 1 <= k1 by FINSEQ_1:3;
                      then
A112:                 k1=indx(D2,D1,k1) by A77,A111;
                      indx(D2,D1,k)<>1 by A77,A99,A108;
                      then
A113:                 inf divset(D2,indx(D2,D1,k))= D2.(indx(D2,D1,k)-1) &
                      sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A105,
                      INTEGRA1:def 5;
                      D2.(indx(D2,D1,k)-1)= D2.indx(D2,D1,k1) by A77,A99,A112;
                      hence thesis by A20,A104,A109,A110,A113,INTEGRA1:def 21;
                    end;
                  end;
                  hence thesis by A103,INTEGRA1:5;
                end;
                j1 in Seg len(lower_volume(f,D1)) by A50,A98,FINSEQ_1:def 3;
                then j1 in dom(lower_volume(f,D1)) by FINSEQ_1:def 3;
                then
A114:           (lower_volume(f,D1)|j1).k = lower_volume(f,D1).k by A100,
                RFINSEQ:19

.=(inf(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
                by A102,INTEGRA1:def 8,B101;
                indx(D2,D1,k) in Seg j1 by A77,A99,A100;
                then
A115:           indx(D2,D1,k) in Seg indx(D2,D1,j1) by A50,A77;

then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;

then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A48,XXREAL_0:2;
                then
                indx(D2,D1,k) in Seg len D2 by FINSEQ_1:3;
  then
B116:   indx(D2,D1,k) in dom D2 by FINSEQ_1:def 3;
                indx(D2,D1,j1) in Seg len D2 by A48,FINSEQ_1:def 3;

then indx(D2,D1,j1) in Seg len lower_volume(f,D2) by INTEGRA1:def 8;
                then
A117:           indx(D2,D1,j1) in dom lower_volume(f,D2) by FINSEQ_1:def 3;
                (lower_volume(f,D2)|indx(D2,D1,j1)).k
                =(lower_volume(f,D2)|indx(D2,D1,j1)).indx(D2,D1,k) by A77,A99
                  .=lower_volume(f,D2).indx(D2,D1,k) by A115,A117,RFINSEQ:19

.=(inf(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
                by INTEGRA1:def 8,B116;
                hence thesis by A114;
              end;
              then
A118:         lower_volume(f,D2)|indx(D2,D1,j1)=lower_volume (f,D1)|j1
              by A96,FINSEQ_1:18;
              indx(D2,D1,j1) in Seg len D2 by A48,FINSEQ_1:def 3;
              then
              indx(D2,D1,j1) in Seg len lower_volume(f,D2) by INTEGRA1:def 8;
  then
B119:  indx(D2,D1,j1) in dom lower_volume(f,D2) by FINSEQ_1:def 3;
              j1 in Seg len D1 by A50,FINSEQ_1:def 3;
              then
              j1 in Seg len lower_volume(f,D1) by INTEGRA1: def 8;
  then
B120:   j1 in dom lower_volume(f,D1) by FINSEQ_1:def 3;
A121:         PLf(D2,indx(D2,D1,j1))=Sum(lower_volume(f,D2)|indx(D2,D1,j1))
              by INTEGRA1:def 22,B119
                .=PLf(D1,j1) by A118,INTEGRA1:def 22,B120;
A122:         indx(D2,D1,j1)+1 <= indx(D2,D1,j)
              proof
                j < j+1 by NAT_1:13;
                then j1 < j by XREAL_1:21;
                then indx(D2,D1,j1) < indx(D2,D1,j) by A20,A44,A50,Th7;
                hence thesis by NAT_1:13;
              end;
A123:         Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))

-Sum mid(lower_volume(f,D1),j,j) <= (sup rng f-inf rng f)*delta(D1)
              proof
A124:           1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len lower_volume(f,D2)
                proof
                  indx(D2,D1,j) in dom D2 by A20,A44,INTEGRA1:def 21;
                  then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;

then indx(D2,D1,j) in Seg len lower_volume(f,D2) by INTEGRA1:def 8;
                  hence thesis by FINSEQ_1:3;
                end;
                then
A125:           1 <= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1
                <= len lower_volume(f, D2) by A48,A122,NAT_1:13,XXREAL_0:2;
A126:           indx(D2,D1,j)-indx(D2,D1,j1) <= 2
                proof
                  assume
A127:             indx(D2,D1,j)-indx(D2,D1,j1) > 2;
                  reconsider ID1=indx(D2,D1,j1)+1 as Element of NAT;
                  reconsider ID2=ID1+1 as Element of NAT;
A128:             indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
                  proof
                    thus indx(D2,D1,j1) < ID1 by NAT_1:13;
                    thus ID1 < ID2 by NAT_1:13;
                    indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A127,XREAL_1:22;
                    hence thesis;
                  end;
A129:             indx(D2,D1,j) in dom D2 by A20,A44,INTEGRA1:def 21;
                  then
A130:             indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A131:             ID1 in dom D2
                  proof
                    1 <= ID1 & ID1 <= indx(D2,D1,j) by A48,A128,XXREAL_0:2;
                    then 1 <= ID1 & ID1 <= len D2 by A130,XXREAL_0:2;
                    then ID1 in Seg len D2 by FINSEQ_1:3;
                    hence thesis by FINSEQ_1:def 3;
                  end;
A132:             ID2 in dom D2
                  proof

indx(D2,D1,j1) <= ID2 & ID2 <= len D2 by A128,A130,XXREAL_0:2;
                    then 1 <= ID2 & ID2 <= len D2 by A48,XXREAL_0:2;
                    then ID2 in Seg len D2 by FINSEQ_1:3;
                    hence thesis by FINSEQ_1:def 3;
                  end;
                  then
A133:             D2

.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2,D1, j)
                  by A48,A128,A129,A131,GOBOARD1:def 1;
A134:             D2.ID1 in rng D & D2.ID2 in rng D
                  proof
A135:               D2.ID1 in rng D \/ rng D1 & D2.ID2 in rng D \/ rng D1
                    by A20,A131,A132,FUNCT_1:def 5;
A136:               D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
                    by A20,A44,A50,INTEGRA1:def 21;
                    not(D2.ID1 in rng D1) & not D2.ID2 in rng D1
                    proof
                      assume
A137:                 D2.ID1 in rng D1 or D2.ID2 in rng D1;
                      per cases by A137;
                      suppose D2.ID1 in rng D1;
                        then consider n such that
A138:                   n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
                        D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
                        by A133,XXREAL_0:2;
                        then j1<n & n<j by A44,A50,A136,A138,GOBOARD2:18;
                        then j<n+1 & n<j by XREAL_1:21;
                        hence contradiction by NAT_1:13;
                      end;
                      suppose D2.ID2 in rng D1;
                        then consider n such that
A139:                   n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
                        D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
                        by A133,XXREAL_0:2;
                        then j1<n & n<j by A44,A50,A136,A139,GOBOARD2:18;
                        then j<n+1 & n<j by XREAL_1:21;
                        hence contradiction by NAT_1:13;
                      end;
                    end;
                    hence thesis by A135,XBOOLE_0:def 2;
                  end;
A140:             inf divset(D1,j)=D2.indx(D2,D1,j1)
                  & sup divset(D1,j)=D2.indx(D2,D1,j)
                  proof
                    inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
                    by A44,A45,INTEGRA1:def 5;
                    hence thesis by A20,A44,A50,INTEGRA1:def 21;
                  end;
A141:             D2.ID1 in rng D /\ divset(D1,j)
                  proof
                    D2.indx(D2,D1,j1)<=D2.ID1&D2.ID1<=D2.indx(D2,D1,j)
                    by A133,XXREAL_0:2;
                    then D2.ID1 in divset(D1,j) by A140,INTEGRA2:1;
                    hence thesis by A134,XBOOLE_0:def 3;
                  end;
                  D2.ID2 in rng D /\ divset(D1,j)
                  proof
                    D2.indx(D2,D1,j1)<=D2.ID2&D2.ID2<=D2.indx(D2,D1,j)
                    by A133,XXREAL_0:2;
                    then D2.ID2 in divset(D1,j) by A140,INTEGRA2:1;
                    hence thesis by A134,XBOOLE_0:def 3;
                  end;

hence contradiction by A19,A44,A128,A131,A132,A141,Th4,GOBOARD2:19;
                end;
                1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
                indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
                proof
A142:             indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
                  =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A122,BINARITH:50;
                  indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
                  hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
                  thus thesis by A126,A142;
                end;
                then
A143:           1 <= len mid(lower_volume(f,D2),(indx(D2,
                D1,j1)+1),indx(D2,D1,j )) &
                len mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
                by A122,A124,A125,JORDAN3:27;
A144:           1 <= j & j <= len lower_volume(f,D1)
                proof
                  1 <= j & j <= len D1 by A44,FINSEQ_3:27;
                  hence thesis by INTEGRA1:def 8;
                end;
                j-'j+1 = 1 by Lm2;
                then
A145:           len mid(lower_volume(f,D1),j,j)= 1 by A144,JORDAN3:27;
                mid(lower_volume(f,D1),j,j).1 = lower_volume(f,D1).j by A144,
                JORDAN3:27;
                then mid(lower_volume(f,D1),j,j)
                =<*lower_volume(f,D1).j*> by A145,FINSEQ_1:57;
                then
A146:           Sum mid(lower_volume(f,D1),j,j)= lower_volume(f,D1).j by
                FINSOP_1:12;
A147:           indx(D2,D1,j1)+1 in Seg len D2
                proof

indx(D2,D1,j1)+1 in Seg len lower_volume(f,D2) by A125,FINSEQ_1: 3;
                  hence thesis by INTEGRA1:def 8;
                end;
  then
B147:  indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
                j in Seg len D1 by A44,FINSEQ_1:def 3;
  then
B148:   j in dom D1 by FINSEQ_1:def 3;
                now per cases by A143,Lm3;
                  suppose
A149:               len
                    mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A150:               indx(D2,D1,j1)+1=indx(D2,D1,j)
                    proof
                      indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=1
                      by A122,A124,A125,A149,JORDAN3:27;

then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A122,BINARITH:50;
                      hence thesis;
                    end;
A151:               divset(D2,indx(D2,D1,j))=divset(D1,j)
                    proof
                      inf divset(D1,j)=D2.indx(D2,D1,j1)
                      & sup divset(D1,j)=D2.indx(D2,D1,j)
                      proof
                        inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
                        by A44,A45,INTEGRA1:def 5;
                        hence thesis by A20,A44,A50,INTEGRA1:def 21;
                      end;
                      then
A152:                 divset(D1,j)=[. D2.indx(D2,D1, j1),D2.indx(D2,D1,j).] by
                      INTEGRA1:5;
A153:                 indx(D2,D1,j)-1=indx(D2,D1,j1) by A150;
A154:                 indx(D2,D1,j) in dom D2 by A20,A44,INTEGRA1:def 21;
                      indx(D2,D1,j)<>1 by A48,A150,NAT_1:13;
                      then inf divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j1)
                      & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
                      by A153,A154,INTEGRA1:def 5;
                      hence thesis by A152,INTEGRA1:5;
                    end;
                    mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1

=lower_volume(f,D2).(indx(D2,D1,j1)+1) by A124,A125,JORDAN3:27;

then mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))

=<*lower_volume(f,D2).(indx(D2,D1,j1)+1)*> by A149,FINSEQ_1:57;
                    then
A155:               Sum mid(lower_volume(f,D2),(indx(
                    D2,D1,j1)+1),indx(D2,D1,j
                    )) =lower_volume(f,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
                      .=(inf(rng(f|divset(D2,(indx(D2,D1,j1)+1)))))
                    *vol(divset(D2,(indx(D2,D1,j1)+1)))
                     by INTEGRA1:def 8,B147
                      .=Sum mid(lower_volume(f,D1),j,j)
                    by A146,A150,A151,INTEGRA1:def 8,B148;
A156:               delta(D1) >= 0 by Th8;
                    sup rng f - inf rng f >= 0 by A1,Lm4,XREAL_1:50;

then (sup rng f - inf rng f)*delta(D1) >= 0*delta(D1) by A156;

hence Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))

-Sum mid(lower_volume(f,D1),j,j) <= (sup rng f-inf rng f)*delta(D1) by A155;
                  end;
                  suppose
A157:               len
                    mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A158:               mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1

=lower_volume(f,D2).(indx(D2,D1,j1)+1) by A124,A125,JORDAN3:27;
                    mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
                    =lower_volume(f,D2).(indx(D2,D1,j1)+2)
                    proof
A159:                 2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;

mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2

=LVf(D2).(2+(indx(D2,D1,j1)+1)-'1) by A122,A124,A125,A157, JORDAN3:27
                        .=LVf(D2).(2+(indx(D2,D1,j1)+1)-1) by A159,BINARITH:50
                        .=LVf(D2).(indx(D2,D1,j1)+(1+1));
                      hence thesis;
                    end;

then mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                    =<*lower_volume(f,D2).(indx(D2,D1,j1)+1),

lower_volume(f,D2).(indx(D2,D1,j1)+2)*> by A157,A158,FINSEQ_1:61;
                    then
A160:               Sum
                    mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                    =lower_volume(f,D2).(indx(D2,D1,j1)+1)
                    +lower_volume(f,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A161:               vol(divset(D1,j))

=vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
                    proof
A162:                 inf

divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
                      proof
                        inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
                        by A44,A45,INTEGRA1:def 5;
                        hence thesis by A20,A44,A50,INTEGRA1:def 21;
                      end;
A163:                 indx(D2,D1,j)=indx(D2,D1,j1)+2
                      proof
                        indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
                        by A122,A124,A125,A157,JORDAN3:27;

then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A122,BINARITH:50;
                        hence thesis;
                      end;
A164:                 inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
                      & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
                      & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
                      & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
                      proof
A165:                   indx
                        (D2,D1,j1)+2 in dom D2 by A20,A44,A163,INTEGRA1:def 21;
                        indx(D2,D1,j1)+1 in Seg len lower_volume(f,D2) by A125
                        , FINSEQ_1:3;
                        then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 8;
                        then
A166:                   indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A167:                   indx(D2,D1,j1)+1 <> 1 by A48,NAT_1:13;
A168:                   indx(D2,D1,j1)+1+1 > 1 by A125,NAT_1:13;
A169:                   indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A170:                   indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;

thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)

& sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
                        by A165,A168,A169,INTEGRA1:def 5;
                        thus thesis by A166,A167,A170,INTEGRA1:def 5;
                      end;
                      vol(divset(D1,j))
                      =D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
                      +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A162,A163,
                      INTEGRA1:def 6;
                      then vol(divset(D1,j)) =vol(divset(D2,indx(D2,D1,j1)+2))

+D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A164,INTEGRA1:def 6
                        .=vol(divset(D2,indx(D2,D1,j1)+2))

+(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1)) by A164;
                      hence thesis by INTEGRA1:def 6;
                    end;
                    then
A171:               lower_volume(f,D1).j=(inf(rng(f| divset(D1,j))))*

(vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
                    by INTEGRA1:def 8,B148;
A172:               vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A173:               vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
A174:               Sum

mid(LVf(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))-Sum mid(LVf(D1) ,j,j)
                    <=(sup rng f - inf rng f)*(vol(divset(D2,indx(D2,D1,j1)+2))
                    +vol(divset(D2,indx(D2,D1,j1)+1)))
                    proof
A175:                 indx(D2,D1,j) in dom D2 by A20,A44,INTEGRA1:def 21;
A176:                 indx(D2,D1,j)=indx(D2,D1,j1)+2
                      proof
                        indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
                        by A122,A124,A125,A157,JORDAN3:27;

then indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1=2 by A122,BINARITH:50;
                        hence thesis;
                      end;
                      then
                      indx(D2,D1,j1)+2 in Seg len D2 by A175,FINSEQ_1:def 3;
  then
B177:   indx(D2,D1,j1)+2 in dom D2 by FINSEQ_1:def 3;
                      set ID1=indx(D2,D1,j1)+1;
                      set ID2=indx(D2,D1,j1)+2;
A178:                 Sum mid(LVf(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                      =(inf rng(f|divset(D2,indx(D2,D1,j1)+2)))
                      *vol(divset(D2,indx(D2,D1,j1)+2))
                      +LVf(D2).(indx(D2,D1,j1)+1)
                       by A160,INTEGRA1:def 8,B177
                        .=(inf rng(f|divset(D2,indx(D2,D1,j1)+2)))
                      *vol(divset(D2,indx(D2,D1,j1)+2))
                      +(inf rng(f|divset(D2,indx(D2,D1,j1)+1)))
                      *vol(divset(D2,indx(D2,D1,j1)+1))
                       by INTEGRA1:def 8,B147;
                      divset(D2,ID2)c=A by A175,A176,INTEGRA1:10;
                      then
A179:                 inf rng(f|divset(D2,ID2)) <= sup rng f by A1,Lm5;
                      ID1 in dom D2 by A147,FINSEQ_1:def 3;
                      then divset(D2,ID1)c=A by INTEGRA1:10;
                      then inf rng(f|divset(D2,ID1)) <= sup rng f by A1,Lm5;
                      then
A180:                 (inf rng(f|divset(D2,ID1)))* vol(divset(D2,ID1))
                      <=(sup rng f)*vol(divset(D2,ID1)) by A172,XREAL_1:66;
                      divset(D1,j) c=A by A44,INTEGRA1:10;
                      then inf rng(f|divset(D1,j)) >= inf rng f by A1,Lm5;
                      then
A181:                 (inf rng(f|divset(D1,j)))*vol( divset(D2,ID2))
                      >=(inf rng f)*vol(divset(D2,ID2))
                      & (inf rng(f|divset(D1,j)))*vol(divset(D2,ID1))

>=(inf rng f)*vol(divset(D2,ID1)) by A172,A173,XREAL_1:66;
                      Sum mid(LVf(D2),ID1,indx(D2,D1,j))
                      -(inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1))

<=(sup rng f)*vol(divset(D2,ID2)) by A173,A178,A179,XREAL_1:66;
                      then Sum mid(LVf(D2),ID1,indx(D2,D1,j))
                      <=(sup rng f)*vol(divset(D2,ID2))

+(inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;

then Sum mid(LVf(D2),ID1,indx(D2,D1,j))-(sup rng f)*vol(divset(D2, ID2))

<=(inf rng(f|divset(D2,ID1)))*vol(divset(D2,ID1)) by XREAL_1:22;

then Sum mid(LVf(D2),ID1,indx(D2,D1,j))-(sup rng f)*vol(divset(D2, ID2))
                      <=(sup rng f)*vol(divset(D2,ID1)) by A180,XXREAL_0:2;
                      then
A182:                 Sum

mid(LVf(D2),ID1,indx(D2,D1,j))<=(sup rng f)*vol(divset(D2,ID2 ))+
                      (sup rng f)*vol(divset(D2,ID1)) by XREAL_1:22;
                      reconsider A = inf(rng(f|divset(D1,j))) as real number;
                      set B = vol(divset(D2,ID1));
                      set C = vol(divset(D2,ID2));
                      lower_volume(f,D1).j-A*B=A*C by A171;

then Sum mid(LVf(D1),j,j)>=(inf rng(f|divset(D1,j)))*vol(divset(D2, ID1))
                      +(inf rng f)*vol(divset(D2,ID2)) by A146,A181,XREAL_1:21;
                      then Sum mid(LVf(D1),j,j)-(inf rng f)*vol(divset(D2,ID2)
                      )

>=(inf rng(f|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:21;
                      then Sum mid(LVf(D1),j,j)-(inf rng f)*vol(divset(D2,ID2)
                      ) >=(inf rng f)*vol(divset(D2,ID1)) by A181,XXREAL_0:2;
                      then Sum mid(LVf(D1),j,j)

>=(inf rng f)*vol(divset(D2,ID2))+(inf rng f)*vol(divset(D2,ID1))
                      by XREAL_1:21;

then Sum mid(LVf(D2),ID1,indx(D2,D1,j))-Sum mid(LVf(D1),j,j)

<=(sup rng f)*vol(divset(D2,ID2))+(sup rng f)*vol(divset(D2,ID1))

-((inf rng f)*vol(divset(D2,ID2))+(inf rng f)*vol(divset(D2,ID1)))
                      by A182,REAL_1:92;
                      hence thesis;
                    end;
                    sup rng f - inf rng f >= 0 by A1,Lm4,XREAL_1:50;
                    then (sup rng f - inf rng f)*(vol(divset(D1,j)))
                    <=(sup rng f - inf rng f)*delta(D1) by A44,Lm6,XREAL_1:66;
                    hence thesis by A161,A174,XXREAL_0:2;
                  end;
                end;
                hence thesis;
              end;
A183:         PLf(D2,indx(D2,D1,j1))
              +Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
              =PLf(D2,indx(D2,D1,j))
              proof
                indx(D2,D1,j) in dom D2 by A20,A44,INTEGRA1:def 21;
                then
A184:           indx(D2,D1,j) in Seg len D2 by FINSEQ_1: def 3;
                then
A185:           1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
                then
A186:           1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len LVf(D2) by
                INTEGRA1:def 8;
                indx(D2,D1,j) in Seg len LVf(D2) by A184,INTEGRA1:def 8;
  then
B187:  indx(D2,D1,j) in dom LVf(D2) by FINSEQ_1:def 3;
A188:           indx(D2,D1,j1) < indx(D2,D1,j) by A122,NAT_1:13;
                indx(D2,D1,j1) in Seg len D2 by A48,FINSEQ_1:def 3;
                then indx(D2,D1,j1) in Seg len LVf(D2) by INTEGRA1:def 8;
  then indx(D2,D1,j1) in dom LVf(D2) by FINSEQ_1:def 3;
                then PLf(D2,indx(D2,D1,j1))
                =Sum(LVf(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
                then PLf(D2,indx(D2,D1,j1))
                +Sum mid(lower_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                =Sum(LVf(D2)|indx(D2,D1,j1)
                ^mid(LVf(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
                  .=Sum(mid(LVf(D2),1,indx(D2,D1,j1))
                ^mid(LVf(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A48,JORDAN3:25

.=Sum(mid(LVf(D2),1,indx(D2,D1,j))) by A48,A186,A188,INTEGRA2:4
                  .=Sum(LVf(D2)|indx(D2,D1,j)) by A185,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B187;
              end;
              PLf(D1,j1)+Sum mid(lower_volume(f,D1),j,j)=PLf(D1,j)
              proof
A189:           j in Seg len D1 by A44,FINSEQ_1:def 3;
                then
A190:           1 <= j & j <= len D1 by FINSEQ_1:3;
                then
A191:           1 <= j & j <= len LVf(D1) by INTEGRA1:def 8;
                j in Seg len LVf(D1) by A189,INTEGRA1:def 8;
  then
B192:  j in dom LVf(D1) by FINSEQ_1:def 3;
                j < j+1 by NAT_1:13;
                then
A193:           j1 < j by XREAL_1:21;
                j1 in Seg len D1 by A50,FINSEQ_1:def 3;
                then j1 in Seg len LVf(D1) by INTEGRA1:def 8;
  then j1 in dom LVf(D1) by FINSEQ_1:def 3;
                then PLf(D1,j1)=Sum(LVf(D1)|j1) by INTEGRA1:def 22;
                then PLf(D1,j1)+Sum mid(LVf(D1),j,j)
                =Sum((LVf(D1)|j1)^mid(LVf(D1),j,j)) by RVSUM_1:105

.=Sum(mid(LVf(D1),1,j1)^mid(LVf(D1),j1+1,j)) by A50,JORDAN3:25
                  .=Sum(mid(LVf(D1),1,j)) by A50,A191,A193,INTEGRA2:4
                  .=Sum(LVf(D1)|j) by A190,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B192;
              end;
              hence thesis by A121,A123,A183;
            end;
            hence thesis by A44;
          end;
A194:     for i being non empty Nat st P[i] holds P[i+1]
          proof
            let i be non empty Nat;
            assume
A195:       P[i];
A196:       i>=1 by NAT_1:14;
            P[i+1]
            proof
              assume
A197:         i+1 in dom D;
              then D.(i+1) in A by INTEGRA1:8;
              then consider j such that
A198:         j in dom D1 & D.(i+1) in divset(D1,j) by Th2;
A199:         1 <= i+1 & i+1 <= len D by A197,FINSEQ_3:27;
              i <= i+1 by NAT_1:11;
              then i <= len D by A199,XXREAL_0:2;
              then
A200:         i in Seg len D by A196,FINSEQ_1:3;
              then
A201:         i in dom D by FINSEQ_1:def 3;
              consider n1 being Element of NAT such that
A202:         n1 in dom D1 & D.i in divset(D1,n1)

& PLf(D2,indx(D2,D1,n1))-PLf(D1,n1)<=i*(sup rng f-inf rng f)*delta(D1)
              by A195,A200,FINSEQ_1:def 3;
A203:         indx(D2,D1,n1) in dom D2 & D2.indx(D2,D1,n1) = D1.n1
              by A20,A202,INTEGRA1:def 21;
              then
A204:         1 <= indx(D2,D1,n1) & indx(D2,D1,n1) <= len D2 by FINSEQ_3:27;
A205:         n1 < j
              proof
                assume
A206:           n1 >= j;
                now per cases by A206,REAL_1:def 5;
                  suppose n1=j;

then D.i in divset(D1,j) & D.i in rng D by A201,A202,FUNCT_1:def 5;
                    then
A207:               D.i in rng D /\ divset(D1,j) by XBOOLE_0:def 3;
                    D.(i+1) in rng D by A197,FUNCT_1:def 5;
                    then
A208:               D.(i+1) in rng D /\ divset(D1,j) by A198,XBOOLE_0:def 3;
                    i+1 > i by XREAL_1:31;

hence contradiction by A19,A197,A198,A201,A207,A208,Th4,GOBOARD2:19;
                  end;
                  suppose n1>j;
                    then
A209:               n1>=j+1 by NAT_1:13;
                    then
A210:               n1-1 >= j by XREAL_1:21;
A211:               inf divset(D1,n1) <= D.i by A202,INTEGRA2:1;
A212:               D.(i+1)<=sup divset(D1,j) by A198,INTEGRA2:1;
                    1 <= j by A198,FINSEQ_3:27;
                    then 1+1 <= j+1 by XREAL_1:8;
                    then
A213:               n1 <> 1 by A209,XXREAL_0:2;
                    then n1-1 in dom D1 by A202,INTEGRA1:9;
                    then
A214:               D1.j <= D1.(n1-1) by A198,A210, GOBOARD2:18;
A215:               sup divset(D1,j)=D1.j
                    proof
                      per cases;
                      suppose j=1;
                        hence thesis by A198,INTEGRA1:def 5;
                      end;
                      suppose j<>1;
                        hence thesis by A198,INTEGRA1:def 5;
                      end;
                    end;
                    D.i >= D1.(n1-1) by A202,A211,A213,INTEGRA1:def 5;
                    then D.i >= D1.j by A214,XXREAL_0:2;
                    then
A216:               D.i >= D.(i+1) by A212,A215, XXREAL_0:2;
                    i < i+1 by XREAL_1:31;
                    hence contradiction by A197,A201,A216,GOBOARD1:def 1;
                  end;
                end;
                hence thesis;
              end;
              then
A217:         n1+1 <= j by NAT_1:13;
              then
A218:         j-n1 >= 1 by XREAL_1:21;
A219:         n1 >= 1 by A202,FINSEQ_3:27;
A220:         1 <= n1 & 1 <= j & j <= len D1 by A198,A202,FINSEQ_3:27;
              then
A221:         1 <= n1+1 & n1+1 <= len D1 by A217,NAT_1:12, XXREAL_0:2;
              then
A222:         n1+1 in dom D1 by FINSEQ_3:27;
              then
A223:         indx(D2,D1,n1+1) in dom D2 & D2.indx(D2,D1,n1+ 1)=D1.(n1+1)
              by A20,INTEGRA1:def 21;
A224:         indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.j
              by A20,A198,INTEGRA1:def 21;
              then D2.indx(D2,D1,n1+1) <= D2.indx(D2,D1,j)
              by A198,A217,A222,A223,GOBOARD2:18;
              then
A225:         indx(D2,D1,n1+1) <= indx(D2,D1,j) by A223,A224,GOBOARD1:def 1;
A226:         1

<= indx(D2,D1,n1+1) & indx(D2,D1,n1+1) <= len D2 by A223,FINSEQ_3:27;
A227:         1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by A224,FINSEQ_3:27;
              n1 < n1+1 by NAT_1:13;
              then D1.n1 < D1.(n1+1) by A202,A222,GOBOARD1:def 1;
              then
A228:         indx(D2,D1,n1) < indx(D2,D1,n1+1) by A203,A223,GOBOARD2:18;
              1+indx(D2,D1,n1+1) <= indx(D2,D1,j)+1 by A225,XREAL_1:8;
              then 1 <= indx(D2,D1,j)+1-indx(D2,D1,n1+1) by XREAL_1:21;
              then
A229:         mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j)).1
              =D2.(1-1+indx(D2,D1,n1+1)) by A225,A226,A227,JORDAN3:31
                .=D1.(n1+1) by A20,A222,INTEGRA1:def 21;
A230:         Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
              -Sum mid(LVf(D1),n1+1,j) <= (sup rng f-inf rng f)*delta(D1)
              proof
                now per cases by A217,REAL_1:def 5;
                  suppose
A231:               n1+1=j;
A232:               1 <= n1+1 & n1+1 <= len LVf(D1) by A221,INTEGRA1:def 8;
                    n1+1 in Seg len D1 by A222,FINSEQ_1:def 3;
  then
B233:  n1+1 in dom D1 by FINSEQ_1:def 3;
A234:               len mid(LVf(D1),n1+1,j)=j-'(n1+1)+1 by A231,A232,JORDAN3:27
                      .=j-j+1 by A231,BINARITH:50
                      .= 1;
                    (n1+1)+1 <= j+1 by A217,XREAL_1:8;
                    then 1 <= j+1-(n1+1) by XREAL_1:21;
                    then mid(LVf(D1),n1+1,j).1
                    =LVf(D1).(1-1+(n1+1)) by A231,A232,JORDAN3:31
                      .=(inf rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))
                    by INTEGRA1:def 8,B233;
                    then mid(LVf(D1),n1+1,j)
                    =<*(inf rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))*>
                    by A234,FINSEQ_1:57;
                    then
A235:               Sum mid(LVf(D1),n1+1,j)

=(inf rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1)) by FINSOP_1:12;
                    divset(D1,n1+1) c= A by A222,INTEGRA1:10;
                    then
A236:               inf rng(f|divset(D1,n1+1)) >= inf rng f by A1,Lm5;
                    vol(divset(D1,n1+1)) >= 0 by INTEGRA1:11;
                    then
A237:               Sum mid(LVf(D1),n1+1,j)
                    >=(inf rng f)*vol(divset(D1,n1+1)) by A235,A236,XREAL_1:66;
A238:               indx(D2,D1,n1)<indx(D2,D1,j)
                    proof
                      D1.n1 < D1.j by A198,A202,A205,GOBOARD1:def 1;
                      hence thesis by A203,A224,GOBOARD2:18;
                    end;
                    then
A239:               indx(D2,D1,n1)+1 <= indx(D2,D1,j) by NAT_1:13;
                    then indx(D2,D1,n1)+1 <= len D2 by A227,XXREAL_0:2;
                    then
A240:               indx(D2,D1,n1)+1 <= len LVf(D2) by INTEGRA1:def 8;
A241:               1<=indx(D2,D1,n1)+1 by NAT_1:12;
A242:               indx(D2,D1,j) <= len LVf(D2) by A227,INTEGRA1:def 8;
                    then
A243:               len mid(LVf(D2),indx(D2,D1,n1)+1, indx(D2,D1,j))

=indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1 by A227,A239,A240,A241,JORDAN3:27
                      .=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A239,BINARITH:50
                      .=indx(D2,D1,j)-indx(D2,D1,n1);
A244:               indx(D2,D1,j)-indx(D2,D1,n1)<=2
                    proof
                      assume indx(D2,D1,j) - indx(D2,D1,n1) > 2;
                      then
A245:                 indx(D2,D1,n1)+2 < indx(D2,D1, j) by XREAL_1:22;
A246:                 indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A247:                 indx(D2,D1,n1)+1 < indx(D2,D1,n1)+2 by XREAL_1:8;
A248:                 indx
                      (D2,D1,n1)+1 < indx(D2,D1,j) & indx(D2,D1,n1)+1 in dom D2
                      proof

thus indx(D2,D1,n1)+1 < indx(D2,D1,j) by A245,A247,XXREAL_0:2;
                        then 1 <= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= len
                        D2 by A204,A227,NAT_1:13,XXREAL_0:2;
                        hence thesis by FINSEQ_3:27;
                      end;
A249:                 D2.(indx(D2,D1,n1)+1) in rng D
                      proof
A250:                   D2.(indx(D2,D1,n1)+1) in rng D2 by A248,FUNCT_1:def 5;
                        not( D2.(indx(D2,D1,n1)+1) in rng D1 )
                        proof
                          assume D2.(indx(D2,D1,n1)+1) in rng D1;
                          then consider k1 being Element of NAT such that
A251:                     k1

in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.k1 by PARTFUN1:26;
                          D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
                          & D2.(indx(D2,D1,n1)+1) < D2.indx(D2,D1,j)
                          by A203,A224,A246,A248,GOBOARD1:def 1;

then n1 < k1 & k1 < j by A198,A202,A203,A224,A251,GOBOARD2:18;
                          hence contradiction by A231,NAT_1:13;
                        end;
                        hence thesis by A20,A250,XBOOLE_0:def 2;
                      end;
A252:                 D2.(indx(D2,D1,n1)+1) in rng D /\ divset(D1,j)
                      proof
A253:                   inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
                        by A198,A205,A219,INTEGRA1:def 5;
                        D2.(indx(D2,D1,n1)+1) >= D2.indx(D2,D1,n1)
                        & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+1)
                        by A203,A224,A246,A248,GOBOARD2:18;
                        then D2.(indx(D2,D1,n1)+1) in divset(D1,j)
                        by A203,A224,A231,A253,INTEGRA2:1;
                        hence thesis by A249,XBOOLE_0:def 3;
                      end;
A254:                 indx

(D2,D1,n1) < indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 in dom D2
                      proof

thus indx(D2,D1,n1) < indx(D2,D1,n1)+2 by A247,NAT_1:13;
                        then 1 <= indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 <= len
                        D2 by A204,A227,A245,XXREAL_0:2;
                        hence thesis by FINSEQ_3:27;
                      end;
A255:                 D2.(indx(D2,D1,n1)+2) in rng D
                      proof
A256:                   D2.(indx(D2,D1,n1)+2) in rng D2 by A254,FUNCT_1:def 5;
                        not D2.(indx(D2,D1,n1)+2) in rng D1
                        proof
                          assume D2.(indx(D2,D1,n1)+2) in rng D1;
                          then consider k1 being Element of NAT such that
A257:                     k1

in dom D1 & D2.(indx(D2,D1,n1)+2) = D1.k1 by PARTFUN1:26;
                          D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+2)
                          & D2.(indx(D2,D1,n1)+2) < D2.indx(D2,D1,j)
                          by A203,A224,A245,A254,GOBOARD1:def 1;

then n1 < k1 & k1 < j by A198,A202,A203,A224,A257,GOBOARD2:18;
                          hence contradiction by A231,NAT_1:13;
                        end;
                        hence thesis by A20,A256,XBOOLE_0:def 2;
                      end;
                      D2.(indx(D2,D1,n1)+2) in rng D /\ divset(D1,j)
                      proof
A258:                   inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
                        by A198,A205,A219,INTEGRA1:def 5;
                        D2.(indx(D2,D1,n1)+2) >= D2.indx(D2,D1,n1)
                        & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+2)
                        by A203,A224,A245,A254,GOBOARD2:18;
                        then D2.(indx(D2,D1,n1)+2) in divset(D1,j)
                        by A203,A224,A231,A258,INTEGRA2:1;
                        hence thesis by A255,XBOOLE_0:def 3;
                      end;

then D2.(indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+2) by A19,A198,A252, Th4;
                      hence contradiction by A247,A248,A254,GOBOARD1:def 1;
                    end;
A259:               indx

(D2,D1,j)-indx(D2,D1,n1)=1 or indx(D2,D1,j)-indx(D2,D1,n1)=2
                    proof
                      indx(D2,D1,n1)+1 <= indx(D2,D1,j) by A238,NAT_1:13;
                      then
A260:                 indx(D2,D1,n1)+1 = indx(D2,D1, j) or
                      indx(D2,D1,n1)+1 < indx(D2,D1,j) by REAL_1:def 5;

indx(D2,D1,n1)+1<indx(D2,D1,j) implies indx(D2,D1,n1)+2=indx(D2, D1, j )
                      proof
                        assume indx(D2,D1,n1)+1 < indx(D2,D1,j);
                        then
A261:                   indx(D2,D1,n1)+1+1 <= indx (D2,D1,j) by NAT_1:13;
                        indx(D2,D1,n1)+2 >= indx(D2,D1,j) by A244,XREAL_1:22;
                        hence thesis by A261,XXREAL_0:1;
                      end;
                      hence thesis by A260;
                    end;
                    Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                    <=(sup rng f)*vol(divset(D1,n1+1))
                    proof
                      per cases by A259;
                      suppose
A262:                   indx(D2,D1,j)-indx(D2,D1,n1)=1;
                        then 1=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1;
                        then
A263:                   mid(LVf(D2),indx(D2,D1,n1) +1,indx(D2,D1,j)).1

=LVf(D2).(1+(indx(D2,D1,n1)+1)-1) by A241,A242,JORDAN3:31
                          .=LVf(D2).(indx(D2,D1,n1)+1);

indx(D2,D1,n1)+1 in Seg len D2 by A224,A262,FINSEQ_1:def 3;
  then indx(D2,D1,n1)+1 in dom D2 by FINSEQ_1:def 3;
                        then
A264:                   LVf(D2).(indx(D2,D1,n1)+1)
                        =(inf rng(f|divset(D2,indx(D2,D1,n1)+1)))
                        *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 8;
A265:                   divset(D2,indx(D2,D1,n1)+1)=divset(D1,n1+1)
                        proof
A266:                     divset

(D1,n1+1)=[.inf divset(D1,n1+1), sup divset(D1,n1+1).] by INTEGRA1:5;
                          indx(D2,D1,n1)+1 > 1 by A204,NAT_1:13;

then inf divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1-1)

& sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
                          by A224,A262,INTEGRA1:def 5;
                          then
A267:                     inf divset(D2,indx(D2, D1,n1)+1)=D1.n1

& sup divset(D2,indx(D2,D1,n1)+1)=D1.j by A20,A198,A202,A262, INTEGRA1:def 21;

inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
                          by A205,A219,A222,A231,INTEGRA1:def 5;
                          hence thesis by A231,A266,A267,INTEGRA1:5;
                        end;
                        vol(divset(D2,indx(D2,D1,n1)+1))>=0 by INTEGRA1:11;
                        then
A268:                   LVf(D2).(indx(D2,D1,n1)+1)

<=(sup rng f)*vol(divset(D1,n1+1)) by A1,A224,A262,A264,A265,Th17, XREAL_1:66;
                        mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))

=<*LVf(D2).(indx(D2,D1,n1)+1)*> by A243,A262,A263,FINSEQ_1:57;
                        hence thesis by A268,FINSOP_1:12;
                      end;
                      suppose
A269:                   indx(D2,D1,j)-indx(D2,D1,n1)=2;
A270:                   indx(D2,D1,n1)+2-1=indx(D2,D1,n1)+1;
A271:                   indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1>=1 by A269;
A272:                   indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1=1+1 by A269;
A273:                   1

<= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= indx(D2,D1,n1)+2
                        by NAT_1:12,XREAL_1:8;

then indx(D2,D1,n1)+1 <= len D2 by A227,A269,XXREAL_0:2;
                        then
A274:                   indx(D2,D1,n1)+1 in dom D2 by A273,FINSEQ_3:27;
A275:                   indx(D2,D1,j) <= len LVf(D2) by A227,INTEGRA1:def 8;
                        then
A276:                   mid(LVf(D2),indx(D2,D1,n1) +1,indx(D2,D1,j)).1
                        =LVf(D2).(1+(indx(D2,D1,n1)+1)-1)
                        by A269,A271,A273,JORDAN3:31
                          .=LVf(D2).(indx(D2,D1,n1)+1);
                        mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).2
                        =LVf(D2).(2+(indx(D2,D1,n1)+1)-1)
                        by A272,A273,A275,JORDAN3:31
                          .=LVf(D2).(indx(D2,D1,n1)+0+2);
                        then mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))

=<*LVf(D2).(indx(D2,D1,n1)+1),LVf(D2).(indx(D2,D1,n1)+2)*>
                        by A243,A269,A276,FINSEQ_1:61;
                        then
A277:                   Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        =LVf(D2).(indx(D2,D1,n1)+1)+LVf(D2).(indx(D2,D1,n1)+2)
                        by RVSUM_1:107;
A278:                   LVf(D2).(indx(D2,D1,n1)+1)
                        <= (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+1))
                        proof

indx(D2,D1,n1)+1 in Seg len D2 by A274,FINSEQ_1:def 3;
  then indx(D2,D1,n1)+1  in dom D2 by FINSEQ_1:def 3;
                          then
A279:                     LVf(D2).(indx(D2,D1,n1 )+1)
                          =(inf rng(f|divset(D2,indx(D2,D1,n1)+1)))
                          *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 8;
                          vol(divset(D2,indx(D2,D1,n1)+1)) >= 0 by INTEGRA1:11;
                          hence thesis by A1,A274,A279,Th17,XREAL_1:66;
                        end;
                        LVf(D2).(indx(D2,D1,n1)+2)
                        <= (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+2))
                        proof

indx(D2,D1,n1)+2 in Seg len D2 by A224,A269,FINSEQ_1:def 3;
  then indx(D2,D1,n1)+2 in dom D2 by FINSEQ_1:def 3;
                          then
A280:                     LVf(D2).(indx(D2,D1,n1 )+2)
                          =(inf rng(f|divset(D2,indx(D2,D1,n1)+2)))
                          *vol(divset(D2,indx(D2,D1,n1)+2)) by INTEGRA1:def 8;
                          vol(divset(D2,indx(D2,D1,n1)+2)) >= 0 by INTEGRA1:11;
                          hence thesis by A1,A224,A269,A280,Th17,XREAL_1:66;
                        end;
                        then
A281:                   Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        <= (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+1))

+ (sup rng f)*vol(divset(D2,indx(D2,D1,n1)+2)) by A277,A278,XREAL_1:9;

vol(divset(D2,indx(D2,D1,n1)+1))+vol(divset(D2,indx(D2,D1,n1)+2) )
                        =vol(divset(D1,n1+1))
                        proof
                          indx(D2,D1,n1)+1 > 1 by A204,NAT_1:13;
                          then
A282:                     inf
                          divset(D2,indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+1-1)

& sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
                          by A274,INTEGRA1:def 5;
                          indx(D2,D1,n1)+2 >= 2+1 by A204,XREAL_1:8;
                          then indx(D2,D1,n1)+2 <> 1;
                          then
A283:                     inf
                          divset(D2,indx(D2,D1,n1)+2) = D2.(indx(D2,D1,n1)+1)
                          & sup divset(D2,indx(D2,D1,n1)+2)=D2.indx(D2,D1,j)
                          by A224,A269,A270,INTEGRA1:def 5;
A284:                     vol(divset(D2,indx(D2,D1,n1)+1))

=D2.(indx(D2,D1,n1)+1)-D1.n1 by A203,A282,INTEGRA1:def 6;
A285:                     vol(divset(D2,indx(D2,D1,n1)+2))

=D1.j-D2.(indx(D2,D1,n1)+1) by A224,A283,INTEGRA1:def 6;

inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
                          by A205,A219,A222,A231,INTEGRA1:def 5;

then vol(divset(D1,n1+1))=D1.(n1+1)-D1.n1 by INTEGRA1:def 6;
                          hence thesis by A231,A284,A285;
                        end;
                        hence thesis by A281;
                      end;
                    end;
                    then
A286:               Sum

mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))-Sum mid(LVf(D1),n1+1 ,j)

<=(sup rng f)*vol(divset(D1,n1+1))-(inf rng f)*vol(divset(D1,n1+1))
                    by A237,REAL_1:92;
A287:               sup rng f-inf rng f >= 0 by A1,Lm4,XREAL_1:50;
                    vol(divset(D1,n1+1))<=delta(D1)
                    proof
A288:                 n1+1 in Seg len D1 by A222,FINSEQ_1:def 3;
  then n1+1 in dom D1 by FINSEQ_1:def 3;
                      then
A289:                 vol(divset(D1,n1+1))=
                      upper_volume(chi(A,A),D1).(n1+1) by INTEGRA1:22;

n1+1 in Seg len upper_volume(chi(A,A),D1) by A288,INTEGRA1:def 7;

then n1+1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
                      then
A290:                 vol(divset(D1,n1+1)) in rng upper_volume(chi(A,A),D1)
                      by A289,FUNCT_1:def 5;

delta(D1)=max rng upper_volume(chi(A,A),D1) by INTEGRA1:def 19;
                      hence thesis by A290,XXREAL_2:def 8;
                    end;
                    then (sup rng f-inf rng f)*vol(divset(D1,n1+1))
                    <=(sup rng f-inf rng f)*delta(D1) by A287,XREAL_1:66;
                    hence Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                    -Sum mid(LVf(D1),n1+1,j) <= (sup rng f-inf rng f)*delta(D1)
                    by A286,XXREAL_0:2;
                  end;
                  suppose
A291:               n1+1 < j;
A292:               n1 < n1+1 by NAT_1:13;
                    then
A293:               D1.n1 < D1.(n1+1) by A202,A222, GOBOARD1:def 1;
                    then consider B being closed-interval Subset of REAL,
                    MD1,MD2 being Element of divs B such that
A294:               D1

.n1=inf B & sup B=MD2.(len MD2) & sup B=MD1.(len MD1) & MD1 <= MD2

& MD1=mid(D1,n1+1,j) & MD2=mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j))
                    by A20,A198,A217,A222,A229,Th14;
A295:               len MD1 = j-'(n1+1)+1 by A217,A220,A221,A294,JORDAN3:27;
                    j-'(n1+1) = j-(n1+1) by A217,BINARITH:50;
                    then
A296:               j-'(n1+1)+1=j-n1;
                    then
A297:               len MD1 = j-n1 by A217,A220,A221, A294,JORDAN3:27;
A298:               len
                    MD1+(n1+1)-1 = j-(n1+1)+1+(n1+1)-1 by A217,A295,BINARITH:50
                      .=j;
A299:               B c= A
                    proof
                      let x1;
                      assume
A300:                 x1 in B;
                      then reconsider x1 as Real;
A301:                 rng D1 c= A by INTEGRA1:def 2;
A302:                 D1
                      .n1 <= x1 & x1 <= MD1.(len MD1) by A294,A300,INTEGRA2:1;

D1.n1 in rng D1 & D1.j in rng D1 by A198,A202,FUNCT_1:def 5;
                      then
A303:                 inf A <= D1.n1 & D1.j <= sup A by A301,INTEGRA2:1;
                      MD1.(len MD1)=D1.(j-n1-1+(n1+1))
                      by A217,A218,A220,A221,A294,A296,A297,JORDAN3:31
                        .=D1.j;
                      then inf A <= x1 & x1 <= sup A by A302,A303,XXREAL_0:2;
                      hence thesis by INTEGRA2:1;
                    end;
                    then reconsider g=f|B as Function of B,REAL by FUNCT_2:38;
A304:               g is_bounded_on B
                    proof
A305:                 f

is_bounded_above_on A&f is_bounded_below_on A by A1,RFUNCT_1:def 11;
                      then consider a be real number such that
A306:                 for x being set st x in A /\ dom f holds a<=f.x
                      by RFUNCT_1:def 10;
                      for x being set st x in B /\ dom g holds a<=g.x
                      proof
                        let x be set;
                        assume x in B /\ dom g;
                        then
A307:                   x in dom g by XBOOLE_0:def 3;
                        then
A308:                   x in dom f /\ B by FUNCT_1 :68;
                        dom f /\ B c= dom f /\ A by A299,XBOOLE_1:26;
                        then a <= f.x by A306,A308;
                        hence thesis by A307,FUNCT_1:68;
                      end;
                      then
A309:                 g is_bounded_below_on B by RFUNCT_1:def 10;
                      consider a be real number such that
A310:                 for x being set st x in A /\ dom f holds f.x<=a
                      by A305,RFUNCT_1:def 9;
                      for x being set st x in B /\ dom g holds g.x<=a
                      proof
                        let x be set;
                        assume x in B /\ dom g;
                        then
A311:                   x in dom g by XBOOLE_0:def 3;
                        then
A312:                   x in dom f /\ B by FUNCT_1 :68;
                        dom f /\ B c= dom f /\ A by A299,XBOOLE_1:26;
                        then a >= f.x by A310,A312;
                        hence thesis by A311,FUNCT_1:68;
                      end;
                      then g is_bounded_above_on B by RFUNCT_1:def 9;
                      hence thesis by A309,RFUNCT_1:def 11;
                    end;
                    rng MD2 <> {};
                    then 1 in dom MD2 by FINSEQ_3:34;
                    then
A313:               1 <= len MD2 by FINSEQ_3:27;
A314:               len MD2=indx(D2,D1,j)-'indx(D2,D1,n1+1)+1
                    by A225,A226,A227,A294,JORDAN3:27;
                    then
A315:               len
                    MD2 = indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by A225,BINARITH:50;
                    then
A316:               len MD2-1+indx(D2,D1,n1+1)=indx(D2,D1,j);
A317:               rng MD2 = rng MD1 \/ {D.(i+1)}
                    proof
                      x1 in rng MD2 implies x1 in (rng MD1 \/ {D.(i+1)})
                      proof
                        assume
A318:                   x1 in rng MD2;
                        then reconsider x1 as Real;
A319:                   MD2.1=D2.indx(D2,D1,n1+1) by A226,A227,A294,JORDAN3:27;
                        MD2.(len MD2)=D2.indx(D2,D1,j)
                        by A225,A226,A227,A294,A313,A314,A316,JORDAN3:31;
                        then
A320:                   D1
                        .(n1+1) <= x1 & x1 <= D1.j by A223,A224,A318,A319,Th15;
A321:                   rng MD2 c= rng D2 by A294,JORDAN3:28;
                        now per cases by A20,A318,A321,XBOOLE_0:def 2;
                          suppose x1 in rng D1;
                            then consider k such that
A322:                       k in dom D1 & D1.k = x1 by PARTFUN1:26;
A323:                       n1

+1 <= k & k <= j by A198,A222,A320,A322,GOBOARD1:def 1;
                            then
A324:                       1 <= k-n1 & k-n1 <= len MD1 by A297,XREAL_1:11,21;
                            j-(n1+1)+1=j-n1;
                            then
A325:                       k-n1 <= j-(n1+1)+1 by A323,XREAL_1:11;
                            n1 <= n1+1 by NAT_1:11;
                            then n1 <= k by A323,XXREAL_0:2;
                            then consider n being Nat such that
A326:                       k=n1+n by NAT_1:10;
                            n in dom MD1 by A324,A326,FINSEQ_3:27;
                            then
A327:                       MD1.n in rng MD1 by FUNCT_1:def 5;
                            n in NAT by ORDINAL1:def 13;

then MD1.n = D1.(k-n1-1+(n1+1)) by A217,A220,A221,A294,A324,A325,A326,
                            JORDAN3:31
                              .= D1.k;

hence x1 in (rng MD1 \/ {D.(i+1)}) by A322,A327,XBOOLE_0:def 2;
                          end;
                          suppose x1 in rng D;
                            then consider n such that
A328:                       n in dom D & D.n = x1 by PARTFUN1:26;
A329:                       D.i <= sup divset(D1,n1) by A202,INTEGRA2:1;
                            sup divset(D1,n1)=D1.n1
                            proof
                              per cases;
                              suppose n1=1;
                                hence thesis by A202,INTEGRA1:def 5;
                              end;
                              suppose n1<>1;
                                hence thesis by A202,INTEGRA1:def 5;
                              end;
                            end;
                            then D.i < D1.(n1+1) by A293,A329,XXREAL_0:2;
                            then D.i < D.n by A320,A328,XXREAL_0:2;
                            then i < n by A201,A328,GOBOARD2:18;
                            then i+1 <= n by NAT_1:13;
                            then
A330:                       i+1 = n or i+1 < n by REAL_1:def 5;
                            not i+1 < n
                            proof
                              assume i+1 < n;
                              then
A331:                         D.(i+1) < D.n by A197,A328,GOBOARD1:def 1;
                              inf divset(D1,j) <= D.(i+1) by A198,INTEGRA2:1;
                              then
A332:                         inf divset(D1, j) <= D.n by A331,XXREAL_0:2;
                              sup divset(D1,j)=D1.j
                              proof
                                per cases;
                                suppose j=1;
                                  hence thesis by A198,INTEGRA1:def 5;
                                end;
                                suppose j<>1;
                                  hence thesis by A198,INTEGRA1:def 5;
                                end;
                              end;
                              then D.n in rng D&D.n in divset(D1,j)
                              by A320,A328,A332,FUNCT_1:def 5,INTEGRA2:1;
                              then
A333:                         x1
                              in rng D /\ divset(D1,j) by A328,XBOOLE_0:def 3;
A334:                         D.(i+1) in rng D by A197,FUNCT_1:def 5;
                              consider y1 being Real such that
A335:                         y1=D.(i+1);

y1 in rng D /\ divset(D1,j) by A198,A334,A335,XBOOLE_0:def 3;

hence contradiction by A19,A198,A328,A331,A333,A335,Th4;
                            end;
                            then x1 in {D.(i+1)} by A328,A330,TARSKI:def 1;

hence x1 in (rng MD1 \/ {D.(i+1)}) by XBOOLE_0:def 2;
                          end;
                        end;
                        hence thesis;
                      end;
                      then
A336:                 rng MD2 c= rng MD1 \/ {D.(i+1) } by TARSKI:def 3;
                      x1 in (rng MD1 \/ {D.(i+1)}) implies x1 in rng MD2
                      proof
                        assume
A337:                   x1 in rng MD1 \/ {D.(i+1)};
                        then reconsider x1 as Real;
                        now per cases by A337,XBOOLE_0:def 2;
                          suppose
A338:                       x1 in rng MD1;
                            rng MD1 c= rng D1 by A294,JORDAN3:28;
                            then
A339:                       x1 in rng D1 by A338;
                            rng MD1 <> {};
                            then 1 in dom MD1 by FINSEQ_3:34;
                            then
A340:                       1 <= len MD1 by FINSEQ_3:27;
A341:                       len
                            MD1=j-'(n1+1)+1 by A217,A220,A221,A294,JORDAN3:27;
A342:                       MD1.1=D1.(n1+1) by A220,A221,A294,JORDAN3:27;

len MD1+(n1+1)-1=j-(n1+1)+1+(n1+1)-1 by A217,A341,BINARITH:50
                              .=j;
                            then MD1.(len MD1)
                            =D1.j by A217,A220,A221,A294,A340,A341,JORDAN3:31;
                            then
A343:                       D2.indx(D2,D1,n1+1
                            ) <= x1 & x1 <= D2.indx(D2,D1,j)
                            by A223,A224,A338,A342,Th15;
                            rng D1 c= rng D2 by A20,INTEGRA1:def 20;
                            then consider k such that
A344:                       k in dom D2 & D2.k = x1 by A339,PARTFUN1:26;
A345:                       indx(D2,D1,n1+1)<=k & k<=indx(D2,D1,j)
                            by A223,A224,A343,A344,GOBOARD1:def 1;
                            then indx(D2,D1,n1+1)+1<=k+1 by XREAL_1:8;
                            then
A346:                       1 <= k+1-indx(D2, D1,n1+1) by XREAL_1:21;
                            k-indx(D2,D1,n1+1)<=indx(D2,D1,j)-indx(D2,D1,n1+1)
                            by A345,XREAL_1:11;
                            then
A347:                       k

-indx(D2,D1,n1+1)+1<=indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by XREAL_1:8;
                            indx(D2,D1,n1+1)<=k+1 by A345,NAT_1:12;
                            then consider n being Nat such that
A348:                       k+1 = indx(D2,D1,n1+1)+n by NAT_1:10;
A349:                       n in dom MD2 by A315,A346,A347,A348,FINSEQ_3:27;
                            n in NAT by ORDINAL1:def 13;
                            then MD2.n=D2.(n+indx(D2,D1,n1+1)-1)
                            by A225,A226,A227,A294,A346,A347,A348,JORDAN3:31
                              .=D2.k by A348;
                            hence x1 in rng MD2 by A344,A349,FUNCT_1:def 5;
                          end;
                          suppose x1 in {D.(i+1)};
                            then
A350:                       x1 = D.(i+1) by TARSKI:def 1;
A351:                       D.(i+1) in rng D by A197,FUNCT_1:def 5;
                            rng D c= rng D2 by A20,INTEGRA1:def 20;
                            then consider k such that
A352:                       k in dom D2 & x1 = D2.k by A350,A351,PARTFUN1:26;

inf divset(D1,j) <= D.(i+1) & D.(i+1) <= sup divset(D1,j) by A198,INTEGRA2:1;
                            then
A353:                       D1.(j-1) <= x1 &
                            x1 <= D1.j by A198,A205,A219,A350, INTEGRA1:def 5;
A354:                       j

-1 in dom D1 & j-1 in NAT by A198,A205,A219,INTEGRA1:9;

reconsider j1 = j-1 as Element of NAT by A198,A205,A219,INTEGRA1:9;
                            n1<j1 by A291,XREAL_1:22;
                            then n1+1 <= j1 by NAT_1:13;

then D1.(n1+1) <= D1.(j-1) by A222,A354,GOBOARD2:18;

then D2.indx(D2,D1,n1+1) <= D2.k & D2.k <= D2.indx(D2,D1,j)

by A20,A198,A223,A352,A353,INTEGRA1:def 21,XXREAL_0:2;
                            hence x1 in rng MD2 by A223,A224,A294,A352,Th16;
                          end;
                        end;
                        hence thesis;
                      end;
                      then rng MD1 \/ {D.(i+1)} c= rng MD2 by TARSKI:def 3;
                      hence thesis by A336,XBOOLE_0:def 10;
                    end;
A355:               len MD1 in dom MD1 by FINSEQ_5:6;
                    then
A356:               1 <= len MD1 by FINSEQ_3:27;
A357:               inf divset(MD1,len MD1)=inf divset(D1,j)
                    & sup divset(MD1,len MD1)=sup divset(D1,j)
                    proof
                      per cases;
                      suppose
A358:                   len MD1=1;
                        then
A359:                   inf divset(MD1,len MD1)= inf B

& sup divset(MD1,len MD1)=MD1.(len MD1) by A355,INTEGRA1:def 5;
                        inf divset(D1,j)=D1.(j-1)

& sup divset(D1,j)=D1.j by A198,A205,A219,INTEGRA1:def 5;
                        hence thesis by A220,A294,A298,A358,A359,JORDAN3:27;
                      end;
                      suppose
A360:                   len MD1<>1;
                        then
A361:                   inf divset(MD1,len MD1)= MD1.(len MD1-1)

& sup divset(MD1,len MD1)=MD1.(len MD1) by A355,INTEGRA1:def 5;
A362:                   len MD1-1+(n1+1)-1=j-1 by A297;
                        len MD1-1 in dom MD1 & len MD1-1 in NAT
                        by A355,A360,INTEGRA1:9;
                        then
A363:                   len MD1-1 >= 1 by Lm1;
                        len MD1 <= len MD1+1 by NAT_1:11;
                        then len MD1 -1 <= len MD1 by XREAL_1:22;
                        then
A364:                   inf

divset(MD1,len MD1)=D1.(j-1) by A217,A220,A221,A294,A295
                        ,A361,A362,A363,JORDAN3:31;
                        sup divset(MD1,len MD1)

=D1.j by A217,A220,A221,A294,A295,A298,A356,A361,JORDAN3:31;
                        hence thesis by A198,A205,A219,A364,INTEGRA1:def 5;
                      end;
                    end;
                    inf divset(D1,j)<=D.(i+1) & D.(i+1)<=sup divset(D1,j)
                    by A198,INTEGRA2:1;
                    then
A365:               D.(i+1) in divset(MD1,len MD1) by A357,INTEGRA2:1;
A366:               Sum lower_volume(g,MD2)-Sum lower_volume(g,MD1)<=
                    (sup rng g-inf rng g)*delta(MD1)
                    proof
                      vol(B)<>0 & D.(i+1) > inf B
                      proof
A367:                   vol(B)=sup B-D1.n1 by A294,INTEGRA1:def 6;
A368:                   len MD1 in dom MD1 by FINSEQ_5:6;
                        sup divset(MD1,len MD1)=MD1.(len MD1)
                        proof
                          per cases;
                          suppose len MD1 = 1;
                            hence thesis by A368,INTEGRA1:def 5;
                          end;
                          suppose len MD1 <> 1;
                            hence thesis by A368,INTEGRA1:def 5;
                          end;
                        end;

then vol(B)=D1.j-D1.n1 by A198,A205,A219,A294,A357,A367,INTEGRA1:def 5;
                        hence vol(B)<>0 by A198,A202,A205,GOBOARD1:def 1;
                        inf divset(D1,j) <= D.(i+1) by A198,INTEGRA2:1;
                        then
A369:                   D1.(j-1) <= D.(i+1) by A198,A205,A219,INTEGRA1:def 5;
A370:                   n1 < j-1 by A291,XREAL_1:22;
                        j-1 in dom D1 by A198,A205,A219,INTEGRA1:9;
                        then D1.n1 <D1.(j-1) by A202,A370,GOBOARD1:def 1;
                        hence thesis by A294,A369,XXREAL_0:2;
                      end;
                      hence thesis by A294,A304,A317,A365,Th12;
                    end;
A371:               rng g c= rng f by RELAT_1:99;
                    f is_bounded_above_on A & f is_bounded_below_on A
                    by A1,RFUNCT_1:def 11;
                    then rng f is bounded_above & rng f is bounded_below
                    by INTEGRA1:13,15;
                    then sup rng f >= sup rng g & inf rng f <= inf rng g
                    by A371,SEQ_4:64,65;
                    then
A372:               sup rng f-inf rng f>=sup rng g - inf rng g by REAL_1:92;
                    delta(MD1) >= 0 by Th8;

then (sup rng f-inf rng f)*delta(MD1)>=(sup rng g-inf rng g)*delta(MD1 )
                    by A372,XREAL_1:66;
                    then
A373:               Sum lower_volume(g,MD2)-Sum lower_volume(g,MD1)<=
                    (sup rng f-inf rng f)*delta(MD1) by A366,XXREAL_0:2;

delta(MD1)=max rng upper_volume(chi(B,B),MD1) by INTEGRA1:def 19;

then delta(MD1) in rng upper_volume(chi(B,B),MD1) by XXREAL_2:def 8;
                    then consider k such that
A374:               k in dom upper_volume(chi(B,B),MD1)
                    & upper_volume(chi(B,B),MD1).k = delta(MD1) by PARTFUN1:26;

k in Seg len upper_volume(chi(B,B),MD1) by A374,FINSEQ_1:def 3;
                    then
A375:               k in Seg len MD1 by INTEGRA1:def 7;
  then k in dom MD1 by FINSEQ_1:def 3;
                    then
A376:               delta(MD1) = vol(divset(MD1,k)) by A374,INTEGRA1:22;
                    n1+1>1 by A219,NAT_1:13;
                    then n1>1-1 by XREAL_1:21;
                    then
A377:               1

<= k & k <= len MD1 & k < k+n1 by A375,FINSEQ_1:3,XREAL_1:31;
                    then
A378:               1 < k+n1 by XXREAL_0:2;
A379:               k in dom MD1 by A375,FINSEQ_1:def 3;
                    k+n1 <= j by A297,A377,XREAL_1:21;
                    then k+n1 <= len D1 by A220,XXREAL_0:2;
                    then
A380:               k+n1 in dom D1 by A378,FINSEQ_3:27;
A381:               divset(MD1,k)=divset(D1,k+n1)
                    proof
                      inf divset(MD1,k)=inf divset(D1,k+n1)
                      & sup divset(MD1,k)=sup divset(D1,k+n1)
                      proof
                        per cases;
                        suppose
A382:                     k=1;

then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k by A379,INTEGRA1:def 5;
                          then
A383:                     inf

divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
                          by A217,A220,A221,A294,A295,A377,JORDAN3:31;

inf divset(D1,k+n1)=D1.(k+n1-1) & sup divset(D1,k+n1)=D1.(k+n1)
                          by A377,A380,INTEGRA1:def 5;
                          hence thesis by A382,A383;
                        end;
                        suppose
A384:                     k<>1;
                          then
A385:                     k-1 in dom MD1 & k-1 in NAT by A379,INTEGRA1:9;
                          then
A386:                     1 <= k-1 & k-1 <= len MD1 by Lm1;
                          inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.
                          k by A379,A384,INTEGRA1:def 5;
                          then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
                          & sup divset(MD1,k)=D1.(k+(n1+1)-1)

by A217,A220,A221,A294,A295,A377,A385,A386,JORDAN3:31;
                          hence thesis by A377,A380,INTEGRA1:def 5;
                        end;
                      end;

then divset(MD1,k)=[.inf divset(D1,k+n1),sup divset(D1,k+n1).] by INTEGRA1:5;
                      hence thesis by INTEGRA1:5;
                    end;
A387:               k+n1 in Seg len D1 by A380,FINSEQ_1:def 3;
  then k+n1 in dom D1 by FINSEQ_1:def 3;
                    then
A388:               delta(MD1)=upper_volume(chi(A,A), D1).(k+n1) by A376,A381,
                    INTEGRA1:22;

k+n1 in Seg len upper_volume(chi(A,A),D1) by A387,INTEGRA1:def 7;

then k+n1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;

then delta(MD1) in rng upper_volume(chi(A,A),D1) by A388,FUNCT_1:def 5;

then delta(MD1) <= max rng upper_volume(chi(A,A),D1) by XXREAL_2:def 8;
                    then
A389:               delta(MD1) <= delta(D1) by INTEGRA1:def 19;
                    sup rng f - inf rng f >= 0 by A1,Lm4,XREAL_1:50;
                    then
A390:               (sup rng f-inf rng f)*delta(MD1) <= (sup rng f-inf rng f)*
                    delta(D1) by A389,XREAL_1:66;
A391:               indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A392:               1 <= indx(D2,D1,n1)+1 by A204,NAT_1:13;
                    D1.n1 < D1.(n1+1) by A202,A222,A292,GOBOARD1:def 1;

then indx(D2,D1,n1) < indx(D2,D1,n1+1) by A203,A223,GOBOARD2:18;
                    then
A393:               indx(D2,D1,n1)+1 <= indx(D2,D1,n1+ 1) by NAT_1:13;
                    then
A394:               indx(D2,D1,n1)+1 <= len D2 by A226,XXREAL_0:2;
                    then
A395:               indx(D2,D1,n1)+1 <= len LVf(D2) by INTEGRA1:def 8;
A396:               indx(D2,D1,n1+1)=indx(D2,D1,n1)+1
                    proof
                      assume indx(D2,D1,n1+1)<> indx(D2,D1,n1)+1;
                      then
A397:                 indx(D2,D1,n1+1)>indx(D2,D1,n1 )+1 by A393,REAL_1:def 5;
A398:                 indx(D2,D1,n1)+1 in dom D2 by A392,A394,FINSEQ_3:27;
                      then
A399:                 D2.(indx(D2,D1,n1)+1) in rng D2 by FUNCT_1:def 5;
                      now per cases by A20,A399,XBOOLE_0:def 2;
                        suppose D2.(indx(D2,D1,n1)+1) in rng D1;
                          then consider n2 being Element of NAT such that
A400:                     n2

in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.n2 by PARTFUN1:26;
                          D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
                          by A203,A391,A398,GOBOARD1:def 1;
                          then n1 < n2 by A202,A203,A400,GOBOARD2:18;
                          then
A401:                     n1+1 <= n2 by NAT_1:13;

D1.n2 < D1.(n1+1) by A223,A397,A398,A400,GOBOARD1:def 1;
                          hence contradiction by A222,A400,A401,GOBOARD2:18;
                        end;
                        suppose D2.(indx(D2,D1,n1)+1) in rng D;
                          then consider n2 being Element of NAT such that
A402:                     n2

in dom D & D2.(indx(D2,D1,n1)+1) = D.n2 by PARTFUN1:26;
A403:                     D1.n1 < D.n2 by A203,A391,A398,A402,GOBOARD1:def 1;
A404:                     D.i <= sup divset(D1,n1) by A202,INTEGRA2:1;
                          sup divset(D1,n1)=D1.n1
                          proof
                            per cases;
                            suppose n1=1;
                              hence thesis by A202,INTEGRA1:def 5;
                            end;
                            suppose n1<>1;
                              hence thesis by A202,INTEGRA1:def 5;
                            end;
                          end;
                          then D.i < D.n2 by A403,A404,XXREAL_0:2;
                          then i < n2 by A201,A402,GOBOARD2:18;
                          then
A405:                     i+1 <= n2 by NAT_1:13;
A406:                     D

.n2 < D1.(n1+1) by A223,A397,A398,A402,GOBOARD1:def 1;
A407:                     j

-1 in dom D1 & j-1 in NAT by A198,A205,A219,INTEGRA1:9;
                          n1+1 +1 <= j by A291,NAT_1:13;
                          then n1+1 <= j-1 by XREAL_1:21;
                          then
A408:                     D1.(n1+1) <= D1.(j-1) by A222,A407,GOBOARD2:18;
A409:                     inf divset(D1,j) <= D.(i+1) by A198,INTEGRA2:1;

inf divset(D1,j) = D1.(j-1) by A198,A205,A219,INTEGRA1:def 5;
                          then D1.(n1+1) <= D.(i+1) by A408,A409,XXREAL_0:2;
                          then D.n2 < D.(i+1) by A406,XXREAL_0:2;
                          hence contradiction by A197,A402,A405,GOBOARD2:18;
                        end;
                      end;
                      hence contradiction;
                    end;
A410:               Sum

lower_volume(g,MD2)=Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                    proof

lower_volume(g,MD2)=mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                      proof
A411:                   len
                        lower_volume(g,MD2)=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1
                        by A315,A396,INTEGRA1:def 8;
A412:                   indx(D2,D1,j) <= len LVf(D2) by A227,INTEGRA1:def 8;
A413:                   indx
                        (D2,D1,n1)+1 <= indx(D2,D1,j) by A225,A393,XXREAL_0:2;
                        then len mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))

= indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1 by A227,A392,A395,A412, JORDAN3:27;
                        then
A414:                   len lower_volume(g,MD2)
                        =len mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        by A225,A393,A411,BINARITH:50,XXREAL_0:2;
                        for k be Nat st 1<=k & k<=len lower_volume(g,MD2)
                        holds

lower_volume(g,MD2).k=mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
                        proof
                          let k be Nat;
                          assume
A415:                     1 <= k & k <= len lower_volume(g,MD2);
                          then
A416:                     k in Seg len lower_volume(g,MD2) by FINSEQ_1:3;
                          then
A417:                     k in Seg len MD2 by INTEGRA1:def 8;
  then
B417:  k in dom MD2 by FINSEQ_1:def 3;
A418:                     divset

(MD2,k)=[.inf divset(MD2,k),sup divset(MD2,k).] by INTEGRA1:5;
A419:                     mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
                          =LVf(D2).(k+(indx(D2,D1,n1)+1)-1)
                          by A392,A411,A412,A413,A415,A416,JORDAN3:31;

k <= indx(D2,D1,j)-((indx(D2,D1,n1)+1)-1) by A315,A396,A415, INTEGRA1:def 8;

then k+((indx(D2,D1,n1)+1)-1) <= indx(D2,D1,j) by XREAL_1:21;
                          then
A420:                     k

+(indx(D2,D1,n1)+1)-1 <= len LVf(D2) by A412,XXREAL_0:2;
                          1<=indx(D2,D1,n1)+1 by NAT_1:12;
                          then 1+1<=k+(indx(D2,D1,n1)+1) by A415,XREAL_1:9;
                          then
A421:                     1 <= k+(indx(D2,D1,n1) +1)-1 by XREAL_1:21;
                          consider k2 being Element of NAT such that
A422:                     indx(D2,D1,n1)+1=1+k2;
                          k+k2 in Seg len LVf(D2) by A420,A421,A422,FINSEQ_1:3;
                          then
A423:                     k+k2 in Seg len D2 by INTEGRA1:def 8;
  then k+k2 in dom D2 by FINSEQ_1:def 3;
                          then
A424:                     mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
                          =(inf rng(f|divset(D2,k+k2)))*vol(divset(D2,k+k2))
                          by A419,A422,INTEGRA1:def 8;
                          inf divset(MD2,k)=inf divset(D2,k+k2)
                          & sup divset(MD2,k)=sup divset(D2,k+k2)
                          proof
                            k+k2>=1+1 by A204,A415,A422,XREAL_1:9;
                            then
A425:                       k+k2>1 by NAT_1:13;
A426:                       k in dom MD2 by A417,FINSEQ_1:def 3;
A427:                       k+k2 in dom D2 by A423,FINSEQ_1:def 3;
                            per cases;
                            suppose
A428:                         k=1;

then inf divset(MD2,k)=inf B & sup divset(MD2,k)=MD2.k by A426,INTEGRA1:def 5;
                              then
A429:                         inf divset(MD2,k)=D1.n1
                              & sup divset(MD2,k)=D2.(k+(indx(D2,D1,n1)+1)-1)

by A225,A227,A294,A392,A396,A411,A415,A416,JORDAN3:31;

inf divset(D2,k+k2)=D2.(k+k2-1) &sup divset(D2,k+k2)=D2.(k+k2 )
                              by A425,A427,INTEGRA1:def 5;

hence thesis by A20,A202,A422,A428,A429,INTEGRA1:def 21;
                            end;
                            suppose
A430:                         k<>1;
                              then
A431:                         k-1 in dom MD2 & k-1 in NAT by A426,INTEGRA1:9;
                              then
A432:                         1 <= k-1 by Lm1;
A433:                         k

-1 <= indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A411,A415,XREAL_1:148 ,XXREAL_0:2;

inf divset(MD2,k)=MD2.(k-1) & sup divset(MD2,k)=MD2.k
                              by A426,A430,INTEGRA1:def 5;

then inf divset(MD2,k)=D2.(k-1+(indx(D2,D1,n1)+1)-1)
                              & sup divset(MD2,k)=D2.(k+(indx(D2,D1,n1)+1)-1)

by A225,A227,A294,A392,A396,A411,A415,A416,A431,A432,A433, JORDAN3:31;
                              hence thesis by A422,A425,A427,INTEGRA1:def 5;
                            end;
                          end;
                          then
A434:                     divset(MD2,k)=divset( D2,k+k2) by A418,INTEGRA1:5;
                          rng(f|divset(D2,k+k2))=rng(g|divset(D2,k+k2))
                          proof
                            k in dom MD2 by A417,FINSEQ_1:def 3;
                            then divset(D2,k+k2) c= B by A434,INTEGRA1:10;
                            hence thesis by FUNCT_1:82;
                          end;
                          hence thesis by A424,A434,INTEGRA1:def 8,B417;
                        end;
                        hence thesis by A414,FINSEQ_1:18;
                      end;
                      hence thesis;
                    end;
                    Sum lower_volume(g,MD1)=Sum mid(LVf(D1),n1+1,j)
                    proof
A435:                 len lower_volume(g,MD1)=len MD1 by INTEGRA1:def 8
                        .=j-'(n1+1)+1 by A217,A220,A221,A294,JORDAN3:27
                        .=j-(n1+1)+1 by A217,BINARITH:50;
A436:                 n1+1 <= len LVf(D1) by A221,INTEGRA1:def 8;
A437:                 j <= len LVf(D1) by A220,INTEGRA1:def 8;
                      then
A438:                 len mid(LVf(D1),n1+1,j)
                      =j-'(n1+1)+1 by A217,A220,A221,A436,JORDAN3:27
                        .=j-(n1+1)+1 by A217,BINARITH:50;
                      lower_volume(g,MD1)=mid(LVf(D1),n1+1,j)
                      proof
                        for k be Nat st 1<=k & k<=len lower_volume(g,MD1)
                        holds lower_volume(g,MD1).k=mid(LVf(D1),n1+1,j).k
                        proof
                          let k be Nat;
                          assume
A439:                     1 <= k & k <= len lower_volume(g,MD1);
                          then
A440:                     k in Seg len lower_volume(g,MD1) by FINSEQ_1:3;
                          then
A441:                     k in Seg len MD1 by INTEGRA1:def 8;
  then k in dom MD1 by FINSEQ_1:def 3;
                          then
A442:                     lower_volume(g,MD1).k

=(inf rng(g|divset(MD1,k)))*vol(divset(MD1,k)) by INTEGRA1:def 8;
                          k <= j-((n1+1)-1) by A435,A439;
                          then
A443:                     k+((n1+1)-1) <= j by XREAL_1:21;
                          consider k2 being Element of NAT such that
A444:                     n1+1=1+k2;
A445:                     k2=(n1+1)-1 by A444;
A446:                     1 <= k+k2 by A439,NAT_1:12;
                          k+k2 <= len D1 by A220,A443,A444,XXREAL_0:2;
                          then
A447:                     k+k2 in Seg len D1 by A446,FINSEQ_1:3;
  then
B447:  k+k2 in dom D1 by FINSEQ_1:def 3;
A448:                     mid(LVf(D1),n1+1,j).k

=LVf(D1).(k+(n1+1)-1) by A217,A221,A435,A437,A439,A440,JORDAN3:31
                            .=(inf rng(f|divset(D1,k+k2)))*vol(divset(D1,k+k2))
                          by A444,INTEGRA1:def 8,B447;
                          1+1 <= k+k2 by A220,A439,A444,XREAL_1:9;
                          then
A449:                     1 < k+k2 by NAT_1:13;
A450:                     divset(MD1,k)=[.inf divset(MD1,k),sup divset(MD1,k).]
                          by INTEGRA1:5;
A451:                     k in dom MD1 by A441,FINSEQ_1:def 3;
A452:                     k+k2 in dom D1 by A447,FINSEQ_1:def 3;
A453:                     divset(D1,k+k2)=divset(MD1,k)
                          proof
                            inf divset(D1,k+k2)=inf divset(MD1,k)
                            & sup divset(D1,k+k2)=sup divset(MD1,k)
                            proof
                              per cases;
                              suppose
A454:                           k=1;

then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k by A451,INTEGRA1:def 5;

then inf divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)

by A217,A220,A221,A294,A435,A439,A440,JORDAN3:31;

hence thesis by A445,A449,A452,A454,INTEGRA1:def 5;
                              end;
                              suppose
A455:                           k<>1;
                                then
A456:                           k-1 in dom
                                MD1 & k-1 in NAT by A451,INTEGRA1:9;
                                then
A457:                           1 <= k-1 by Lm1;
A458:                           k

-1 <= j-(n1+1)+1 by A435,A439,XREAL_1:148,XXREAL_0:2;

inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
                                by A451,A455,INTEGRA1:def 5;
                                then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
                                & sup divset(MD1,k)=D1.(k+(n1+1)-1)

by A217,A220,A221,A294,A435,A439,A440,A456,A457,A458,JORDAN3:31;
                                hence thesis by A444,A449,A452,INTEGRA1:def 5;
                              end;
                            end;
                            hence thesis by A450,INTEGRA1:5;
                          end;
                          k in dom MD1 by A441,FINSEQ_1:def 3;
                          then divset(D1,k+k2) c= B by A453,INTEGRA1:10;
                          hence thesis by A442,A448,A453,FUNCT_1:82;
                        end;
                        hence thesis by A435,A438,FINSEQ_1:18;
                      end;
                      hence thesis;
                    end;
                    hence Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)) -Sum

mid(LVf(D1),n1+1,j) <= (sup rng f-inf rng f)*delta(D1) by A373,A390,A410,
                    XXREAL_0:2;
                  end;
                end;
                hence thesis;
              end;
A459:         PLf(D2,indx(D2,D1,j))=

PLf(D2,indx(D2,D1,n1))+Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
              proof
A460:           indx(D2,D1,n1)<indx(D2,D1,j) by A225,A228,XXREAL_0:2;
                indx(D2,D1,j) in Seg len D2 by A224,FINSEQ_1:def 3;
                then
                indx(D2,D1,j) in Seg len LVf(D2) by INTEGRA1:def 8;
  then
B461:  indx(D2,D1,j) in dom LVf(D2) by FINSEQ_1:def 3;
A462:           indx(D2,D1,j) <= len LVf(D2) by A227,INTEGRA1:def 8;
                indx(D2,D1,n1) in Seg len D2 by A203,FINSEQ_1:def 3;
                then indx(D2,D1,n1) in Seg len LVf(D2) by INTEGRA1:def 8;
  then indx(D2,D1,n1) in dom LVf(D2) by FINSEQ_1:def 3;
                then PLf(D2,indx(D2,D1,n1))=Sum(LVf(D2)|indx(D2,D1,n1)) by
                INTEGRA1:def 22
                  .=Sum mid(LVf(D2),1,indx(D2,D1,n1)) by A204,JORDAN3:25;

then PLf(D2,indx(D2,D1,n1))+Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2, D1,j))
                =Sum(mid(LVf(D2),1,indx(D2,D1,n1))^
                mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))) by RVSUM_1:105

.=Sum mid(LVf(D2),1,indx(D2,D1,j)) by A204,A460,A462,INTEGRA2:4
                  .=Sum(LVf(D2)|indx(D2,D1,j)) by A227,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B461;
              end;
A463:         PLf(D1,j)=PLf(D1,n1)+Sum mid(LVf(D1),n1+1,j)
              proof
A464:           j <= len LVf(D1) by A220,INTEGRA1:def 8;
                then
                j in Seg len LVf(D1) by A220,FINSEQ_1:3;
  then
B465:  j in dom LVf(D1) by FINSEQ_1:def 3;
                n1 in Seg len D1 by A202,FINSEQ_1:def 3;
                then n1 in Seg len LVf(D1) by INTEGRA1:def 8;
  then n1 in dom LVf(D1) by FINSEQ_1:def 3;
                then PLf(D1,n1)=Sum(LVf(D1)|n1) by INTEGRA1:def 22
                  .=Sum mid(LVf(D1),1,n1) by A220,JORDAN3:25;
                then PLf(D1,n1)+Sum mid(LVf(D1),n1+1,j)
                =Sum(mid(LVf(D1),1,n1)^mid(LVf(D1),n1+1,j)) by RVSUM_1:105
                  .=Sum mid(LVf(D1),1,j) by A205,A220,A464,INTEGRA2:4
                  .=Sum(LVf(D1)|j) by A220,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B465;
              end;
A466:         (PLf(D2,indx(D2,D1,n1))-PLf(D1,n1))+
              (Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
              -Sum mid(LVf(D1),n1+1,j))

<=i*(sup rng f-inf rng f)*delta(D1)+(sup rng f-inf rng f)*delta(D1)
              by A202,A230,XREAL_1:9;
              (PLf(D2,indx(D2,D1,n1))-PLf(D1,n1))+
              (Sum mid(LVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
              -Sum mid(LVf(D1),n1+1,j))
              =PLf(D2,indx(D2,D1,j))-PLf(D1,j) by A459,A463;
              hence thesis by A198,A466;
            end;
            hence thesis;
          end;
A467:     for k being non empty Nat holds P[k] from NAT_1:sch 10(A42,A194);
          i in Seg len D by A22,FINSEQ_1:def 3;
          then reconsider i as non empty Element of NAT by FINSEQ_1:3;
          P[i] by A467;
          hence thesis by A22;
        end;
        len D in dom D by FINSEQ_5:6;
        then consider j such that
A468:   j in dom D1 & D.(len D) in divset(D1,j) &
        PLf(D2,indx(D2,D1,j))-PLf(D1,j)
        <= (len D)*(sup(rng f)-inf(rng f))*delta(D1) by A21;
A469:   len D1 in dom D1 by FINSEQ_5:6;
A470:   j = len D1
        proof
          assume
A471:     j<>len D1;
A472:     D.(len D) <= sup divset(D1,j) by A468,INTEGRA2:1;
          j <= len D1 by A468,FINSEQ_3:27;
          then j < len D1 by A471,REAL_1:def 5;
          then D1.j < D1.(len D1) by A468,A469,GOBOARD1:def 1;
          then
A473:     D1.j < sup A by INTEGRA1:def 2;
          sup divset(D1,j) < sup A
          proof
            per cases;
            suppose j=1;
              hence thesis by A468,A473,INTEGRA1:def 5;
            end;
            suppose j<>1;
              hence thesis by A468,A473,INTEGRA1:def 5;
            end;
          end;
          hence contradiction by A472,INTEGRA1:def 2;
        end;
A474:   len D2 in dom D2 by FINSEQ_5:6;
A475:   indx(D2,D1,len D1) in dom D2 &
        D1.(len D1) = D2.indx(D2,D1,len D1) by A20,A469,INTEGRA1:def 21;
        then sup A = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
        then D2.(len D2) = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
        then indx(D2,D1,len D1)=len D2 by A474,A475,GOBOARD2:19;
        then PLf(D2,len D2)-lower_sum(f,D1)<=(len D)*(sup(rng f)-inf(rng f))*
        delta(D1) by A468,A470,INTEGRA1:45;
        hence thesis by INTEGRA1:45;
      end;
      hence thesis by A20;
    end;
    hence thesis;
  end;
A476: for e be real number st e>0 ex n st for m st n<=m holds
  abs((lower_sum(f,T)).m-lower_integral(f))<e
  proof
    let e be real number;
    assume
A477: e>0;
    then
A478: e/2>0 by REAL_2:127;
    reconsider e as Real by XREAL_0:def 1;
A479: lower_integral(f) = sup rng lower_sum_set(f) by INTEGRA1:def 16;
A480: rng lower_sum_set(f) is bounded_above by A1,INTEGRA2:36;
    dom lower_sum_set(f) is non empty by INTEGRA1:def 12;
    then rng lower_sum_set(f) is non empty by RELAT_1:65;
    then consider y be real number such that
A481: y in rng lower_sum_set(f) & lower_integral(f)-e/2<y
    by A478,A479,A480,SEQ_4:def 4;
    consider D being Element of divs A such that
A482: D in dom lower_sum_set(f) & y=(lower_sum_set(f)).D & D.1>inf A
    by A3,A481,Lm8;
A483: y=lower_sum(f,D) by A482,INTEGRA1:def 12;
    set p=len D;
    set H=sup rng f;
    set h=inf rng f;
    deffunc F(Nat)=vol(divset(D,$1));
    consider v being FinSequence of REAL such that
A484: len v = len D & for j be Nat st j in dom v holds v.j=F(j)
    from FINSEQ_2:sch 1;
A485: dom v = Seg len D by A484,FINSEQ_1:def 3;
    consider v1 being non-decreasing FinSequence of REAL such that
A486: v,v1 are_fiberwise_equipotent by INTEGRA2:3;
    defpred P[Nat] means $1 in dom v1 & v1.$1>0;
A487: ex k be Nat st P[k]
    proof
      consider H being Function such that
A488: dom H = dom v & rng H = dom v1 & H is one-to-one & v=v1*H
      by A486,RFINSEQ:3;
      consider k such that
A489: k in dom D & vol(divset(D,k)) > 0 by A3,Th1;
      dom D = Seg len v by A484,FINSEQ_1:def 3;
      then
A490: k in dom v & v.k > 0 by A484,A489,A485;
      then H.k in dom v1 & v1.(H.k) > 0 by A488,FUNCT_1:21,22;
      then reconsider Hk = H.k as Nat;
      P[Hk] by A488,A490,FUNCT_1:21,22;
      hence thesis;
    end;
    consider k be Nat such that
A491: P[k] & for n be Nat st P[n] holds k<=n from NAT_1:sch 5(A487);
    p <> 0 by CARD_2:59;
    then p > 0;
    then
A492: 2*p >0 by REAL_2:122;
    H-h >= 0 by A1,Lm4,XREAL_1:50;
    then H-h+1 > 0+0;
    then
A493: 2*p*(H-h+1) > 0 by A492,REAL_2:122;
    min(v1.k,e/(2*p*(H-h+1))) > 0
    proof
      per cases by XXREAL_0:15;
      suppose min(v1.k,e/(2*p*(H-h+1))) = v1.k;
        hence thesis by A491;
      end;
      suppose min(v1.k,e/(2*p*(H-h+1))) = e/(2*p*(H-h+1));
        hence thesis by A477,A493,REAL_2:127;
      end;
    end;
    then consider n such that
A494: for m st n<=m holds 0 < (delta(T)).m
    & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A5;
A495: for m st n<=m holds abs((lower_sum(f,T)).m-lower_integral(f))<e
    proof
      let m;
      assume
A496: n<=m;
      then
A497: 0 < (delta(T)).m & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A494;
      reconsider D1 = T.m as Element of divs A;
      consider D2 being Element of divs A such that
A498: D <= D2 & D1 <= D2 & rng D2 = rng D1 \/ rng D &
      0 <= lower_sum(f,D2)-lower_sum(f,D) &
      0 <= lower_sum(f,D2)-lower_sum(f,D1) by A14;
      f is_bounded_below_on A by A1,RFUNCT_1:def 11;
      then lower_sum(f,D) <= lower_sum(f,D2) by A498,INTEGRA1:48;
      then
A499: lower_sum(f,D)-lower_sum(f,D2)<=0 by REAL_2:106;
A500: delta(D1)=(delta(T)).m by INTEGRA2:def 3;
A501: delta(D1)<min (v1.k,e/(2*p*(H-h+1))) by A497,INTEGRA2:def 3;
      min (v1.k,e/(2*p*(H-h+1))) <= v1.k by XXREAL_0:17;
      then
A502: delta(D1)<v1.k by A501,XXREAL_0:2;
A503: v1.1 > 0
      proof
A504:   for n1 be Element of NAT st n1 in dom D holds vol(divset(D,n1))>0
        proof
          let n1 be Element of NAT;
          assume
A505:     n1 in dom D;
          then
A506:     1 <= n1 by FINSEQ_3:27;
          per cases by A506,REAL_1:def 5;
          suppose
A507:       n1=1;
            then inf divset(D,n1)=inf A & sup divset(D,n1)=D.n1
            by A505,INTEGRA1:def 5;
            then vol(divset(D,n1))=D.n1-inf A by INTEGRA1:def 6;
            hence thesis by A482,A507,XREAL_1:52;
          end;
          suppose
A508:       n1>1;
            then inf divset(D,n1)=D.(n1-1) & sup divset(D,n1)=D.n1
            by A505,INTEGRA1:def 5;
            then
A509:       vol(divset(D,n1))=D.n1-D.(n1-1) by INTEGRA1:def 6;
A510:       n1-1 in dom D by A505,A508,INTEGRA1:9;
            n1 < n1+1 by XREAL_1:31;
            then n1-1 < n1 by XREAL_1:21;
            then D.(n1-1)<D.n1 by A505,A510,GOBOARD1:def 1;
            hence thesis by A509,XREAL_1:52;
          end;
        end;
        1 <= k & k <= len v1 by A491,FINSEQ_3:27;
        then 1 <= len v1 by XXREAL_0:2;
        then 1 in dom v1 by FINSEQ_3:27;
        then
A511:   v1.1 in rng v1 by FUNCT_1:def 5;
        rng v = rng v1 by A486,RFINSEQ:1;
        then consider n1 being Element of NAT such that
A512:   n1 in dom v & v1.1 = v.n1 by A511,PARTFUN1:26;
A513:   n1 in Seg len D by A484,A512,FINSEQ_1:def 3;
A514:   v1.1 = vol(divset(D,n1)) by A484,A512;
        n1 in dom D by A513,FINSEQ_1:def 3;
        hence thesis by A504,A514;
      end;
      v1.k = min rng upper_volume(chi(A,A),D)
      proof
A515:   k=1
        proof
          assume
A516:     k <> 1;
A517:     len v1 = len v by A486,RFINSEQ:16;
A518:     k in Seg len v1 by A491,FINSEQ_1:def 3;
          k in Seg len v by A491,A517,FINSEQ_1:def 3;
          then
A519:     1 <= k & k <= len D by A484,FINSEQ_1:3;
          then
A520:     k > 1 by A516,REAL_1:def 5;
          k <= len v1 by A518,FINSEQ_1:3;
          then 1 <= len v1 by A519,XXREAL_0:2;
          then 1 in dom v1 by FINSEQ_3:27;
          hence contradiction by A491,A503,A520;
        end;
        min rng upper_volume(chi(A,A),D) in rng upper_volume(chi(A,A),D)
        & for x st x in rng upper_volume(chi(A,A),D)
        holds min rng upper_volume(chi(A,A),D) <= x by XXREAL_2:def 7;
        then consider m such that
A521:   m in dom upper_volume(chi(A,A),D)
        & min rng upper_volume(chi(A,A),D)=upper_volume(chi(A,A),D).m
        by PARTFUN1:26;
        m in Seg len upper_volume(chi(A,A),D) by A521,FINSEQ_1:def 3;
        then
A522:   m in Seg len D by INTEGRA1:def 7;
  then m in dom D by FINSEQ_1:def 3;
        then min rng upper_volume(chi(A,A),D)=vol(divset(D,m))
        by A521,INTEGRA1:22;
        then
A523:   v.m=min rng upper_volume(chi(A,A),D) by A484,A522,A485;
        m in dom v by A484,A522,FINSEQ_1:def 3;
        then
A524:   min rng upper_volume(chi(A,A),D) in rng v by A523,FUNCT_1: def 5;
A525:   rng v = rng v1 by A486,RFINSEQ:1;
        then consider m1 being Element of NAT such that
A526:   m1 in dom v1 & min rng upper_volume(chi(A,A),D)=v1.m1
        by A524,PARTFUN1:26;
        m1 >= 1 by A526,FINSEQ_3:27;
        then
A527:   v1.1 <= min rng upper_volume(chi(A,A),D) by A491,A515,A526,
        INTEGRA2:2;
        v1.k in rng v1 by A491,FUNCT_1:def 5;
        then consider k2 being Element of NAT such that
A528:   k2 in dom v & v1.k = v.k2 by A525,PARTFUN1:26;
A529:   k2 in Seg len D by A484,A528,FINSEQ_1:def 3;
  then
B529:  k2 in dom D by FINSEQ_1:def 3;
        v1.k = vol(divset(D,k2)) by A484,A528;
        then
A530:   v1.k = upper_volume(chi(A,A),D).k2 by INTEGRA1:22,B529;
        k2 in Seg len upper_volume(chi(A,A),D) by A529,INTEGRA1:def 7;
        then k2 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
        then v1.k in rng upper_volume(chi(A,A),D) by A530,FUNCT_1:def 5;
        then v1.k >= min rng upper_volume(chi(A,A),D) by XXREAL_2:def 7;
        hence thesis by A515,A527,XXREAL_0:1;
      end;
      then consider D3 being Element of divs A such that
A531: D<=D3 & D1<=D3 & rng D3=rng D1 \/
      rng D & lower_sum(f,D3)-lower_sum(f,D1)
      <=(len D)*(sup rng f-inf rng f)*delta(D1) by A18,A502;
A532: lower_sum(f,D2)-lower_sum(f,D1)<=(len D)*(sup rng f-inf rng f)*delta(D1)
      by A498,A531,Th5;
      H-h <= H-h+1 by XREAL_1:31;
      then p*(H-h)<=p*(H-h+1) by XREAL_1:66;
      then p*(H-h)*(delta(T)).m <= p*(H-h+1)*(delta(T)).m by A497,XREAL_1:66;
      then
A533: lower_sum(f,D2)-lower_sum(f,T.m) <= p*(H-h+1)*(delta(T)).m
      by A500,A532,XXREAL_0:2;
A534: (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A494,A496;
      min(v1.k,e/(2*p*(H-h+1))) <= e/(2*p*(H-h+1)) by XXREAL_0:17;
      then (delta(T)).m < e/(2*p*(H-h+1)) by A534,XXREAL_0:2;
      then (delta(T)).m*(2*p*(H-h+1))<e by A493,REAL_2:177;
      then ((delta(T)).m*(p*(H-h+1)))*2<e;
      then
A535: p*(H-h+1)*(delta(T)).m < e/2 by REAL_2:178;
      set s=lower_integral(f);
      set sD=lower_sum(f,D);
      set sD1=lower_sum(f,T.m);
      set sD2=lower_sum(f,D2);
      s-sD1+sD1 < sD+e/2 by A481,A483,XREAL_1:21;
      then
A536: s-sD1 < sD+e/2-sD1 by XREAL_1:22;
      (sD-sD1) - (sD2-sD1) = (sD-sD2);
      then sD-sD1 <= sD2-sD1 by A499,XREAL_1:52;
      then sD-sD1 <= p*(H-h+1)*(delta(T)).m by A533,XXREAL_0:2;
      then sD-sD1 < e/2 by A535,XXREAL_0:2;
      then sD-sD1+e/2 < e/2+e/2 by XREAL_1:8;
      then s-sD1 < e by A536,XXREAL_0:2;
      then
A537: lower_integral(f)-(lower_sum(f,T)).m < e by INTEGRA2:def 5;
      T.m in divs A;
      then
A538: T.m in dom lower_sum_set(f) by INTEGRA1:def 12;
      (lower_sum(f,T)).m = lower_sum(f,T.m) by INTEGRA2:def 5;
      then (lower_sum(f,T)).m = (lower_sum_set(f)).(T.m) by A538,
      INTEGRA1:def 12;
      then (lower_sum(f,T)).m in rng lower_sum_set(f) by A538,FUNCT_1:def 5;
      then sup rng lower_sum_set(f)>=(lower_sum(f,T)).m by A480,SEQ_4:def 4;
      then lower_integral(f)>=(lower_sum(f,T)).m by INTEGRA1:def 16;
      then lower_integral(f)-(lower_sum(f,T)).m >= 0 by XREAL_1:50;
      then abs(lower_integral(f)-(lower_sum(f,T)).m) < e by A537,
      ABSVALUE:def 1;
      then abs(-(lower_integral(f)-(lower_sum(f,T)).m)) < e by COMPLEX1:138;
      hence thesis;
    end;
    take n;
    thus thesis by A495;
  end;
  hence lower_sum(f,T) is convergent by SEQ_2:def 6;
  hence thesis by A476,SEQ_2:def 7;
end;

theorem
  for A be closed-interval Subset of REAL, f be Function of A,REAL,
  T be DivSequence of A
  st f is_bounded_on A & delta(T) is convergent_to_0 & vol(A)<>0
  holds upper_sum(f,T) is convergent & lim upper_sum(f,T) = upper_integral(f)
proof
  let A be closed-interval Subset of REAL;
  let f be Function of A,REAL;
  let T be DivSequence of A;
  assume
A1: f is_bounded_on A;
  assume
A2: delta(T) is convergent_to_0;
  assume
A3: vol(A)<>0;
A4: delta(T) is_not_0 & delta(T) is convergent & lim delta(T) = 0
  by A2,FDIFF_1:def 1;
A5: for e st e>0 ex n st for m st n<=m holds
  0 < (delta(T)).m & (delta(T)).m < e
  proof
    let e;
    assume e>0;
    then consider n such that
A6: for m st n<=m holds abs((delta(T)).m-0)<e by A4,SEQ_2:def 7;
    take n;
    let m;
    assume n<=m;
    then
A7: abs((delta(T)).m-0)<e by A6;
    (delta(T)).m-0<=abs((delta(T)).m-0) by ABSVALUE:11;
    then
A8: (delta(T)).m+abs((delta(T)).m-0)<e+abs((delta(T)).m-0) by A7, XREAL_1:10;
A9: (delta(T)).m<>0 by A4,SEQ_1:7;
A10: (delta(T)).m = delta(T.m) by INTEGRA2:def 3;
    delta(T.m) = max rng upper_volume(chi(A,A),T.m) by INTEGRA1:def 19;
    then delta(T.m) in rng upper_volume(chi(A,A),T.m) by XXREAL_2:def 8;
    then consider i such that
A11: i in dom upper_volume(chi(A,A),T.m) &
    delta(T.m)=upper_volume(chi(A,A),T.m).i by PARTFUN1:26;
A12: i in Seg len upper_volume(chi(A,A),T.m) by A11,FINSEQ_1:def 3;
    reconsider D = T.m as Element of divs A;
    i in Seg len D by A12,INTEGRA1:def 7;
  then i in dom D by FINSEQ_1:def 3;
    then delta(T.m)=vol(divset(T.m,i)) by A11,INTEGRA1:22;
    hence thesis by A8,A9,A10,INTEGRA1:11,XREAL_1:8;
  end;
A13: for D,D1 be Element of divs A holds ex D2 be Element of divs A st
  D<=D2 & D1<=D2 & rng D2=rng D1 \/
  rng D & 0<=upper_sum(f,D)-upper_sum(f,D2) &
  0<=upper_sum(f,D1)-upper_sum(f,D2)
  proof
    let D,D1 be Element of divs A;
    consider D2 be Element of divs A such that
A14: D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D by Th3;
A15: f is_bounded_above_on A by A1,RFUNCT_1:def 11;
    then
A16: upper_sum(f,D)-upper_sum(f,D2)>=0 by A14,INTEGRA1:47,XREAL_1:50;
    upper_sum(f,D1)-upper_sum(f,D2)>=0 by A14,A15,INTEGRA1:47,XREAL_1:50;
    hence thesis by A14,A16;
  end;
A17: for
  D,D1 be Element of divs A st delta(D1)<min rng upper_volume(chi(A,A),D)
  holds ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D
  & upper_sum(f,D1)-upper_sum(f,D2) <=
  (len D)*(sup(rng f)-inf(rng f))*delta(D1)
  proof
    let D,D1 be Element of divs A;
    assume
A18: delta(D1)<min rng upper_volume(chi(A,A),D);
    ex D2 be Element of divs A st D<=D2 & D1<=D2 & rng D2=rng D1 \/ rng D

& upper_sum(f,D1)-upper_sum(f,D2)<=(len D)*(sup(rng f)-inf(rng f))*delta(D1)
    proof
      consider D2 be Element of divs A such that
A19:  D<=D2 & D1<=D2 & rng D2=rng D1 \/
      rng D & 0<=upper_sum(f,D)-upper_sum(f,D2)
      & 0<=upper_sum(f,D1)-upper_sum(f,D2) by A13;
      upper_sum(f,D1)-upper_sum(f,D2) <=
      (len D)*(sup(rng f)-inf(rng f))*delta(D1)
      proof
        deffunc PUf(Element of divs A,Nat) = (PartSums(upper_volume(f,$1))).$2;
        deffunc UVf(Element of divs A) = upper_volume(f,$1);
A20:    for i st i in dom D holds ex j st j in dom D1 & D.i in divset(D1,j)
        & PUf(D1,j)-PUf(D2,indx(D2,D1,j))<=i*(sup(rng f)-inf(rng f))*delta(D1)
        proof
          let i;
          assume
A21:      i in dom D;
A22:      for
          i,j st i in dom D & j in dom D1 & D.i in divset(D1,j) holds j >= 2
          proof
            let i,j;
            assume
A23:        i in dom D;
            assume
A24:        j in dom D1 & D.i in divset(D1,j);
            assume j<2;
            then j<1+1;
            then
A25:        j <= 1 by NAT_1:13;
A26:        inf divset(D1,j)<=D.i & D.i<=sup divset(D1,j) by A24,INTEGRA2:1;
            j in Seg len D1 by A24,FINSEQ_1:def 3;
            then j >= 1 by FINSEQ_1:3;
            then j = 1 by A25,XXREAL_0:1;
            then
A27:        inf divset(D1,j)=inf A & sup divset(D1,j)=D1.j by A24,
            INTEGRA1:def 5;
            delta(D1) >= min rng upper_volume(chi(A,A),D)
            proof
              per cases;
              suppose
A28:            i=1;
                len D <> 0 by CARD_2:59;
                then len D in Seg len D by FINSEQ_1:5;
                then 1 <= len D by FINSEQ_1:3;
                then
A29:            1 in dom D by FINSEQ_3:27;
                then
A30:            inf divset(D,1)=inf A & sup divset(D,1)=D.
                1 by INTEGRA1:def 5;
                sup divset(D1,j)-inf A >= D.1-inf A by A26,A28,XREAL_1:11;
                then vol(divset(D1,j)) >= sup divset(D,1)-inf divset(D,1)
                by A27,A30,INTEGRA1:def 6;
                then
A31:            vol(divset(D1,j)) >= vol(divset(D,1)) by INTEGRA1:def 6;
                vol(divset(D1,j)) <= delta(D1) by A24,Lm6;
                then
A32:            delta(D1) >= vol(divset(D,1)) by A31, XXREAL_0:2;
A33:            1 in Seg len D by A29,FINSEQ_1:def 3;
                then 1 in Seg len upper_volume(chi(A,A),D) by INTEGRA1:def 7;
                then
A34:            1 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;

   1 in dom D by FINSEQ_1:def 3,A33;
  then
vol(divset(D,1)) = upper_volume(chi(A,A),D).1 by INTEGRA1:22;
                then vol(divset(D,1)) in rng upper_volume(chi(A,A),D)
                by A34,FUNCT_1:def 5;
                then vol(divset(D,1))>=min rng upper_volume(chi(A,A),D) by
                XXREAL_2:def 7;
                hence thesis by A32,XXREAL_0:2;
              end;
              suppose
A35:            i<>1;
                then
A36:            inf divset(D,i)=D.(i-1) & sup divset(D,i)= D.i by A23,
                INTEGRA1:def 5;
                then
A37:            sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)- inf A
                by A26,A27,XREAL_1:11;
                D.(i-1) in A by A23,A35,INTEGRA1:9;
                then inf A <= D.(i-1) by INTEGRA2:1;
                then sup divset(D,i)-inf A >= sup divset(D,i)-inf divset(D,i)
                by A36,REAL_2:106;

then sup divset(D1,j)-inf divset(D1,j) >= sup divset(D,i)-inf divset( D,i)
                by A37,XXREAL_0:2;
                then vol(divset(D1,j)) >= sup divset(D,i)-inf divset(D,i)
                by INTEGRA1:def 6;
                then
A38:            vol(divset(D1,j)) >= vol(divset(D,i)) by INTEGRA1:def 6;
                vol(divset(D1,j)) <= delta(D1) by A24,Lm6;
                then
A39:            delta(D1) >= vol(divset(D,i)) by A38, XXREAL_0:2;
A40:            i in Seg len D by A23,FINSEQ_1:def 3;
                then i in Seg len upper_volume(chi(A,A),D) by INTEGRA1:def 7;
                then
A41:            i in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;

   i in dom D by A40,FINSEQ_1:def 3;
  then
vol(divset(D,i)) = upper_volume(chi(A,A),D).i by INTEGRA1:22;
                then vol(divset(D,i)) in rng upper_volume(chi(A,A),D)
                by A41,FUNCT_1:def 5;
                then vol(divset(D,i))>=min rng upper_volume(chi(A,A),D) by
                XXREAL_2:def 7;
                hence thesis by A39,XXREAL_0:2;
              end;
            end;
            hence contradiction by A18;
          end;
          defpred P[non empty Nat] means $1 in dom D implies
          ex j st j in dom D1 & D.$1 in divset(D1,j)

& PUf(D1,j)-PUf(D2,indx(D2,D1,j))<=$1*(sup rng f-inf rng f)*delta(D1);
A42:      P[1]
          proof
            len D <> 0 by CARD_2:59;
            then len D in Seg len D by FINSEQ_1:5;
            then 1 <= len D by FINSEQ_1:3;
            then
A43:        1 in dom D by FINSEQ_3:27;
            then D.1 in A by INTEGRA1:8;
            then consider j such that
A44:        j in dom D1 & D.1 in divset(D1,j) by Th2;
            PUf(D1,j)-PUf(D2,indx(D2,D1,j))<=1*(sup rng f-inf rng f)*delta(D1)
            proof
A45:          j <> 1 by A22,A43,A44;
              then reconsider j1=j-1 as Element of NAT by A44,INTEGRA1:9;
A46:          j-1 in NAT & j-1 in dom D1 by A44,A45,INTEGRA1:9;

inf divset(D1,j) <= D.1 & D.1 <= sup divset(D1,j) by A44,INTEGRA2:1;
              then
A47:          D1.j1 <= D.1 & D.1 <= D1.j by A44,A45,INTEGRA1 :def 5;
A48:          indx(D2,D1,j1) in dom D2 & 1 <= indx(D2,D1,j1) &
              indx(D2,D1,j1) <= len D2
              proof
                thus indx(D2,D1,j1) in dom D2 by A19,A46,INTEGRA1:def 21;
                then indx(D2,D1,j1) in Seg len D2 by FINSEQ_1:def 3;
                hence thesis by FINSEQ_1:3;
              end;
              then mid(D2,1,indx(D2,D1,j1)) is increasing by INTEGRA1:37;
              then
A49:          D2|indx(D2,D1,j1) is increasing by A48,JORDAN3 :25;
A50:          j1 in dom D1 & 1 <= j1 & j1 <= len D1
              proof
                thus j1 in dom D1 by A44,A45,INTEGRA1:9;
                j1 in Seg len D1 by A46,FINSEQ_1:def 3;
                hence thesis by FINSEQ_1:3;
              end;
              then mid(D1,1,j1) is increasing by INTEGRA1:37;
              then
A51:          D1|j1 is increasing by A50,JORDAN3:25;
A52:          rng (D2|indx(D2,D1,j1)) = rng (D1|j1)
              proof
                for x1 st x1 in rng(D2|indx(D2,D1,j1)) holds x1 in rng(D1|j1)
                proof
                  let x1;
                  assume x1 in rng(D2|indx(D2,D1,j1));
                  then consider k such that
A53:              k in dom(D2|indx(D2,D1,j1)) & x1=(D2|indx(D2,D1,j1)).k
                  by PARTFUN1:26;
                  k in Seg len(D2|indx(D2,D1,j1)) by A53,FINSEQ_1:def 3;
                  then
A54:              k in Seg indx(D2,D1,j1) by A48, FINSEQ_1:80;
                  then
A55:              (D2|indx(D2,D1,j1)).k = D2.k & k in
                  dom D2 by A48,RFINSEQ:19;
                  then
A56:              D2.k in rng D2 by FUNCT_1:def 5;
                  1 <= k & k <= indx(D2,D1,j1) by A54,FINSEQ_1:3;
                  then D2.k <= D2.indx(D2,D1,j1) by A48,A55,GOBOARD2:18;
                  then
A57:              D2.k <= D1.j1 by A19,A46,INTEGRA1:def 21;
A58:              len(D1|j1) = j1 by A50,FINSEQ_1:80;
A59:              D2.k in rng D implies D2.k = D1.j1
                  proof
                    assume D2.k in rng D;
                    then consider n such that
A60:                n in dom D & D2.k=D.n by PARTFUN1:26;
                    1 <= n by A60,FINSEQ_3:27;
                    then D.1 <= D2.k by A43,A60,GOBOARD2:18;
                    then D1.j1 <= D2.k by A47,XXREAL_0:2;
                    hence thesis by A57,XXREAL_0:1;
                  end;
A61:              D2.k in rng D implies D2.k in rng(D1|j1)
                  proof
                    assume
A62:                D2.k in rng D;
                    j1 in Seg len(D1|j1) by A50,A58,FINSEQ_1:3;
                    then j1 in dom(D1|j1) by FINSEQ_1:def 3;
                    then
A63:                (D1|j1).j1 in rng(D1|j1) by FUNCT_1:def 5;
                    j1 in Seg j1 by A50,FINSEQ_1:3;
                    hence thesis by A50,A59,A62,A63,RFINSEQ:19;
                  end;
                  D2.k in rng D1 implies D2.k in rng(D1|j1)
                  proof
                    assume D2.k in rng D1;
                    then consider m such that
A64:                m in dom D1 & D2.k = D1.m by PARTFUN1:26;
                    m in Seg len D1 by A64,FINSEQ_1:def 3;
                    then
A65:                1 <= m & m <= j1 by A50,A57,A64,
                    FINSEQ_1:3,GOBOARD1:def 1;
                    then m in Seg len(D1|j1) by A58,FINSEQ_1:3;
                    then
A66:                m in dom (D1|j1) by FINSEQ_1:def 3;
                    m in Seg j1 by A65,FINSEQ_1:3;
                    then D2.k = (D1|j1).m by A50,A64,RFINSEQ:19;
                    hence thesis by A66,FUNCT_1:def 5;
                  end;

hence thesis by A19,A48,A53,A54,A56,A61,RFINSEQ:19,XBOOLE_0:def 2;
                end;
                then
A67:            rng(D2|indx(D2,D1,j1)) c= rng (D1|j1) by TARSKI:def 3;
                for x1 st x1 in rng(D1|j1) holds x1 in rng(D2|indx(D2,D1,j1))
                proof
                  let x1;
                  assume x1 in rng(D1|j1);
                  then consider k such that
A68:              k in dom(D1|j1) & x1=(D1|j1).k by PARTFUN1:26;
                  k in Seg len(D1|j1) by A68,FINSEQ_1:def 3;
                  then
A69:              k in Seg j1 by A50,FINSEQ_1:80;
                  then
A70:              (D1|j1).k = D1.k & k in dom D1 by A50, RFINSEQ:19;
                  then D1.k in rng D1 by FUNCT_1:def 5;
                  then x1 in rng D2 by A19,A68,A70,XBOOLE_0:def 2;
                  then consider n such that
A71:              n in dom D2 & x1=D2.n by PARTFUN1:26;
A72:              indx(D2,D1,k) in dom D2 & D2.indx(D2,D1,k)=D2.n
                  by A19,A68,A70,A71,INTEGRA1:def 21;
                  k <= j1 by A69,FINSEQ_1:3;
                  then D1.k <= D1.j1 by A46,A70,GOBOARD2:18;
                  then D2.indx(D2,D1,k) <= D1.j1 by A19,A70,INTEGRA1:def 21;
                  then D2.indx(D2,D1,k)<=D2.indx(D2,D1,j1)
                  by A19,A46,INTEGRA1:def 21;
                  then
A73:              n <= indx(D2,D1,j1) by A48,A71,A72, GOBOARD1:def 1;
                  1 <= n by A71,FINSEQ_3:27;
                  then
A74:              n in Seg indx(D2,D1,j1) by A73, FINSEQ_1:3;
                  then
A75:              D2.n = (D2|indx(D2,D1,j1)).n by A48, RFINSEQ:19;
                  n in Seg len(D2|indx(D2,D1,j1)) by A48,A74,FINSEQ_1:80;
                  then n in dom(D2|indx(D2,D1,j1)) by FINSEQ_1:def 3;
                  hence thesis by A71,A75,FUNCT_1:def 5;
                end;
                then rng(D1|j1) c= rng(D2|indx(D2,D1,j1)) by TARSKI:def 3;
                hence thesis by A67,XBOOLE_0:def 10;
              end;
              then
A76:          D2|indx(D2,D1,j1)=D1|j1 by A49,A51,Th5;
A77:          for k st 1 <= k & k <= j1 holds k=indx(D2,D1,k)
              proof
                let k;
                assume
A78:            1 <= k & k <= j1;
                assume
A79:            k<>indx(D2,D1,k);
                now per cases by A79,XXREAL_0:1;
                  suppose
A80:                k > indx(D2,D1,k);
                    1 <= k & k <= len D1 by A50,A78,XXREAL_0:2;
                    then
A81:                k in dom D1 by FINSEQ_3:27;
                    then
A82:                indx(D2,D1,k) in dom D2 & D1.k=D2. indx(D2,D1,k)
                    by A19,INTEGRA1:def 21;
                    then indx(D2,D1,k) in Seg len D2 by FINSEQ_1:def 3;
                    then
A83:                1<=indx(D2,D1,k)&indx(D2,D1,k)<= indx(D2,D1,j1)
                    by A19,A50,A78,A81,Th6,FINSEQ_1:3;
                    then indx(D2,D1,k) in Seg indx(D2,D1,j1) by FINSEQ_1:3;
                    then
A84:                (D2|indx(D2,D1,j1)).indx(D2,D1,k)=
                    D2.indx(D2,D1,k) by A48, RFINSEQ:19;
A85:                indx(D2,D1,k) < j1 by A78,A80,XXREAL_0:2;
                    then indx(D2,D1,k) <= len D1 by A50,XXREAL_0:2;
                    then indx(D2,D1,k) in dom D1 by A83,FINSEQ_3:27;
                    then
A86:                D1.k > D1.indx(D2,D1,k) by A80,A81,GOBOARD1:def 1;
                    indx(D2,D1,k) in Seg j1 by A83,A85,FINSEQ_1:3;
                    hence contradiction by A50,A76,A82,A84,A86,RFINSEQ:19;
                  end;
                  suppose
A87:                k < indx(D2,D1,k);
                    k in Seg j1 by A78,FINSEQ_1:3;
                    then
A88:                D1.k = (D1|j1).k by A46,RFINSEQ:19;
                    1 <= k & k <= len D1 by A50,A78,XXREAL_0:2;
                    then
A89:                k in dom D1 by FINSEQ_3:27;
                    then
A90:                indx(D2,D1,k) in dom D2 & D1.k=D2. indx(D2,D1,k)
                    by A19,INTEGRA1:def 21;
                    indx(D2,D1,k) <= indx(D2,D1,j1) & indx(D2,D1,k) in dom D2
                    & indx(D2,D1,j1) in dom D2 by A19,A50,A78,A89,Th6;
                    then
A91:                k <= indx(D2,D1,j1) by A87, XXREAL_0:2;
                    then k <= len D2 by A48,XXREAL_0:2;
                    then k in dom D2 by A78,FINSEQ_3:27;
                    then
A92:                D2.k < D2.indx(D2,D1,k) by A87,A90,GOBOARD1:def 1;
                    k in Seg indx(D2,D1,j1) by A78,A91,FINSEQ_1:3;
                    hence contradiction by A48,A76,A88,A90,A92,RFINSEQ:19;
                  end;
                end;
                hence contradiction;
              end;
A93:          len (D2|indx(D2,D1,j1))=len (D1|j1) by A49,A51,A52,Th5;
              len (D2|indx(D2,D1,j1))=indx(D2,D1,j1) by A48,FINSEQ_1:80;
              then
A94:          indx(D2,D1,j1) =j1 by A50,A93,FINSEQ_1:80;
              j1 <= len D1 by A46,FINSEQ_3:27;
              then j1 <= len upper_volume(f,D1) by INTEGRA1:def 7;
              then
A95:          len(upper_volume(f,D1)|j1)=indx(D2,D1,j1) by A94,FINSEQ_1:80;
              indx(D2,D1,j1) in dom D2 by A19,A46,INTEGRA1:def 21;
              then indx(D2,D1,j1) <= len D2 by FINSEQ_3:27;
              then indx(D2,D1,j1) <= len upper_volume(f,D2) by INTEGRA1:def 7;
              then
A96:          len(upper_volume(f,D1)|j1)=len(upper_volume(f,
              D2)|indx(D2,D1,j1)) by A95,FINSEQ_1:80;
              for k be Nat st 1 <= k & k <= len(upper_volume(f,D1)|j1) holds
              (upper_volume(f,D1)|j1).k = (upper_volume(f,D2)|indx(D2,D1,j1)).k
              proof
                let k be Nat;
                assume
A97:            1 <= k & k <= len(upper_volume(f,D1)|j1);
A98:            len(upper_volume(f,D1)) = len D1 by INTEGRA1:def 7;
                then
A99:            1 <= k & k <= j1 by A50,A97,FINSEQ_1:80;
                then
A100:           k in Seg j1 by FINSEQ_1:3;
                k <= len D1 by A50,A99,XXREAL_0:2;
                then
A101:           k in Seg len D1 by A97,FINSEQ_1:3;
  then
B101:  k in dom D1 by FINSEQ_1:def 3;
A102:           divset(D1,k)=divset(D2,indx(D2,D1,k))
                proof
A103:             divset(D2,indx(D2,D1,k))= [. inf divset(D2,indx(D2,D1,k)),
                  sup divset(D2,indx(D2,D1,k)).] by INTEGRA1:5;
A104:             k in dom D1 by A101,FINSEQ_1:def 3;
                  then
A105:             indx(D2,D1,k) in dom D2 & D1.k=D2.indx (D2,D1,k) by A19,
                  INTEGRA1:def 21;
                  inf divset(D1,k)=inf divset(D2,indx(D2,D1,k)) &
                  sup divset(D1,k)=sup divset(D2,indx(D2,D1,k))
                  proof
                    per cases;
                    suppose
A106:                 k=1;
                      then
A107:                 inf divset(D1,k)=inf A&sup divset(D1,k)=D1.k by A104,
                      INTEGRA1:def 5;
                      indx(D2,D1,k)=1 by A50,A77,A106;
                      hence thesis by A105,A107,INTEGRA1:def 5;
                    end;
                    suppose
A108:                 k<>1;
                      then
A109:                 inf divset(D1,k)=D1.(k-1) & sup divset(D1,k)=D1.k
                      by A104,INTEGRA1:def 5;
A110:                 k-1 in dom D1 & D1.(k-1) in A & k-1 in NAT
                      by A104,A108,INTEGRA1:9;

reconsider k1=k-1 as Element of NAT by A104,A108,INTEGRA1:9;
                      k <= k+1 by NAT_1:11;
                      then k1 <= k by XREAL_1:22;
                      then
A111:                 k1 <= j1 by A99,XXREAL_0:2;
                      1 <= k1 by A110,FINSEQ_3:27;
                      then
A112:                 k1=indx(D2,D1,k1) by A77,A111;
                      indx(D2,D1,k)<>1 by A77,A99,A100,A108;
                      then
A113:                 inf divset(D2,indx(D2,D1,k))= D2.(indx(D2,D1,k)-1) &
                      sup divset(D2,indx(D2,D1,k))=D2.indx(D2,D1,k) by A105,
                      INTEGRA1:def 5;

D2.(indx(D2,D1,k)-1)= D2.indx(D2,D1,k1) by A77,A99,A100,A112;
                      hence thesis by A19,A104,A109,A110,A113,INTEGRA1:def 21;
                    end;
                  end;
                  hence thesis by A103,INTEGRA1:5;
                end;
                j1 in Seg len(upper_volume(f,D1)) by A50,A98,FINSEQ_1:def 3;
                then j1 in dom(upper_volume(f,D1)) by FINSEQ_1:def 3;
                then
A114:           (upper_volume(f,D1)|j1).k = upper_volume(f,D1).k by A100,
                RFINSEQ:19

.=(sup(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
                by A102,INTEGRA1:def 7,B101;
                indx(D2,D1,k) in Seg j1 by A77,A99,A100;
                then
A115:           indx(D2,D1,k) in Seg indx(D2,D1,j1) by A50,A77;

then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=indx(D2,D1,j1) by FINSEQ_1:3;

then 1<=indx(D2,D1,k) & indx(D2,D1,k)<=len D2 by A48,XXREAL_0:2;
                then
                indx(D2,D1,k) in Seg len D2 by FINSEQ_1:3;
  then
B116:  indx(D2,D1,k) in dom D2 by FINSEQ_1:def 3;
                indx(D2,D1,j1) in Seg len D2 by A48,FINSEQ_1:def 3;

then indx(D2,D1,j1) in Seg len upper_volume(f,D2) by INTEGRA1:def 7;
                then
A117:           indx(D2,D1,j1) in dom upper_volume(f,D2) by FINSEQ_1:def 3;
                (upper_volume(f,D2)|indx(D2,D1,j1)).k
                =(upper_volume(f,D2)|indx(D2,D1,j1)).indx(D2,D1,k)
                by A77,A99,A100
                  .=upper_volume(f,D2).indx(D2,D1,k) by A115,A117,RFINSEQ:19

.=(sup(rng(f|divset(D2,indx(D2,D1,k)))))*vol(divset(D2,indx(D2,D1,k)))
                by INTEGRA1:def 7,B116;
                hence thesis by A114;
              end;
              then
A118:         upper_volume(f,D2)|indx(D2,D1,j1)=upper_volume (f,D1)|j1
              by A96,FINSEQ_1:18;
              indx(D2,D1,j1) in Seg len D2 by A48,FINSEQ_1:def 3;
              then
              indx(D2,D1,j1) in Seg len upper_volume(f,D2) by INTEGRA1:def 7;
  then
B119:  indx(D2,D1,j1) in dom upper_volume(f,D2) by FINSEQ_1:def 3;
              j1 in Seg len D1 by A50,FINSEQ_1:def 3;
              then
              j1 in Seg len upper_volume(f,D1) by INTEGRA1: def 7;
  then
B120:  j1 in dom upper_volume(f,D1) by FINSEQ_1:def 3;
A121:         indx(D2,D1,j1)+1 <= indx(D2,D1,j)
              proof
                j < j+1 by NAT_1:13;
                then j1 < j by XREAL_1:21;
                then indx(D2,D1,j1) < indx(D2,D1,j) by A19,A44,A50,Th7;
                hence thesis by NAT_1:13;
              end;
A122:         PUf(D2,indx(D2,D1,j1))=Sum(upper_volume(f,D2)|indx(D2,D1,j1))
              by INTEGRA1:def 22,B119
                .=PUf(D1,j1) by A118,INTEGRA1:def 22,B120;
A123:         Sum mid(upper_volume(f,D1),j,j)
              -Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
              <= (sup rng f-inf rng f)*delta(D1)
              proof
A124:           1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len upper_volume(f,D2)
                proof
                  indx(D2,D1,j) in dom D2 by A19,A44,INTEGRA1:def 21;
                  then indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;

then indx(D2,D1,j) in Seg len upper_volume(f,D2) by INTEGRA1:def 7;
                  hence thesis by FINSEQ_1:3;
                end;
                then
A125:           1

<= indx(D2,D1,j1)+1 & indx(D2,D1,j1)+1 <= len upper_volume(f,D2 )
                by A48,A121,NAT_1:13,XXREAL_0:2;
A126:           indx(D2,D1,j)-indx(D2,D1,j1) <= 2
                proof
                  assume
A127:             indx(D2,D1,j)-indx(D2,D1,j1) > 2;
                  reconsider ID1=indx(D2,D1,j1)+1 as Element of NAT;
                  reconsider ID2=ID1+1 as Element of NAT;
A128:             indx(D2,D1,j1) < ID1 & ID1 < ID2 & ID2 < indx(D2,D1,j)
                  proof
                    thus indx(D2,D1,j1) < ID1 by NAT_1:13;
                    thus ID1 < ID2 by NAT_1:13;
                    indx(D2,D1,j1)+(1+1)<indx(D2,D1,j) by A127,XREAL_1:22;
                    hence thesis;
                  end;
A129:             indx(D2,D1,j) in dom D2 by A19,A44,INTEGRA1:def 21;
                  then
A130:             indx(D2,D1,j) <= len D2 by FINSEQ_3:27;
A131:             ID1 in dom D2
                  proof
A132:               1 <= ID1 & ID1 <= indx(D2,D1,j) by A48,A128,XXREAL_0:2;
                    then ID1 <= len D2 by A130,XXREAL_0:2;
                    hence thesis by A132,FINSEQ_3:27;
                  end;
A133:             ID2 in dom D2
                  proof
A134:               indx
                    (D2,D1,j1) <= ID2 & ID2 <= len D2 by A128,A130,XXREAL_0:2;
                    then 1 <= ID2 by A48,XXREAL_0:2;
                    hence thesis by A134,FINSEQ_3:27;
                  end;
                  then
A135:             D2

.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.ID2 & D2.ID2<D2.indx(D2,D1, j)
                  by A48,A128,A129,A131,GOBOARD1:def 1;
A136:             D2.ID1 in rng D & D2.ID2 in rng D
                  proof
A137:               D2

.ID1 in rng D2 & D2.ID2 in rng D2 by A131,A133,FUNCT_1:def 5;
A138:               D1.j1 = D2.indx(D2,D1,j1) & D1.j = D2.indx(D2,D1,j)
                    by A19,A44,A50,INTEGRA1:def 21;
                    not(D2.ID1 in rng D1) & not D2.ID2 in rng D1
                    proof
                      assume
A139:                 D2.ID1 in rng D1 or D2.ID2 in rng D1;
                      per cases by A139;
                      suppose D2.ID1 in rng D1;
                        then consider n such that
A140:                   n in dom D1 & D1.n=D2.ID1 by PARTFUN1:26;
                        D2.indx(D2,D1,j1)<D2.ID1 & D2.ID1<D2.indx(D2,D1,j)
                        by A135,XXREAL_0:2;
                        then j1<n & n<j by A44,A50,A138,A140,GOBOARD2:18;
                        then j<n+1 & n<j by XREAL_1:21;
                        hence contradiction by NAT_1:13;
                      end;
                      suppose D2.ID2 in rng D1;
                        then consider n such that
A141:                   n in dom D1 & D1.n=D2.ID2 by PARTFUN1:26;
                        D2.indx(D2,D1,j1)<D2.ID2 & D2.ID2<D2.indx(D2,D1,j)
                        by A135,XXREAL_0:2;
                        then j1<n & n<j by A44,A50,A138,A141,GOBOARD2:18;
                        then j<n+1 & n<j by XREAL_1:21;
                        hence contradiction by NAT_1:13;
                      end;
                    end;
                    hence thesis by A19,A137,XBOOLE_0:def 2;
                  end;
A142:             inf divset(D1,j)=D2.indx(D2,D1,j1)
                  & sup divset(D1,j)=D2.indx(D2,D1,j)
                  proof
                    inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
                    by A44,A45,INTEGRA1:def 5;
                    hence thesis by A19,A44,A50,INTEGRA1:def 21;
                  end;
A143:             D2.ID1 in rng D /\ divset(D1,j)
                  proof
                    D2.indx(D2,D1,j1)<=D2.ID1&D2.ID1<=D2.indx(D2,D1,j)
                    by A135,XXREAL_0:2;
                    then D2.ID1 in divset(D1,j) by A142,INTEGRA2:1;
                    hence thesis by A136,XBOOLE_0:def 3;
                  end;
                  D2.ID2 in rng D /\ divset(D1,j)
                  proof
                    D2.indx(D2,D1,j1)<=D2.ID2&D2.ID2<=D2.indx(D2,D1,j)
                    by A135,XXREAL_0:2;
                    then D2.ID2 in divset(D1,j) by A142,INTEGRA2:1;
                    hence thesis by A136,XBOOLE_0:def 3;
                  end;

hence contradiction by A18,A44,A128,A131,A133,A143,Th4,GOBOARD2:19;
                end;
                1 <= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 &
                indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 <= 2
                proof
A144:             indx(D2,D1,j)-'(indx(D2,D1,j1)+1)
                  =indx(D2,D1,j)-(indx(D2,D1,j1)+1) by A121,BINARITH:50;
                  indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 0+1 by XREAL_1:8;
                  hence indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 >= 1;
                  thus thesis by A126,A144;
                end;
                then
A145:           1 <= len mid(upper_volume(f,D2),(indx(D2,
                D1,j1)+1),indx(D2,D1,j )) &
                len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))<=2
                by A121,A124,A125,JORDAN3:27;
                1 <= j & j <= len D1 by A44,FINSEQ_3:27;
                then
A146:           1 <= j & j <= len upper_volume(f,D1) by INTEGRA1:def 7;
                j-'j+1 = 1 by Lm2;
                then
A147:           len mid(upper_volume(f,D1),j,j) = 1 by A146,JORDAN3:27;
                mid(upper_volume(f,D1),j,j).1 = upper_volume(f,D1).j
                by A146,JORDAN3:27;
                then mid(upper_volume(f,D1),j,j)
                =<*upper_volume(f,D1).j*> by A147,FINSEQ_1:57;
                then
A148:           Sum mid(upper_volume(f,D1),j,j)= upper_volume(f,D1).j by
                FINSOP_1:12;
A149:           indx(D2,D1,j1)+1 in Seg len D2
                proof

indx(D2,D1,j1)+1 in Seg len upper_volume(f,D2) by A125,FINSEQ_1: 3;
                  hence thesis by INTEGRA1:def 7;
                end;
  then
B149:   indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
                j in Seg len D1 by A44,FINSEQ_1:def 3;
  then
B150:  j in dom D1 by FINSEQ_1:def 3;
                now per cases by A145,Lm3;
                  suppose
A151:               len
                    mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=1;
A152:               indx(D2,D1,j1)+1=indx(D2,D1,j)
                    proof

len mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))

= indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1 by A121,A124,A125,JORDAN3:27;

then indx(D2,D1,j)-(indx(D2,D1,j1)+1)=0 by A121,A151,BINARITH:50;
                      hence thesis;
                    end;
A153:               divset(D2,indx(D2,D1,j))=divset(D1,j)
                    proof
                      inf divset(D1,j)=D2.indx(D2,D1,j1) &
                      sup divset(D1,j)=D2.indx(D2,D1,j)
                      proof
                        inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
                        by A44,A45,INTEGRA1:def 5;
                        hence thesis by A19,A44,A50,INTEGRA1:def 21;
                      end;
                      then
A154:                 divset(D1,j)=[. D2.indx(D2,D1, j1),D2.indx(D2,D1,j).] by
                      INTEGRA1:5;
A155:                 indx(D2,D1,j)-1=indx(D2,D1,j1) by A152;
A156:                 indx(D2,D1,j) in dom D2 by A19,A44,INTEGRA1:def 21;
                      indx(D2,D1,j)<>1 by A48,A152,NAT_1:13;
                      then inf divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j1)
                      & sup divset(D2,indx(D2,D1,j))=D2.indx(D2,D1,j)
                      by A155,A156,INTEGRA1:def 5;
                      hence thesis by A154,INTEGRA1:5;
                    end;
                    mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1

=upper_volume(f,D2).(indx(D2,D1,j1)+1) by A124,A125,JORDAN3:27;

then mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))

=<*upper_volume(f,D2).(indx(D2,D1,j1)+1)*> by A151,FINSEQ_1:57;
                    then
A157:               Sum mid(upper_volume(f,D2),(indx(
                    D2,D1,j1)+1),indx(D2,D1,j
                    )) =upper_volume(f,D2).(indx(D2,D1,j1)+1) by FINSOP_1:12
                      .=(sup(rng(f|divset(D2,(indx(D2,D1,j1)+1)))))
                    *vol(divset(D2,(indx(D2,D1,j1)+1)))
                     by INTEGRA1:def 7,B149
                      .=Sum mid(upper_volume(f,D1),j,j)
                    by A148,A152,A153,INTEGRA1:def 7,B150;
A158:               delta(D1) >= 0 by Th8;
                    sup rng f - inf rng f >= 0 by A1,Lm4,XREAL_1:50;

then (sup rng f - inf rng f)*delta(D1) >= 0*delta(D1) by A158;
                    hence Sum mid(upper_volume(f,D1),j,j)

-Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                    <= (sup rng f-inf rng f)*delta(D1) by A157;
                  end;
                  suppose
A159:               len
                    mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))=2;
A160:               mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).1

=upper_volume(f,D2).(indx(D2,D1,j1)+1) by A124,A125,JORDAN3:27;
                    mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2
                    =upper_volume(f,D2).(indx(D2,D1,j1)+2)
                    proof
A161:                 2+(indx(D2,D1,j1)+1)>=0+1 by XREAL_1:9;

mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j)).2

=UVf(D2).(2+(indx(D2,D1,j1)+1)-'1) by A121,A124,A125,A159, JORDAN3:27
                        .=UVf(D2).(2+(indx(D2,D1,j1)+1)-1) by A161,BINARITH:50
                        .=UVf(D2).(indx(D2,D1,j1)+(1+1));
                      hence thesis;
                    end;

then mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                    =<*upper_volume(f,D2).(indx(D2,D1,j1)+1),

upper_volume(f,D2).(indx(D2,D1,j1)+2)*> by A159,A160,FINSEQ_1:61;
                    then
A162:               Sum
                    mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                    =upper_volume(f,D2).(indx(D2,D1,j1)+1)
                    +upper_volume(f,D2).(indx(D2,D1,j1)+2) by RVSUM_1:107;
A163:               vol(divset(D1,j))

=vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2))
                    proof
A164:                 inf

divset(D1,j)=D2.indx(D2,D1,j1)&sup divset(D1,j)=D2.indx(D2,D1,j)
                      proof
                        inf divset(D1,j)=D1.j1 & sup divset(D1,j)=D1.j
                        by A44,A45,INTEGRA1:def 5;
                        hence thesis by A19,A44,A50,INTEGRA1:def 21;
                      end;
A165:                 indx(D2,D1,j)=indx(D2,D1,j1)+2
                      proof
                        indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
                        by A121,A124,A125,A159,JORDAN3:27;

then 2=indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1 by A121,BINARITH:50
                          .=indx(D2,D1,j)-indx(D2,D1,j1);
                        hence thesis;
                      end;
A166:                 inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)
                      & sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
                      & inf divset(D2,(indx(D2,D1,j1)+1))=D2.indx(D2,D1,j1)
                      & sup divset(D2,(indx(D2,D1,j1)+1))=D2.(indx(D2,D1,j1)+1)
                      proof
A167:                   indx
                        (D2,D1,j1)+2 in dom D2 by A19,A44,A165,INTEGRA1:def 21;

indx(D2,D1,j1)+1 in Seg len upper_volume(f,D2) by A125,FINSEQ_1:3;
                        then indx(D2,D1,j1)+1 in Seg len D2 by INTEGRA1:def 7;
                        then
A168:                   indx(D2,D1,j1)+1 in dom D2 by FINSEQ_1:def 3;
A169:                   indx(D2,D1,j1)+1 <> 1 by A48,NAT_1:13;
A170:                   indx(D2,D1,j1)+1+1 > 1 by A125,NAT_1:13;
A171:                   indx(D2,D1,j1)+2-1=indx(D2,D1,j1)+1;
A172:                   indx(D2,D1,j1)+1-1=indx(D2,D1,j1)+0;

thus inf divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+1)

& sup divset(D2,(indx(D2,D1,j1)+2))=D2.(indx(D2,D1,j1)+2)
                        by A167,A170,A171,INTEGRA1:def 5;
                        thus thesis by A168,A169,A172,INTEGRA1:def 5;
                      end;
                      vol(divset(D1,j))
                      =D2.(indx(D2,D1,j1)+2)-D2.(indx(D2,D1,j1)+1)
                      +D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A164,A165,
                      INTEGRA1:def 6;
                      then vol(divset(D1,j))=vol(divset(D2,indx(D2,D1,j1)+2))

+D2.(indx(D2,D1,j1)+1)-D2.indx(D2,D1,j1) by A166,INTEGRA1:def 6
                        .=vol(divset(D2,indx(D2,D1,j1)+2))

+(sup divset(D2,indx(D2,D1,j1)+1)-inf divset(D2,indx(D2,D1,j1)+1)) by A166;
                      hence thesis by INTEGRA1:def 6;
                    end;
                    then
A173:               upper_volume(f,D1).j=(sup(rng(f| divset(D1,j))))*

(vol(divset(D2,indx(D2,D1,j1)+1))+vol(divset(D2,indx(D2,D1,j1)+2)))
                    by INTEGRA1:def 7,B150;
A174:               vol(divset(D2,indx(D2,D1,j1)+1))>=0 by INTEGRA1:11;
A175:               vol(divset(D2,indx(D2,D1,j1)+2))>=0 by INTEGRA1:11;
A176:               Sum

mid(UVf(D1),j,j)-Sum mid(UVf(D2),indx(D2,D1,j1)+1,indx(D2, D1,j))
                    <=(sup rng f - inf rng f)*(vol(divset(D2,indx(D2,D1,j1)+2))
                    +vol(divset(D2,indx(D2,D1,j1)+1)))
                    proof
A177:                 indx(D2,D1,j) in dom D2 by A19,A44,INTEGRA1:def 21;
                      then
                      indx(D2,D1,j) in Seg len D2 by FINSEQ_1:def 3;
  then
B178:  indx(D2,D1,j) in dom D2 by FINSEQ_1:def 3;
A179:                 indx(D2,D1,j)=indx(D2,D1,j1)+2
                      proof
                        indx(D2,D1,j)-'(indx(D2,D1,j1)+1)+1=2
                        by A121,A124,A125,A159,JORDAN3:27;

then 2=indx(D2,D1,j)-(indx(D2,D1,j1)+1)+1 by A121,BINARITH:50
                          .=indx(D2,D1,j)-indx(D2,D1,j1);
                        hence thesis;
                      end;
                      set ID1=indx(D2,D1,j1)+1;
                      set ID2=indx(D2,D1,j1)+2;
A180:                 Sum mid(UVf(D2),ID1,indx(D2,D1,j))
                      =(sup rng(f|divset(D2,ID2)))*vol(divset(D2,ID2))
                      +UVf(D2).ID1 by A162,A179,INTEGRA1:def 7,B178
                        .=(sup rng(f|divset(D2,ID2)))*vol(divset(D2,ID2))
                      +(sup rng(f|divset(D2,ID1)))
                      *vol(divset(D2,ID1)) by INTEGRA1:def 7,B149;
                      divset(D2,ID2) c= A by A177,A179,INTEGRA1:10;
                      then
A181:                 sup rng(f|divset(D2,ID2)) >= inf rng f by A1,Lm5;
                      ID1 in dom D2 by A149,FINSEQ_1:def 3;
                      then divset(D2,ID1)c=A by INTEGRA1:10;
                      then sup rng(f|divset(D2,ID1)) >= inf rng f by A1,Lm5;
                      then
A182:                 (sup rng(f|divset(D2,ID1)))* vol(divset(D2,ID1))
                      >=(inf rng f)*vol(divset(D2,ID1)) by A174,XREAL_1:66;
                      divset(D1,j)c=A by A44,INTEGRA1:10;
                      then sup rng(f|divset(D1,j)) <= sup rng f by A1,Lm5;
                      then
A183:                 (sup rng(f|divset(D1,j)))*vol( divset(D2,ID2))
                      <=(sup rng f)*vol(divset(D2,ID2))
                      & (sup rng(f|divset(D1,j)))*vol(divset(D2,ID1))

<=(sup rng f)*vol(divset(D2,ID1)) by A174,A175,XREAL_1:66;

set SR = sup rng(f|divset(D2,ID1)), VR = vol(divset(D2,ID1));
                      Sum mid(UVf(D2),ID1,indx(D2,D1,j)) - SR*VR

>=(inf rng f)*vol(divset(D2,ID2)) by A175,A180,A181,XREAL_1:66;
                      then Sum mid(UVf(D2),ID1,indx(D2,D1,j))
                      >=(inf rng f)*vol(divset(D2,ID2))+SR*VR by XREAL_1:21;

then Sum mid(UVf(D2),ID1,indx(D2,D1,j))-(inf rng f)*vol(divset(D2, ID2))
                      >=SR*VR by XREAL_1:21;

then Sum mid(UVf(D2),ID1,indx(D2,D1,j))-(inf rng f)*vol(divset(D2, ID2))
                      >=(inf rng f)*VR by A182,XXREAL_0:2;
                      then
A184:                 Sum

mid(UVf(D2),ID1,indx(D2,D1,j))>=(inf rng f)*vol(divset(D2, ID2))+
                      (inf rng f)*VR by XREAL_1:21;
                      reconsider A = sup rng(f|divset(D1,j)) as real number;
                      set B = vol(divset(D2,ID1));
                      set C = vol(divset(D2,ID2));
                      upper_volume(f,D1).j-A*B = A*C by A173;

then Sum mid(UVf(D1),j,j)<=(sup rng(f|divset(D1,j)))*vol(divset(D2, ID1))
                      +(sup rng f)*vol(divset(D2,ID2)) by A148,A183,XREAL_1:22;
                      then Sum mid(UVf(D1),j,j)-(sup rng f)*vol(divset(D2,ID2)
                      )

<=(sup rng(f|divset(D1,j)))*vol(divset(D2,ID1)) by XREAL_1:22;
                      then Sum mid(UVf(D1),j,j)-(sup rng f)*vol(divset(D2,ID2)
                      ) <=(sup rng f)*vol(divset(D2,ID1)) by A183,XXREAL_0:2;
                      then Sum mid(UVf(D1),j,j)

<=(sup rng f)*vol(divset(D2,ID2))+(sup rng f)*vol(divset(D2,ID1))
                      by XREAL_1:22;

then Sum mid(UVf(D1),j,j)-Sum mid(UVf(D2),ID1,indx(D2,D1,j))

<=(sup rng f)*vol(divset(D2,ID2))+(sup rng f)*vol(divset(D2,ID1))

-((inf rng f)*vol(divset(D2,ID2))+(inf rng f)*vol(divset(D2,ID1)))
                      by A184,REAL_1:92;
                      hence thesis;
                    end;
                    sup rng f - inf rng f >= 0 by A1,Lm4,XREAL_1:50;
                    then (sup rng f - inf rng f)*(vol(divset(D1,j)))
                    <=(sup rng f - inf rng f)*delta(D1) by A44,Lm6,XREAL_1:66;
                    hence thesis by A163,A176,XXREAL_0:2;
                  end;
                end;
                hence thesis;
              end;
A185:         PUf(D2,indx(D2,D1,j1))
              +Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
              =PUf(D2,indx(D2,D1,j))
              proof
                indx(D2,D1,j) in dom D2 by A19,A44,INTEGRA1:def 21;
                then
A186:           indx(D2,D1,j) in Seg len D2 by FINSEQ_1: def 3;
                then
A187:           1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by FINSEQ_1:3;
                then
A188:           1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len UVf(D2) by
                INTEGRA1:def 7;
                indx(D2,D1,j) in Seg len UVf(D2) by A186,INTEGRA1:def 7;
  then
B189:  indx(D2,D1,j) in dom UVf(D2) by FINSEQ_1:def 3;
A190:           indx(D2,D1,j1) < indx(D2,D1,j) by A121,NAT_1:13;
                indx(D2,D1,j1) in Seg len D2 by A48,FINSEQ_1:def 3;
                then indx(D2,D1,j1) in Seg len UVf(D2) by INTEGRA1:def 7;
  then indx(D2,D1,j1) in dom UVf(D2) by FINSEQ_1:def 3;
                then PUf(D2,indx(D2,D1,j1))
                =Sum(UVf(D2)|indx(D2,D1,j1)) by INTEGRA1:def 22;
                then PUf(D2,indx(D2,D1,j1))
                +Sum mid(upper_volume(f,D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))
                =Sum(UVf(D2)|indx(D2,D1,j1)
                ^mid(UVf(D2),(indx(D2,D1,j1)+1),indx(D2,D1,j))) by RVSUM_1:105
                  .=Sum(mid(UVf(D2),1,indx(D2,D1,j1))
                ^mid(UVf(D2),indx(D2,D1,j1)+1,indx(D2,D1,j))) by A48,JORDAN3:25

.=Sum(mid(UVf(D2),1,indx(D2,D1,j))) by A48,A188,A190,INTEGRA2:4
                  .=Sum(UVf(D2)|indx(D2,D1,j)) by A187,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B189;
              end;
              PUf(D1,j1)+Sum mid(upper_volume(f,D1),j,j)=PUf(D1,j)
              proof
A191:           j in Seg len D1 by A44,FINSEQ_1:def 3;
                then
A192:           1 <= j & j <= len D1 by FINSEQ_1:3;
                then
A193:           1 <= j & j <= len UVf(D1) by INTEGRA1:def 7;
                j in Seg len UVf(D1) by A191,INTEGRA1:def 7;
  then
B194:  j in dom UVf(D1) by FINSEQ_1:def 3;
                j < j+1 by NAT_1:13;
                then
A195:           j1 < j by XREAL_1:21;
                j1 in Seg len D1 by A50,FINSEQ_1:def 3;
                then j1 in Seg len UVf(D1) by INTEGRA1:def 7;
  then j1 in dom UVf(D1) by FINSEQ_1:def 3;
                then PUf(D1,j1)=Sum(UVf(D1)|j1) by INTEGRA1:def 22;
                then PUf(D1,j1)+Sum mid(UVf(D1),j,j)
                =Sum((UVf(D1)|j1)^mid(UVf(D1),j,j)) by RVSUM_1:105

.=Sum(mid(UVf(D1),1,j1)^mid(UVf(D1),j1+1,j)) by A50,JORDAN3:25
                  .=Sum(mid(UVf(D1),1,j)) by A50,A193,A195,INTEGRA2:4
                  .=Sum(UVf(D1)|j) by A192,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B194;
              end;
              hence thesis by A122,A123,A185;
            end;
            hence thesis by A44;
          end;
A196:     for i being non empty Nat st P[i] holds P[i+1]
          proof
            let i be non empty Nat;
            assume
A197:       P[i];
A198:       i>=1 by NAT_1:14;
            P[i+1]
            proof
              assume
A199:         i+1 in dom D;
              then D.(i+1) in A by INTEGRA1:8;
              then consider j such that
A200:         j in dom D1 & D.(i+1) in divset(D1,j) by Th2;
              i+1 in Seg len D by A199,FINSEQ_1:def 3;
              then
A201:         1 <= i+1 & i+1 <= len D by FINSEQ_1:3;
              i <= i+1 by NAT_1:11;
              then i <= len D by A201,XXREAL_0:2;
              then
A202:         i in Seg len D by A198,FINSEQ_1:3;
              then
A203:         i in dom D by FINSEQ_1:def 3;
              consider n1 being Element of NAT such that
A204:         n1 in dom D1 & D.i in divset(D1,n1)

& PUf(D1,n1)-PUf(D2,indx(D2,D1,n1))<=i*(sup rng f-inf rng f)*delta(D1)
              by A197,A202,FINSEQ_1:def 3;
A205:         indx(D2,D1,n1) in dom D2 & D2.indx(D2,D1,n1) = D1.n1
              by A19,A204,INTEGRA1:def 21;
              then
A206:         1 <= indx(D2,D1,n1) & indx(D2,D1,n1) <= len D2 by FINSEQ_3:27;
A207:         n1 < j
              proof
                assume
A208:           n1 >= j;
                now per cases by A208,REAL_1:def 5;
                  suppose n1=j;

then D.i in divset(D1,j) & D.i in rng D by A203,A204,FUNCT_1:def 5;
                    then
A209:               D.i in rng D /\ divset(D1,j) by XBOOLE_0:def 3;
                    D.(i+1) in rng D by A199,FUNCT_1:def 5;
                    then
A210:               D.(i+1) in rng D /\ divset(D1,j) by A200,XBOOLE_0:def 3;
                    i+1 > i by XREAL_1:31;

hence contradiction by A18,A199,A200,A203,A209,A210,Th4,GOBOARD2:19;
                  end;
                  suppose n1>j;
                    then
A211:               n1>=j+1 by NAT_1:13;
                    then
A212:               n1-1 >= j by XREAL_1:21;
A213:               inf divset(D1,n1) <= D.i by A204,INTEGRA2:1;
A214:               D.(i+1)<=sup divset(D1,j) by A200,INTEGRA2:1;
                    1 <= j by A200,FINSEQ_3:27;
                    then 1+1 <= j+1 by XREAL_1:8;
                    then
A215:               n1 <> 1 by A211,XXREAL_0:2;
                    then n1-1 in dom D1 by A204,INTEGRA1:9;
                    then
A216:               D1.j <= D1.(n1-1) by A200,A212, GOBOARD2:18;
A217:               sup divset(D1,j)=D1.j
                    proof
                      per cases;
                      suppose j=1;
                        hence thesis by A200,INTEGRA1:def 5;
                      end;
                      suppose j<>1;
                        hence thesis by A200,INTEGRA1:def 5;
                      end;
                    end;
                    inf divset(D1,n1)=D1.(n1-1) by A204,A215,INTEGRA1:def 5;
                    then D.i >= D1.j by A213,A216,XXREAL_0:2;
                    then
A218:               D.i >= D.(i+1) by A214,A217, XXREAL_0:2;
                    i < i+1 by XREAL_1:31;
                    hence contradiction by A199,A203,A218,GOBOARD1:def 1;
                  end;
                end;
                hence thesis;
              end;
              then
A219:         n1+1 <= j by NAT_1:13;
              then
A220:         j-n1 >= 1 by XREAL_1:21;
A221:         n1 >= 1 by A204,FINSEQ_3:27;
A222:         1 <= n1 & 1 <= j & j <= len D1 by A200,A204,FINSEQ_3:27;
              then
A223:         1 <= n1+1 & n1+1 <= len D1 by A219,NAT_1:12, XXREAL_0:2;
              then
A224:         n1+1 in dom D1 by FINSEQ_3:27;
              then
A225:         indx(D2,D1,n1+1) in dom D2 & D2.indx(D2,D1,n1+ 1)=D1.(n1+1)
              by A19,INTEGRA1:def 21;
A226:         indx(D2,D1,j) in dom D2 & D2.indx(D2,D1,j)=D1.j
              by A19,A200,INTEGRA1:def 21;
              D1.(n1+1) <= D1.j by A200,A219,A224,GOBOARD2:18;
              then
A227:         indx(D2,D1,n1+1) <= indx(D2,D1,j) by A225,A226,GOBOARD1:def 1;
A228:         1

<= indx(D2,D1,n1+1) & indx(D2,D1,n1+1) <= len D2 by A225,FINSEQ_3:27;
A229:         1 <= indx(D2,D1,j) & indx(D2,D1,j) <= len D2 by A226,FINSEQ_3:27;
              n1 < n1+1 by NAT_1:13;
              then D1.n1 < D1.(n1+1) by A204,A224,GOBOARD1:def 1;
              then
A230:         indx(D2,D1,n1) < indx(D2,D1,n1+1) by A205,A225,GOBOARD2:18;
              1+indx(D2,D1,n1+1) <= indx(D2,D1,j)+1 by A227,XREAL_1:8;
              then 1 <= indx(D2,D1,j)+1-indx(D2,D1,n1+1) by XREAL_1:21;
              then
A231:         mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j)).1
              =D2.(1-1+indx(D2,D1,n1+1)) by A227,A228,A229,JORDAN3:31
                .=D1.(n1+1) by A19,A224,INTEGRA1:def 21;
A232:         Sum

mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
              <= (sup rng f-inf rng f)*delta(D1)
              proof
                per cases by A219,REAL_1:def 5;
                suppose
A233:             n1+1=j;
A234:             1 <= n1+1 & n1+1 <= len UVf(D1) by A223,INTEGRA1:def 7;
A235:             j-'(n1+1)+1=j-(n1+1)+1 by A233,BINARITH:50;
                  n1+1 in Seg len D1 by A224,FINSEQ_1:def 3;
  then
B236:  n1+1 in dom D1 by FINSEQ_1:def 3;
A237:             len mid(UVf(D1),n1+1,j)= 1 by A233,A234,A235,JORDAN3:27;
                  (n1+1)+1 <= j+1 by A219,XREAL_1:8;
                  then 1 <= j+1-(n1+1) by XREAL_1:21;
                  then mid(UVf(D1),n1+1,j).1 = UVf(D1).(1+(n1+1)-1)
                  by A233,A234,JORDAN3:31
                    .=(sup rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))
                  by INTEGRA1:def 7,B236;
                  then mid(UVf(D1),n1+1,j)
                  =<*(sup rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1))*>
                  by A237,FINSEQ_1:57;
                  then
A238:             Sum mid(UVf(D1),n1+1,j)

=(sup rng(f|divset(D1,n1+1)))*vol(divset(D1,n1+1)) by FINSOP_1:12;
                  divset(D1,n1+1) c= A by A224,INTEGRA1:10;
                  then
A239:             sup rng(f|divset(D1,n1+1)) <= sup rng f by A1,Lm5;
                  vol(divset(D1,n1+1)) >= 0 by INTEGRA1:11;
                  then
A240:             Sum mid(UVf(D1),n1+1,j)
                  <=(sup rng f)*vol(divset(D1,n1+1)) by A238,A239,XREAL_1:66;
                  D1.n1 < D1.j by A200,A204,A207,GOBOARD1:def 1;
                  then
A241:             indx(D2,D1,n1)<indx(D2,D1,j) by A205, A226,GOBOARD2:18;
                  then
A242:             indx(D2,D1,n1)+1 <= indx(D2,D1,j) by NAT_1:13;
                  then indx(D2,D1,n1)+1 <= len D2 by A229,XXREAL_0:2;
                  then
A243:             indx(D2,D1,n1)+1 <= len UVf(D2) by INTEGRA1:def 7;
A244:             1<=indx(D2,D1,n1)+1 by NAT_1:12;
A245:             indx(D2,D1,j) <= len UVf(D2) by A229,INTEGRA1:def 7;
                  then
A246:             len mid(UVf(D2),indx(D2,D1,n1)+1,indx( D2,D1,j))

=indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1 by A229,A242,A243,A244,JORDAN3:27
                    .=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A242,BINARITH:50
                    .=indx(D2,D1,j)-indx(D2,D1,n1);
A247:             indx(D2,D1,j)-indx(D2,D1,n1)<=2
                  proof
                    assume indx(D2,D1,j) - indx(D2,D1,n1) > 2;
                    then
A248:               indx(D2,D1,n1)+2 < indx(D2,D1,j) by XREAL_1:22;
A249:               indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A250:               indx(D2,D1,n1)+1 < indx(D2,D1,n1)+2 by XREAL_1:8;
A251:               indx
                    (D2,D1,n1)+1 < indx(D2,D1,j) & indx(D2,D1,n1)+1 in dom D2
                    proof

thus indx(D2,D1,n1)+1 < indx(D2,D1,j) by A248,A250,XXREAL_0:2;
                      then 1 <= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= len D2
                      by A206,A229,NAT_1:13,XXREAL_0:2;
                      hence thesis by FINSEQ_3:27;
                    end;
A252:               D2.(indx(D2,D1,n1)+1) in rng D
                    proof
A253:                 D2.(indx(D2,D1,n1)+1) in rng D2 by A251,FUNCT_1:def 5;
                      not D2.(indx(D2,D1,n1)+1) in rng D1
                      proof
                        assume D2.(indx(D2,D1,n1)+1) in rng D1;
                        then consider k1 being Element of NAT such that
A254:                   k1

in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.k1 by PARTFUN1:26;
                        D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
                        & D2.(indx(D2,D1,n1)+1) < D2.indx(D2,D1,j)
                        by A205,A226,A249,A251,GOBOARD1:def 1;

then n1 < k1 & k1 < j by A200,A204,A205,A226,A254,GOBOARD2:18;
                        hence contradiction by A233,NAT_1:13;
                      end;
                      hence thesis by A19,A253,XBOOLE_0:def 2;
                    end;
A255:               D2.(indx(D2,D1,n1)+1) in rng D /\ divset(D1,j)
                    proof
A256:                 inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
                      by A200,A207,A221,INTEGRA1:def 5;
                      D2.(indx(D2,D1,n1)+1) >= D2.indx(D2,D1,n1)
                      & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+1)
                      by A205,A226,A249,A251,GOBOARD2:18;

then D2.(indx(D2,D1,n1)+1) in divset(D1,j) by A205,A226,A233,A256, INTEGRA2:1;
                      hence thesis by A252,XBOOLE_0:def 3;
                    end;
A257:               indx
                    (D2,D1,n1) < indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 in dom D2
                    proof
                      thus indx(D2,D1,n1) < indx(D2,D1,n1)+2 by A250,NAT_1:13;
                      then 1 <= indx(D2,D1,n1)+2 & indx(D2,D1,n1)+2 <= len D2
                      by A206,A229,A248,XXREAL_0:2;
                      hence thesis by FINSEQ_3:27;
                    end;
A258:               D2.(indx(D2,D1,n1)+2) in rng D
                    proof
A259:                 D2.(indx(D2,D1,n1)+2) in rng D2 by A257,FUNCT_1:def 5;
                      not D2.(indx(D2,D1,n1)+2) in rng D1
                      proof
                        assume D2.(indx(D2,D1,n1)+2) in rng D1;
                        then consider k1 being Element of NAT such that
A260:                   k1

in dom D1 & D2.(indx(D2,D1,n1)+2) = D1.k1 by PARTFUN1:26;
                        D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+2)
                        & D2.(indx(D2,D1,n1)+2) < D2.indx(D2,D1,j)
                        by A205,A226,A248,A257,GOBOARD1:def 1;

then n1 < k1 & k1 < j by A200,A204,A205,A226,A260,GOBOARD2:18;
                        hence contradiction by A233,NAT_1:13;
                      end;
                      hence thesis by A19,A259,XBOOLE_0:def 2;
                    end;
                    D2.(indx(D2,D1,n1)+2) in rng D /\ divset(D1,j)
                    proof
A261:                 inf divset(D1,j) = D1.(j-1) & sup divset(D1,j) = D1.j
                      by A200,A207,A221,INTEGRA1:def 5;
                      D2.(indx(D2,D1,n1)+2) >= D2.indx(D2,D1,n1)
                      & D2.indx(D2,D1,j) >= D2.(indx(D2,D1,n1)+2)
                      by A205,A226,A248,A257,GOBOARD2:18;

then D2.(indx(D2,D1,n1)+2) in divset(D1,j) by A205,A226,A233,A261, INTEGRA2:1;
                      hence thesis by A258,XBOOLE_0:def 3;
                    end;

then D2.(indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+2) by A18,A200,A255, Th4;
                    hence contradiction by A250,A251,A257,GOBOARD1:def 1;
                  end;
A262:             indx
                  (D2,D1,j)-indx(D2,D1,n1)=1 or indx(D2,D1,j)-indx(D2,D1,n1)=2
                  proof
                    indx(D2,D1,n1)+1 <= indx(D2,D1,j) by A241,NAT_1:13;
                    then
A263:               indx(D2,D1,n1)+1 = indx(D2,D1,j) or
                    indx(D2,D1,n1)+1 < indx(D2,D1,j) by REAL_1:def 5;

indx(D2,D1,n1)+1<indx(D2,D1,j) implies indx(D2,D1,n1)+2=indx(D2, D1, j )
                    proof
                      assume indx(D2,D1,n1)+1 < indx(D2,D1,j);
                      then
A264:                 indx(D2,D1,n1)+1+1 <= indx(D2, D1,j) by NAT_1:13;
                      indx(D2,D1,n1)+2 >= indx(D2,D1,j) by A247,XREAL_1:22;
                      hence thesis by A264,XXREAL_0:1;
                    end;
                    hence thesis by A263;
                  end;
                  Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                  >=(inf rng f)*vol(divset(D1,n1+1))
                  proof
                    now per cases by A262;
                      suppose
A265:                   indx(D2,D1,j)-indx(D2,D1,n1)=1;
                        then 1=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1;
                        then
A266:                   mid(UVf(D2),indx(D2,D1,n1) +1,indx(D2,D1,j)).1

=UVf(D2).(1+(indx(D2,D1,n1)+1)-1) by A244,A245,JORDAN3:31
                          .=UVf(D2).(indx(D2,D1,n1)+1);

indx(D2,D1,n1)+1 in Seg len D2 by A226,A265,FINSEQ_1:def 3;
  then indx(D2,D1,n1)+1 in dom D2 by FINSEQ_1:def 3;
                        then
A267:                   UVf(D2).(indx(D2,D1,n1)+1)
                        =(sup rng(f|divset(D2,indx(D2,D1,n1)+1)))
                        *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 7;
A268:                   divset(D2,indx(D2,D1,n1)+1)=divset(D1,n1+1)
                        proof
A269:                     divset

(D1,n1+1)=[.inf divset(D1,n1+1), sup divset(D1,n1+1).] by INTEGRA1:5;
                          indx(D2,D1,n1)+1 >= 1+1 by A206,XREAL_1:8;
                          then indx(D2,D1,n1)+1 <>1;

then inf divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1-1)

& sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
                          by A226,A265,INTEGRA1:def 5;
                          then
A270:                     inf divset(D2,indx(D2, D1,n1)+1)=D1.n1

& sup divset(D2,indx(D2,D1,n1)+1)=D1.j by A19,A200,A204,A265, INTEGRA1:def 21;

inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
                          by A207,A221,A224,A233,INTEGRA1:def 5;
                          hence thesis by A233,A269,A270,INTEGRA1:5;
                        end;
                        vol(divset(D2,indx(D2,D1,n1)+1))>=0 by INTEGRA1:11;
                        then
A271:                   UVf(D2).(indx(D2,D1,n1)+1)

>=(inf rng f)*vol(divset(D1,n1+1)) by A1,A226,A265,A267,A268,Th18, XREAL_1:66;
                        mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))

=<*UVf(D2).(indx(D2,D1,n1)+1)*> by A246,A265,A266,FINSEQ_1:57;
                        hence Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        >=(inf rng f)*vol(divset(D1,n1+1)) by A271,FINSOP_1:12;
                      end;
                      suppose
A272:                   indx(D2,D1,j)-indx(D2,D1,n1)=2;
A273:                   indx(D2,D1,n1)+2-1=indx(D2,D1,n1)+1;
A274:                   indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1>=1 by A272;
A275:                   indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1=1+1 by A272;
A276:                   1

<= indx(D2,D1,n1)+1 & indx(D2,D1,n1)+1 <= indx(D2,D1,n1)+2
                        by NAT_1:12,XREAL_1:8;

then indx(D2,D1,n1)+1 <= len D2 by A229,A272,XXREAL_0:2;
                        then
A277:                   indx(D2,D1,n1)+1 in dom D2 by A276,FINSEQ_3:27;
A278:                   indx(D2,D1,j) <= len UVf(D2) by A229,INTEGRA1:def 7;
                        then
A279:                   mid(UVf(D2),indx(D2,D1,n1) +1,indx(D2,D1,j)).1

=UVf(D2).(1+(indx(D2,D1,n1)+1)-1) by A272,A274,A276,JORDAN3:31
                          .=UVf(D2).(indx(D2,D1,n1)+1);
                        mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).2
                        =UVf(D2).(2+(indx(D2,D1,n1)+1)-1)
                        by A275,A276,A278,JORDAN3:31
                          .=UVf(D2).(indx(D2,D1,n1)+0+2);
                        then mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))

=<*UVf(D2).(indx(D2,D1,n1)+1),UVf(D2).(indx(D2,D1,n1)+2)*>
                        by A246,A272,A279,FINSEQ_1:61;
                        then
A280:                   Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        =UVf(D2).(indx(D2,D1,n1)+1)+UVf(D2).(indx(D2,D1,n1)+2)
                        by RVSUM_1:107;
A281:                   UVf(D2).(indx(D2,D1,n1)+1)
                        >= (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+1))
                        proof

indx(D2,D1,n1)+1 in Seg len D2 by A277,FINSEQ_1:def 3;
  then indx(D2,D1,n1)+1 in dom D2 by FINSEQ_1:def 3;
                          then
A282:                     UVf(D2).(indx(D2,D1,n1 )+1)
                          =(sup rng(f|divset(D2,indx(D2,D1,n1)+1)))
                          *vol(divset(D2,indx(D2,D1,n1)+1)) by INTEGRA1:def 7;
                          vol(divset(D2,indx(D2,D1,n1)+1)) >= 0 by INTEGRA1:11;
                          hence thesis by A1,A277,A282,Th18,XREAL_1:66;
                        end;
                        UVf(D2).(indx(D2,D1,n1)+2)
                        >= (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+2))
                        proof

indx(D2,D1,n1)+2 in Seg len D2 by A226,A272,FINSEQ_1:def 3;
  then indx(D2,D1,n1)+2 in dom D2 by FINSEQ_1:def 3;
                          then
A283:                     UVf(D2).(indx(D2,D1,n1 )+2)
                          =(sup rng(f|divset(D2,indx(D2,D1,n1)+2)))
                          *vol(divset(D2,indx(D2,D1,n1)+2)) by INTEGRA1:def 7;
                          vol(divset(D2,indx(D2,D1,n1)+2)) >= 0 by INTEGRA1:11;
                          hence thesis by A1,A226,A272,A283,Th18,XREAL_1:66;
                        end;
                        then
A284:                   Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        >= (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+1))

+ (inf rng f)*vol(divset(D2,indx(D2,D1,n1)+2)) by A280,A281,XREAL_1:9;

vol(divset(D2,indx(D2,D1,n1)+1))+vol(divset(D2,indx(D2,D1,n1)+2))
                        =vol(divset(D1,n1+1))
                        proof
                          indx(D2,D1,n1)+1 > 1 by A206,NAT_1:13;
                          then
A285:                     inf
                          divset(D2,indx(D2,D1,n1)+1) = D2.(indx(D2,D1,n1)+1-1)

& sup divset(D2,indx(D2,D1,n1)+1)=D2.(indx(D2,D1,n1)+1)
                          by A277,INTEGRA1:def 5;
                          indx(D2,D1,n1)+2 >= 2+1 by A206,XREAL_1:8;
                          then indx(D2,D1,n1)+2 <> 1;
                          then
A286:                     inf
                          divset(D2,indx(D2,D1,n1)+2) = D2.(indx(D2,D1,n1)+1)
                          & sup divset(D2,indx(D2,D1,n1)+2)=D2.indx(D2,D1,j)
                          by A226,A272,A273,INTEGRA1:def 5;
A287:                     vol(divset(D2,indx(D2,D1,n1)+1))

=D2.(indx(D2,D1,n1)+1)-D1.n1 by A205,A285,INTEGRA1:def 6;
A288:                     vol(divset(D2,indx(D2,D1,n1)+2))

=D1.j-D2.(indx(D2,D1,n1)+1) by A226,A286,INTEGRA1:def 6;

inf divset(D1,n1+1)=D1.(n1+1-1) & sup divset(D1,n1+1)=D1.(n1+1)
                          by A207,A221,A224,A233,INTEGRA1:def 5;

then vol(divset(D1,n1+1))=D1.(n1+1)-D1.n1 by INTEGRA1:def 6;
                          hence thesis by A233,A287,A288;
                        end;
                        hence Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                        >=(inf rng f)*vol(divset(D1,n1+1)) by A284;
                      end;
                    end;
                    hence thesis;
                  end;
                  then
A289:             Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2 ),indx(D2,D1,n1)+1,
                  indx(D2, D1,j))

<=(sup rng f)*vol(divset(D1,n1+1))-(inf rng f)*vol(divset(D1,n1+1))
                  by A240,REAL_1:92;
A290:             sup rng f-inf rng f >= 0 by A1,Lm4,XREAL_1:50;
                  vol(divset(D1,n1+1))<=delta(D1)
                  proof
A291:               n1+1 in Seg len D1 by A224,FINSEQ_1:def 3;
  then n1+1 in dom D1 by FINSEQ_1:def 3;
                    then
A292:               vol(divset(D1,n1+1))=upper_volume( chi(A,A),D1).(n1+1) by
                    INTEGRA1:22;

n1+1 in Seg len upper_volume(chi(A,A),D1) by A291,INTEGRA1:def 7;

then n1+1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;
                    then
A293:               vol(divset(D1,n1+1)) in rng upper_volume(chi(A,A),D1)
                    by A292,FUNCT_1:def 5;

delta(D1)=max rng upper_volume(chi(A,A),D1) by INTEGRA1:def 19;
                    hence thesis by A293,XXREAL_2:def 8;
                  end;
                  then (sup rng f-inf rng f)*vol(divset(D1,n1+1))
                  <=(sup rng f-inf rng f)*delta(D1) by A290,XREAL_1:66;
                  hence thesis by A289,XXREAL_0:2;
                end;
                suppose
A294:             n1+1 < j;
A295:             n1 < n1+1 by NAT_1:13;
                  then
A296:             D1.n1 < D1.(n1+1) by A204,A224, GOBOARD1:def 1;
                  then consider B being closed-interval Subset of REAL,
                  MD1,MD2 being Element of divs B such that
A297:             D1

.n1=inf B & sup B=MD2.(len MD2) & sup B=MD1.(len MD1) & MD1 <= MD2

& MD1=mid(D1,n1+1,j) & MD2=mid(D2,indx(D2,D1,n1+1),indx(D2,D1,j))
                  by A19,A200,A219,A224,A231,Th14;
A298:             len MD1 = j-'(n1+1)+1 by A219,A222,A223,A297,JORDAN3:27;
A299:             j-'(n1+1) = j-(n1+1) by A219,BINARITH:50;
A300:             len MD1 = j-(n1+1)+1 by A219,A298,BINARITH:50;
A301:             j-'(n1+1)+1=j-n1 by A299;
A302:             len MD1+(n1+1)-1 =j by A300;
A303:             B c= A
                  proof
                    let x1;
                    assume
A304:               x1 in B;
                    then reconsider x1 as Real;
A305:               rng D1 c= A by INTEGRA1:def 2;
A306:               D1.n1 <= x1 & x1 <= MD1.(len MD1) by A297,A304,INTEGRA2:1;

D1.n1 in rng D1 & D1.j in rng D1 by A200,A204,FUNCT_1:def 5;
                    then
A307:               inf A <= D1.n1 & D1.j <= sup A by A305,INTEGRA2:1;
                    MD1.(len MD1)=D1.(j-n1-1+(n1+1))
                    by A219,A220,A222,A223,A297,A298,A299,JORDAN3:31
                      .=D1.j;
                    then inf A <= x1 & x1 <= sup A by A306,A307,XXREAL_0:2;
                    hence thesis by INTEGRA2:1;
                  end;
                  then reconsider g=f|B as Function of B,REAL by FUNCT_2:38;
A308:             g is_bounded_on B
                  proof
A309:               f

is_bounded_above_on A&f is_bounded_below_on A by A1,RFUNCT_1:def 11;
                    then consider a be real number such that
A310:               for x being set st x in A /\ dom f holds a<=f.x
                    by RFUNCT_1:def 10;
                    for x being set st x in B /\ dom g holds a<=g.x
                    proof
                      let x be set;
                      assume x in B /\ dom g;
                      then
A311:                 x in dom g by XBOOLE_0:def 3;
                      then
A312:                 x in dom f /\ B by FUNCT_1:68;
                      dom f /\ B c= dom f /\ A by A303,XBOOLE_1:26;
                      then a <= f.x by A310,A312;
                      hence thesis by A311,FUNCT_1:68;
                    end;
                    then
A313:               g is_bounded_below_on B by RFUNCT_1:def 10;
                    consider a be real number such that
A314:               for x being set st x in A /\ dom f holds f.x<=a
                    by A309,RFUNCT_1:def 9;
                    for x being set st x in B /\ dom g holds g.x<=a
                    proof
                      let x be set;
                      assume x in B /\ dom g;
                      then
A315:                 x in dom g by XBOOLE_0:def 3;
                      then
A316:                 x in dom f /\ B by FUNCT_1:68;
                      dom f /\ B c= dom f /\ A by A303,XBOOLE_1:26;
                      then a >= f.x by A314,A316;
                      hence thesis by A315,FUNCT_1:68;
                    end;
                    then g is_bounded_above_on B by RFUNCT_1:def 9;
                    hence thesis by A313,RFUNCT_1:def 11;
                  end;
                  rng MD2 <> {};
                  then 1 in dom MD2 by FINSEQ_3:34;
                  then
A317:             1 <= len MD2 by FINSEQ_3:27;
A318:             len MD2=indx(D2,D1,j)-'indx(D2,D1,n1+1)+1
                  by A227,A228,A229,A297,JORDAN3:27;
                  then
A319:             len
                  MD2 = indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by A227,BINARITH:50;
                  then
A320:             len MD2-1+indx(D2,D1,n1+1)=indx(D2,D1, j);
A321:             rng MD2 = rng MD1 \/ {D.(i+1)}
                  proof
                    x1 in rng MD2 implies x1 in (rng MD1 \/ {D.(i+1)})
                    proof
                      assume
A322:                 x1 in rng MD2;
                      then reconsider x1 as Real;
A323:                 MD2.1 <= x1 & x1 <= MD2.(len MD2) by A322,Th15;
A324:                 MD2.1=D2.indx(D2,D1,n1+1) by A228,A229,A297,JORDAN3:27;
A325:                 MD2

.(len MD2)=D2.indx(D2,D1,j) by A227,A228,A229,A297,A317,A318,A320,JORDAN3:31;
A326:                 D1

.(n1+1) <= x1 & x1 <= D1.j by A19,A224,A226,A227,A228,A229,A297
                      ,A317,A318,A320,A323,A324,INTEGRA1:def 21,JORDAN3:31;
A327:                 rng MD2 c= rng D2 by A297,JORDAN3:28;
                      now per cases by A19,A322,A327,XBOOLE_0:def 2;
                        suppose x1 in rng D1;
                          then consider k such that
A328:                     k in dom D1 & D1.k = x1 by PARTFUN1:26;
A329:                     n1

+1 <= k & k <= j by A200,A224,A225,A226,A323,A324,A325,A328, GOBOARD1:def 1;
                          then
A330:                     1 <= k-n1 & k-n1 <= j- n1 by XREAL_1:11,21;
A331:                     1

<= k-n1 & k-n1 <= len MD1 by A298,A301,A329,XREAL_1:11,21;
A332:                     j-(n1+1)+1=j-n1;
                          n1 <= n1+1 by NAT_1:11;
                          then n1 <= k by A329,XXREAL_0:2;
                          then consider n being Nat such that
A333:                     k=n1+n by NAT_1:10;
                          n in dom MD1 by A331,A333,FINSEQ_3:27;
                          then
A334:                     MD1.n in rng MD1 by FUNCT_1:def 5;
                          n in NAT by ORDINAL1:def 13;
                          then MD1.n = D1.(k-n1-1+(n1+1))
                          by A219,A222,A223,A297,A330,A332,A333,JORDAN3:31
                            .= D1.k;

hence x1 in (rng MD1 \/ {D.(i+1)}) by A328,A334,XBOOLE_0:def 2;
                        end;
                        suppose x1 in rng D;
                          then consider n such that
A335:                     n in dom D & D.n = x1 by PARTFUN1:26;
A336:                     D.i <= sup divset(D1,n1) by A204,INTEGRA2:1;
                          sup divset(D1,n1)=D1.n1
                          proof
                            per cases;
                            suppose n1=1;
                              hence thesis by A204,INTEGRA1:def 5;
                            end;
                            suppose n1<>1;
                              hence thesis by A204,INTEGRA1:def 5;
                            end;
                          end;
                          then D.i < D1.(n1+1) by A296,A336,XXREAL_0:2;
                          then D.i < D.n by A225,A323,A324,A335,XXREAL_0:2;
                          then i < n by A203,A335,GOBOARD2:18;
                          then i+1 <= n by NAT_1:13;
                          then
A337:                     i+1 = n or i+1 < n by REAL_1:def 5;
                          not i+1 < n
                          proof
                            assume i+1 < n;
                            then
A338:                       D.(i+1) < D.n by A199,A335,GOBOARD1:def 1;
                            inf divset(D1,j) <= D.(i+1) by A200,INTEGRA2:1;
                            then
A339:                       inf divset(D1,j) <= D.n by A338,XXREAL_0:2;
                            sup divset(D1,j)=D1.j
                            proof
                              per cases;
                              suppose j=1;
                                hence thesis by A200,INTEGRA1:def 5;
                              end;
                              suppose j<>1;
                                hence thesis by A200,INTEGRA1:def 5;
                              end;
                            end;
                            then D.n in rng D&D.n in divset(D1,j)
                            by A326,A335,A339,FUNCT_1:def 5,INTEGRA2:1;
                            then
A340:                       x1 in rng D /\
                            divset(D1,j) by A335,XBOOLE_0:def 3;
A341:                       D.(i+1) in rng D by A199,FUNCT_1:def 5;
                            consider y1 being Real such that
A342:                       y1=D.(i+1);

y1 in rng D /\ divset(D1,j) by A200,A341,A342,XBOOLE_0:def 3;

hence contradiction by A18,A200,A335,A338,A340,A342,Th4;
                          end;
                          then x1 in {D.(i+1)} by A335,A337,TARSKI:def 1;
                          hence x1 in (rng MD1 \/ {D.(i+1)}) by XBOOLE_0:def 2;
                        end;
                      end;
                      hence thesis;
                    end;
                    then
A343:               rng MD2 c= rng MD1 \/ {D.(i+1)} by TARSKI:def 3;
                    x1 in rng MD1 \/ {D.(i+1)} implies x1 in rng MD2
                    proof
                      assume
A344:                 x1 in rng MD1 \/ {D.(i+1)};
                      then reconsider x1 as Real;
                      now per cases by A344,XBOOLE_0:def 2;
                        suppose
A345:                     x1 in rng MD1;
                          rng MD1 c= rng D1 by A297,JORDAN3:28;
                          then
A346:                     x1 in rng D1 by A345;
A347:                     MD1.1 <= x1 & x1 <= MD1.(len MD1) by A345,Th15;
                          rng MD1 <> {};
                          then 1 in dom MD1 by FINSEQ_3:34;
                          then
A348:                     1 <= len MD1 by FINSEQ_3:27;
A349:                     len
                          MD1=j-'(n1+1)+1 by A219,A222,A223,A297,JORDAN3:27;
A350:                     MD1.1=D1.(n1+1) by A222,A223,A297,JORDAN3:27;

len MD1+(n1+1)-1=j-(n1+1)+1+(n1+1)-1 by A219,A349,BINARITH:50
                            .=j;
                          then
A351:                     MD1.(len MD1)=D1.j
                          by A219,A222,A223,A297,A348,A349,JORDAN3:31;
                          rng D1 c= rng D2 by A19,INTEGRA1:def 20;
                          then consider k such that
A352:                     k in dom D2 & D2.k = x1 by A346,PARTFUN1:26;
A353:                     indx(D2,D1,n1+1)<=k & k<=indx(D2,D1,j)
                          by A225,A226,A347,A350,A351,A352,GOBOARD1:def 1;
                          then indx(D2,D1,n1+1)+1<=k+1 by XREAL_1:8;
                          then
A354:                     1 <= k+1-indx(D2,D1,n1 +1) by XREAL_1:21;
                          k-indx(D2,D1,n1+1)<=indx(D2,D1,j)-indx(D2,D1,n1+1)
                          by A353,XREAL_1:11;
                          then
A355:                     k

-indx(D2,D1,n1+1)+1<=indx(D2,D1,j)-indx(D2,D1,n1+1)+1 by XREAL_1:8;
                          indx(D2,D1,n1+1)<=k+1 by A353,NAT_1:12;
                          then consider n being Nat such that
A356:                     k+1 = indx(D2,D1,n1+1)+n by NAT_1:10;
A357:                     n in NAT by ORDINAL1:def 13;
                          n in dom MD2 by A319,A354,A355,A356,FINSEQ_3:27;
                          then
A358:                     MD2.n in rng MD2 by FUNCT_1:def 5;
                          n+indx(D2,D1,n1+1)-1=k by A356;

hence x1 in rng MD2 by A227,A228,A229,A297,A352,A354,A355,A357,A358,
                          JORDAN3:31;
                        end;
                        suppose x1 in {D.(i+1)};
                          then
A359:                     x1 = D.(i+1) by TARSKI :def 1;
A360:                     D.(i+1) in rng D by A199,FUNCT_1:def 5;
                          rng D c= rng D2 by A19,INTEGRA1:def 20;
                          then consider k such that
A361:                     k in dom D2 & x1 = D2.k by A359,A360,PARTFUN1:26;
                          inf divset(D1,j)<=D.(i+1) & D.(i+1)<=sup divset(D1,j
                          ) by A200,INTEGRA2:1;
                          then
A362:                     D1.(j-1) <= x1 & x1 <= D1.j by A200,A207,A221,A359,
                          INTEGRA1:def 5;
A363:                     j

-1 in dom D1 & j-1 in NAT by A200,A207,A221,INTEGRA1:9;

reconsider j1 = j-1 as Element of NAT by A200,A207,A221,INTEGRA1:9;
                          n1<j1 by A294,XREAL_1:22;
                          then n1+1 <= j1 by NAT_1:13;
                          then D1.(n1+1) <= D1.(j-1) by A224,A363,GOBOARD2:18;

then D2.indx(D2,D1,n1+1) <= D2.k & D2.k <= D2.indx(D2,D1,j)

by A19,A200,A225,A361,A362,INTEGRA1:def 21,XXREAL_0:2;
                          hence x1 in rng MD2 by A225,A226,A297,A361,Th16;
                        end;
                      end;
                      hence thesis;
                    end;
                    then rng MD1 \/ {D.(i+1)} c= rng MD2 by TARSKI:def 3;
                    hence thesis by A343,XBOOLE_0:def 10;
                  end;
A364:             len MD1 in dom MD1 by FINSEQ_5:6;
                  then
A365:             1 <= len MD1 by FINSEQ_3:27;
A366:             inf divset(MD1,len MD1)=inf divset(D1,j)
                  & sup divset(MD1,len MD1)=sup divset(D1,j)
                  proof
                    per cases;
                    suppose
A367:                 len MD1=1;
                      then
A368:                 inf divset(MD1,len MD1)=inf B

& sup divset(MD1,len MD1)=MD1.(len MD1) by A364,INTEGRA1:def 5;
                      inf divset(D1,j)=D1.(j-1)
                      & sup divset(D1,j)=D1.j by A200,A207,A221,INTEGRA1:def 5;
                      hence thesis by A222,A297,A300,A367,A368,JORDAN3:27;
                    end;
                    suppose
A369:                 len MD1<>1;
                      then
A370:                 inf divset(MD1,len MD1)=MD1.( len MD1-1)

& sup divset(MD1,len MD1)=MD1.(len MD1) by A364,INTEGRA1:def 5;
A371:                 len MD1-1+(n1+1)-1=j-1 by A298,A299;
                      len MD1-1 in dom MD1 & len MD1-1 in NAT
                      by A364,A369,INTEGRA1:9;
                      then
A372:                 len MD1-1 >= 1 by Lm1;
                      len MD1 <= len MD1+1 by NAT_1:11;
                      then len MD1 -1 <= len MD1 by XREAL_1:22;
                      then
A373:                 inf divset(MD1,len MD1) = D1.( j-1)
                      by A219,A222,A223,A297,A298,A370,A371,A372,JORDAN3:31;
                      sup divset(MD1,len MD1)=D1.j
                      by A219,A222,A223,A297,A298,A302,A365,A370,JORDAN3:31;
                      hence thesis by A200,A207,A221,A373,INTEGRA1:def 5;
                    end;
                  end;
                  inf divset(D1,j)<=D.(i+1) & D.(i+1)<=sup divset(D1,j)
                  by A200,INTEGRA2:1;
                  then
A374:             D.(i+1) in divset(MD1,len MD1) by A366,INTEGRA2:1;
A375:             Sum upper_volume(g,MD1)-Sum upper_volume(g,MD2)<=
                  (sup rng g-inf rng g)*delta(MD1)
                  proof
A376:               vol(B)=sup B-D1.n1 by A297,INTEGRA1:def 6;
A377:               len MD1 in dom MD1 by FINSEQ_5:6;
                    vol(B)<>0 & D.(i+1) > inf B
                    proof
                      sup divset(MD1,len MD1)=MD1.(len MD1)
                      proof
                        per cases;
                        suppose len MD1 = 1;
                          hence thesis by A377,INTEGRA1:def 5;
                        end;
                        suppose len MD1 <> 1;
                          hence thesis by A377,INTEGRA1:def 5;
                        end;
                      end;

then vol(B)=D1.j-D1.n1 by A200,A207,A221,A297,A366,A376,INTEGRA1:def 5;
                      hence vol(B)<>0 by A200,A204,A207,GOBOARD1:def 1;
                      inf divset(D1,j) <= D.(i+1) by A200,INTEGRA2:1;
                      then
A378:                 D1.(j-1) <= D.(i+1) by A200, A207,A221,INTEGRA1:def 5;
A379:                 n1 < j-1 by A294,XREAL_1:22;
                      j-1 in dom D1 by A200,A207,A221,INTEGRA1:9;
                      then D1.n1 <D1.(j-1) by A204,A379,GOBOARD1:def 1;
                      hence thesis by A297,A378,XXREAL_0:2;
                    end;
                    hence thesis by A297,A308,A321,A374,Th13;
                  end;
A380:             rng g c= rng f by RELAT_1:99;
                  f is_bounded_above_on A & f is_bounded_below_on A
                  by A1,RFUNCT_1:def 11;
                  then rng f is bounded_above & rng f is bounded_below
                  by INTEGRA1:13,15;
                  then sup rng f >= sup rng g & inf rng f <= inf rng g
                  by A380,SEQ_4:64,65;
                  then
A381:             sup rng f-inf rng f>=sup rng g - inf rng g by REAL_1:92;
                  delta(MD1) >= 0 by Th8;

then (sup rng f-inf rng f)*delta(MD1)>=(sup rng g-inf rng g)*delta(MD1 )
                  by A381,XREAL_1:66;
                  then
A382:             Sum upper_volume(g,MD1)-Sum upper_volume(g,MD2)<=
                  (sup rng f-inf rng f)*delta(MD1) by A375,XXREAL_0:2;

delta(MD1)=max rng upper_volume(chi(B,B),MD1) by INTEGRA1:def 19;

then delta(MD1) in rng upper_volume(chi(B,B),MD1) by XXREAL_2:def 8;
                  then consider k such that
A383:             k in dom upper_volume(chi(B,B),MD1)
                  & upper_volume(chi(B,B),MD1).k = delta(MD1) by PARTFUN1:26;

k in Seg len upper_volume(chi(B,B),MD1) by A383,FINSEQ_1:def 3;
                  then
A384:             k in Seg len MD1 by INTEGRA1:def 7;
  then k in dom MD1 by FINSEQ_1:def 3;
                  then
A385:             delta(MD1) = vol(divset(MD1,k)) by A383,INTEGRA1:22;
                  n1+1>1 by A221,NAT_1:13;
                  then n1>1-1 by XREAL_1:21;
                  then
A386:             1
                  <= k & k <= len MD1 & k < k+n1 by A384,FINSEQ_1:3,XREAL_1:31;
                  then
A387:             1 < k+n1 by XXREAL_0:2;
A388:             k in dom MD1 by A384,FINSEQ_1:def 3;
                  k+n1 <= j by A298,A301,A386,XREAL_1:21;
                  then k+n1 <= len D1 by A222,XXREAL_0:2;
                  then
A389:             k+n1 in dom D1 by A387,FINSEQ_3:27;
A390:             divset(MD1,k)=divset(D1,k+n1)
                  proof
                    inf divset(MD1,k)=inf divset(D1,k+n1)
                    & sup divset(MD1,k)=sup divset(D1,k+n1)
                    proof
                      per cases;
                      suppose
A391:                   k=1;
                        then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k
                        by A388,INTEGRA1:def 5;
                        then
A392:                   inf
                        divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
                        by A219,A222,A223,A297,A298,A386,JORDAN3:31;

inf divset(D1,k+n1)=D1.(k+n1-1) & sup divset(D1,k+n1)=D1.(k+n1)
                        by A386,A389,INTEGRA1:def 5;
                        hence thesis by A391,A392;
                      end;
                      suppose
A393:                   k<>1;
                        then
A394:                   k-1 in dom MD1 & k-1 in NAT by A388,INTEGRA1:9;
                        then
A395:                   1 <= k-1 & k-1 <= len MD1 by Lm1;
                        inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
                        by A388,A393,INTEGRA1:def 5;
                        then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
                        & sup divset(MD1,k)=D1.(k+(n1+1)-1)
                        by A219,A222,A223,A297,A298,A386,A394,A395,JORDAN3:31;
                        hence thesis by A386,A389,INTEGRA1:def 5;
                      end;
                    end;

then divset(MD1,k)=[.inf divset(D1,k+n1),sup divset(D1,k+n1).] by INTEGRA1:5;
                    hence thesis by INTEGRA1:5;
                  end;
A396:             k+n1 in Seg len D1 by A389,FINSEQ_1:def 3;
  then k+n1 in dom D1 by FINSEQ_1:def 3;
                  then
A397:             delta(MD1)=upper_volume(chi(A,A),D1).( k+n1) by A385,A390,
                  INTEGRA1:22;

k+n1 in Seg len upper_volume(chi(A,A),D1) by A396,INTEGRA1:def 7;
                  then k+n1 in dom upper_volume(chi(A,A),D1) by FINSEQ_1:def 3;

then delta(MD1) in rng upper_volume(chi(A,A),D1) by A397,FUNCT_1:def 5;

then delta(MD1) <= max rng upper_volume(chi(A,A),D1) by XXREAL_2:def 8;
                  then
A398:             delta(MD1) <= delta(D1) by INTEGRA1: def 19;
                  sup rng f - inf rng f >= 0 by A1,Lm4,XREAL_1:50;
                  then
A399:             (sup rng f-inf rng f)*delta(MD1) <= ( sup rng f-inf rng f)*
                  delta(D1) by A398,XREAL_1:66;
A400:             indx(D2,D1,n1) < indx(D2,D1,n1)+1 by NAT_1:13;
A401:             1 <= indx(D2,D1,n1)+1 by A206,NAT_1:13;
                  D1.n1 < D1.(n1+1) by A204,A224,A295,GOBOARD1:def 1;

then indx(D2,D1,n1) < indx(D2,D1,n1+1) by A205,A225,GOBOARD2:18;
                  then
A402:             indx(D2,D1,n1)+1 <= indx(D2,D1,n1+1) by NAT_1:13;
                  then
A403:             indx(D2,D1,n1)+1 <= len D2 by A228, XXREAL_0:2;
                  then
A404:             indx(D2,D1,n1)+1 <= len UVf(D2) by INTEGRA1:def 7;
A405:             indx(D2,D1,n1+1)=indx(D2,D1,n1)+1
                  proof
                    assume indx(D2,D1,n1+1)<> indx(D2,D1,n1)+1;
                    then
A406:               indx(D2,D1,n1+1)>indx(D2,D1,n1)+1 by A402,REAL_1:def 5;
A407:               indx(D2,D1,n1)+1 in dom D2 by A401,A403,FINSEQ_3:27;
                    then
A408:               D2.(indx(D2,D1,n1)+1) in rng D2 by FUNCT_1:def 5;
                    now per cases by A19,A408,XBOOLE_0:def 2;
                      suppose D2.(indx(D2,D1,n1)+1) in rng D1;
                        then consider n2 being Element of NAT such that
A409:                   n2

in dom D1 & D2.(indx(D2,D1,n1)+1) = D1.n2 by PARTFUN1:26;
                        D2.indx(D2,D1,n1) < D2.(indx(D2,D1,n1)+1)
                        by A205,A400,A407,GOBOARD1:def 1;
                        then n1 < n2 by A204,A205,A409,GOBOARD2:18;
                        then
A410:                   n1+1 <= n2 by NAT_1:13;

D1.n2 < D1.(n1+1) by A225,A406,A407,A409,GOBOARD1:def 1;
                        hence contradiction by A224,A409,A410,GOBOARD2:18;
                      end;
                      suppose D2.(indx(D2,D1,n1)+1) in rng D;
                        then consider n2 being Element of NAT such that
A411:                   n2
                        in dom D & D2.(indx(D2,D1,n1)+1) = D.n2 by PARTFUN1:26;
A412:                   D1.n1 < D.n2 by A205,A400,A407,A411,GOBOARD1:def 1;
A413:                   D.i <= sup divset(D1,n1) by A204,INTEGRA2:1;
                        sup divset(D1,n1)=D1.n1
                        proof
                          per cases;
                          suppose n1=1;
                            hence thesis by A204,INTEGRA1:def 5;
                          end;
                          suppose n1<>1;
                            hence thesis by A204,INTEGRA1:def 5;
                          end;
                        end;
                        then D.i < D.n2 by A412,A413,XXREAL_0:2;
                        then i < n2 by A203,A411,GOBOARD2:18;
                        then
A414:                   i+1 <= n2 by NAT_1:13;
A415:                   D.n2 < D1.(n1+1) by A225,A406,A407,A411,GOBOARD1:def 1;
A416:                   j
                        -1 in dom D1 & j-1 in NAT by A200,A207,A221,INTEGRA1:9;
                        n1+1 +1 <= j by A294,NAT_1:13;
                        then n1+1 <= j-1 by XREAL_1:21;
                        then
A417:                   D1.(n1+1) <= D1.(j-1) by A224,A416,GOBOARD2:18;
A418:                   inf divset(D1,j) <= D.(i+1) by A200,INTEGRA2:1;

inf divset(D1,j) = D1.(j-1) by A200,A207,A221,INTEGRA1:def 5;
                        then D1.(n1+1) <= D.(i+1) by A417,A418,XXREAL_0:2;
                        then D.n2 < D.(i+1) by A415,XXREAL_0:2;
                        hence contradiction by A199,A411,A414,GOBOARD2:18;
                      end;
                    end;
                    hence contradiction;
                  end;
A419:             Sum

upper_volume(g,MD2)=Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                  proof

upper_volume(g,MD2)=mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                    proof
A420:                 len
                      upper_volume(g,MD2)=indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1
                      by A319,A405,INTEGRA1:def 7;
A421:                 indx(D2,D1,j) <= len UVf(D2) by A229,INTEGRA1:def 7;
A422:                 indx
                      (D2,D1,n1)+1 <= indx(D2,D1,j) by A227,A402,XXREAL_0:2;
                      then len mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                      = indx(D2,D1,j)-'(indx(D2,D1,n1)+1)+1
                      by A229,A401,A404,A421,JORDAN3:27;
                      then
A423:                 len upper_volume(g,MD2)
                      =len mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
                      by A227,A402,A420,BINARITH:50,XXREAL_0:2;
                      for k be Nat st 1<=k & k<=len upper_volume(g,MD2) holds

upper_volume(g,MD2).k=mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
                      proof
                        let k be Nat;
                        assume
A424:                   1 <= k & k <= len upper_volume(g,MD2);
                        then
A425:                   k in Seg len upper_volume( g,MD2) by FINSEQ_1:3;
                        then
A426:                   k in Seg len MD2 by INTEGRA1:def 7;
  then k in dom MD2 by FINSEQ_1:def 3;
                        then
A427:                   upper_volume(g,MD2).k

=(sup rng(g|divset(MD2,k)))*vol(divset(MD2,k)) by INTEGRA1:def 7;
A428:                   divset

(MD2,k)=[.inf divset(MD2,k),sup divset(MD2,k).] by INTEGRA1:5;
A429:                   mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)).k
                        =UVf(D2).(k+(indx(D2,D1,n1)+1)-1)
                        by A401,A420,A421,A422,A424,A425,JORDAN3:31;

k <= indx(D2,D1,j)-((indx(D2,D1,n1)+1)-1) by A319,A405,A424, INTEGRA1:def 7;

then k+((indx(D2,D1,n1)+1)-1) <= indx(D2,D1,j) by XREAL_1:21;
                        then
A430:                   k

+(indx(D2,D1,n1)+1)-1 <= len UVf(D2) by A421,XXREAL_0:2;
                        1<=indx(D2,D1,n1)+1 by NAT_1:12;
                        then 1+1<=k+(indx(D2,D1,n1)+1) by A424,XREAL_1:9;
                        then
A431:                   1 <= k+(indx(D2,D1,n1)+1)- 1 by XREAL_1:21;
                        consider k2 being Element of NAT such that
A432:                   indx(D2,D1,n1)+1=1+k2;
                        k+k2 in Seg len UVf(D2) by A430,A431,A432,FINSEQ_1:3;
                        then
A433:                   k+k2 in Seg len D2 by INTEGRA1:def 7;
  then k+k2 in dom D2 by FINSEQ_1:def 3;
                        then
A434:                   mid(UVf(D2),indx(D2,D1,n1) +1,indx(D2,D1,j)).k
                        =(sup rng(f|divset(D2,k+k2)))*vol(divset(D2,k+k2))
                        by A429,A432,INTEGRA1:def 7;
                        inf divset(MD2,k)=inf divset(D2,k+k2)
                        & sup divset(MD2,k)=sup divset(D2,k+k2)
                        proof
                          k+k2>=1+1 by A206,A424,A432,XREAL_1:9;
                          then
A435:                     k+k2>1 by NAT_1:13;
A436:                     k in dom MD2 by A426,FINSEQ_1:def 3;
A437:                     k+k2 in dom D2 by A433,FINSEQ_1:def 3;
                          per cases;
                          suppose
A438:                       k=1;
                            then
A439:                       inf divset(MD2,k)= inf B & sup divset(MD2,k)=MD2.k
                            by A436,INTEGRA1:def 5;
                            then
A440:                       sup divset(MD2,k)= D2.(1+indx(D2,D1,n1+1)-1)

by A227,A229,A297,A401,A405,A420,A424,A438,JORDAN3:31
                              .=D1.(n1+1) by A19,A224,INTEGRA1:def 21;

inf divset(D2,k+k2)=D2.(1+k2-1) & sup divset(D2,k+k2)=D2.(1+ k2 )
                            by A435,A437,A438,INTEGRA1:def 5;
                            hence inf divset(MD2,k)=inf divset(D2,k+k2)
                            & sup divset(MD2,k)=sup divset(D2,k+k2)

by A19,A204,A224,A297,A405,A432,A439,A440,INTEGRA1:def 21;
                          end;
                          suppose
A441:                       k<>1;
                            then
A442:                       k-1 in dom MD2 & k -1 in NAT by A436,INTEGRA1:9;
                            then
A443:                       1 <= k-1 by Lm1;
A444:                       k

-1 <= indx(D2,D1,j)-(indx(D2,D1,n1)+1)+1 by A420,A424,XREAL_1:148 ,XXREAL_0:2;

inf divset(MD2,k)=MD2.(k-1) & sup divset(MD2,k)=MD2.k
                            by A436,A441,INTEGRA1:def 5;

then inf divset(MD2,k)=D2.(k-1+(indx(D2,D1,n1)+1)-1)
                            & sup divset(MD2,k)=D2.(k+(indx(D2,D1,n1)+1)-1)

by A227,A229,A297,A401,A405,A420,A424,A425,A442,A443,A444,JORDAN3: 31;
                            hence inf divset(MD2,k)=inf divset(D2,k+k2)

& sup divset(MD2,k)=sup divset(D2,k+k2) by A432,A435,A437, INTEGRA1:def 5;
                          end;
                        end;
                        then
A445:                   divset(MD2,k)=divset(D2,k+ k2) by A428,INTEGRA1:5;
                        k in dom MD2 by A426,FINSEQ_1:def 3;
                        then divset(D2,k+k2) c= B by A445,INTEGRA1:10;
                        hence thesis by A427,A434,A445,FUNCT_1:82;
                      end;
                      hence thesis by A423,FINSEQ_1:18;
                    end;
                    hence thesis;
                  end;
                  Sum upper_volume(g,MD1)=Sum mid(UVf(D1),n1+1,j)
                  proof
                    upper_volume(g,MD1)=mid(UVf(D1),n1+1,j)
                    proof
A446:                 j-'(n1+1)+1=j-(n1+1)+1 by A219,BINARITH:50;
A447:                 len upper_volume(g,MD1)=len MD1 by INTEGRA1:def 7
                        .=j-(n1+1)+1 by A219,A222,A223,A297,A446,JORDAN3:27;
A448:                 n1+1 <= len UVf(D1) by A223,INTEGRA1:def 7;
A449:                 j <= len UVf(D1) by A222,INTEGRA1:def 7;
                      then
A450:                 len upper_volume(g,MD1)=len mid(UVf(D1),n1+1,j)
                      by A219,A222,A223,A446,A447,A448,JORDAN3:27;
                      for k be Nat st 1<=k & k<=len upper_volume(g,MD1) holds
                      upper_volume(g,MD1).k=mid(UVf(D1),n1+1,j).k
                      proof
                        let k be Nat;
                        assume
A451:                   1 <= k & k <= len upper_volume(g,MD1);
                        then
A452:                   k in Seg len upper_volume( g,MD1) by FINSEQ_1:3;
                        then
A453:                   k in Seg len MD1 by INTEGRA1:def 7;
  then k in dom MD1 by FINSEQ_1:def 3;
                        then
A454:                   upper_volume(g,MD1).k

=(sup rng(g|divset(MD1,k)))*vol(divset(MD1,k)) by INTEGRA1:def 7;
                        k <= j-((n1+1)-1) by A447,A451;
                        then
A455:                   k+((n1+1)-1) <= j by XREAL_1:21;
                        consider k2 being Element of NAT such that
A456:                   n1+1=1+k2;
A457:                   k2=(n1+1)-1 by A456;
A458:                   1 <= k+k2 by A451,NAT_1:12;
                        k+k2 <= len D1 by A222,A455,A456,XXREAL_0:2;
                        then
A459:                   k+k2 in Seg len D1 by A458,FINSEQ_1:3;
  then
B459:   k+k2 in dom D1 by FINSEQ_1:def 3;
A460:                   mid(UVf(D1),n1+1,j).k

=UVf(D1).(k+(n1+1)-1) by A219,A223,A447,A449,A451,A452,JORDAN3:31
                          .=(sup rng(f|divset(D1,k+k2)))*vol(divset(D1,k+k2))
                        by A456,INTEGRA1:def 7,B459;
A461:                   divset(D1,k+k2)=divset(MD1,k)
                        proof
                          1+1 <= k+k2 by A222,A451,A456,XREAL_1:9;
                          then
A462:                     1 < k+k2 by NAT_1:13;
A463:                     divset(MD1,k)=[.inf divset(MD1,k),sup divset(MD1,k).]
                          by INTEGRA1:5;
A464:                     k in dom MD1 by A453,FINSEQ_1:def 3;
A465:                     k+k2 in dom D1 by A459,FINSEQ_1:def 3;
                          inf divset(D1,k+k2)=inf divset(MD1,k)
                          & sup divset(D1,k+k2)=sup divset(MD1,k)
                          proof
                            per cases;
                            suppose
A466:                         k=1;

then inf divset(MD1,k)=inf B & sup divset(MD1,k)=MD1.k by A464,INTEGRA1:def 5;

then inf divset(MD1,k)=D1.n1 & sup divset(MD1,k)=D1.(k+(n1+1)-1)
                              by A219,A222,A223,A297,A447,A451,A452,JORDAN3:31;

hence thesis by A457,A462,A465,A466,INTEGRA1:def 5;
                            end;
                            suppose
A467:                         k<>1;
                              then
A468:                         k-1 in dom MD1 & k-1 in NAT by A464,INTEGRA1:9;
                              then
A469:                         1 <= k-1 by Lm1;
A470:                         k

-1 <= j-(n1+1)+1 by A447,A451,XREAL_1:148,XXREAL_0:2;

inf divset(MD1,k)=MD1.(k-1) & sup divset(MD1,k)=MD1.k
                              by A464,A467,INTEGRA1:def 5;
                              then inf divset(MD1,k)=D1.(k-1+(n1+1)-1)
                              & sup divset(MD1,k)=D1.(k+(n1+1)-1)

by A219,A222,A223,A297,A447,A451,A452,A468,A469,A470,JORDAN3:31;
                              hence thesis by A456,A462,A465,INTEGRA1:def 5;
                            end;
                          end;
                          hence thesis by A463,INTEGRA1:5;
                        end;
                        k in dom MD1 by A453,FINSEQ_1:def 3;
                        then divset(D1,k+k2) c= B by A461,INTEGRA1:10;
                        hence thesis by A454,A460,A461,FUNCT_1:82;
                      end;
                      hence thesis by A450,FINSEQ_1:18;
                    end;
                    hence thesis;
                  end;
                  hence thesis by A382,A399,A419,XXREAL_0:2;
                end;
              end;
A471:         PUf(D2,indx(D2,D1,j))=

PUf(D2,indx(D2,D1,n1))+Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))
              proof
A472:           indx(D2,D1,n1)<indx(D2,D1,j) by A227,A230,XXREAL_0:2;
                indx(D2,D1,j) in Seg len D2 by A226,FINSEQ_1:def 3;
                then
                indx(D2,D1,j) in Seg len UVf(D2) by INTEGRA1:def 7;
  then
B473:  indx(D2,D1,j) in dom UVf(D2) by FINSEQ_1:def 3;
A474:           indx(D2,D1,j) <= len UVf(D2) by A229,INTEGRA1:def 7;
                indx(D2,D1,n1) in Seg len D2 by A205,FINSEQ_1:def 3;
                then indx(D2,D1,n1) in Seg len UVf(D2) by INTEGRA1:def 7;
  then indx(D2,D1,n1) in dom UVf(D2) by FINSEQ_1:def 3;
                then PUf(D2,indx(D2,D1,n1))=Sum(UVf(D2)|indx(D2,D1,n1)) by
                INTEGRA1:def 22
                  .=Sum mid(UVf(D2),1,indx(D2,D1,n1)) by A206,JORDAN3:25;

then PUf(D2,indx(D2,D1,n1))+Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2, D1,j))
                =Sum(mid(UVf(D2),1,indx(D2,D1,n1))^
                mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j))) by RVSUM_1:105

.=Sum mid(UVf(D2),1,indx(D2,D1,j)) by A206,A472,A474,INTEGRA2:4
                  .=Sum(UVf(D2)|indx(D2,D1,j)) by A229,JORDAN3:25;
                hence thesis by INTEGRA1:def 22,B473;
              end;
A475:         j <= len UVf(D1) by A222,INTEGRA1:def 7;
              then
              j in Seg len UVf(D1) by A222,FINSEQ_1:3;
  then
B476:  j in dom UVf(D1) by FINSEQ_1:def 3;
              n1 in Seg len D1 by A204,FINSEQ_1:def 3;
              then n1 in Seg len UVf(D1) by INTEGRA1:def 7;
  then n1 in dom UVf(D1) by FINSEQ_1:def 3;
              then PUf(D1,n1)=Sum(UVf(D1)|n1) by INTEGRA1:def 22
                .=Sum mid(UVf(D1),1,n1) by A222,JORDAN3:25;
              then PUf(D1,n1)+Sum mid(UVf(D1),n1+1,j)
              =Sum(mid(UVf(D1),1,n1)^mid(UVf(D1),n1+1,j)) by RVSUM_1:105
                .=Sum mid(UVf(D1),1,j) by A207,A222,A475,INTEGRA2:4
                .=Sum(UVf(D1)|j) by A222,JORDAN3:25;
              then
A477:         PUf(D1,j)=PUf(D1,n1)+Sum mid(UVf(D1),n1+1,j) by B476,
              INTEGRA1:def 22;
A478:         (PUf(D1,n1)-PUf(D2,indx(D2,D1,n1)))+

(Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)))

<=i*(sup rng f-inf rng f)*delta(D1)+(sup rng f-inf rng f)*delta(D1)
              by A204,A232,XREAL_1:9;
              (PUf(D1,n1)-PUf(D2,indx(D2,D1,n1)))+

(Sum mid(UVf(D1),n1+1,j)-Sum mid(UVf(D2),indx(D2,D1,n1)+1,indx(D2,D1,j)))
              =PUf(D1,j)-PUf(D2,indx(D2,D1,j)) by A471,A477;
              hence thesis by A200,A478;
            end;
            hence thesis;
          end;
A479:     for k being non empty Nat holds P[k] from NAT_1:sch 10(A42,A196);
          i in Seg len D by A21,FINSEQ_1:def 3;
          then reconsider i as non empty Element of NAT by FINSEQ_1:3;
          P[i] by A479;
          hence thesis by A21;
        end;
        len D in dom D by FINSEQ_5:6;
        then consider j such that
A480:   j in dom D1 & D.(len D) in divset(D1,j) &
        PUf(D1,j)-PUf(D2,indx(D2,D1,j))
        <= (len D)*(sup(rng f)-inf(rng f))*delta(D1) by A20;
A481:   len D1 in dom D1 by FINSEQ_5:6;
A482:   j = len D1
        proof
          assume
A483:     j<>len D1;
A484:     D.(len D) <= sup divset(D1,j) by A480,INTEGRA2:1;
          j in Seg len D1 by A480,FINSEQ_1:def 3;
          then j <= len D1 by FINSEQ_1:3;
          then j < len D1 by A483,REAL_1:def 5;
          then D1.j < D1.(len D1) by A480,A481,GOBOARD1:def 1;
          then
A485:     D1.j < sup A by INTEGRA1:def 2;
          sup divset(D1,j) < sup A
          proof
            per cases;
            suppose j=1;
              hence thesis by A480,A485,INTEGRA1:def 5;
            end;
            suppose j<>1;
              hence thesis by A480,A485,INTEGRA1:def 5;
            end;
          end;
          hence contradiction by A484,INTEGRA1:def 2;
        end;
A486:   len D2 in dom D2 by FINSEQ_5:6;
        indx(D2,D1,len D1)=len D2
        proof
A487:     indx(D2,D1,len D1) in dom D2 &
          D1.(len D1) = D2.indx(D2,D1,len D1) by A19,A481,INTEGRA1:def 21;
          then sup A = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
          then D2.(len D2) = D2.indx(D2,D1,len D1) by INTEGRA1:def 2;
          hence thesis by A486,A487,GOBOARD2:19;
        end;
        then upper_sum(f,D1)-PUf(D2,len D2)<=(len D)*(sup(rng f)-inf(rng f))*
        delta(D1) by A480,A482,INTEGRA1:44;
        hence thesis by INTEGRA1:44;
      end;
      hence thesis by A19;
    end;
    hence thesis;
  end;
A488: for e be real number st e>0 ex n st for m st n<=m holds
  abs((upper_sum(f,T)).m-upper_integral(f))<e
  proof
    let e be real number;
    assume
A489: e>0;
    then
A490: e/2>0 by REAL_2:127;
    reconsider e as Real by XREAL_0:def 1;
A491: upper_integral(f) = inf rng upper_sum_set(f) by INTEGRA1:def 15;
A492: rng upper_sum_set(f) is bounded_below by A1,INTEGRA2:35;
    dom upper_sum_set(f) is non empty by INTEGRA1:def 11;
    then rng upper_sum_set(f) is non empty by RELAT_1:65;
    then consider y be real number such that
A493: y in rng upper_sum_set(f) & upper_integral(f)+e/2>y
    by A490,A491,A492,SEQ_4:def 5;
    ex D being Element of divs A st D in dom upper_sum_set(f) &
    y=(upper_sum_set(f)).D & D.1 > inf A
    proof
      consider D3 being Element of divs A such that
A494: D3 in dom upper_sum_set(f) & y=(upper_sum_set(f)).D3 by A493,
      PARTFUN1:26;
      len D3 <> 0 by CARD_2:59;
      then
A495: len D3 in Seg len D3 by FINSEQ_1:5;
      then 1 <= len D3 by FINSEQ_1:3;
      then
      1 in Seg len D3 by FINSEQ_1:3;
      then
A497: 1 in dom D3 by FINSEQ_1:def 3;
  then
B496:  1 in dom D3;
      per cases;
      suppose
A498:   D3.1 <> inf A;
        D3.1 in A by A497,INTEGRA1:8;
        then inf A <= D3.1 by INTEGRA2:1;
        then D3.1 > inf A by A498,REAL_1:def 5;
        hence ex D being Element of divs A st D in dom upper_sum_set(f) &
        y=(upper_sum_set(f)).D & D.1 > inf A by A494;
      end;
      suppose
A499:   D3.1 = inf A;
        ex D being Element of divs A st D in dom upper_sum_set(f) &
        y=(upper_sum_set(f)).D & D.1 > inf A
        proof
A500:     D3.(len D3) = sup A by INTEGRA1:def 2;
A501:     len D3 in dom D3 by A495,FINSEQ_1:def 3;
          vol(A) >= 0 by INTEGRA1:11;
          then sup A - inf A > 0 by A3,INTEGRA1:def 6;
          then
A502:     sup A > inf A by REAL_2:106;
          then
A503:     len D3 > 1 by A497,A499,A500,A501,GOBOARD2:18;
          then reconsider D=D3/^1 as increasing FinSequence of REAL
          by INTEGRA1:36;
A504:     len D = len D3 - 1 &
          for m be Element of NAT st m in dom D holds D.m = D3.(m+1)
          by A503,RFINSEQ:def 2;
          then
A505:     len D <> 0 by A499,A502,INTEGRA1:def 2;
          then reconsider D as non empty increasing FinSequence of REAL
          by CARD_1:47;
          rng D c= rng D3 & rng D3 c= A by FINSEQ_5:36,INTEGRA1:def 2;
          then
A506:     rng D c= A by XBOOLE_1:1;
A507:     len D+1=len D3 by A504;
A508:     len D in Seg len D by A505,FINSEQ_1:5;
          len D in dom D by FINSEQ_5:6;
          then D.(len D)=sup A by A500,A503,A507,RFINSEQ:def 2;
          then D is DivisionPoint of A by A506,INTEGRA1:def 2;
          then reconsider D as Element of divs A by INTEGRA1:def 4;
          D in divs A;
          then
A509:     D in dom upper_sum_set(f) by INTEGRA1:def 11;
A510:     y=(upper_sum_set(f)).D
          proof
A511:       y=upper_sum(f,D3) by A494,INTEGRA1:def 11
              .=Sum(upper_volume(f,D3)) by INTEGRA1:def 9

.=Sum((upper_volume(f,D3)|1)^(upper_volume(f,D3)/^1)) by RFINSEQ:21;
A512:       1 <= len upper_volume(f,D3) by A503,INTEGRA1:def 7;
            then
A513:       len (upper_volume(f,D3)|1)=1 by FINSEQ_1:80;
A514:       1 in dom upper_volume(f,D3) by A512,FINSEQ_3:27;
            1 in Seg 1 by FINSEQ_1:3;
            then (upper_volume(f,D3)|1).1 = upper_volume(f,D3).1 by A514,
            RFINSEQ:19;
            then
A515:       upper_volume(f,D3)|1 = <*upper_volume(f,D3).1*> by A513,
            FINSEQ_1:57;
A516:       vol
            (divset(D3,1))=sup divset(D3,1)-inf divset(D3,1) by INTEGRA1:def 6
              .=sup divset(D3,1) - inf A by A497,INTEGRA1:def 5
              .=D3.1 - inf A by A497,INTEGRA1:def 5
              .=0 by A499;
A517:       upper_volume(f,D3).1=(sup rng(f|divset(D3,1)))*vol(divset(D3,1))
            by INTEGRA1:def 7,B496;
            upper_volume(f,D3)/^1 = upper_volume(f,D)
            proof
A518:         2-'1=2-1 by BINARITH:50
                .= 1;
A519:         len D3 >= 1+1 by A503,NAT_1:13;
              then len upper_volume(f,D3) >= 2 by INTEGRA1:def 7;
              then
A520:         mid(upper_volume(f,D3),2,len upper_volume(f,D3 ))
              =upper_volume(f,D3)/^1 by A518,JORDAN3:26;
A521:         2 <= len upper_volume(f,D3) & 1 <= len upper_volume(f,D3)
              by A503,A519,INTEGRA1:def 7;
              then
A522:         len(mid(upper_volume(f,D3),2,len upper_volume( f,D3)))
              =len upper_volume(f,D3)-'2+1 by JORDAN3:27
                .=len D3-'2+1 by INTEGRA1:def 7
                .=len D3-2+1 by A519,BINARITH:50
                .=len D3-1;
              then
A523:         len(mid(upper_volume(f,D3),2,len upper_volume( f,D3)))
              =len upper_volume(f,D) by A504,INTEGRA1:def 7;
              for i be Nat st
              1<=i&i<=len mid(upper_volume(f,D3),2,len upper_volume(f,D3))
              holds mid(upper_volume(f,D3),2,len upper_volume(f,D3)).i
              =upper_volume(f,D).i
              proof
                let i be Nat;
A524:           i in NAT by ORDINAL1:def 13;
                assume
A525:           1<=i&i<=len mid(upper_volume(f,D3),2,len upper_volume(f,D3));
                then i <= len upper_volume(f,D3) - 1 by A522,INTEGRA1:def 7;
                then i <= len upper_volume(f,D3)-2+1;
                then
A526:           mid(upper_volume(f,D3),2,len upper_volume( f,D3)).i
                =upper_volume(f,D3).(i+2-1) by A521,A524,A525,JORDAN3:31
                  .=upper_volume(f,D3).(i+1);
                1 <= i+1 & i+1 <= len D3 by A522,A525,NAT_1:12,XREAL_1:21;
                then
A527:           i+1 in Seg len D3 by FINSEQ_1:3;
  then i+1 in dom D3 by FINSEQ_1:def 3;
                then
A528:           mid(upper_volume(f,D3),2,len upper_volume( f,D3)).i
                =(sup rng(f|divset(D3,i+1)))*vol(divset(D3,i+1))
                by A526,INTEGRA1:def 7;
A529:           divset(D3,i+1)=divset(D,i)
                proof
A530:             1<>i+1 by A525,NAT_1:13;
                  i+1 in dom D3 by A527,FINSEQ_1:def 3;
                  then
A531:             sup divset(D3,i+1)=D3.(i+1) & inf divset(D3,i+1)=D3.(i+1 -1)
                  by A530,INTEGRA1:def 5;
A532:             i in dom D by A504,A522,A525,FINSEQ_3:27;
                  then
A533:             D.i=D3.(i+1) by A503,RFINSEQ:def 2;
                  per cases;
                  suppose
A534:               i=1;
                    then
A535:               inf divset(D,i)=inf A & sup divset (D,i)=D.i
                    by A532,INTEGRA1:def 5;

divset(D3,i+1)=[.inf A, D.i.] by A499,A531,A533,A534,INTEGRA1:5;
                    hence divset(D3,i+1)=divset(D,i) by A535,INTEGRA1:5;
                  end;
                  suppose
A536:               i<>1;
                    then
A537:               inf divset(D,i)=D.(i-1) & sup divset(D,i)=D.i
                    by A532,INTEGRA1:def 5;
                    i-1 in dom D & i-1 in NAT by A532,A536,INTEGRA1:9;
                    then i-1 in dom D & i-1 is Nat;
                    then D.(i-1)=D3.(i-1+1) by A503,RFINSEQ:def 2
                      .=D3.i;
                    then divset(D3,i+1)=[.inf divset(D,i),sup divset(D,i).]
                    by A531,A533,A537,INTEGRA1:5;
                    hence thesis by INTEGRA1:5;
                  end;
                end;
                i in Seg len D by A504,A522,A525,FINSEQ_1:3;
  then i in dom D by FINSEQ_1:def 3;
                hence thesis by A528,A529,INTEGRA1:def 7;
              end;
              hence thesis by A520,A523,FINSEQ_1:18;
            end;
            then y=0+Sum(upper_volume(f,D)) by A511,A515,A516,A517,RVSUM_1:106
              .=upper_sum(f,D) by INTEGRA1:def 9;
            hence thesis by A509,INTEGRA1:def 11;
          end;
          1 <= len D by A508,FINSEQ_1:3;
          then 1 in dom D by FINSEQ_3:27;
          then
A538:     D.1=D3.(1+1) by A503,RFINSEQ:def 2
            .=D3.2;
          1+1 <= len D3 by A503,NAT_1:13;
          then 2 in dom D3 by FINSEQ_3:27;
          then D3.1 < D3.2 by A497,GOBOARD1:def 1;
          hence thesis by A499,A509,A510,A538;
        end;
        hence thesis;
      end;
    end;
    then consider D being Element of divs A such that
A539: D in dom upper_sum_set(f) & y=(upper_sum_set(f)).D & D.1>inf A;
A540: y=upper_sum(f,D) by A539,INTEGRA1:def 11;
    set p=len D, H=sup rng f, h=inf rng f;
    deffunc F(Nat)=vol(divset(D,$1));
    consider v being FinSequence of REAL such that
A541: len v = len D & for j be Nat st j in dom v holds v.j=F(j)
    from FINSEQ_2:sch 1;
A542: dom v = Seg len D by A541,FINSEQ_1:def 3;
    consider v1 being non-decreasing FinSequence of REAL such that
A543: v,v1 are_fiberwise_equipotent by INTEGRA2:3;
    defpred P[Nat] means $1 in dom v1 & v1.$1 > 0;
A544: ex k be Nat st P[k]
    proof
      consider H being Function such that
A545: dom H = dom v & rng H = dom v1 & H is one-to-one & v=v1*H
      by A543,RFINSEQ:3;
      consider k such that
A546: k in dom D & vol(divset(D,k)) > 0 by A3,Th1;
      dom D = Seg len D by FINSEQ_1:def 3;
      then
A547: k in dom v & v.k > 0 by A541,A546,A542;
      then H.k in dom v1 & v1.(H.k) > 0 by A545,FUNCT_1:21,22;
      then reconsider Hk = H.k as Element of NAT;
      P[Hk] by A545,A547,FUNCT_1:21,22;
      hence thesis;
    end;
    consider k be Nat such that
A548: P[k] & for n be Nat st P[n] holds k<=n from NAT_1:sch 5(A544);
    p <> 0 by CARD_2:59;
    then p > 0;
    then
A549: 2*p >0 by REAL_2:122;
    H-h >= 0 by A1,Lm4,XREAL_1:50;
    then H-h+1 > 0+0;
    then
A550: 2*p*(H-h+1) > 0 by A549,REAL_2:122;
    min(v1.k,e/(2*p*(H-h+1))) > 0
    proof
      per cases by XXREAL_0:15;
      suppose min(v1.k,e/(2*p*(H-h+1))) = v1.k;
        hence thesis by A548;
      end;
      suppose min(v1.k,e/(2*p*(H-h+1))) = e/(2*p*(H-h+1));
        hence thesis by A489,A550,REAL_2:127;
      end;
    end;
    then consider n such that
A551: for m st n<=m holds 0 < (delta(T)).m
    & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A5;
A552: for m st n<=m holds abs((upper_sum(f,T)).m-upper_integral(f))<e
    proof
      let m;
      assume
A553: n<=m;
      then
A554: 0 < (delta(T)).m & (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A551;
      reconsider D1 = T.m as Element of divs A;
      consider D2 being Element of divs A such that
A555: D <= D2 & D1 <= D2 & rng D2 = rng D1 \/ rng D &
      0 <= upper_sum(f,D)-upper_sum(f,D2) &
      0 <= upper_sum(f,D1)-upper_sum(f,D2) by A13;
      f is_bounded_above_on A by A1,RFUNCT_1:def 11;
      then
A556: upper_sum(f,D2) <= upper_sum(f,D) by A555,INTEGRA1:47;
A557: delta(D1)=(delta(T)).m by INTEGRA2:def 3;
      min (v1.k,e/(2*p*(H-h+1))) <= v1.k by XXREAL_0:17;
      then
A558: delta(D1)<v1.k by A554,A557,XXREAL_0:2;
A559: v1.1 > 0
      proof
A560:   for n1 be Element of NAT st n1 in dom D holds vol(divset(D,n1))>0
        proof
          let n1 be Element of NAT;
          assume
A561:     n1 in dom D;
          then
A562:     1 <= n1 by FINSEQ_3:27;
          per cases by A562,REAL_1:def 5;
          suppose
A563:       n1=1;
            then inf divset(D,n1)=inf A & sup divset(D,n1)=D.n1
            by A561,INTEGRA1:def 5;
            then vol(divset(D,n1))=D.n1-inf A by INTEGRA1:def 6;
            hence thesis by A539,A563,XREAL_1:52;
          end;
          suppose
A564:       n1>1;
            then inf divset(D,n1)=D.(n1-1) & sup divset(D,n1)=D.n1
            by A561,INTEGRA1:def 5;
            then
A565:       vol(divset(D,n1))=D.n1-D.(n1-1) by INTEGRA1:def 6;
A566:       n1-1 in dom D by A561,A564,INTEGRA1:9;
            n1 < n1+1 by XREAL_1:31;
            then n1-1 < n1 by XREAL_1:21;
            then D.(n1-1)<D.n1 by A561,A566,GOBOARD1:def 1;
            hence thesis by A565,XREAL_1:52;
          end;
        end;
        1 <= k & k <= len v1 by A548,FINSEQ_3:27;
        then 1 <= len v1 by XXREAL_0:2;
        then 1 in dom v1 by FINSEQ_3:27;
        then
A567:   v1.1 in rng v1 by FUNCT_1:def 5;
        rng v = rng v1 by A543,RFINSEQ:1;
        then consider n1 being Element of NAT such that
A568:   n1 in dom v & v1.1 = v.n1 by A567,PARTFUN1:26;
A569:   n1 in Seg len D by A541,A568,FINSEQ_1:def 3;
A570:   v1.1 = vol(divset(D,n1)) by A541,A568;
        n1 in dom D by A569,FINSEQ_1:def 3;
        hence thesis by A560,A570;
      end;
      v1.k = min rng upper_volume(chi(A,A),D)
      proof
A571:   k=1
        proof
          assume
A572:     k <> 1;
A573:     len v1 = len v by A543,RFINSEQ:16;
A574:     k in Seg len v1 by A548,FINSEQ_1:def 3;
          k in Seg len v by A548,A573,FINSEQ_1:def 3;
          then
A575:     1 <= k & k <= len D by A541,FINSEQ_1:3;
          then
A576:     k > 1 by A572,REAL_1:def 5;
          k <= len v1 by A574,FINSEQ_1:3;
          then 1 <= len v1 by A575,XXREAL_0:2;
          then 1 in dom v1 by FINSEQ_3:27;
          hence contradiction by A548,A559,A576;
        end;
        min rng upper_volume(chi(A,A),D) in rng upper_volume(chi(A,A),D)
        & for x st x in rng upper_volume(chi(A,A),D)
        holds min rng upper_volume(chi(A,A),D) <= x by XXREAL_2:def 7;
        then consider m such that
A577:   m in dom upper_volume(chi(A,A),D)
        & min rng upper_volume(chi(A,A),D)=upper_volume(chi(A,A),D).m
        by PARTFUN1:26;
        m in Seg len upper_volume(chi(A,A),D) by A577,FINSEQ_1:def 3;
        then
A578:   m in Seg len D by INTEGRA1:def 7;
  then m in dom D by FINSEQ_1:def 3;
        then min rng upper_volume(chi(A,A),D)=vol(divset(D,m))
        by A577,INTEGRA1:22;
        then
A579:   v.m=min rng upper_volume(chi(A,A),D) by A541,A578,A542;
        m in dom v by A541,A578,FINSEQ_1:def 3;
        then
A580:   min rng upper_volume(chi(A,A),D) in rng v by A579,FUNCT_1: def 5;
A581:   rng v = rng v1 by A543,RFINSEQ:1;
        then consider m1 being Element of NAT such that
A582:   m1 in dom v1 & min rng upper_volume(chi(A,A),D)=v1.m1
        by A580,PARTFUN1:26;
        m1 >= 1 by A582,FINSEQ_3:27;
        then
A583:   v1.1 <= min rng upper_volume(chi(A,A),D) by A548,A571,A582,
        INTEGRA2:2;
        v1.k in rng upper_volume(chi(A,A),D)
        proof
          v1.k in rng v by A548,A581,FUNCT_1:def 5;
          then consider k2 being Element of NAT such that
A584:     k2 in dom v & v1.k = v.k2 by PARTFUN1:26;
A585:     k2 in Seg len D by A541,A584,FINSEQ_1:def 3;
  then
B585:  k2 in dom D by FINSEQ_1:def 3;
          v1.k = vol(divset(D,k2)) by A541,A584;
          then
A586:     v1.k = upper_volume(chi(A,A),D).k2 by INTEGRA1:22,B585;
          k2 in Seg len upper_volume(chi(A,A),D) by A585,INTEGRA1:def 7;
          then k2 in dom upper_volume(chi(A,A),D) by FINSEQ_1:def 3;
          hence thesis by A586,FUNCT_1:def 5;
        end;
        then v1.k >= min rng upper_volume(chi(A,A),D) by XXREAL_2:def 7;
        hence thesis by A571,A583,XXREAL_0:1;
      end;
      then consider D3 being Element of divs A such that
A587: D<=D3 & D1<=D3 & rng D3=rng D1 \/
      rng D & upper_sum(f,D1)-upper_sum(f,D3)
      <=(len D)*(sup rng f-inf rng f)*delta(D1) by A17,A558;
A588: upper_sum(f,D1)-upper_sum(f,D2)<=(len D)*(sup rng f-inf rng f)*delta(D1)
      by A555,A587,Th5;
      H-h <= H-h+1 by XREAL_1:31;
      then p*(H-h)<=p*(H-h+1) by XREAL_1:66;
      then p*(H-h)*(delta(T)).m <= p*(H-h+1)*(delta(T)).m by A554,XREAL_1:66;
      then
A589: upper_sum(f,T.m)-upper_sum(f,D2) <= p*(H-h+1)*(delta(T)).m
      by A557,A588,XXREAL_0:2;
A590: (delta(T)).m < min(v1.k,e/(2*p*(H-h+1))) by A551,A553;
      min(v1.k,e/(2*p*(H-h+1))) <= e/(2*p*(H-h+1)) by XXREAL_0:17;
      then (delta(T)).m < e/(2*p*(H-h+1)) by A590,XXREAL_0:2;
      then (delta(T)).m*(2*p*(H-h+1))<e by A550,REAL_2:177;
      then ((delta(T)).m*(p*(H-h+1)))*2<e;
      then
A591: p*(H-h+1)*(delta(T)).m < e/2 by REAL_2:178;
      set s=upper_integral(f), sD=upper_sum(f,D);
      set sD1=upper_sum(f,T.m), sD2=upper_sum(f,D2);
      sD+sD1-sD1-s < e/2 by A493,A540,XREAL_1:21;
      then sD1-s+sD-sD1 < e/2;
      then sD1-s+sD < sD1+e/2 by XREAL_1:21;
      then
A592: sD1-s < sD1+e/2-sD by XREAL_1:22;
      sD1-sD <= sD1-sD2 by A556,REAL_2:106;
      then sD1-sD <= p*(H-h+1)*(delta(T)).m by A589,XXREAL_0:2;
      then sD1-sD < e/2 by A591,XXREAL_0:2;
      then sD1-sD+e/2 < e/2+e/2 by XREAL_1:8;
      then sD1-s < e by A592,XXREAL_0:2;
      then
A593: (upper_sum(f,T)).m-upper_integral(f) < e by INTEGRA2:def 4;
      T.m in divs A;
      then
A594: T.m in dom upper_sum_set(f) by INTEGRA1:def 11;
      (upper_sum(f,T)).m = upper_sum(f,T.m) by INTEGRA2:def 4;
      then (upper_sum(f,T)).m = (upper_sum_set(f)).(T.m) by A594,
      INTEGRA1:def 11;
      then (upper_sum(f,T)).m in rng upper_sum_set(f) by A594,FUNCT_1:def 5;
      then inf rng upper_sum_set(f)<=(upper_sum(f,T)).m by A492,SEQ_4:def 5;
      then upper_integral(f)<=(upper_sum(f,T)).m by INTEGRA1:def 15;
      then (upper_sum(f,T)).m-upper_integral(f) >= 0 by XREAL_1:50;
      hence thesis by A593,ABSVALUE:def 1;
    end;
    take n;
    thus thesis by A552;
  end;
  hence upper_sum(f,T) is convergent by SEQ_2:def 6;
  hence thesis by A488,SEQ_2:def 7;
end;

