:: On the Representation of Natural Numbers in Positional Numeral Systems
::  by Adam Naumowicz
::
:: Received December 31, 2006
:: Copyright (c) 2006 Association of Mizar Users

environ

 vocabularies BOOLE, NUMERAL1, ARYTM, ORDINAL2, AFINSQ_1, FUNCT_1, FINSEQ_1,
      ARYTM_1, RELAT_1, RLVECT_1, ALGSEQ_1, GROUP_1, NAT_1, MONOID_0, FINSOP_1,
      SEQ_1, SERIES_1, PREPOWER, POWER, ARYTM_3;
 notations TARSKI, XBOOLE_0, SUBSET_1, FUNCT_1, ORDINAL1, RELSET_1, BINOP_1,
      NUMBERS, XCMPLX_0, XXREAL_0, NAT_D, BINOP_2, SEQ_1, NEWTON, PREPOWER,
      POWER, SERIES_1, AFINSQ_1, STIRL2_1, FUNCT_2;
 constructors BINOP_1, SETWISEO, XXREAL_0, REAL_1, NAT_1, NAT_D, BINOP_2,
      SEQ_1, NEWTON, PREPOWER, SERIES_1, STIRL2_1;
 registrations XBOOLE_0, RELAT_1, FUNCT_1, ORDINAL1, NUMBERS, XXREAL_0,
      XREAL_0, NAT_1, INT_1, BINOP_2, MEMBERED, NEWTON, RFINSEQ, AFINSQ_1;
 requirements BOOLE, SUBSET, NUMERALS, ARITHM, REAL;
 definitions TARSKI, STIRL2_1;
 theorems ORDINAL1, FUNCT_1, STIRL2_1, AFINSQ_1, CARD_5, TARSKI, RELAT_1,
      XBOOLE_1, FUNCT_2, NAT_2, XREAL_1, NAT_1, INT_1, NEWTON, BINOP_2,
      XBOOLE_0, SERIES_1, SEQ_1, PREPOWER, POWER, XCMPLX_1, PRGCOR_2, PEPIN,
      PRE_FF, NAT_D, XXREAL_0;
 schemes AFINSQ_1, RECDEF_1, STIRL2_1, NAT_1;

begin :: Preliminaries

  Lm1: for d being XFinSequence holds
  (ex n being natural number st n in dom d) iff len d > 0
  proof
    let d be XFinSequence;
    thus (ex n being natural number st n in dom d) implies len d > 0
    proof
      given n being natural number such that A1: n in dom d;
      n in len d by AFINSQ_1:def 1,A1;
      hence len d > 0;
    end;
    assume len d > 0; then
    dom d <> {} by AFINSQ_1:def 1; then
    consider n being set such that A2: n in dom d by XBOOLE_0:def 1;
    reconsider n as Element of NAT by A2;
    take n;
    thus thesis by A2;
  end;

theorem Th1:
  for d,e being XFinSequence of NAT holds Sum(d^e)=Sum(d)+Sum(e)
  proof
    let d,e be XFinSequence of NAT;
    thus Sum(d^e)=addnat.(Sum(d),Sum(e)) by STIRL2_1:47
    .= Sum(d)+Sum(e) by BINOP_2:def 23;
  end;

theorem Th2:
  for S being Real_Sequence, d being XFinSequence of NAT,
  n being natural number
  st d=S|(n+1) holds Sum(d)=Partial_Sums(S).n
  proof
    let S be Real_Sequence, d be XFinSequence of NAT, n be natural number;
    assume A1: d=S|(n+1); then
    A2: dom d = dom S /\ (n+1) & for x being set st x in dom d holds
    d.x = S.x by FUNCT_1:68;
    n+1 in NAT by ORDINAL1:def 13; then
    n+1 c= NAT & REAL<>{} by ORDINAL1:def 2; then
    n+1 c= dom S by FUNCT_2:def 1; then
    A3: dom d = n+1 by A2,XBOOLE_1:28; then
    A4: len d = n+1 by AFINSQ_1:def 1; then
    consider f be Function of NAT,NAT such that
    A5: f.0 = d.0 &
    (for m being Element of NAT st m+1 < len d holds
    f.(m + 1) = addnat.(f.m,d.(m + 1))) & addnat "**" d = f.(len d-1)
    by STIRL2_1:def 3;

    defpred P[Element of NAT] means
    $1 in dom d implies f.$1=Partial_Sums(S).$1;

    Partial_Sums(S).0=S.0 by SERIES_1:def 1; then
    A6:P[0] by A5,A1,FUNCT_1:68;
    A7:
    now
      let k be Element of NAT;
      assume A8: P[k];

      thus P[k+1]
      proof
        assume A9: k+1 in dom d; then
        k+1 in len d by AFINSQ_1:def 1; then
        A10: k<k+1 & k+1 < len d by NAT_1:13,PRGCOR_2:1; then
        k<len d by XXREAL_0:2; then
        A11: k in len d by PRGCOR_2:1;
        thus f.(k+1)= addnat.(f.k,d.(k + 1)) by A5,A10
        .= (f.k)+d.(k + 1) by BINOP_2:def 23
        .= (f.k)+S.(k+1) by A9,A1,FUNCT_1:68
        .= Partial_Sums(S).(k+1) by A11,A8,AFINSQ_1:def 1,SERIES_1:def 1;
      end;
    end;
    A12: for m being Element of NAT holds P[m] from NAT_1:sch 1(A6,A7);
    reconsider N=n as Element of NAT by ORDINAL1:def 13;
    A13: N in dom d by A3,AFINSQ_1:1;
    thus Sum(d) = Partial_Sums(S).n by A12,A13,A4,A5;
  end;

theorem Th3:
  for k,l,m being natural number holds
  (k(#)(l GeoSeq))|m is XFinSequence of NAT
  proof
    let k,l,m be natural number;
    set g=(k(#)(l GeoSeq))|m;
    A1: dom (k(#)(l GeoSeq)) = NAT by FUNCT_2:def 1; then
    m in dom (k(#)(l GeoSeq)) by ORDINAL1:def 13; then
    m c= dom (k(#)(l GeoSeq)) by A1,ORDINAL1:def 2; then
    dom g = m by RELAT_1:91; then
    reconsider g'=g as XFinSequence by ORDINAL1:def 7;
    rng g' c= NAT
    proof
      let a be set;
      assume a in rng g'; then
      consider o being set such that
      A2: o in dom g & a=g.o by FUNCT_1:def 5;
      reconsider o as Element of NAT by A2;
      g.o = (k(#)(l GeoSeq)).o by A2,FUNCT_1:68
      .= k*((l GeoSeq).o) by SEQ_1:13
      .= k*(l|^o) by PREPOWER:def 1;
      hence a in NAT by A2,ORDINAL1:def 13;
    end;
    hence g is XFinSequence of NAT by ORDINAL1:def 8;
  end;

theorem Th4:
  for d,e being XFinSequence of NAT st
  len d >= 1 & len d = len e &
  for i being natural number st i in dom d holds d.i<=e.i
  holds Sum d <= Sum e
  proof
    let d,e be XFinSequence of NAT such that
    A1: len d >=1 & len d = len e &
    for i being natural number st i in dom d holds d.i<=e.i;
    consider f being Function of NAT,NAT such that
    A2: f.0 = d.0 &
    (for n being Element of NAT st n+1 < len d holds
    f.(n + 1) = addnat.(f.n,d.(n + 1))) & Sum d = f.(len d-1)
    by STIRL2_1:def 3,A1;
    consider g being Function of NAT,NAT such that
    A3: g.0 = e.0 &
    (for n being Element of NAT st n+1 < len e holds
    g.(n + 1) = addnat.(g.n,e.(n + 1))) & Sum e = g.(len e-1)
    by STIRL2_1:def 3,A1;

    defpred P[Element of NAT] means $1 in dom d implies f.$1 <= g.$1;

    A4: P[0] by A1,A2,A3;
    A5:
    now
      let i be Element of NAT;
      assume A6: P[i];
      thus P[i+1]
      proof
        assume A7: i+1 in dom d; then
        i+1 in len d by AFINSQ_1:def 1; then
        A8: i+1 < len d by PRGCOR_2:1;
        i < len d by A8, NAT_1:13; then
        A9:i in len d by PRGCOR_2:1;
        A10: f.(i+1) = addnat.(f.i,d.(i + 1)) by A8,A2
        .= f.i + d.(i+1) by BINOP_2:def 23;
        A11: g.(i+1) = addnat.(g.i,e.(i + 1)) by A8,A3,A1
        .= g.i + e.(i+1) by BINOP_2:def 23;
        d.(i+1) <= e.(i+1) by A1,A7;
        hence f.(i+1) <= g.(i+1) by A9,A6,AFINSQ_1:def 1,A10,A11,XREAL_1:9;
      end;
    end;
    A12: for i being Element of NAT holds P[i] from NAT_1:sch 1(A4,A5);

    reconsider ld=len d-1 as Element of NAT by A1,NAT_1:21;
    len d-1 < len d - 0 by XREAL_1:12; then
    ld in len d by PRGCOR_2:1; then
    ld in dom d by AFINSQ_1:def 1;
    hence Sum d <= Sum e by A12,A2,A3,A1;
  end;

theorem Th5:
  for d being XFinSequence of NAT, n being natural number st
  for i being natural number st i in dom d holds n divides d.i
  holds n divides Sum d
  proof
    let d be XFinSequence of NAT, n be natural number such that
    A1: for i being natural number st i in dom d holds n divides d.i;
    per cases;
    suppose len d=0; then
      Sum d = 0 by STIRL2_1:53;
      hence n divides Sum d by NAT_D:6;
    end;
    suppose A2: len d > 0; then
      consider f being Function of NAT,NAT such that
      A3: f.0 = d.0 &
      (for n being Element of NAT st n+1 < len d holds
      f.(n + 1) = addnat.(f.n,d.(n + 1))) & Sum d = f.(len d-1)
      by STIRL2_1:def 3;

      defpred P[Element of NAT] means $1 < len d implies n divides f.$1;

      0 in len d by A2,PRGCOR_2:1; then
      0 in dom d by AFINSQ_1:def 1; then
      A4: P[0] by A3,A1;
      A5: now
        let k be Element of NAT;
        assume A6: P[k];
        thus P[k+1]
        proof
          assume A7: k+1 < len d; then
          k+1 in len d by PRGCOR_2:1; then
          k+1 in dom d by AFINSQ_1:def 1; then
          A8: n divides d.(k+1) by A1;
          f.(k+1) = addnat.(f.k,d.(k+1)) by A7,A3 .= f.k + d.(k+1)
          by BINOP_2:def 23;
          hence n divides f.(k+1) by NAT_1:13,A6,A7,A8,NAT_D:8;
        end;
      end;
      A9: for k being Element of NAT holds P[k] from NAT_1:sch 1(A4,A5);
      reconsider ld=len d-1 as Element of NAT by A2,NAT_1:20;
      ld < len d by XREAL_1:149;
      hence n divides Sum d by A3,A9;
    end;
  end;

theorem Th6:
  for d,e being XFinSequence of NAT, n being natural number st
  dom d = dom e &
  for i being natural number st i in dom d holds e.i = d.i mod n
  holds Sum d mod n = Sum e mod n
  proof
    let d,e be XFinSequence of NAT, n be natural number such that
    A1: dom d = dom e &
    for i being natural number st i in dom d holds e.i = d.i mod n;

    defpred P[XFinSequence of NAT] means
    for e being XFinSequence of NAT st dom $1=dom e &
    for i being natural number st i in dom $1 holds e.i = $1.i mod n
    holds (Sum $1) mod n = (Sum e) mod n;

    A2: P[<%>NAT]
    proof
      let e be XFinSequence of NAT;
      assume dom <%>NAT=dom e &
      for i being natural number st i in dom <%>NAT holds e.i = <%>NAT.i mod n;
      then len <%>NAT = dom e by AFINSQ_1:def 1; then
      dom e = 0 by AFINSQ_1:18; then
      len e = 0 by AFINSQ_1:def 1;
      hence (Sum <%>NAT) mod n = (Sum e) mod n by AFINSQ_1:18;
    end;
    A3: for p being XFinSequence of NAT,l being Element of NAT
    st P[p] holds P[p^<%l%>]
    proof
      let p be XFinSequence of NAT,l be Element of NAT;
      assume A4: P[p];
      thus P[p^<%l%>]
      proof
        let e be XFinSequence of NAT;
        assume A5: dom (p^<%l%>)=dom e &
        for i being natural number st i in dom (p^<%l%>) holds
        e.i = (p^<%l%>).i mod n;

        defpred Q[set,set] means $2=p.$1 mod n;
        reconsider dop=dom p as Element of NAT by ORDINAL1:def 13;

        A6: for k being Element of NAT st k in dop
        ex x being Element of NAT st Q[k,x];

        consider p' being XFinSequence of NAT such that
        A7: dom p' = dop &
        for k being Element of NAT st k in dop holds Q[k,p'.k]
        from STIRL2_1:sch 6(A6);
        A8: for i being natural number st i in dom p holds
        p'.i = p.i mod n by A7;

        A9: dom e=len p + len <%l%> by A5,AFINSQ_1:def 4
        .= dom p + len <%l%> by AFINSQ_1:def 1
        .= dom p + 1 by AFINSQ_1:37
        .= dom p + len <%l mod n%> by AFINSQ_1:37
        .= len p' + len <%l mod n%> by A7,AFINSQ_1:def 1;
        A10:
        now
          let k be Element of NAT;
          assume A11: k in dom p'; then
          k < dom p' by PRGCOR_2:1; then
          k < len p & len p < len p + 1 by NAT_1:13,A7,AFINSQ_1:def 1; then
          k < len p + 1 by XXREAL_0:2; then
          k < len p + len <%l%> by AFINSQ_1:37; then
          k in len p + len <%l%> by PRGCOR_2:1; then
          k in dom (p^<%l%>) by AFINSQ_1:def 4;
          hence e.k = (p^<%l%>).k mod n by A5
          .= p.k mod n by A11,A7,AFINSQ_1:def 4
          .= p'.k by A7,A11;
        end;
        now
          let k be Element of NAT;
          assume k in dom <%l mod n%>; then
          A12: k in 1 by AFINSQ_1:36; then
          k < 1 by PRGCOR_2:1; then
          A13: k = 0 by NAT_1:14;
          k in dom <%l%> by A12,AFINSQ_1:36; then
          A14: len p + k in dom (p^<%l%>) by AFINSQ_1:26;
          thus e.(len p' + k) = e.(dom p) by A13,A7,AFINSQ_1:def 1
          .= e.(len p) by AFINSQ_1:def 1
          .= (p^<%l%>).len p mod n by A5,A14,A13
          .= l mod n by AFINSQ_1:40
          .= <%l mod n%>.k by A13,AFINSQ_1:38;
        end; then
        A15: e=p'^<%l mod n%> by A9,A10,AFINSQ_1:def 4;
        thus Sum (p^<%l%>) mod n = (Sum p + Sum <%l%>) mod n by Th1
        .= (Sum p + l) mod n by STIRL2_1:44
        .= ((Sum p) mod n + l) mod n by NAT_D:22
        .= ((Sum p) mod n + (l mod n)) mod n by NAT_D:22
        .= ((Sum p') mod n + (l mod n)) mod n by A4,A7,A8
        .= (Sum p' + (l mod n)) mod n by NAT_D:22
        .= (Sum p' + Sum <%l mod n%>) mod n by STIRL2_1:44
        .= (Sum e) mod n by A15,Th1;
      end;
    end;
    for p being XFinSequence of NAT holds P[p] from STIRL2_1:sch 5(A2,A3);
    hence (Sum d) mod n = (Sum e) mod n by A1;
  end;

begin :: Representation of numbers in the base-$b$ numeral system

definition
  let d be XFinSequence of NAT;
  let b be natural number;
  func value(d,b) -> natural number means :Def1:
  ex d' being XFinSequence of NAT st (dom d' = dom d &
  for i being natural number st i in dom d' holds d'.i = (d.i)*(b|^i)) &
  it = Sum d';
  existence
  proof

    deffunc F(natural number)=(d.$1)*(b|^$1);

    consider d' being XFinSequence such that
    A1: len d' = len d &
    for i being Element of NAT st i in len d holds d'.i = F(i)
    from AFINSQ_1:sch 2;
    rng d' c= NAT
    proof
      let a be set;
      assume a in rng d'; then
      consider i being set such that
      A2: i in dom d' & d'.i=a by FUNCT_1:def 5;
      reconsider i as Element of NAT by A2;
      i in len d' by A2,AFINSQ_1:def 1; then
      a=F(i) by A1,A2;
      hence a in NAT by ORDINAL1:def 13;
    end; then
    reconsider d' as XFinSequence of NAT by ORDINAL1:def 8;
    A3: dom d' = len d' by AFINSQ_1:def 1 .= dom d by AFINSQ_1:def 1,A1;
    A4: for i being natural number st i in dom d' holds d'.i = (d.i)*(b|^i)
    proof
      let i be natural number;
      reconsider j=i as Element of NAT by ORDINAL1:def 13;
      assume i in dom d'; then
      j in len d by A1,AFINSQ_1:def 1;
      hence d'.i = (d.i)*(b|^i) by A1;
    end;
    take Sum d';
    thus thesis by A4,A3;
  end;
  uniqueness
  proof
    let k,l be natural number;
    given k' being XFinSequence of NAT such that A5: (dom k' = dom d &
    for i being natural number st i in dom k' holds k'.i = (d.i)*(b|^i)) &
    k = Sum k';
    given l' being XFinSequence of NAT such that A6: (dom l' = dom d &
    for i being natural number st i in dom l' holds l'.i = (d.i)*(b|^i)) &
    l = Sum l';
    now
      let i be Element of NAT;
      assume A7: i in dom d;
      thus k'.i=(d.i)*(b|^i) by A5,A7 .= l'.i by A6,A7;
    end;
    hence k=l by A5,A6,AFINSQ_1:10;
  end;
end;

definition
  let n,b be natural number;
  assume A1: b>1;
  func digits(n,b) -> XFinSequence of NAT means :Def2:
  value(it,b)=n & it.(len(it)-1) <> 0 &
  for i being natural number st i in dom it holds
  0 <= it.i & it.i < b if n <> 0
  otherwise it = <%0%>;
  consistency;
  existence
  proof
    reconsider N=n,B=b as Element of NAT by ORDINAL1:def 13;
    thus n<>0 implies ex d being XFinSequence of NAT st
    value(d,b)=n & d.(len(d)-1) <> 0 &
    for i being natural number st i in dom d holds 0 <= d.i & d.i < b
    proof
      assume A2: n<>0;

      deffunc G(Element of NAT,Element of NAT)=$2 div B;

      consider f being Function of NAT,NAT such that
      A3: f.0=N &
      for i being Element of NAT holds f.(i+1)=G(i,(f.i) qua Element of NAT)
      from RECDEF_1:sch 4;

      defpred R[natural number] means f.$1 = 0;

      defpred Q[natural number] means ex i being Element of NAT st f.i = $1;

      A4: ex k being Element of NAT st Q[k] by A3;
      A5: for k being Element of NAT st k <> 0 & Q[k]
      ex l being Element of NAT st l < k & Q[l]
      proof
        let k be Element of NAT;
        assume A6: k <> 0 & Q[k]; then
        consider i being Element of NAT such that
        A7: f.i=k;
        take l=k div b;
        k>0 & b > 1 by A6,A1;
        hence l<k by INT_1:83;
        take i+1;
        thus thesis by A7,A3;
      end;
      Q[0] from NAT_1:sch 7(A4,A5); then
      A8: ex l being Element of NAT st R[l];
      consider l being Element of NAT such that
      A9: R[l] & for i being Element of NAT st R[i] holds l<=i
      from NAT_1:sch 5(A8);
      consider m being natural number such that
      A10: m+1=l by NAT_1:6,A9,A3,A2;
      reconsider m as Element of NAT by ORDINAL1:def 13;
      m < l by NAT_1:13,A10; then
      A11: f.m<>0 by A9;
      A12: R[l] by A9;
      A13:
      now
        let i be Element of NAT such that l <= i;
        assume R[i]; then
        f.(i+1)=0 div b by A3;
        hence R[i+1] by NAT_2:4;
      end;
      A14: for i being Element of NAT st l <= i holds R[i]
      from NAT_1:sch 8(A12,A13);
      A15:
      now
        let i be Element of NAT;
        assume m < i; then
        l<=i by A10,NAT_1:25;
        hence f.i=0 by A14;
      end;
      dom f=NAT by FUNCT_2:def 1; then
      m+1 c= dom f by ORDINAL1:def 2; then
      dom (f|(m+1)) = m+1 by RELAT_1:91; then
      A16: f|(m+1) is XFinSequence by ORDINAL1:def 7;
      rng (f|(m+1)) c= NAT; then
      reconsider g=f|(m+1) as XFinSequence of NAT by A16,ORDINAL1:def 8;

      defpred P[Element of NAT,Element of NAT] means $2=g.$1 mod b;

      A17: for i being Element of NAT st i in m+1
      ex x being Element of NAT st P[i,x];
      consider d being XFinSequence of NAT such that
      A18: dom d = m+1 & for i being Element of NAT st i in m+1 holds
      P[i,(d.i)qua Element of NAT]
      from STIRL2_1:sch 6(A17);
      take d;

      deffunc F(Element of NAT)=(d.$1)*(b|^$1);

      consider d' being XFinSequence such that
      A19: len d' = len d & for i being Element of NAT st i in len d holds
      d'.i = F(i) from AFINSQ_1:sch 2;
      rng d' c= NAT
      proof
        let a be set;
        assume a in rng d'; then
        consider i being set such that
        A20: i in dom d' & d'.i=a by FUNCT_1:def 5;
        reconsider i as Element of NAT by A20;
        i in len d' by A20,AFINSQ_1:def 1; then
        a=F(i) by A19,A20;
        hence a in NAT by ORDINAL1:def 13;
      end; then
      reconsider d' as XFinSequence of NAT by ORDINAL1:def 8;
      A21: dom d' = len d' by AFINSQ_1:def 1 .= dom d by A19,AFINSQ_1:def 1;
      A22: for i being natural number st i in dom d' holds d'.i = (d.i)*(b|^i)
      proof
        let i be natural number;
        reconsider j=i as Element of NAT by ORDINAL1:def 13;
        assume i in dom d'; then
        j in len d by A19,AFINSQ_1:def 1;
        hence d'.i = (d.i)*(b|^i) by A19;
      end;
      A23: m<m+1 by NAT_1:13;
      A24: m in m+1 by AFINSQ_1:1; then
      g.m = f.m by FUNCT_1:72; then
      f.(m+1)=g.m div b by A3; then
      g.m div b = 0 by A15,A23; then
      A25: g.m < b by A1,NAT_2:14;
      A26: len(d) = m+1 by A18,AFINSQ_1:def 1; then
      consider s being Function of NAT,NAT such that
      A27: s.0 = d'.0 &
      (for i being Element of NAT st i+1 < len d' holds
      s.(i + 1) = addnat.(s.i,d'.(i + 1))) & addnat "**" d' = s.(len d'-1)
      by STIRL2_1:def 3,A19;

      defpred I[Element of NAT] means
      $1<len d' implies s.$1=n-f.($1+1)*b|^($1+1);

      A28: 0 in m+1 by PRGCOR_2:1; then
      d'.0=(d.0)*(b|^0) by A18,A21,A22
      .= (g.0 mod b)*(b|^0) by A18,A28
      .= (f.0 mod b)*(b|^0) by A28,FUNCT_1:72
      .= (n mod b)*1 by A3,NEWTON:9
      .= N-B*(N div B) by NEWTON:77,A1
      .= n-(n div b)*b|^1 by NEWTON:10
      .= n-f.(0+1)*b|^(0+1) by A3; then
      A29: I[0] by A27;
      A30:
      now
        let i be Element of NAT;
        assume A31: I[i];
        now
          assume A32: i+1<len d'; then
          i+1 in len d' by PRGCOR_2:1; then
          A33: i+1 in dom d' by AFINSQ_1:def 1;
          thus s.(i+1)=addnat.(s.i,d'.(i + 1)) by A27,A32
          .= n-f.(i+1)*b|^(i+1) +  d'.(i+1) by A31,A32,NAT_1:13,BINOP_2:def 23
          .= n-f.(i+1)*b|^(i+1) + (d.(i+1)*(b|^(i+1))) by A22,A33
          .= n-f.(i+1)*b|^(i+1) + ((g.(i+1) mod b)*(b|^(i+1))) by A18,A21,A33
          .= n-f.(i+1)*b|^(i+1) + ((f.(i+1) mod b)*(b|^(i+1)))
          by A18,A21,A33,FUNCT_1:72
          .= n-f.(i+1)*b|^(i+1) + ((f.(i+1) - b*(f.(i+1) div B))*(b|^(i+1)))
          by NEWTON:77,A1
          .= n-f.(i+1)*b|^(i+1) + ((f.(i+1) - b*(f.(i+1+1)))*(b|^(i+1))) by A3
          .= n-f.(i+1)*b|^(i+1) + ((f.(i+1)*(b|^(i+1)) -
          (f.(i+1+1))*(b*(b|^(i+1)))))
          .= n-f.(i+1)*b|^(i+1) + ((f.(i+1)*(b|^(i+1)) -
          (f.(i+1+1))*((b|^(i+1+1))))) by NEWTON:11
          .= n-f.(i+1+1)*b|^(i+1+1);
        end;
        hence I[i+1];
      end;
      A34: for i being Element of NAT holds I[i] from NAT_1:sch 1(A29,A30);
      reconsider ld=len d'-1 as Element of NAT by A19,A26;
      ld<len d' by XREAL_1:46; then
      s.(ld)= n-f.(m+1)*b|^(m+1) by A26,A19,A34
      .=n by A9,A10; then
      n=Sum d' by A27;
      hence value(d,b)=n by A21,A22,Def1;
      d.(len(d)-1) = g.m mod b by A24,A26,A18 .= g.m by NAT_D:24,A25;
      hence d.(len(d)-1) <> 0 by A24,A11,FUNCT_1:72;
      let i be natural number;
      assume i in dom d; then
      d.i=g.i mod b by A18;
      hence 0 <= d.i & d.i < b by NAT_D:1,A1;
    end;
    assume n=0;
    reconsider d=<%0%> as XFinSequence of NAT; take d; thus thesis;
  end;
  uniqueness
  proof
    reconsider b1=b-1 as Element of NAT by A1,NAT_1:20;
    let d,e be XFinSequence of NAT;
    thus n<>0 &
    (value(d,b)=n & d.(len(d)-1) <> 0 &
    for i being natural number st i in dom d holds 0 <= d.i & d.i < b) &
    (value(e,b)=n & e.(len(e)-1) <> 0 &
    for i being natural number st i in dom e holds 0 <= e.i & e.i < b)
    implies d=e
    proof
      assume n<>0; then A35: n>0;
      assume A36: (value(d,b)=n & d.(len(d)-1) <> 0 &
      for i being natural number st i in dom d holds 0 <= d.i & d.i < b);
      assume A37: (value(e,b)=n & e.(len(e)-1) <> 0 &
      for i being natural number st i in dom e holds 0 <= e.i & e.i < b);
      consider D being XFinSequence of NAT such that
      A38: (dom D = dom d &
      for i being natural number st i in dom D holds D.i = (d.i)*(b|^i)) &
      n = Sum D by A36,Def1;

      A39: len(d)-1 in dom d by A36,FUNCT_1:def 4; then
      reconsider k=len(d)-1 as Element of NAT;
      d.k>=1 by A36,NAT_1:14; then
      A40: 1*(b|^k)<=(d.k)*(b|^k) by NAT_1:4;
      k in dom D by A36,FUNCT_1:def 4,A38; then
      A41: len D > 0 by Lm1;

      A42: b|^k>0 & b|^(k+1)>0 by PREPOWER:13,A1;
      log(2,b)>log(2,1) by A1,POWER:65; then
      A43: log(2,b)>0 by POWER:59;
      D.k = (d.k)*(b|^k) by A38,A39; then
      (d.k)*(b|^k) <= n by STIRL2_1:52,A39,A41,A38; then
      b|^k <= n by A40,XXREAL_0:2; then
      log(2,b|^k) <= log(2,n) by PRE_FF:12,A42; then
      log(2,b to_power k) <= log(2,n) by A1,POWER:46; then
      k*log(2,b) <= log(2,n) by POWER:63,A1; then
      k*log(2,b)/log(2,b) <= log(2,n)/log(2,b) by XREAL_1:74,A43; then
      A44: k <= log(2,n)/log(2,b) by XCMPLX_1:90,A43;

      consider E being XFinSequence of NAT such that
      A45: (dom E = dom e &
      for i being natural number st i in dom E holds E.i = (e.i)*(b|^i)) &
      n = Sum E by A37,Def1;

      reconsider g=((b1)(#)(b GeoSeq))|len d as XFinSequence of NAT by Th3;
      dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
      len d c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
      A46: dom g = len d by RELAT_1:91;
      A47: 1-b <> 0 by A1;
      g=((b-1)(#)(b GeoSeq))|(k+1); then
      A48: Sum g = Partial_Sums((b-1)(#)(b GeoSeq)).k by Th2
      .= ((b-1)(#)Partial_Sums(b GeoSeq)).k by SERIES_1:12
      .= (b-1)*(Partial_Sums(b GeoSeq).k) by SEQ_1:13
      .= (b-1)*((1 - (b to_power (k+1)))/(1-b)) by SERIES_1:26,A1
      .= (b-1)*((1 - (b |^ (k+1)))/(1-b)) by POWER:46,A1
      .= -((1-b)*((1 - (b |^ (k+1)))/(1-b)))
      .= -(1 - (b |^ (k+1))) by XCMPLX_1:88,A47
      .= b|^(k+1)-1;
      A49: len D >= 0+1 by A41,NAT_1:13;
      A50: len D = dom D by AFINSQ_1:def 1
      .= len d by A38,AFINSQ_1:def 1
      .= len g by A46,AFINSQ_1:def 1;
      for i being natural number st i in dom D holds D.i <= g.i
      proof
        let i be natural number;
        reconsider I=i as Element of NAT by ORDINAL1:def 13;
        assume A51: i in dom D; then
        i in len d by A38,AFINSQ_1:def 1; then
        A52: g.I = ((b-1)(#)(b GeoSeq)).I by A46,FUNCT_1:68
        .= (b-1)*((b GeoSeq).I) by SEQ_1:13
        .= b1*(b|^I) by PREPOWER:def 1;
        d.i < b1+1 by A36,A51,A38; then
        A53: d.i <= b1 by NAT_1:13;
        D.i = (d.i)*(b|^i) by A38,A51;
        hence D.i <= g.i by A52,A53,XREAL_1:66;
      end; then
      n <= (b|^(k+1))-1 by A48,A38,Th4,A49,A50; then
      n < b|^(k+1)-1+1 by XREAL_1:41; then
      log(2,n) < log(2,b|^(k+1)) by A35,POWER:65; then
      log(2,n) < log(2,b to_power (k+1)) by A1,POWER:46; then
      log(2,n) < (k+1)*log(2,b) by POWER:63,A1; then
      log(2,n)/log(2,b) < (k+1)*log(2,b)/log(2,b) by XREAL_1:76,A43; then
      A54: log(2,n)/log(2,b) < k+1 by XCMPLX_1:90,A43;

      A55: len(e)-1 in dom e by A37,FUNCT_1:def 4; then
      reconsider l=len(e)-1 as Element of NAT;
      e.l>=1 by A37,NAT_1:14; then
      A56: 1*(b|^l)<=(e.l)*(b|^l) by NAT_1:4;
      l in dom E by A37,FUNCT_1:def 4,A45; then
      A57: len E > 0 by Lm1;

      A58: b|^l>0 & b|^(l+1)>0 by PREPOWER:13,A1;
      log(2,b)>log(2,1) by A1,POWER:65; then
      A59: log(2,b)>0 by POWER:59;
      E.l = (e.l)*(b|^l) by A45,A55; then
      (e.l)*(b|^l) <= n by STIRL2_1:52,A55,A57,A45; then
      b|^l <= n by A56,XXREAL_0:2; then
      log(2,b|^l) <= log(2,n) by PRE_FF:12,A58; then
      log(2,b to_power l) <= log(2,n) by A1,POWER:46; then
      l*log(2,b) <= log(2,n) by POWER:63,A1; then
      l*log(2,b)/log(2,b) <= log(2,n)/log(2,b) by XREAL_1:74,A59; then
      A60: l <= log(2,n)/log(2,b) by XCMPLX_1:90,A59;

      reconsider g=((b1)(#)(b GeoSeq))|len e as XFinSequence of NAT by Th3;
      dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
      len e c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
      A61: dom g = len e by RELAT_1:91;
      A62: 1-b <> 0 by A1;
      g=((b-1)(#)(b GeoSeq))|(l+1); then
      A63: Sum g = Partial_Sums((b-1)(#)(b GeoSeq)).l by Th2
      .= ((b-1)(#)Partial_Sums(b GeoSeq)).l by SERIES_1:12
      .= (b-1)*(Partial_Sums(b GeoSeq).l) by SEQ_1:13
      .= (b-1)*((1 - (b to_power (l+1)))/(1-b)) by SERIES_1:26,A1
      .= (b-1)*((1 - (b |^ (l+1)))/(1-b)) by POWER:46,A1
      .= -((1-b)*((1 - (b |^ (l+1)))/(1-b)))
      .= -(1 - (b |^ (l+1))) by XCMPLX_1:88,A62
      .= b|^(l+1)-1;
      A64: len E >= 0+1 by A57,NAT_1:13;
      A65: len E = dom E by AFINSQ_1:def 1
      .= len e by A45,AFINSQ_1:def 1
      .= len g by A61,AFINSQ_1:def 1;
      for i being natural number st i in dom E holds E.i <= g.i
      proof
        let i be natural number;
        reconsider I=i as Element of NAT by ORDINAL1:def 13;
        assume A66: i in dom E; then
        i in len e by A45,AFINSQ_1:def 1; then
        A67: g.I = ((b-1)(#)(b GeoSeq)).I by A61,FUNCT_1:68
        .= (b-1)*((b GeoSeq).I) by SEQ_1:13
        .= b1*(b|^I) by PREPOWER:def 1;
        e.i < b1+1 by A37,A66,A45; then
        A68: e.i <= b1 by NAT_1:13;
        E.i = (e.i)*(b|^i) by A45,A66;
        hence E.i <= g.i by A67,A68,XREAL_1:66;
      end; then
      n <= (b|^(l+1))-1 by A63,A45,Th4,A64,A65; then
      n < b|^(l+1)-1+1 by XREAL_1:41; then
      log(2,n) < log(2,b|^(l+1)) by A35,POWER:65; then
      log(2,n) < log(2,b to_power (l+1)) by A1,POWER:46; then
      log(2,n) < (l+1)*log(2,b) by POWER:63,A1; then
      log(2,n)/log(2,b) < (l+1)*log(2,b)/log(2,b) by XREAL_1:76,A59; then
      A69: log(2,n)/log(2,b) < l+1 by XCMPLX_1:90,A59;

      k<l+1 by A44,A69,XXREAL_0:2; then
      A70: k<=l by NAT_1:13;
      l<k+1 by A60,A54,XXREAL_0:2; then
      l<=k by NAT_1:13; then
      A71: k=l by A70,XXREAL_0:1;
      A72: dom d = len d by AFINSQ_1:def 1 .= dom e by A71,AFINSQ_1:def 1;
      now
        let a be set;
        assume A73: a in dom d; then
        reconsider o=a as Element of NAT;
        a in len e by A73,AFINSQ_1:def 1,A71; then
        A74: a in dom e by AFINSQ_1:def 1;
        A75: o in len d by AFINSQ_1:def 1,A73; then
        A76: o < len d by PRGCOR_2:1; then
        reconsider oo=len d - o as Element of NAT by NAT_1:21;
        o<k+1 by A75,PRGCOR_2:1; then
        A77: o<=k by NAT_1:13;
        per cases by A77,XXREAL_0:1;
        suppose A78: o = 0 & o = k;
          dom d = 1 by A78,AFINSQ_1:def 1; then
          len D = 1 by A38,AFINSQ_1:def 1; then
          A79: D = <%D.0%> by AFINSQ_1:38
          .= <%d.0*b|^0%> by A38,A73,A78
          .= <%d.0*1%> by NEWTON:9;
          dom e = 1 by A71,A78,AFINSQ_1:def 1; then
          len E = 1 by A45,AFINSQ_1:def 1; then
          A80: E = <%E.0%> by AFINSQ_1:38
          .= <%e.0*b|^0%> by A45,A74,A78
          .= <%e.0*1%> by NEWTON:9;
          thus d.a = n by A79,A78,A38,STIRL2_1:44
          .= e.a by A80,A78,A45,STIRL2_1:44;
        end;
        suppose A81: o = 0 & o < k;

          set d'=D;

          A82: dom d'= oo by A81,A38,AFINSQ_1:def 1;
          set do=<%>NAT;

          A83: len d'=oo by A82,AFINSQ_1:def 1;
          A84: len do=o by A81,AFINSQ_1:18;
          A85: dom D = len do + len d' by A83,A84,A38,AFINSQ_1:def 1;
          A86: for x being Element of NAT st x in dom do holds D.x=do.x
          proof
            let x be Element of NAT;
            assume x in dom do; then
            x in len do;
            hence D.x=do.x by AFINSQ_1:18;
          end;
          A87: for x being Element of NAT st x in dom d' holds D.(len do+x)=d'.
x
          by A84,A81;
          D=do^d' by A85,A86,A87,AFINSQ_1:def 4; then
          A88: n = Sum do + Sum d' by Th1,A38;
          reconsider bo=b|^o as Element of NAT by ORDINAL1:def 13;
          A89: bo <> 0 by PREPOWER:12,A1;

          Sum do = 0 by A84,STIRL2_1:53,A81; then
          A90: Sum do div (b|^o) = 0 by NAT_2:4;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume k in dom d'; then
            k in len d' by AFINSQ_1:def 1; then
            k < len d' by PRGCOR_2:1; then
            o+k < dom D by AFINSQ_1:def 1,A81; then
            o+k in dom D by PRGCOR_2:1; then
            d'.K = d.(o+k)*b|^(o+k) by A81,A38
            .= d.(o+k)*(b|^o*b|^k) by NEWTON:13
            .= (d.(o+k)*(b|^k))*(b|^o);
            hence b|^o divides d'.k by NAT_D:def 3;
          end; then
          A91: b|^o divides Sum d' by Th5; then
          Sum d' mod (b|^o) = 0 by PEPIN:6,A89; then
          n div (b|^o) = (Sum d' div (b|^o)) + (Sum do div (b|^o))
          by A88,NAT_D:19; then
          A92: (n div (b|^o)) * b|^o = Sum d' by A91,NAT_D:3,A90;

          reconsider o1=o+1 as Element of NAT;
          o1 <= k & k < len d by XREAL_1:149,A81,NAT_1:13; then
          A93: o1 < len d by XXREAL_0:2; then
          reconsider oo1=len d - o1 as Element of NAT by NAT_1:21;

          defpred P[Element of NAT,set] means $2=D.($1+o1);

          A94: for u being Element of NAT st u in oo1
          ex x be Element of NAT st P[u,x];

          consider d'1 being XFinSequence of NAT such that
          A95: dom d'1=oo1 & for x being Element of NAT st x in oo1 holds
          P[x,d'1.x] from STIRL2_1:sch 6(A94);
          reconsider do1=D|o1 as XFinSequence of NAT by AFINSQ_1:16;

          A96: len d'1=oo1 by A95,AFINSQ_1:def 1;
          A97: len d=dom D by AFINSQ_1:def 1,A38 .= len D by AFINSQ_1:def 1;
          then
          A98: len do1=o1 by A93,AFINSQ_1:14;
          A99: dom D = len do1 + len d'1 by A96,A98,A38,AFINSQ_1:def 1;
          A100: for x being Element of NAT st x in dom do1 holds
          D.x=do1.x by FUNCT_1:70;
          A101: for x being Element of NAT st x in dom d'1 holds
          D.(len do1+x)=d'1.x
          by A98,A95;
          D=do1^d'1 by A99,A100,A101,AFINSQ_1:def 4; then
          A102: n = Sum do1 + Sum d'1 by Th1,A38;
          reconsider bo1=b|^o1 as Element of NAT by ORDINAL1:def 13;
          A103: bo1 <> 0 by PREPOWER:12,A1;

          consider ok1 being natural number such that
          A104: ok1+1=o1;
          reconsider ok1 as Element of NAT by ORDINAL1:def 13;
          reconsider g1=((b1)(#)(b GeoSeq))|(ok1+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o1 c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A105: dom g1 = o1 by RELAT_1:91,A104;
          A106: 1-b <> 0 by A1;
          A107: Sum g1 = Partial_Sums((b-1)(#)(b GeoSeq)).ok1 by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok1 by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok1) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok1+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok1+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o1))/(1-b))) by A104
          .= -(1 - (b |^ o1)) by XCMPLX_1:88,A106
          .= b|^o1-1;
          A108: len do1>=0+1 by A98,NAT_1:13;
          A109: len do1 = len g1 by A98,A105,AFINSQ_1:def 1;
          for i being natural number st i in dom do1 holds do1.i <= g1.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A110: i in dom do1; then
            i in o1 by A97,A93,AFINSQ_1:14; then
            A111: g1.I = ((b-1)(#)(b GeoSeq)).I by A105,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A112: dom do1 c= dom D by RELAT_1:89; then
            d.i < b1+1 by A36,A38,A110; then
            A113: d.i <= b1 by NAT_1:13;
            do1.i = D.i by FUNCT_1:70,A110
            .= (d.i)*(b|^i) by A38,A110,A112;
            hence do1.i <= g1.i by A111,A113,XREAL_1:66;
          end; then
          Sum do1 <= (b|^o1)-1 by A107,Th4,A108,A109; then
          Sum do1 < b|^o1 -1 + 1 by XREAL_1:147; then
          A114: Sum do1 div (b|^o1) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A115: k in dom d'1; then
            k in len d'1 by AFINSQ_1:def 1; then
            k < len d'1 by PRGCOR_2:1; then
            o1+k < dom D by A99,A98,XREAL_1:10; then
            o1+k in dom D by PRGCOR_2:1; then
            D.(o1+k) = d.(o1+k)*b|^(o1+k) by A38; then
            d'1.K = d.(o1+k)*b|^(o1+k) by A95,A115
            .= d.(o1+k)*(b|^o1*b|^k) by NEWTON:13
            .= (d.(o1+k)*(b|^k))*(b|^o1);
            hence b|^o1 divides d'1.k by NAT_D:def 3;
          end; then
          A116: b|^o1 divides Sum d'1 by Th5; then
          Sum d'1 mod (b|^o1) = 0 by PEPIN:6,A103; then
          n div (b|^o1) = (Sum d'1 div (b|^o1)) + (Sum do1 div (b|^o1))
          by A102,NAT_D:19; then
          A117: (n div (b|^o1)) * b|^o1 = Sum d'1 by A116,NAT_D:3,A114;
          A118: dom d'= 1 + dom d'1 by A81,A38,AFINSQ_1:def 1,A95
          .= 1 + len d'1 by AFINSQ_1:def 1
          .= len <%D.o%> + len d'1 by AFINSQ_1:38;
          A119:
          now
            let k be Element of NAT;
            assume k in dom <%D.o%>; then
            k in 1 by AFINSQ_1:36; then
            k < 1 by PRGCOR_2:1; then
            k=0 by NAT_1:14;
            hence d'.k = <%D.o%>.k by A81,AFINSQ_1:def 5;
          end;
          now
            let k be Element of NAT;
            assume A120: k in dom d'1;
            thus d'.(len <%D.o%> + k) = D.(len do1 + k)
            by A98,A81,AFINSQ_1:37
            .= d'1.k by A120,A98,A95;
          end; then
          d'=<%D.o%>^d'1 by A118,A119,AFINSQ_1:def 4; then
          Sum d' = Sum <%D.o%> + Sum d'1 by Th1; then
          D.o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A92,A117,STIRL2_1:44;
          then
          d.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A38,A73; then
          d.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * (b|^o*b|^1)
          by NEWTON:13; then
          d.o*b|^o = b|^o*((n div (b|^o)) - (n div (b|^o1)) * b|^1); then
          (b|^o*d.o)/b|^o = (b|^o*((n div (b|^o)) - (n div (b|^o1)) * b))/b|^o
          by NEWTON:10;
          then
          A121: d.o = (b|^o*((n div (b|^o)) - (n div (b|^o1)) * b))/b|^o
          by XCMPLX_1:90,A89;

          set d'=E;

          A122: dom d'= oo by A71,A81,A45,AFINSQ_1:def 1;
          set do=<%>NAT;

          A123: len d'=oo by A122,AFINSQ_1:def 1;
          A124: len do=o by A81,AFINSQ_1:18;
          A125: dom E = len do + len d' by A71,A123,A124,A45,AFINSQ_1:def 1;
          A126: for x being Element of NAT st x in dom do holds E.x=do.x
          proof
            let x be Element of NAT;
            assume x in dom do; then
            x in len do;
            hence E.x=do.x by AFINSQ_1:18;
          end;
          A127: for x being Element of NAT st x in dom d' holds E.(len do+x)=d'
.x
          by A124,A81;
          E=do^d' by A125,A126,A127,AFINSQ_1:def 4; then
          A128: n = Sum do + Sum d' by Th1,A45;
          reconsider bo=b|^o as Element of NAT by ORDINAL1:def 13;
          A129: bo <> 0 by PREPOWER:12,A1;

          Sum do = 0 by STIRL2_1:53,A124,A81; then
          A130: Sum do div (b|^o) = 0 by NAT_2:4;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume k in dom d'; then
            k in len d' by AFINSQ_1:def 1; then
            k < len d' by PRGCOR_2:1; then
            o+k < dom E by AFINSQ_1:def 1,A81; then
            o+k in dom E by PRGCOR_2:1; then
            d'.K = e.(o+k)*b|^(o+k) by A81,A45
            .= e.(o+k)*(b|^o*b|^k) by NEWTON:13
            .= (e.(o+k)*(b|^k))*(b|^o);
            hence b|^o divides d'.k by NAT_D:def 3;
          end; then
          A131: b|^o divides Sum d' by Th5; then
          Sum d' mod (b|^o) = 0 by PEPIN:6,A129; then
          n div (b|^o) = (Sum d' div (b|^o)) + (Sum do div (b|^o))
          by A128,NAT_D:19; then
          A132: (n div (b|^o)) * b|^o = Sum d' by A131,NAT_D:3,A130;

          reconsider o1=o+1 as Element of NAT;
          o1 <= k & k < len d by XREAL_1:149,A81,NAT_1:13; then
          A133: o1 < len d by XXREAL_0:2; then
          reconsider oo1=len d - o1 as Element of NAT by NAT_1:21;

          defpred P[Element of NAT,set] means $2=E.($1+o1);

          A134: for u being Element of NAT st u in oo1
          ex x be Element of NAT st P[u,x];

          consider d'1 being XFinSequence of NAT such that
          A135: dom d'1=oo1 & for x being Element of NAT st x in oo1 holds
          P[x,d'1.x] from STIRL2_1:sch 6(A134);
          reconsider do1=E|o1 as XFinSequence of NAT by AFINSQ_1:16;

          A136: len d'1=oo1 by A135,AFINSQ_1:def 1;
          A137: len e=dom E by AFINSQ_1:def 1,A45 .= len E by AFINSQ_1:def 1;
          then
          A138: len do1=o1 by A71,A133,AFINSQ_1:14;
          A139: dom E = len do1 + len d'1 by A71,A136,A138,A45,AFINSQ_1:def 1;
          A140: for x being Element of NAT st x in dom do1 holds E.x=do1.x
          by FUNCT_1:70;
          A141: for x being Element of NAT st x in dom d'1 holds
          E.(len do1+x)=d'1.x
          by A138,A135;
          E=do1^d'1 by A139,A140,A141,AFINSQ_1:def 4; then
          A142: n = Sum do1 + Sum d'1 by Th1,A45;
          reconsider bo1=b|^o1 as Element of NAT by ORDINAL1:def 13;
          A143: bo1 <> 0 by PREPOWER:12,A1;

          consider ok1 being natural number such that
          A144: ok1+1=o1;
          reconsider ok1 as Element of NAT by ORDINAL1:def 13;
          reconsider g1=((b1)(#)(b GeoSeq))|(ok1+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o1 c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A145: dom g1 = o1 by RELAT_1:91,A144;
          A146: 1-b <> 0 by A1;
          A147: Sum g1 = Partial_Sums((b-1)(#)(b GeoSeq)).ok1 by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok1 by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok1) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok1+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok1+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o1))/(1-b))) by A144
          .= -(1 - (b |^ o1)) by XCMPLX_1:88,A146
          .= b|^o1-1;
          A148: len do1>=0+1 by A138,NAT_1:13;
          A149: len do1 = len g1 by A138,A145,AFINSQ_1:def 1;
          for i being natural number st i in dom do1 holds do1.i <= g1.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A150: i in dom do1; then
            i in o1 by A137,A71,A133,AFINSQ_1:14; then
            A151: g1.I = ((b-1)(#)(b GeoSeq)).I by A145,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A152: dom do1 c= dom E by RELAT_1:89; then
            e.i < b1+1 by A37,A150,A45; then
            A153: e.i <= b1 by NAT_1:13;
            do1.i = E.i by FUNCT_1:70,A150
            .= (e.i)*(b|^i) by A150,A45,A152;
            hence do1.i <= g1.i by A151,A153,XREAL_1:66;
          end; then
          Sum do1 <= (b|^o1)-1 by A147,Th4,A148,A149; then
          Sum do1 < b|^o1 -1 + 1 by XREAL_1:147; then
          A154: Sum do1 div (b|^o1) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A155: k in dom d'1; then
            k in len d'1 by AFINSQ_1:def 1; then
            k < len d'1 by PRGCOR_2:1; then
            o1+k < dom E by A139,A138,XREAL_1:10; then
            o1+k in dom E by PRGCOR_2:1; then
            E.(o1+k) = e.(o1+k)*b|^(o1+k) by A45; then
            d'1.K = e.(o1+k)*b|^(o1+k) by A155,A135
            .= e.(o1+k)*(b|^o1*b|^k) by NEWTON:13
            .= (e.(o1+k)*(b|^k))*(b|^o1);
            hence b|^o1 divides d'1.k by NAT_D:def 3;
          end; then
          A156: b|^o1 divides Sum d'1 by Th5; then
          Sum d'1 mod (b|^o1) = 0 by PEPIN:6,A143; then
          n div (b|^o1) = (Sum d'1 div (b|^o1)) + (Sum do1 div (b|^o1))
          by A142,NAT_D:19; then
          A157: (n div (b|^o1)) * b|^o1 = Sum d'1 by A156,NAT_D:3,A154;

          o in len e by A71,AFINSQ_1:def 1,A73; then
          A158: o in dom E by A45,AFINSQ_1:def 1;

          A159: dom d'= 1 + dom d'1 by A71,A81,A45,AFINSQ_1:def 1,A135
          .= 1 + len d'1 by AFINSQ_1:def 1
          .= len <%E.o%> + len d'1 by AFINSQ_1:38;
          A160:
          now
            let k be Element of NAT;
            assume k in dom <%E.o%>; then
            k in 1 by AFINSQ_1:36; then
            k < 1 by PRGCOR_2:1; then
            k=0 by NAT_1:14;
            hence d'.k = <%E.o%>.k by A81,AFINSQ_1:def 5;
          end;
          now
            let k be Element of NAT;
            assume A161: k in dom d'1;
            thus d'.(len <%E.o%> + k) = E.(len do1 + k)
            by A138,A81,AFINSQ_1:37
            .= d'1.k by A161,A138,A135;
          end; then
          d'=<%E.o%>^d'1 by A159,A160,AFINSQ_1:def 4; then
          Sum d' = Sum <%E.o%> + Sum d'1 by Th1; then
          E.o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A132,A157,STIRL2_1:44;
          then
          e.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1 by A45,
A158;
          then
          e.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * (b|^o*b|^1)
          by NEWTON:13; then
          e.o*b|^o = b|^o*((n div (b|^o)) - (n div (b|^o1)) * b|^1); then
          (b|^o*e.o)/b|^o = (b|^o*((n div (b|^o)) - (n div (b|^o1)) * b))/b|^o
          by NEWTON:10;
          hence d.a=e.a by A121,XCMPLX_1:90,A129;
        end;
        suppose A162: o>0 & o = k;

          set d'=<%D.o%>;

          reconsider do=D|o as XFinSequence of NAT by AFINSQ_1:16;

          A163: len d'=oo by AFINSQ_1:38,A162;
          A164: len d=dom D by AFINSQ_1:def 1,A38 .= len D by AFINSQ_1:def 1;
          then
          A165: len do=o by A76,AFINSQ_1:14;
          A166: dom D = len do + len d' by A163,A165,A38,AFINSQ_1:def 1;
          A167: for x being Element of NAT st x in dom do holds D.x=do.x
          by FUNCT_1:70;
          A168: for x being Element of NAT st x in dom d' holds D.(len do+x)=d'
.x
          proof
            let x be Element of NAT;
            assume x in dom d'; then
            x in 1 by A163,AFINSQ_1:def 1,A162; then
            x < 1 by PRGCOR_2:1; then
            x = 0 by NAT_1:14;
            hence D.(len do+x)=d'.x by A165,AFINSQ_1:38;
          end;
          D=do^d' by A166,A167,A168,AFINSQ_1:def 4; then
          A169: n = Sum do + Sum d' by Th1,A38;
          reconsider bo=b|^o as Element of NAT by ORDINAL1:def 13;
          A170: bo <> 0 by PREPOWER:12,A1;

          consider ok being natural number such that
          A171: ok+1=o by NAT_1:6,A162;
          reconsider ok as Element of NAT by ORDINAL1:def 13;
          reconsider g=((b1)(#)(b GeoSeq))|(ok+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A172: dom g = o by RELAT_1:91,A171;
          A173: 1-b <> 0 by A1;
          A174: Sum g = Partial_Sums((b-1)(#)(b GeoSeq)).ok by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o))/(1-b))) by A171
          .= -(1 - (b |^ o)) by XCMPLX_1:88,A173
          .= b|^o-1;
          A175: len do>=0+1 by A165,A162,NAT_1:13;
          A176: len do = len g by A165,A172,AFINSQ_1:def 1;
          for i being natural number st i in dom do holds do.i <= g.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A177: i in dom do; then
            i in o by A164,A76,AFINSQ_1:14; then
            A178: g.I = ((b-1)(#)(b GeoSeq)).I by A172,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A179: dom do c= dom D by RELAT_1:89; then
            d.i < b1+1 by A36,A38,A177; then
            A180: d.i <= b1 by NAT_1:13;
            do.i = D.i by FUNCT_1:70,A177
            .= (d.i)*(b|^i) by A38,A179,A177;
            hence do.i <= g.i by A178,A180,XREAL_1:66;
          end; then
          Sum do <= (b|^o)-1 by A174,Th4,A175,A176; then
          Sum do < b|^o -1 + 1 by XREAL_1:147; then
          A181: Sum do div (b|^o) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A182: k in dom d'; then
            k in len d' by AFINSQ_1:def 1; then
            k < len d' by PRGCOR_2:1; then
            o+k < dom D by A166,A165,XREAL_1:10; then
            o+k in dom D by PRGCOR_2:1; then
            D.(o+k) = d.(o+k)*b|^(o+k) by A38; then
            d'.K = d.(o+k)*b|^(o+k) by A182,A168,A165
            .= d.(o+k)*(b|^o*b|^k) by NEWTON:13
            .= (d.(o+k)*(b|^k))*(b|^o);
            hence b|^o divides d'.k by NAT_D:def 3;
          end; then
          A183: b|^o divides Sum d' by Th5; then
          Sum d' mod (b|^o) = 0 by PEPIN:6,A170; then
          n div (b|^o) = (Sum d' div (b|^o)) + (Sum do div (b|^o))
          by A169,NAT_D:19; then
          (n div (b|^o)) * b|^o = Sum d' by A183,NAT_D:3,A181; then
          D.o = (n div (b|^o)) * b|^o by STIRL2_1:44; then
          d.o*b|^o/b|^o = (n div (b|^o)) * b|^o/b|^o by A38,A73; then
          A184: d.o = (n div (b|^o)) * b|^o/b|^o by XCMPLX_1:90,A170;

          set d'=<%E.o%>;

          reconsider do=E|o as XFinSequence of NAT by AFINSQ_1:16;

          A185: len d'=oo by A162,AFINSQ_1:38;
          A186: len e=dom E by AFINSQ_1:def 1,A45 .= len E by AFINSQ_1:def 1;
          then
          A187: len do=o by A71,A76,AFINSQ_1:14;
          A188: dom E = len do + len d' by A71,A185,A187,A45,AFINSQ_1:def 1;
          A189: for x being Element of NAT st x in dom do holds E.x=do.x
          by FUNCT_1:70;
          A190: for x being Element of NAT st x in dom d' holds E.(len do+x)=d'
.x
          proof
            let x be Element of NAT;
            assume x in dom d'; then
            x in 1 by A185,AFINSQ_1:def 1,A162; then
            x < 1 by PRGCOR_2:1; then
            x = 0 by NAT_1:14;
            hence E.(len do+x)=d'.x by A187,AFINSQ_1:38;
          end;
          E=do^d' by A188,A189,A190,AFINSQ_1:def 4; then
          A191: n = Sum do + Sum d' by Th1,A45;
          reconsider bo=b|^o as Element of NAT by ORDINAL1:def 13;
          A192: bo <> 0 by PREPOWER:12,A1;

          consider ok being natural number such that
          A193: ok+1=o by NAT_1:6,A162;
          reconsider ok as Element of NAT by ORDINAL1:def 13;
          reconsider g=((b1)(#)(b GeoSeq))|(ok+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A194: dom g = o by RELAT_1:91,A193;
          A195: 1-b <> 0 by A1;
          A196: Sum g = Partial_Sums((b-1)(#)(b GeoSeq)).ok by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o))/(1-b))) by A193
          .= -(1 - (b |^ o)) by XCMPLX_1:88,A195
          .= b|^o-1;
          A197: len do>=0+1 by A187,A162,NAT_1:13;
          A198: len do = len g by A187,A194,AFINSQ_1:def 1;
          for i being natural number st i in dom do holds do.i <= g.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A199: i in dom do; then
            i in o by A186,A71,A76,AFINSQ_1:14; then
            A200: g.I = ((b-1)(#)(b GeoSeq)).I by A194,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A201: dom do c= dom E by RELAT_1:89; then
            e.i < b1+1 by A37,A45,A199; then
            A202: e.i <= b1 by NAT_1:13;
            do.i = E.i by FUNCT_1:70,A199
            .= (e.i)*(b|^i) by A45,A201,A199;
            hence do.i <= g.i by A200,A202,XREAL_1:66;
          end; then
          Sum do <= (b|^o)-1 by A196,Th4,A197,A198; then
          Sum do < b|^o -1 + 1 by XREAL_1:147; then
          A203: Sum do div (b|^o) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A204: k in dom d'; then
            k in len d' by AFINSQ_1:def 1; then
            k < len d' by PRGCOR_2:1; then
            o+k < dom E by A188,A187,XREAL_1:10; then
            o+k in dom E by PRGCOR_2:1; then
            E.(o+k) = e.(o+k)*b|^(o+k) by A45; then
            d'.K = e.(o+k)*b|^(o+k) by A204,A190,A187
            .= e.(o+k)*(b|^o*b|^k) by NEWTON:13
            .= (e.(o+k)*(b|^k))*(b|^o);
            hence b|^o divides d'.k by NAT_D:def 3;
          end; then
          A205: b|^o divides Sum d' by Th5; then
          Sum d' mod (b|^o) = 0 by PEPIN:6,A192; then
          n div (b|^o) = (Sum d' div (b|^o)) + (Sum do div (b|^o))
          by A191,NAT_D:19; then
          (n div (b|^o)) * b|^o = Sum d' by A205,NAT_D:3,A203; then
          E.o = (n div (b|^o)) * b|^o by STIRL2_1:44; then
          e.o*b|^o/b|^o = (n div (b|^o)) * b|^o/b|^o by A45,A74;
          hence d.a=e.a by A184,XCMPLX_1:90,A192;
        end;
        suppose A206: o>0 & o < k;
          defpred P[Element of NAT,set] means $2=D.($1+o);

          A207: for u being Element of NAT st u in oo
          ex x be Element of NAT st P[u,x];

          consider d' being XFinSequence of NAT such that
          A208: dom d'=oo & for x being Element of NAT st x in oo holds
          P[x,d'.x] from STIRL2_1:sch 6(A207);
          reconsider do=D|o as XFinSequence of NAT by AFINSQ_1:16;

          A209: len d'=oo by A208,AFINSQ_1:def 1;
          A210: len d=dom D by AFINSQ_1:def 1,A38 .= len D by AFINSQ_1:def 1;
          then
          A211: len do=o by A76,AFINSQ_1:14;
          A212: dom D = len do + len d' by A209,A211,A38,AFINSQ_1:def 1;
          A213: for x being Element of NAT st x in dom do holds D.x=do.x
          by FUNCT_1:70;
          A214: for x being Element of NAT st x in dom d' holds D.(len do+x)=d'
.x
          by A211,A208;
          D=do^d' by A212,A213,A214,AFINSQ_1:def 4; then
          A215: n = Sum do + Sum d' by Th1,A38;
          reconsider bo=b|^o as Element of NAT by ORDINAL1:def 13;
          A216: bo <> 0 by PREPOWER:12,A1;

          consider ok being natural number such that
          A217: ok+1=o by NAT_1:6,A206;
          reconsider ok as Element of NAT by ORDINAL1:def 13;
          reconsider g=((b1)(#)(b GeoSeq))|(ok+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A218: dom g = o by RELAT_1:91,A217;
          A219: 1-b <> 0 by A1;
          A220: Sum g = Partial_Sums((b-1)(#)(b GeoSeq)).ok by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o))/(1-b))) by A217
          .= -(1 - (b |^ o)) by XCMPLX_1:88,A219
          .= b|^o-1;
          A221: len do>=0+1 by A211,A206,NAT_1:13;
          A222: len do = len g by A211,A218,AFINSQ_1:def 1;
          for i being natural number st i in dom do holds do.i <= g.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A223: i in dom do; then
            i in o by A210,A76,AFINSQ_1:14; then
            A224: g.I = ((b-1)(#)(b GeoSeq)).I by A218,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A225: dom do c= dom D by RELAT_1:89; then
            d.i < b1+1 by A36,A223,A38; then
            A226: d.i <= b1 by NAT_1:13;
            do.i = D.i by FUNCT_1:70,A223
            .= (d.i)*(b|^i) by A225,A38,A223;
            hence do.i <= g.i by A224,A226,XREAL_1:66;
          end; then
          Sum do <= (b|^o)-1 by A220,Th4,A221,A222; then
          Sum do < b|^o -1 + 1 by XREAL_1:147; then
          A227: Sum do div (b|^o) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A228: k in dom d'; then
            k in len d' by AFINSQ_1:def 1; then
            k < len d' by PRGCOR_2:1; then
            o+k < dom D by A212,A211,XREAL_1:10; then
            o+k in dom D by PRGCOR_2:1; then
            D.(o+k) = d.(o+k)*b|^(o+k) by A38; then
            d'.K = d.(o+k)*b|^(o+k) by A228,A208
            .= d.(o+k)*(b|^o*b|^k) by NEWTON:13
            .= (d.(o+k)*(b|^k))*(b|^o);
            hence b|^o divides d'.k by NAT_D:def 3;
          end; then
          A229: b|^o divides Sum d' by Th5; then
          Sum d' mod (b|^o) = 0 by PEPIN:6,A216; then
          n div (b|^o) = (Sum d' div (b|^o)) + (Sum do div (b|^o))
          by A215,NAT_D:19; then
          A230: (n div (b|^o)) * b|^o = Sum d' by A229,NAT_D:3,A227;

          reconsider o1=o+1 as Element of NAT;
          o1 <= k & k < len d by XREAL_1:149,A206,NAT_1:13; then
          A231: o1 < len d by XXREAL_0:2; then
          reconsider oo1=len d - o1 as Element of NAT by NAT_1:21;

          defpred P[Element of NAT,set] means $2=D.($1+o1);

          A232: for u being Element of NAT st u in oo1
          ex x be Element of NAT st P[u,x];

          consider d'1 being XFinSequence of NAT such that
          A233: dom d'1=oo1 & for x being Element of NAT st x in oo1 holds
          P[x,d'1.x] from STIRL2_1:sch 6(A232);
          reconsider do1=D|o1 as XFinSequence of NAT by AFINSQ_1:16;

          A234: len d'1=oo1 by A233,AFINSQ_1:def 1;
          A235: len d=dom D by AFINSQ_1:def 1,A38 .= len D by AFINSQ_1:def 1;
          then
          A236: len do1=o1 by A231,AFINSQ_1:14;
          A237: dom D = len do1 + len d'1 by A234,A236,A38,AFINSQ_1:def 1;
          A238: for x being Element of NAT st x in dom do1 holds D.x=do1.x
          by FUNCT_1:70;
          A239: for x being Element of NAT st x in dom d'1 holds
          D.(len do1+x)=d'1.x by A236,A233;
          D=do1^d'1 by A237,A238,A239,AFINSQ_1:def 4; then
          A240: n = Sum do1 + Sum d'1 by Th1,A38;
          reconsider bo1=b|^o1 as Element of NAT by ORDINAL1:def 13;
          A241: bo1 <> 0 by PREPOWER:12,A1;

          consider ok1 being natural number such that
          A242: ok1+1=o1;
          reconsider ok1 as Element of NAT by ORDINAL1:def 13;
          reconsider g1=((b1)(#)(b GeoSeq))|(ok1+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o1 c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A243: dom g1 = o1 by RELAT_1:91,A242;
          A244: 1-b <> 0 by A1;
          A245: Sum g1 = Partial_Sums((b-1)(#)(b GeoSeq)).ok1 by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok1 by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok1) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok1+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok1+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o1))/(1-b))) by A242
          .= -(1 - (b |^ o1)) by XCMPLX_1:88,A244
          .= b|^o1-1;
          A246: len do1>=0+1 by A236,NAT_1:13;
          A247: len do1 = len g1 by A236,A243,AFINSQ_1:def 1;
          for i being natural number st i in dom do1 holds do1.i <= g1.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A248: i in dom do1; then
            i in o1 by A235,A231,AFINSQ_1:14; then
            A249: g1.I = ((b-1)(#)(b GeoSeq)).I by A243,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A250: dom do1 c= dom D by RELAT_1:89; then
            d.i < b1+1 by A36,A38,A248; then
            A251: d.i <= b1 by NAT_1:13;
            do1.i = D.i by FUNCT_1:70,A248
            .= (d.i)*(b|^i) by A38,A250,A248;
            hence do1.i <= g1.i by A249,A251,XREAL_1:66;
          end; then
          Sum do1 <= (b|^o1)-1 by A245,Th4,A246,A247; then
          Sum do1 < b|^o1 -1 + 1 by XREAL_1:147; then
          A252: Sum do1 div (b|^o1) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A253: k in dom d'1; then
            k in len d'1 by AFINSQ_1:def 1; then
            k < len d'1 by PRGCOR_2:1; then
            o1+k < dom D by A237,A236,XREAL_1:10; then
            o1+k in dom D by PRGCOR_2:1; then
            D.(o1+k) = d.(o1+k)*b|^(o1+k) by A38; then
            d'1.K = d.(o1+k)*b|^(o1+k) by A253,A233
            .= d.(o1+k)*(b|^o1*b|^k) by NEWTON:13
            .= (d.(o1+k)*(b|^k))*(b|^o1);
            hence b|^o1 divides d'1.k by NAT_D:def 3;
          end; then
          A254: b|^o1 divides Sum d'1 by Th5; then
          Sum d'1 mod (b|^o1) = 0 by PEPIN:6,A241; then
          n div (b|^o1) = (Sum d'1 div (b|^o1)) + (Sum do1 div (b|^o1))
          by A240,NAT_D:19; then
          A255: (n div (b|^o1)) * b|^o1 = Sum d'1 by A254,NAT_D:3,A252;
          A256: dom d' = 1 + dom d'1 by A208,A233
          .= 1 + len d'1 by AFINSQ_1:def 1
          .= len <%D.o%> + len d'1 by AFINSQ_1:38;
          A257:
          now
            let k be Element of NAT;
            assume k in dom <%D.o%>; then
            k in 1 by AFINSQ_1:36; then
            k < 1 by PRGCOR_2:1; then
            A258: k=0 by NAT_1:14;
            oo > 0 by XREAL_1:52,A76; then
            k in dom d' by A258,A208,PRGCOR_2:1;
            hence d'.k=D.(k+o) by A208
            .= <%D.o%>.k by A258,AFINSQ_1:def 5;
          end;
          now
            let k be Element of NAT;
            assume A259: k in dom d'1; then
            k < oo1 by PRGCOR_2:1,A233; then
            k+1 < oo1+1 by XREAL_1:10; then
            A260: k+1 in dom d' by A208,PRGCOR_2:1;
            thus d'.(len <%D.o%> + k) = d'.(1 + k) by AFINSQ_1:37
            .= D.(len do+(k+1)) by A211,A208,A260
            .= D.(len do1 + k) by A211,A236
            .= d'1.k by A259,A236,A233;
          end; then
          d'=<%D.o%>^d'1 by A256,A257,AFINSQ_1:def 4; then
          Sum d' = Sum <%D.o%> + Sum d'1 by Th1; then
          D.o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A230,A255,STIRL2_1:44; then
          d.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A38,A73; then
          d.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * (b|^o*b|^1)
          by NEWTON:13; then
          d.o*b|^o = b|^o*((n div (b|^o)) - (n div (b|^o1)) * b|^1); then
          (b|^o*d.o)/b|^o = (b|^o*((n div (b|^o)) - (n div (b|^o1)) * b))/b|^o
          by NEWTON:10;
          then
          A261: d.o = (b|^o*((n div (b|^o)) - (n div (b|^o1)) * b))/b|^o
          by XCMPLX_1:90,A216;

          defpred P[Element of NAT,set] means $2=E.($1+o);

          A262: for u being Element of NAT st u in oo
          ex x be Element of NAT st P[u,x];

          consider d' being XFinSequence of NAT such that
          A263: dom d'=oo & for x being Element of NAT st x in oo holds
          P[x,d'.x] from STIRL2_1:sch 6(A262);
          reconsider do=E|o as XFinSequence of NAT by AFINSQ_1:16;

          A264: len d'=oo by A263,AFINSQ_1:def 1;
          A265: len e=dom E by AFINSQ_1:def 1,A45 .= len E by AFINSQ_1:def 1;
          then
          A266: len do=o by A71,A76,AFINSQ_1:14;
          A267: dom E = len do + len d' by A71,A264,A266,A45,AFINSQ_1:def 1;
          A268: for x being Element of NAT st x in dom do holds E.x=do.x
          by FUNCT_1:70;
          A269: for x being Element of NAT st x in dom d' holds E.(len do+x)=d'
.x
          by A266,A263;
          E=do^d' by A267,A268,A269,AFINSQ_1:def 4; then
          A270: n = Sum do + Sum d' by Th1,A45;
          reconsider bo=b|^o as Element of NAT by ORDINAL1:def 13;
          A271: bo <> 0 by PREPOWER:12,A1;

          consider ok being natural number such that
          A272: ok+1=o by NAT_1:6,A206;
          reconsider ok as Element of NAT by ORDINAL1:def 13;
          reconsider g=((b1)(#)(b GeoSeq))|(ok+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A273: dom g = o by RELAT_1:91,A272;
          A274: 1-b <> 0 by A1;
          A275: Sum g = Partial_Sums((b-1)(#)(b GeoSeq)).ok by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o))/(1-b))) by A272
          .= -(1 - (b |^ o)) by XCMPLX_1:88,A274
          .= b|^o-1;
          A276: len do>=0+1 by A266,A206,NAT_1:13;
          A277: len do = len g by A266,A273,AFINSQ_1:def 1;
          for i being natural number st i in dom do holds do.i <= g.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A278: i in dom do; then
            i in o by A265,A71,A76,AFINSQ_1:14; then
            A279: g.I = ((b-1)(#)(b GeoSeq)).I by A273,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A280: dom do c= dom E by RELAT_1:89; then
            e.i < b1+1 by A37,A278,A45; then
            A281: e.i <= b1 by NAT_1:13;
            do.i = E.i by FUNCT_1:70,A278
            .= (e.i)*(b|^i) by A45,A280,A278;
            hence do.i <= g.i by A279,A281,XREAL_1:66;
          end; then
          Sum do <= (b|^o)-1 by A275,Th4,A276,A277; then
          Sum do < b|^o -1 + 1 by XREAL_1:147; then
          A282: Sum do div (b|^o) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A283: k in dom d'; then
            k in len d' by AFINSQ_1:def 1; then
            k < len d' by PRGCOR_2:1; then
            o+k < dom E by A267,A266,XREAL_1:10; then
            o+k in dom E by PRGCOR_2:1; then
            E.(o+k) = e.(o+k)*b|^(o+k) by A45; then
            d'.K = e.(o+k)*b|^(o+k) by A283,A263
            .= e.(o+k)*(b|^o*b|^k) by NEWTON:13
            .= (e.(o+k)*(b|^k))*(b|^o);
            hence b|^o divides d'.k by NAT_D:def 3;
          end; then
          A284: b|^o divides Sum d' by Th5; then
          Sum d' mod (b|^o) = 0 by PEPIN:6,A271; then
          n div (b|^o) = (Sum d' div (b|^o)) + (Sum do div (b|^o))
          by A270,NAT_D:19; then
          A285: (n div (b|^o)) * b|^o = Sum d' by A284,NAT_D:3,A282;

          reconsider o1=o+1 as Element of NAT;
          o1 <= k & k < len d by XREAL_1:149,A206,NAT_1:13; then
          A286: o1 < len d by XXREAL_0:2; then
          reconsider oo1=len d - o1 as Element of NAT by NAT_1:21;

          defpred P[Element of NAT,set] means $2=E.($1+o1);

          A287: for u being Element of NAT st u in oo1
          ex x be Element of NAT st P[u,x];

          consider d'1 being XFinSequence of NAT such that
          A288: dom d'1=oo1 & for x being Element of NAT st x in oo1 holds
          P[x,d'1.x] from STIRL2_1:sch 6(A287);
          reconsider do1=E|o1 as XFinSequence of NAT by AFINSQ_1:16;

          A289: len d'1=oo1 by A288,AFINSQ_1:def 1;
          A290: len e=dom E by AFINSQ_1:def 1,A45 .= len E by AFINSQ_1:def 1;
          then
          A291: len do1=o1 by A71,A286,AFINSQ_1:14;
          A292: dom E = len do1 + len d'1 by A71,A289,A291,A45,AFINSQ_1:def 1;
          A293: for x being Element of NAT st x in dom do1 holds E.x=do1.x
          by FUNCT_1:70;
          A294: for x being Element of NAT st x in dom d'1 holds
          E.(len do1+x)=d'1.x by A291,A288;
          E=do1^d'1 by A292,A293,A294,AFINSQ_1:def 4; then
          A295: n = Sum do1 + Sum d'1 by Th1,A45;
          reconsider bo1=b|^o1 as Element of NAT by ORDINAL1:def 13;
          A296: bo1 <> 0 by PREPOWER:12,A1;

          consider ok1 being natural number such that
          A297: ok1+1=o1;
          reconsider ok1 as Element of NAT by ORDINAL1:def 13;
          reconsider g1=((b1)(#)(b GeoSeq))|(ok1+1) as XFinSequence of NAT
          by Th3;
          dom ((b-1)(#)(b GeoSeq)) = NAT by FUNCT_2:def 1; then
          o1 c= dom ((b-1)(#)(b GeoSeq)) by ORDINAL1:def 2; then
          A298: dom g1 = o1 by RELAT_1:91,A297;
          A299: 1-b <> 0 by A1;
          A300: Sum g1 = Partial_Sums((b-1)(#)(b GeoSeq)).ok1 by Th2
          .= ((b-1)(#)Partial_Sums(b GeoSeq)).ok1 by SERIES_1:12
          .= (b-1)*(Partial_Sums(b GeoSeq).ok1) by SEQ_1:13
          .= (b-1)*((1 - (b to_power (ok1+1)))/(1-b)) by SERIES_1:26,A1
          .= (b-1)*((1 - (b |^ (ok1+1)))/(1-b)) by POWER:46,A1
          .= -((1-b)*((1 - (b |^ o1))/(1-b))) by A297
          .= -(1 - (b |^ o1)) by XCMPLX_1:88,A299
          .= b|^o1-1;
          A301: len do1>=0+1 by A291,NAT_1:13;
          A302: len do1 = len g1 by A291,A298,AFINSQ_1:def 1;
          for i being natural number st i in dom do1 holds do1.i <= g1.i
          proof
            let i be natural number;
            reconsider I=i as Element of NAT by ORDINAL1:def 13;
            assume A303: i in dom do1; then
            i in o1 by A290,A71,A286,AFINSQ_1:14; then
            A304: g1.I = ((b-1)(#)(b GeoSeq)).I by A298,FUNCT_1:68
            .= (b-1)*((b GeoSeq).I) by SEQ_1:13
            .= b1*(b|^I) by PREPOWER:def 1;
            A305: dom do1 c= dom E by RELAT_1:89; then
            e.i < b1+1 by A37,A303,A45; then
            A306: e.i <= b1 by NAT_1:13;
            do1.i = E.i by FUNCT_1:70,A303
            .= (e.i)*(b|^i) by A45,A305,A303;
            hence do1.i <= g1.i by A304,A306,XREAL_1:66;
          end; then
          Sum do1 <= (b|^o1)-1 by A300,Th4,A301,A302; then
          Sum do1 < b|^o1 -1 + 1 by XREAL_1:147; then
          A307: Sum do1 div (b|^o1) = 0 by NAT_D:27;
          now
            let k be natural number;
            reconsider K=k as Element of NAT by ORDINAL1:def 13;
            assume A308: k in dom d'1; then
            k in len d'1 by AFINSQ_1:def 1; then
            k < len d'1 by PRGCOR_2:1; then
            o1+k < dom E by A292,A291,XREAL_1:10; then
            o1+k in dom E by PRGCOR_2:1; then
            E.(o1+k) = e.(o1+k)*b|^(o1+k) by A45; then
            d'1.K = e.(o1+k)*b|^(o1+k) by A308,A288
            .= e.(o1+k)*(b|^o1*b|^k) by NEWTON:13
            .= (e.(o1+k)*(b|^k))*(b|^o1);
            hence b|^o1 divides d'1.k by NAT_D:def 3;
          end; then
          A309: b|^o1 divides Sum d'1 by Th5; then
          Sum d'1 mod (b|^o1) = 0 by PEPIN:6,A296; then
          n div (b|^o1) = (Sum d'1 div (b|^o1)) + (Sum do1 div (b|^o1))
          by A295,NAT_D:19; then
          A310: (n div (b|^o1)) * b|^o1 = Sum d'1 by A309,NAT_D:3,A307;

          o in len e by A71,AFINSQ_1:def 1,A73; then
          A311: o in dom E by A45,AFINSQ_1:def 1;

          A312: dom d' = 1 + dom d'1 by A263,A288
          .= 1 + len d'1 by AFINSQ_1:def 1
          .= len <%E.o%> + len d'1 by AFINSQ_1:38;
          A313:
          now
            let k be Element of NAT;
            assume k in dom <%E.o%>; then
            k in 1 by AFINSQ_1:36; then
            k < 1 by PRGCOR_2:1; then
            A314: k=0 by NAT_1:14;
            oo > 0 by XREAL_1:52,A76; then
            k in dom d' by A314,A263,PRGCOR_2:1;
            hence d'.k=E.(k+o) by A263
            .= <%E.o%>.k by A314,AFINSQ_1:def 5;
          end;
          now
            let k be Element of NAT;
            assume A315: k in dom d'1; then
            k < oo1 by PRGCOR_2:1,A288; then
            k+1 < oo1+1 by XREAL_1:10; then
            A316: k+1 in oo by PRGCOR_2:1;
            thus d'.(len <%E.o%> + k) = d'.(1 + k) by AFINSQ_1:37
            .= E.(len do+(k+1)) by A316,A266,A263
            .= E.(len do1 + k) by A266,A291
            .= d'1.k by A315,A291,A288;
          end; then
          d'=<%E.o%>^d'1 by A312,A313,AFINSQ_1:def 4; then
          Sum d' = Sum <%E.o%> + Sum d'1 by Th1; then
          E.o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A285,A310,STIRL2_1:44;
          then
          e.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * b|^o1
          by A45,A311; then
          e.o*b|^o = (n div (b|^o)) * b|^o - (n div (b|^o1)) * (b|^o*b|^1)
          by NEWTON:13; then
          e.o*b|^o = b|^o*((n div (b|^o)) - (n div (b|^o1)) * b|^1); then
          (b|^o*e.o)/b|^o = (b|^o*((n div (b|^o)) -
          (n div (b|^o1)) * b))/b|^o by NEWTON:10;
          hence d.a=e.a by A261,XCMPLX_1:90,A271;
        end;
      end;

      hence d=e by FUNCT_1:9,A72;
    end;
    assume n=0 & d=<%0%> & e=<%0%>;
    hence thesis;
  end;
end;

theorem Th7:
  for n,b being natural number st b > 1 holds
  len digits(n,b) >= 1
  proof
    let n,b be natural number;
    assume A1: b > 1;
    per cases;
    suppose n=0;
      then digits(n,b)=<%0%> by A1,Def2;
      hence len digits(n,b) >= 1 by AFINSQ_1:37;
    end;
    suppose n<>0;
      then digits(n,b).(len digits(n,b) -1) <> 0 by A1,Def2; then
      len digits(n,b) -1 in dom digits(n,b) by FUNCT_1:def 4; then
      len digits(n,b) <> 0 by AFINSQ_1:def 1;
      hence len digits(n,b) >= 1 by NAT_1:14;
    end;
  end;

theorem Th8:
  for n,b being natural number st b > 1 holds
  value(digits(n,b),b)=n
  proof
    let n,b be natural number;
    assume A1: b>1;
    per cases;
    suppose n<>0;
      hence thesis by Def2,A1;
    end;
    suppose A2: n=0; then
      A3: digits(n,b)= <%0%> by Def2,A1;
      now
        let i be natural number;
        assume i in dom <%0%>; then
        i in {0} by CARD_5:1,AFINSQ_1:def 5; then
        A4: i=0 by TARSKI:def 1;
        hence <%0%>.i = 0*(b|^i) by AFINSQ_1:def 5
        .= (digits(n,b).i)*(b|^i) by A4,A3,AFINSQ_1:def 5;
      end; then
      A5: value(digits(n,b),b)=Sum <%0%> by Def1,A3;
      now
        let i be Element of NAT;
        assume i in dom <%0%>; then
        i in {0} by CARD_5:1,AFINSQ_1:def 5; then
        i=0 by TARSKI:def 1;
        hence <%0%>.i=0 by AFINSQ_1:def 5;
      end;
      hence thesis by STIRL2_1:53,A2,A5;
    end;
  end;

begin :: Selected divisibility criteria

theorem Th9:
  for n,k being natural number st k=10|^n - 1 holds 9 divides k
  proof
    let n,k be natural number;
    assume A1: k=10|^n - 1;

    defpred P[natural number] means
    ex k being natural number st k=(10|^$1)-1 & 9 divides k;

    A2: (10|^0) -1 = 1-1 by NEWTON:9 .= 0;
    9 divides 0 by NAT_D:6; then
    A3: P[0] by A2;
    A4:
    now
      let k be natural number;
      assume P[k]; then
      consider l being natural number such that
      A5: l=(10|^k)-1 & 9 divides l;
      consider m being natural number such that
      A6: l = 9 * m by NAT_D:def 3,A5;
      A7: 10|^(k+1)-1 = (9*m+1)*10 -1 by NEWTON:11,A6,A5
      .= 9*(m*10+1);
      9 divides 9*(m*10+1) by NAT_D:def 3;
      hence P[k+1] by A7;
    end;
    for k being natural number holds P[k] from NAT_1:sch 2(A3,A4);
    then consider l being natural number such that
    A8: l=10|^n -1 & 9 divides l;
    thus 9 divides k by A1,A8;
  end;

theorem
  for n,b being natural number st b>1 holds
  b divides n iff digits(n,b).0 = 0
  proof
    let n,b be natural number;
    reconsider B=b as Element of NAT by ORDINAL1:def 13;
    assume A1: b>1;
    thus b divides n implies digits(n,b).0 = 0
    proof
      assume A2: b divides n;
      consider d being XFinSequence of NAT such that
      A3: (dom d = dom digits(n,b) &
      for i being natural number st i in dom d holds
      d.i = (digits(n,b).i)*(b|^i)) & value(digits(n,b),b) = Sum d by Def1;
      A4: len digits(n,b)>=1 by Th7,A1;
      per cases by A4,XXREAL_0:1;
      suppose A5: len digits(n,b)=1; then
        dom digits(n,b)=1 by AFINSQ_1:def 1; then
        A6: 0 in dom digits(n,b) by PRGCOR_2:1;
        len d = dom digits(n,b) by AFINSQ_1:def 1,A3
        .= 1 by A5,AFINSQ_1:def 1; then
        d=<%d.0%> by AFINSQ_1:38; then
        A7: Sum d = d.0 by STIRL2_1:44
        .= digits(n,b).0*(b|^0) by A3,A6;
        b divides Sum d by A3,Th8,A2,A1; then
        A8: b divides digits(n,b).0*1 by A7,NEWTON:9;
        per cases;
        suppose n=0; then
          digits(n,b) = <%0%> by A1,Def2;
          hence digits(n,b).0 = 0 by AFINSQ_1:38;
        end;
        suppose n<>0; then
          digits(n,b).0 < b by A1,A6,Def2;
          then digits(n,b).0 <= 0 by NAT_D:7,A8;
          hence digits(n,b).0 = 0;
        end;
      end;
      suppose A9: len digits(n,b)>1; then
        reconsider k=len digits(n,b)-1 as Element of NAT by NAT_1:21;
        dom digits(n,b)>1 by A9,AFINSQ_1:def 1; then
        A10: 0 in dom digits(n,b) by PRGCOR_2:1;

        defpred P[Element of NAT,set] means $2=d.($1+1);

        A11: for u being Element of NAT st u in k
        ex x be Element of NAT st P[u,x];

        consider d' being XFinSequence of NAT such that
        A12: dom d'=k & for x being Element of NAT st x in k holds P[x,d'.x]
        from STIRL2_1:sch 6(A11);

        now
          let i be natural number;
          assume A13: i in dom d'; then
          i < k by PRGCOR_2:1,A12; then
          i+1 < k+1 by XREAL_1:10; then
          i+1 < dom d by A3,AFINSQ_1:def 1; then
          A14: i+1 in dom d by PRGCOR_2:1;
          d'.i=d.(i+1) by A12,A13
          .= digits(n,b).(i+1)*b|^(i+1) by A3,A14
          .= digits(n,b).(i+1)*(b|^i*b) by NEWTON:11
          .= b*(digits(n,b).(i+1)*b|^i);
          hence b divides d'.i by NAT_D:def 3;
        end; then
        b divides Sum d' by Th5; then
        A15: Sum d' mod B = 0 by A1,PEPIN:6;
        A16: dom d = k+1 by A3,AFINSQ_1:def 1
        .= 1 + len d' by AFINSQ_1:def 1,A12
        .= len <%d.0%> + len d' by AFINSQ_1:37;
        A17:
        now
          let l be Element of NAT;
          assume l in dom <%d.0%>; then
          l in 1 by AFINSQ_1:def 5; then
          l < 1 by PRGCOR_2:1; then
          l=0 by NAT_1:14;
          hence d.l=<%d.0%>.l by AFINSQ_1:38;
        end;
        now
          let l be Element of NAT;
          assume A18: l in dom d';
          len <%d.0%> + l = l+1 by AFINSQ_1:38;
          hence d.(len <%d.0%> + l) = d'.l by A18,A12;
        end; then
        d=<%d.0%>^d' by A16,A17,AFINSQ_1:def 4; then
        Sum d = Sum <%d.0%> + Sum d' by Th1; then
        n = Sum <%d.0%> + Sum d' by A1,Th8,A3; then
        n = d.0 + Sum d' by STIRL2_1:44; then
        (d.0 + Sum d') mod B = 0 by A1,A2,PEPIN:6; then
        d.0 mod b = 0 by A15,NAT_D:17; then
        B divides d.0 by A1,PEPIN:6; then
        b divides digits(n,b).0*(b|^0) by A3,A10; then
        A19: b divides digits(n,b).0*1 by NEWTON:9;
        per cases;
        suppose n=0; then
          digits(n,b) = <%0%> by A1,Def2;
          hence digits(n,b).0 = 0 by AFINSQ_1:38;
        end;
        suppose n<>0; then
          digits(n,b).0 < b by A1,A10,Def2;
          then digits(n,b).0 <= 0 by NAT_D:7,A19;
          hence digits(n,b).0 = 0;
        end;
      end;
    end;
    assume A20: digits(n,b).0=0;
    consider d being XFinSequence of NAT such that
    A21: (dom d = dom digits(n,b) &
    for i being natural number st i in dom d holds
    d.i = (digits(n,b).i)*(b|^i)) & value(digits(n,b),b) = Sum d by Def1;
    now
      let i be natural number;
      assume A22: i in dom d;
      per cases;
      suppose i=0; then
        d.i = (digits(n,b).0)*b|^0 by A21,A22
        .= digits(n,b).0*1 by NEWTON:9;
        hence b divides d.i by A20,NAT_D:6;
      end;
      suppose i>0; then
        consider j being natural number such that
        A23: j+1=i by NAT_1:6;
        d.i = digits(n,b).i*(b|^(j+1)) by A22,A23,A21
        .= digits(n,b).i*((b|^j)*b) by NEWTON:11
        .= b*(digits(n,b).i*(b|^j));
        hence b divides d.i by NAT_D:def 3;
      end;
    end; then
    b divides value(digits(n,b),b) by A21,Th5;
    hence b divides n by Th8,A1;
  end;

theorem
  for n being natural number holds
  2 divides n iff 2 divides digits(n,10).0
  proof
    let n be natural number;
    thus 2 divides n implies 2 divides digits(n,10).0
    proof
      assume A1: 2 divides n;
      consider d being XFinSequence of NAT such that
      A2: (dom d = dom digits(n,10) &
      for i being natural number st i in dom d holds
      d.i = (digits(n,10).i)*(10|^i)) & value(digits(n,10),10) = Sum d by Def1;
      A3: len digits(n,10)>=1 by Th7;
      per cases by A3,XXREAL_0:1;
      suppose A4: len digits(n,10)=1; then
        dom digits(n,10)=1 by AFINSQ_1:def 1; then
        A5: 0 in dom digits(n,10) by PRGCOR_2:1;
        len d = dom digits(n,10) by AFINSQ_1:def 1,A2
        .= 1 by A4,AFINSQ_1:def 1; then
        d=<%d.0%> by AFINSQ_1:38; then
        A6: Sum d = d.0 by STIRL2_1:44
        .= digits(n,10).0*(10|^0) by A2,A5;
        2 divides Sum d by A2,Th8,A1; then
        2 divides digits(n,10).0*1 by A6,NEWTON:9;
        hence 2 divides digits(n,10).0;
      end;
      suppose A7: len digits(n,10)>1; then
        reconsider k=len digits(n,10)-1 as Element of NAT by NAT_1:21;
        dom digits(n,10)>1 by A7,AFINSQ_1:def 1; then
        A8: 0 in dom digits(n,10) by PRGCOR_2:1;

        defpred P[Element of NAT,set] means $2=d.($1+1);

        A9: for u being Element of NAT st u in k
        ex x be Element of NAT st P[u,x];

        consider d' being XFinSequence of NAT such that
        A10: dom d'=k & for x being Element of NAT st x in k holds P[x,d'.x]
        from STIRL2_1:sch 6(A9);

        now
          let i be natural number;
          assume A11: i in dom d'; then
          i < k by PRGCOR_2:1,A10; then
          i+1 < k+1 by XREAL_1:10; then
          i+1 < dom d by A2,AFINSQ_1:def 1; then
          A12: i+1 in dom d by PRGCOR_2:1;
          d'.i=d.(i+1) by A10,A11
          .= digits(n,10).(i+1)*10|^(i+1) by A2,A12
          .= digits(n,10).(i+1)*(10|^i*10) by NEWTON:11
          .= 2*(digits(n,10).(i+1)*10|^i*5);
          hence 2 divides d'.i by NAT_D:def 3;
        end; then
        2 divides Sum d' by Th5; then
        A13: Sum d' mod 2 = 0 by PEPIN:6;
        A14: dom d = k+1 by A2,AFINSQ_1:def 1
        .= 1 + len d' by AFINSQ_1:def 1,A10
        .= len <%d.0%> + len d' by AFINSQ_1:37;
        A15:
        now
          let l be Element of NAT;
          assume l in dom <%d.0%>; then
          l in 1 by AFINSQ_1:def 5; then
          l < 1 by PRGCOR_2:1; then
          l=0 by NAT_1:14;
          hence d.l=<%d.0%>.l by AFINSQ_1:38;
        end;
        now
          let l be Element of NAT;
          assume A16: l in dom d';
          len <%d.0%> + l = l+1 by AFINSQ_1:38;
          hence d.(len <%d.0%> + l) = d'.l by A16,A10;
        end; then
        d=<%d.0%>^d' by A14,A15,AFINSQ_1:def 4; then
        Sum d = Sum <%d.0%> + Sum d' by Th1; then
        n = Sum <%d.0%> + Sum d' by Th8,A2; then
        n = d.0 + Sum d' by STIRL2_1:44; then
        (d.0 + Sum d') mod 2 = 0 by A1,PEPIN:6; then
        d.0 mod 2 = 0 by A13,NAT_D:17; then
        2 divides d.0 by PEPIN:6; then
        2 divides digits(n,10).0*(10|^0) by A2,A8; then
        2 divides digits(n,10).0*1 by NEWTON:9;
        hence 2 divides digits(n,10).0;
      end;
    end;
    assume A17: 2 divides digits(n,10).0;
    consider d being XFinSequence of NAT such that
    A18: (dom d = dom digits(n,10) &
    for i being natural number st i in dom d holds
    d.i = (digits(n,10).i)*(10|^i)) & value(digits(n,10),10) = Sum d by Def1;
    now
      let i be natural number;
      assume A19: i in dom d;
      per cases;
      suppose i=0; then
        d.i = (digits(n,10).0)*10|^0 by A18,A19
        .= digits(n,10).0*1 by NEWTON:9;
        hence 2 divides d.i by A17;
      end;
      suppose i>0; then
        consider j being natural number such that
        A20: j+1=i by NAT_1:6;
        d.i = digits(n,10).i*(10|^(j+1)) by A19,A20,A18
        .= digits(n,10).i*((10|^j)*10) by NEWTON:11
        .= 2*(digits(n,10).i*(10|^j)*5);
        hence 2 divides d.i by NAT_D:def 3;
      end;
    end; then
    2 divides value(digits(n,10),10) by A18,Th5;
    hence 2 divides n by Th8;
  end;

theorem
  for n being natural number holds
  3 divides n iff 3 divides Sum digits(n,10)
  proof
    let n be natural number;
      consider p being XFinSequence of NAT such that
      A1: (dom p = dom digits(n,10) &
      for i being natural number st i in dom p holds
      p.i = (digits(n,10).i)*(10|^i)) & value(digits(n,10),10) = Sum p by Def1;

      defpred Q[set,set] means $2=p.$1 mod 3;
      reconsider dop=dom p as Element of NAT by ORDINAL1:def 13;

      A2: for k being Element of NAT st k in dop
      ex x being Element of NAT st Q[k,x];

      consider p' being XFinSequence of NAT such that
      A3: dom p' = dop &
      for k being Element of NAT st k in dop holds Q[k,p'.k]
      from STIRL2_1:sch 6(A2);
      A4: for i being natural number st i in dom p holds
      p'.i = p.i mod 3 by A3;
      A5:
      now
        let i be natural number;
        10|^i > 0 by NEWTON:102; then
        reconsider dz=10|^i - 1 as natural number by NAT_1:20;
        reconsider dz as Element of NAT by ORDINAL1:def 13;
        3 divides 3*3 & 9 divides dz by Th9,NAT_D:def 3; then
        3 divides dz by NAT_D:4; then
        3 divides (digits(n,10).i)*dz by NAT_D:9; then
        A6: (digits(n,10).i)*dz mod 3 = 0 by PEPIN:6;
        assume A7: i in dom p;
        hence p'.i = p.i mod 3 by A3
        .= (digits(n,10).i)*(dz+1) mod 3 by A1,A7
        .= ((digits(n,10).i)*dz+ digits(n,10).i) mod 3
        .= (0+digits(n,10).i) mod 3 by A6,NAT_D:22
        .= digits(n,10).i mod 3;
      end;
    thus 3 divides n implies 3 divides Sum digits(n,10)
    proof
      assume 3 divides n; then
      3 divides Sum p by Th8,A1; then
      Sum p mod 3 = 0 by PEPIN:6; then
      Sum p' mod 3 = 0 by Th6,A3,A4; then
      Sum digits(n,10) mod 3 = 0 by Th6,A5,A1,A3;
      hence 3 divides Sum digits(n,10) by PEPIN:6;
    end;
    assume 3 divides Sum digits(n,10); then
    Sum digits(n,10) mod 3 = 0 by PEPIN:6; then
    Sum p' mod 3 = 0 by Th6,A5,A1,A3; then
    Sum p mod 3 = 0 by Th6,A3,A4; then
    3 divides Sum p by PEPIN:6;
    hence 3 divides n by Th8,A1;
  end;

theorem
  for n being natural number holds
  5 divides n iff 5 divides digits(n,10).0
  proof
    let n be natural number;
    thus 5 divides n implies 5 divides digits(n,10).0
    proof
      assume A1: 5 divides n;
      consider d being XFinSequence of NAT such that
      A2: (dom d = dom digits(n,10) &
      for i being natural number st i in dom d holds
      d.i = (digits(n,10).i)*(10|^i)) & value(digits(n,10),10) = Sum d by Def1;
      A3: len digits(n,10)>=1 by Th7;
      per cases by A3,XXREAL_0:1;
      suppose A4: len digits(n,10)=1; then
        dom digits(n,10)=1 by AFINSQ_1:def 1; then
        A5: 0 in dom digits(n,10) by PRGCOR_2:1;
        len d = dom digits(n,10) by AFINSQ_1:def 1,A2
        .= 1 by A4,AFINSQ_1:def 1; then
        d=<%d.0%> by AFINSQ_1:38; then
        A6: Sum d = d.0 by STIRL2_1:44
        .= digits(n,10).0*(10|^0) by A2,A5;
        5 divides Sum d by A2,Th8,A1; then
        5 divides digits(n,10).0*1 by A6,NEWTON:9;
        hence 5 divides digits(n,10).0;
      end;
      suppose A7: len digits(n,10)>1; then
        reconsider k=len digits(n,10)-1 as Element of NAT by NAT_1:21;
        dom digits(n,10)>1 by A7,AFINSQ_1:def 1; then
        A8: 0 in dom digits(n,10) by PRGCOR_2:1;

        defpred P[Element of NAT,set] means $2=d.($1+1);

        A9: for u being Element of NAT st u in k
        ex x be Element of NAT st P[u,x];

        consider d' being XFinSequence of NAT such that
        A10: dom d'=k & for x being Element of NAT st x in k holds P[x,d'.x]
        from STIRL2_1:sch 6(A9);

        now
          let i be natural number;
          assume A11: i in dom d'; then
          i < k by PRGCOR_2:1,A10; then
          i+1 < k+1 by XREAL_1:10; then
          i+1 < dom d by A2,AFINSQ_1:def 1; then
          A12: i+1 in dom d by PRGCOR_2:1;
          d'.i=d.(i+1) by A10,A11
          .= digits(n,10).(i+1)*10|^(i+1) by A2,A12
          .= digits(n,10).(i+1)*(10|^i*10) by NEWTON:11
          .= 5*(digits(n,10).(i+1)*10|^i*2);
          hence 5 divides d'.i by NAT_D:def 3;
        end; then
        5 divides Sum d' by Th5; then
        A13: Sum d' mod 5 = 0 by PEPIN:6;
        A14: dom d = k+1 by A2,AFINSQ_1:def 1
        .= 1 + len d' by AFINSQ_1:def 1,A10
        .= len <%d.0%> + len d' by AFINSQ_1:37;
        A15:
        now
          let l be Element of NAT;
          assume l in dom <%d.0%>; then
          l in 1 by AFINSQ_1:def 5; then
          l < 1 by PRGCOR_2:1; then
          l=0 by NAT_1:14;
          hence d.l=<%d.0%>.l by AFINSQ_1:38;
        end;
        now
          let l be Element of NAT;
          assume A16: l in dom d';
          len <%d.0%> + l = l+1 by AFINSQ_1:38;
          hence d.(len <%d.0%> + l) = d'.l by A16,A10;
        end; then
        d=<%d.0%>^d' by A14,A15,AFINSQ_1:def 4; then
        Sum d = Sum <%d.0%> + Sum d' by Th1; then
        n = Sum <%d.0%> + Sum d' by Th8,A2; then
        n = d.0 + Sum d' by STIRL2_1:44; then
        (d.0 + Sum d') mod 5 = 0 by A1,PEPIN:6; then
        d.0 mod 5 = 0 by A13,NAT_D:17; then
        5 divides d.0 by PEPIN:6; then
        5 divides digits(n,10).0*(10|^0) by A2,A8; then
        5 divides digits(n,10).0*1 by NEWTON:9;
        hence 5 divides digits(n,10).0;
      end;
    end;
    assume A17: 5 divides digits(n,10).0;
    consider d being XFinSequence of NAT such that
    A18: (dom d = dom digits(n,10) &
    for i being natural number st i in dom d holds
    d.i = (digits(n,10).i)*(10|^i)) & value(digits(n,10),10) = Sum d by Def1;
    now
      let i be natural number;
      assume A19: i in dom d;
      per cases;
      suppose i=0; then
        d.i = (digits(n,10).0)*10|^0 by A18,A19
        .= digits(n,10).0*1 by NEWTON:9;
        hence 5 divides d.i by A17;
      end;
      suppose i>0; then
        consider j being natural number such that
        A20: j+1=i by NAT_1:6;
        d.i = digits(n,10).i*(10|^(j+1)) by A19,A20,A18
        .= digits(n,10).i*((10|^j)*10) by NEWTON:11
        .= 5*(digits(n,10).i*(10|^j)*2);
        hence 5 divides d.i by NAT_D:def 3;
      end;
    end; then
    5 divides value(digits(n,10),10) by A18,Th5;
    hence 5 divides n by Th8;
  end;
  
